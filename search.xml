<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>GDB å…¨æŒ‡ä»¤é€ŸæŸ¥å¤§å…¨ï¼ˆfor Linux x86_64 C/C++ demo_multithreadï¼‰</title>
    <url>/gdb%E5%85%A8%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5%E5%A4%A7%E5%85%A8/</url>
    <content><![CDATA[<p>âœ… <strong>Cheat Sheet å®Œæ•´è¦†ç›–ç»å¤§éƒ¨åˆ† GDB å®æ“è¯­æ³•ã€è¡¨è¾¾å¼ã€æ–­ç‚¹&#x2F;å˜é‡&#x2F;è¿›ç¨‹&#x2F;çº¿ç¨‹&#x2F;å†…å­˜  æ“ä½œç­‰ï¼Œè¶³å¤Ÿä½œä¸ºæ—¥å¸¸ Linux x86_64 C&#x2F;C++ è°ƒè¯•çš„å…¨åŠŸèƒ½æ¸…å•ä¸é€ŸæŸ¥è¡¨ã€‚</strong></p>
<span id="more"></span>

<hr>
<h2 id="ğŸ“˜-ç›®å½•"><a href="#ğŸ“˜-ç›®å½•" class="headerlink" title="ğŸ“˜ ç›®å½•"></a>ğŸ“˜ ç›®å½•</h2><ol>
<li>åŸºæœ¬å¯åŠ¨ä¸é€€å‡º  </li>
<li>è¿è¡Œæ§åˆ¶ä¸è¿›ç¨‹ç®¡ç†  </li>
<li>æ–­ç‚¹ç§ç±»ä¸é«˜çº§æ–­ç‚¹  </li>
<li>å•æ­¥ä¸ç»§ç»­æ‰§è¡Œ  </li>
<li>çº¿ç¨‹ä¸è¿›ç¨‹è°ƒè¯•  </li>
<li>å˜é‡ä¸è¡¨è¾¾å¼  </li>
<li>å†…å­˜è¯»å†™ä¸å †æ ˆçª¥æ¢  </li>
<li>å¯„å­˜å™¨ä¸ä¸Šä¸‹æ–‡  </li>
<li>æ±‡ç¼–ä¸åæ±‡ç¼–  </li>
<li>watchpoint &#x2F; ç¡¬ä»¶æ–­ç‚¹  </li>
<li>å‡½æ•°ä¸è°ƒç”¨æ ˆ  </li>
<li>æ—¥å¿—è¾“å‡ºä¸æ ¼å¼åŒ–æ‰“å°  </li>
<li>è„šæœ¬åŒ–ä¸å‘½ä»¤åˆ«å  </li>
<li>TUI äº¤äº’æ¨¡å¼  </li>
<li>è¿œç¨‹è°ƒè¯•ä¸ gdbserver  </li>
<li>core dump åˆ†æ  </li>
<li>GDB Python ç®€å•ç¤ºä¾‹  </li>
<li>å¸¸ç”¨ alias ä¸ å¿«æ·ç»„åˆ  </li>
<li>é«˜å±å‘½ä»¤å°å¿ƒæ¸…å•  </li>
<li>å­¦ä¹ ä¸å¿ƒæ³•é™„æ³¨</li>
</ol>
<p>æ¯æ¡æŒ‡ä»¤ï¼š<br><code>è¯­æ³•</code> + <code>ç¤ºä¾‹</code> + <code>è¯´æ˜</code> + <code>åœé¡¿/é£é™©</code>ã€‚</p>
<hr>
<h2 id="ä¸€ã€å¯åŠ¨ä¸é€€å‡º"><a href="#ä¸€ã€å¯åŠ¨ä¸é€€å‡º" class="headerlink" title="ä¸€ã€å¯åŠ¨ä¸é€€å‡º"></a>ä¸€ã€å¯åŠ¨ä¸é€€å‡º</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
<th>åœé¡¿é£é™©</th>
</tr>
</thead>
<tbody><tr>
<td><code>gdb &lt;prog&gt;</code></td>
<td><code>gdb ./demo_multithread</code></td>
<td>å¯åŠ¨è°ƒè¯•</td>
<td>æ— </td>
</tr>
<tr>
<td><code>gdb --args &lt;prog&gt; &lt;arg...&gt;</code></td>
<td><code>gdb --args ./demo_multithread -t 4</code></td>
<td>å¯å¸¦å‚æ•°å¯åŠ¨</td>
<td>æ— </td>
</tr>
<tr>
<td><code>attach &lt;pid&gt;</code></td>
<td><code>attach 12345</code></td>
<td>é™„åŠ åˆ°å·²è¿è¡Œè¿›ç¨‹</td>
<td>ä¸­</td>
</tr>
<tr>
<td><code>detach</code></td>
<td>â€”</td>
<td>ä»è¿›ç¨‹åˆ†ç¦»</td>
<td>æ— </td>
</tr>
<tr>
<td><code>quit</code></td>
<td>â€”</td>
<td>é€€å‡º GDB</td>
<td>æ— </td>
</tr>
</tbody></table>
<hr>
<h2 id="äºŒã€è¿è¡Œæ§åˆ¶ä¸è¿›ç¨‹ç®¡ç†"><a href="#äºŒã€è¿è¡Œæ§åˆ¶ä¸è¿›ç¨‹ç®¡ç†" class="headerlink" title="äºŒã€è¿è¡Œæ§åˆ¶ä¸è¿›ç¨‹ç®¡ç†"></a>äºŒã€è¿è¡Œæ§åˆ¶ä¸è¿›ç¨‹ç®¡ç†</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>run [args]</code></td>
<td><code>run 10 foo.txt</code></td>
<td>å¯åŠ¨ç¨‹åº</td>
</tr>
<tr>
<td><code>start</code></td>
<td>â€”</td>
<td>å¯åŠ¨å¹¶åœ¨ main å‰æš‚åœ</td>
</tr>
<tr>
<td><code>continue</code> &#x2F; <code>c</code></td>
<td>â€”</td>
<td>ç»§ç»­è¿è¡Œ</td>
</tr>
<tr>
<td><code>kill</code></td>
<td>â€”</td>
<td>åœæ­¢è¢«è°ƒè¯•è¿›ç¨‹</td>
</tr>
<tr>
<td><code>signal &lt;sig&gt;</code></td>
<td><code>signal SIGUSR1</code></td>
<td>å‘ç¨‹åºå‘é€ä¿¡å·</td>
</tr>
<tr>
<td><code>set args</code></td>
<td><code>set args input1 input2</code></td>
<td>è®¾ç½®è¿è¡Œå‚æ•°</td>
</tr>
<tr>
<td><code>show args</code></td>
<td>â€”</td>
<td>æŸ¥çœ‹å‚æ•°</td>
</tr>
<tr>
<td>&#96;set follow-fork-mode [child</td>
<td>parent]&#96;</td>
<td><code>set follow-fork-mode child</code></td>
</tr>
<tr>
<td><code>catch fork/vfork/exec/catch throw/catch catch</code></td>
<td>â€”</td>
<td>æ•è·äº‹ä»¶</td>
</tr>
<tr>
<td><code>info inferiors</code></td>
<td>â€”</td>
<td>å¤šè¿›ç¨‹ï¼ˆinferiorï¼‰ä¿¡æ¯</td>
</tr>
<tr>
<td><code>inferior N</code></td>
<td><code>inferior 2</code></td>
<td>åˆ‡æ¢åˆ°ç¬¬ N ä¸ªè¿›ç¨‹</td>
</tr>
</tbody></table>
<hr>
<h2 id="ä¸‰ã€æ–­ç‚¹ç³»ç»Ÿè¯¦è§£"><a href="#ä¸‰ã€æ–­ç‚¹ç³»ç»Ÿè¯¦è§£" class="headerlink" title="ä¸‰ã€æ–­ç‚¹ç³»ç»Ÿè¯¦è§£"></a>ä¸‰ã€æ–­ç‚¹ç³»ç»Ÿè¯¦è§£</h2><table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è¯­æ³•</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>æ–‡ä»¶è¡Œ</td>
<td><code>break file:line</code></td>
<td><code>break main.cpp:42</code></td>
<td>ä»£ç è¡Œæ–­ç‚¹</td>
</tr>
<tr>
<td>å‡½æ•°</td>
<td><code>break &lt;func&gt;</code></td>
<td><code>break worker_thread</code></td>
<td>å‡½æ•°å…¥å£</td>
</tr>
<tr>
<td>åœ°å€</td>
<td><code>break *addr</code></td>
<td><code>break *0x401000</code></td>
<td>æŒ‡ä»¤åœ°å€</td>
</tr>
<tr>
<td>ä¸´æ—¶</td>
<td><code>tbreak</code></td>
<td><code>tbreak foo</code></td>
<td>ä¸€æ¬¡æ€§æ–­ç‚¹</td>
</tr>
<tr>
<td>æ¡ä»¶</td>
<td><code>break &lt;func&gt; if &lt;expr&gt;</code></td>
<td><code>break update if count&gt;100</code></td>
<td>æ¡ä»¶å‘½ä¸­</td>
</tr>
<tr>
<td>å¿½ç•¥æ¬¡æ•°</td>
<td><code>ignore &lt;bp_no&gt; &lt;N&gt;</code></td>
<td><code>ignore 1 5</code></td>
<td>å¿½ç•¥å‰ 5 æ¬¡</td>
</tr>
<tr>
<td>watch</td>
<td><code>watch expr</code></td>
<td><code>watch var</code></td>
<td>å†™ç›‘è§†ç‚¹</td>
</tr>
<tr>
<td>rwatch</td>
<td><code>rwatch expr</code></td>
<td><code>rwatch counter</code></td>
<td>è¯»ç›‘è§†ç‚¹</td>
</tr>
<tr>
<td>awatch</td>
<td><code>awatch expr</code></td>
<td><code>awatch *ptr</code></td>
<td>è¯»å†™ç›‘è§†</td>
</tr>
<tr>
<td>hardware bp</td>
<td><code>hbreak</code></td>
<td><code>hbreak *0x401200</code></td>
<td>ç¡¬ä»¶æ–­ç‚¹</td>
</tr>
<tr>
<td>disable</td>
<td><code>disable &lt;bp_no&gt;</code></td>
<td>â€”</td>
<td>ç¦ç”¨æ–­ç‚¹</td>
</tr>
<tr>
<td>enable</td>
<td><code>enable &lt;bp_no&gt;</code></td>
<td>â€”</td>
<td>å¯ç”¨æ–­ç‚¹</td>
</tr>
<tr>
<td>delete</td>
<td><code>delete &lt;bp_no&gt;</code></td>
<td>â€”</td>
<td>åˆ é™¤æ–­ç‚¹</td>
</tr>
<tr>
<td>info break</td>
<td>â€”</td>
<td>æŸ¥çœ‹æ–­ç‚¹è¡¨</td>
<td></td>
</tr>
<tr>
<td>commands + end</td>
<td>å¦‚ä¸‹</td>
<td>å‘½ä¸­æ‰§è¡Œå‘½ä»¤å—</td>
<td></td>
</tr>
<tr>
<td>break thread-specific</td>
<td><code>break func thread 3</code></td>
<td>ä»…æŸçº¿ç¨‹å‘½ä¸­</td>
<td></td>
</tr>
</tbody></table>
<p>å‘½ä»¤å—ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">break process_request if id==42</span><br><span class="line">commands</span><br><span class="line">  silent</span><br><span class="line">  printf &quot;hit id=42 at %p\n&quot;,$rip</span><br><span class="line">  continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<blockquote>
<p>âš ï¸ é«˜é£é™©ï¼šå‘½ä»¤å—å†…è‹¥ <code>continue</code>ï¼Œä¼šå¿½ç•¥ç”¨æˆ·äº¤äº’ã€‚</p>
</blockquote>
<hr>
<h2 id="å››ã€å•æ­¥ä¸ç»§ç»­"><a href="#å››ã€å•æ­¥ä¸ç»§ç»­" class="headerlink" title="å››ã€å•æ­¥ä¸ç»§ç»­"></a>å››ã€å•æ­¥ä¸ç»§ç»­</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>step</code> &#x2F; <code>s</code></td>
<td>â€”</td>
<td>å•æ­¥ï¼ˆè¿›å…¥å­å‡½æ•°ï¼‰</td>
</tr>
<tr>
<td><code>next</code> &#x2F; <code>n</code></td>
<td>â€”</td>
<td>å•æ­¥ï¼ˆä¸è¿›å…¥ï¼‰</td>
</tr>
<tr>
<td><code>finish</code></td>
<td>â€”</td>
<td>è¿è¡Œè‡³å½“å‰å‡½æ•°è¿”å›</td>
</tr>
<tr>
<td><code>until [loc]</code></td>
<td><code>until 100</code></td>
<td>è¿è¡Œåˆ°æŒ‡å®šè¡Œ</td>
</tr>
<tr>
<td><code>advance &lt;loc&gt;</code></td>
<td><code>advance update</code></td>
<td>å¿«è¿›åˆ°å‡½æ•°å…¥å£</td>
</tr>
<tr>
<td><code>jump &lt;loc&gt;</code></td>
<td><code>jump main.cpp:88</code></td>
<td>å¼ºåˆ¶è·³è½¬æ‰§è¡Œä½ç½®</td>
</tr>
<tr>
<td><code>set scheduler-locking on</code></td>
<td>â€”</td>
<td>å•çº¿ç¨‹æ‰§è¡Œé”</td>
</tr>
</tbody></table>
<hr>
<h2 id="äº”ã€å¤šçº¿ç¨‹è°ƒè¯•"><a href="#äº”ã€å¤šçº¿ç¨‹è°ƒè¯•" class="headerlink" title="äº”ã€å¤šçº¿ç¨‹è°ƒè¯•"></a>äº”ã€å¤šçº¿ç¨‹è°ƒè¯•</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">info threads                  # åˆ—å‡ºçº¿ç¨‹ (TID, çŠ¶æ€)</span><br><span class="line">thread &lt;N&gt;                    # åˆ‡æ¢åˆ°çº¿ç¨‹ N</span><br><span class="line">thread apply all bt           # å…¨çº¿ç¨‹å›æº¯</span><br><span class="line">thread apply all bt full      # å…¨æ ˆè¯¦ç»†ä¿¡æ¯</span><br><span class="line">thread apply 2 4 info locals  # å¯¹ç‰¹å®šçº¿ç¨‹æ‰§è¡Œå‘½ä»¤</span><br><span class="line">set scheduler-locking step    # å•æ­¥æ—¶ä»…å½“å‰çº¿ç¨‹æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ä¹Ÿå¯ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">break func thread 5 if value==1</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å…­ã€å˜é‡ä¸è¡¨è¾¾å¼"><a href="#å…­ã€å˜é‡ä¸è¡¨è¾¾å¼" class="headerlink" title="å…­ã€å˜é‡ä¸è¡¨è¾¾å¼"></a>å…­ã€å˜é‡ä¸è¡¨è¾¾å¼</h2><table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>æ‰“å°å˜é‡</td>
<td><code>print expr</code></td>
<td><code>print count</code></td>
<td>æ˜¾ç¤ºå˜é‡å€¼</td>
</tr>
<tr>
<td>ç®€å†™</td>
<td><code>p</code></td>
<td><code>p i</code></td>
<td>å¿«é€Ÿæ˜¾ç¤º</td>
</tr>
<tr>
<td>ä¿®æ”¹å˜é‡</td>
<td><code>set var &lt;name&gt;=&lt;value&gt;</code></td>
<td><code>set var flag=1</code></td>
<td>ä¿®æ”¹è¿è¡Œæ—¶å˜é‡</td>
</tr>
<tr>
<td>ç›‘è§†å˜é‡å˜åŒ–</td>
<td><code>display expr</code></td>
<td><code>display x*y</code></td>
<td>æ¯æ­¥æ˜¾ç¤º</td>
</tr>
<tr>
<td>åœæ­¢æ˜¾ç¤º</td>
<td><code>undisplay N</code></td>
<td>â€”</td>
<td>å–æ¶ˆ</td>
</tr>
<tr>
<td>ä¸´æ—¶å®šä¹‰å˜é‡</td>
<td><code>set $tmp=expr</code></td>
<td><code>set $tmp=$eax+4</code></td>
<td>è‡ªå®šä¹‰ GDB å†…éƒ¨å˜é‡</td>
</tr>
<tr>
<td>ä½¿ç”¨å†…éƒ¨å˜é‡</td>
<td><code>$tmp</code></td>
<td><code>p $tmp</code></td>
<td>åœ¨è¡¨è¾¾å¼ä¸­å¤ç”¨è®¡ç®—å€¼</td>
</tr>
<tr>
<td>info locals</td>
<td>â€”</td>
<td>å½“å‰å‡½æ•°å±€éƒ¨å˜é‡</td>
<td></td>
</tr>
<tr>
<td>info args</td>
<td>â€”</td>
<td>å½“å‰å‡½æ•°å‚æ•°</td>
<td></td>
</tr>
<tr>
<td>whatis var</td>
<td>â€”</td>
<td>è·å–ç±»å‹å£°æ˜</td>
<td></td>
</tr>
<tr>
<td>ptype var</td>
<td>â€”</td>
<td>æ‰“å°è¯¦ç»†ç±»å‹ä¿¡æ¯</td>
<td></td>
</tr>
<tr>
<td>call func()</td>
<td><code>call compute_sum(3,5)</code></td>
<td>è°ƒç”¨å‡½æ•°ï¼ˆå¯å¸¦å‰¯ä½œç”¨ï¼‰</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>âš ï¸ è‹¥å‡½æ•°å«é”&#x2F;IO&#x2F;çŠ¶æ€ä¾èµ–ï¼Œ<code>call</code> å¯èƒ½ä¿®æ”¹ç¨‹åºè¡Œä¸ºã€‚</p>
</blockquote>
<hr>
<h2 id="ä¸ƒã€å†…å­˜ä¸æ ˆæ“ä½œ"><a href="#ä¸ƒã€å†…å­˜ä¸æ ˆæ“ä½œ" class="headerlink" title="ä¸ƒã€å†…å­˜ä¸æ ˆæ“ä½œ"></a>ä¸ƒã€å†…å­˜ä¸æ ˆæ“ä½œ</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>x&#x2F;Nfu <expr></td>
<td><code>x/16xb buf</code></td>
<td>æŒ‰æ ¼å¼æŸ¥çœ‹å†…å­˜</td>
</tr>
<tr>
<td>æ ¼å¼å­—ç¬¦</td>
<td>x&#x3D;16è¿›åˆ¶ã€d&#x3D;åè¿›åˆ¶ã€s&#x3D;å­—ç¬¦ä¸²ã€i&#x3D;æŒ‡ä»¤</td>
<td></td>
</tr>
<tr>
<td>u&#x3D;å•å…ƒå­—èŠ‚</td>
<td>b(1), h(2), w(4), g(8)</td>
<td></td>
</tr>
<tr>
<td>x&#x2F;32gx $rsp</td>
<td>â€”</td>
<td>æŸ¥çœ‹æ ˆé¡¶</td>
</tr>
<tr>
<td>set <em>(type</em>)addr &#x3D; value</td>
<td><code>set *(int*)0x7ffeef = 10</code></td>
<td>ä¿®æ”¹å†…å­˜</td>
</tr>
<tr>
<td>find <start>,<end>,<pat></td>
<td><code>find 0x400000,0x410000,0x90</code></td>
<td>å†…å­˜æœç´¢</td>
</tr>
</tbody></table>
<hr>
<h2 id="å…«ã€å¯„å­˜å™¨ä¸ä¸Šä¸‹æ–‡"><a href="#å…«ã€å¯„å­˜å™¨ä¸ä¸Šä¸‹æ–‡" class="headerlink" title="å…«ã€å¯„å­˜å™¨ä¸ä¸Šä¸‹æ–‡"></a>å…«ã€å¯„å­˜å™¨ä¸ä¸Šä¸‹æ–‡</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">info registers</span><br><span class="line">info all-registers</span><br><span class="line">info float</span><br><span class="line">info vector</span><br><span class="line">set $rax = 0</span><br><span class="line">p $rip</span><br></pre></td></tr></table></figure>
<p>å¯„å­˜å™¨å˜é‡ <code>$rip</code>, <code>$rsp</code>, <code>$rbp</code>, <code>$rax</code>, <code>$rbx</code>, â€¦ å¯ç›´æ¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨ã€‚</p>
<hr>
<h2 id="ä¹ã€åæ±‡ç¼–ä¸æ‰§è¡Œæµ"><a href="#ä¹ã€åæ±‡ç¼–ä¸æ‰§è¡Œæµ" class="headerlink" title="ä¹ã€åæ±‡ç¼–ä¸æ‰§è¡Œæµ"></a>ä¹ã€åæ±‡ç¼–ä¸æ‰§è¡Œæµ</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>&#96;disassemble [func</td>
<td>addr-range]&#96;</td>
<td><code>disassemble main</code></td>
</tr>
<tr>
<td><code>x/10i $pc</code></td>
<td>â€”</td>
<td>å‘¨è¾¹æŒ‡ä»¤</td>
</tr>
<tr>
<td><code>layout asm</code></td>
<td>â€”</td>
<td>TUI æ¨¡å¼ä¸­æ±‡ç¼–</td>
</tr>
<tr>
<td><code>si</code></td>
<td>â€”</td>
<td>å•æ­¥æ±‡ç¼–çº§</td>
</tr>
<tr>
<td><code>ni</code></td>
<td>â€”</td>
<td>ä¸å…¥å­è°ƒç”¨æ­¥è¿›</td>
</tr>
<tr>
<td><code>info line *$rip</code></td>
<td>â€”</td>
<td>æŸ¥çœ‹æ±‡ç¼–å¯¹åº”æºç </td>
</tr>
<tr>
<td><code>info frame</code></td>
<td>â€”</td>
<td>å½“å‰è°ƒç”¨å¸§å¯„å­˜å™¨ä¸æ ˆè¾¹ç•Œ</td>
</tr>
</tbody></table>
<hr>
<h2 id="åã€watchpoints-ä¸ç¡¬ä»¶ç›‘æ§"><a href="#åã€watchpoints-ä¸ç¡¬ä»¶ç›‘æ§" class="headerlink" title="åã€watchpoints ä¸ç¡¬ä»¶ç›‘æ§"></a>åã€watchpoints ä¸ç¡¬ä»¶ç›‘æ§</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>watch var</td>
<td><code>watch counter</code></td>
<td>å†™æ—¶æ–­ç‚¹</td>
</tr>
<tr>
<td>rwatch var</td>
<td><code>rwatch *ptr</code></td>
<td>è¯»æ—¶æ–­ç‚¹</td>
</tr>
<tr>
<td>awatch var</td>
<td><code>awatch *p</code></td>
<td>è¯»å†™æ–­ç‚¹</td>
</tr>
<tr>
<td>info watchpoints</td>
<td>â€”</td>
<td>æŸ¥çœ‹å½“å‰ watch</td>
</tr>
<tr>
<td>delete watchpoints</td>
<td>â€”</td>
<td>æ¸…é™¤æ‰€æœ‰ watch</td>
</tr>
<tr>
<td>hwatch expr</td>
<td><code>hwatch *addr</code></td>
<td>ç¡¬ä»¶ watchï¼ˆéƒ¨åˆ†å¹³å°ï¼‰</td>
</tr>
<tr>
<td>cond watch</td>
<td><code>watch x if x&gt;100</code></td>
<td>æ¡ä»¶è§¦å‘</td>
</tr>
</tbody></table>
<blockquote>
<p>âš ï¸ x86 é€šå¸¸ 4 ä¸ªç¡¬ä»¶æ–­ç‚¹èµ„æºé™åˆ¶ã€‚</p>
</blockquote>
<hr>
<h2 id="åä¸€ã€å‡½æ•°ä¸è°ƒç”¨æ ˆ"><a href="#åä¸€ã€å‡½æ•°ä¸è°ƒç”¨æ ˆ" class="headerlink" title="åä¸€ã€å‡½æ•°ä¸è°ƒç”¨æ ˆ"></a>åä¸€ã€å‡½æ•°ä¸è°ƒç”¨æ ˆ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">backtrace / bt                # è°ƒç”¨æ ˆ</span><br><span class="line">bt full                       # å¸¦å±€éƒ¨å˜é‡</span><br><span class="line">frame &lt;N&gt;                     # åˆ‡æ¢å¸§</span><br><span class="line">up / down                     # ä¸Š/ä¸‹ä¸€ä¸ªå¸§</span><br><span class="line">info args                     # å½“å‰å¸§å‚æ•°</span><br><span class="line">return &lt;expr&gt;                 # æå‰ä»å½“å‰å‡½æ•°è¿”å›</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="åäºŒã€è¾“å‡ºä¸æ ¼å¼åŒ–"><a href="#åäºŒã€è¾“å‡ºä¸æ ¼å¼åŒ–" class="headerlink" title="åäºŒã€è¾“å‡ºä¸æ ¼å¼åŒ–"></a>åäºŒã€è¾“å‡ºä¸æ ¼å¼åŒ–</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>printf â€œformatâ€, vars</td>
<td><code>printf &quot;len=%d\n&quot;, len</code></td>
<td>è‡ªå®šä¹‰è¾“å‡º</td>
</tr>
<tr>
<td>set logging on&#x2F;off</td>
<td>â€”</td>
<td>è¾“å‡ºé‡å®šå‘åˆ° to <code>gdb.txt</code></td>
</tr>
<tr>
<td>set pagination off</td>
<td>â€”</td>
<td>è¾“å‡ºå…¨å±•å¼€</td>
</tr>
<tr>
<td>shell <cmd></td>
<td><code>shell ls /tmp</code></td>
<td>æ‰§è¡Œå¤–éƒ¨å‘½ä»¤</td>
</tr>
<tr>
<td>echo</td>
<td><code>echo Hello\n</code></td>
<td>æ§åˆ¶å°è¾“å‡º</td>
</tr>
</tbody></table>
<hr>
<h2 id="åä¸‰ã€è„šæœ¬ä¸åˆ«å"><a href="#åä¸‰ã€è„šæœ¬ä¸åˆ«å" class="headerlink" title="åä¸‰ã€è„šæœ¬ä¸åˆ«å"></a>åä¸‰ã€è„šæœ¬ä¸åˆ«å</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">define btf</span><br><span class="line">  thread apply all bt full</span><br><span class="line">end</span><br><span class="line">alias btf = btf</span><br><span class="line"></span><br><span class="line">define ctx</span><br><span class="line">  info registers</span><br><span class="line">  info locals</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>å¯æ”¾å…¥ <code>.gdbinit</code> å†…ã€‚<br>æ‰§è¡Œå¤–éƒ¨è„šæœ¬ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">source &lt;file.gdb&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="åå››ã€TUI-æ¨¡å¼"><a href="#åå››ã€TUI-æ¨¡å¼" class="headerlink" title="åå››ã€TUI æ¨¡å¼"></a>åå››ã€TUI æ¨¡å¼</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><code>layout src</code></td>
<td>æºç çª—å£</td>
</tr>
<tr>
<td><code>layout asm</code></td>
<td>æ±‡ç¼–çª—å£</td>
</tr>
<tr>
<td><code>layout regs</code></td>
<td>å¯„å­˜å™¨çª—å£</td>
</tr>
<tr>
<td><code>focus next/prev</code></td>
<td>åˆ‡æ¢ç„¦ç‚¹</td>
</tr>
<tr>
<td><code>refresh</code></td>
<td>é‡ç»˜ TUI ç•Œé¢</td>
</tr>
</tbody></table>
<p>åœ¨ CLI æ¨¡å¼ä¸­æŒ‰ <code>Ctrl+X A</code> å¯åˆ‡æ¢ TUI â†” æ™®é€šæ¨¡å¼ã€‚</p>
<hr>
<h2 id="åäº”ã€è¿œç¨‹è°ƒè¯•-gdbserver"><a href="#åäº”ã€è¿œç¨‹è°ƒè¯•-gdbserver" class="headerlink" title="åäº”ã€è¿œç¨‹è°ƒè¯• (gdbserver)"></a>åäº”ã€è¿œç¨‹è°ƒè¯• (gdbserver)</h2><p>ç›®æ ‡æœºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdbserver :1234 ./demo_multithread</span><br></pre></td></tr></table></figure>
<p>æœ¬åœ°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb ./demo_multithread</span><br><span class="line">target remote &lt;ip&gt;:1234</span><br><span class="line"><span class="built_in">set</span> sysroot /usr/sysroot/</span><br></pre></td></tr></table></figure>
<blockquote>
<p>âš ï¸ è‹¥è·¨æ¶æ„ï¼šç”¨ <code>gdb-multiarch</code>ã€‚</p>
</blockquote>
<hr>
<h2 id="åå…­ã€Core-Dump-åˆ†æ"><a href="#åå…­ã€Core-Dump-åˆ†æ" class="headerlink" title="åå…­ã€Core Dump åˆ†æ"></a>åå…­ã€Core Dump åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -c unlimited</span><br><span class="line">./demo_multithread</span><br><span class="line"><span class="comment"># å´©æºƒåï¼š</span></span><br><span class="line">gdb ./demo_multithread core</span><br><span class="line">(gdb) bt full</span><br><span class="line">(gdb) info sharedlibrary</span><br><span class="line">(gdb) info registers</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="åä¸ƒã€GDB-Python-åŸºç¡€"><a href="#åä¸ƒã€GDB-Python-åŸºç¡€" class="headerlink" title="åä¸ƒã€GDB Python åŸºç¡€"></a>åä¸ƒã€GDB Python åŸºç¡€</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python</span><br><span class="line"><span class="keyword">import</span> gdb</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Hello</span>(gdb.Command):</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">s</span>): <span class="built_in">super</span>().__init__(<span class="string">&quot;hello&quot;</span>, gdb.COMMAND_USER)</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">invoke</span>(<span class="params">s,arg,from_tty</span>): <span class="built_in">print</span>(<span class="string">&quot;Hello GDB!&quot;</span>)</span><br><span class="line">Hello()</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>â†’ è¿è¡Œï¼š<code>hello</code></p>
<hr>
<h2 id="åå…«ã€20-æ¡é«˜é¢‘å¯å¤åˆ¶å‘½ä»¤æ¸…å•"><a href="#åå…«ã€20-æ¡é«˜é¢‘å¯å¤åˆ¶å‘½ä»¤æ¸…å•" class="headerlink" title="åå…«ã€20 æ¡é«˜é¢‘å¯å¤åˆ¶å‘½ä»¤æ¸…å•"></a>åå…«ã€20 æ¡é«˜é¢‘å¯å¤åˆ¶å‘½ä»¤æ¸…å•</h2><table>
<thead>
<tr>
<th>åºå·</th>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>break main</code></td>
<td>åœ¨ä¸»å‡½æ•°è®¾ç½®æ–­ç‚¹</td>
</tr>
<tr>
<td>2</td>
<td><code>break foo if x&gt;5</code></td>
<td>æ¡ä»¶æ–­ç‚¹</td>
</tr>
<tr>
<td>3</td>
<td><code>tbreak bar</code></td>
<td>å•æ¬¡æ–­ç‚¹</td>
</tr>
<tr>
<td>4</td>
<td><code>info break</code></td>
<td>æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹</td>
</tr>
<tr>
<td>5</td>
<td><code>display var</code></td>
<td>æ¯æ­¥æ˜¾ç¤ºå˜é‡</td>
</tr>
<tr>
<td>6</td>
<td><code>thread apply all bt full</code></td>
<td>æ‰€æœ‰çº¿ç¨‹æ ˆ</td>
</tr>
<tr>
<td>7</td>
<td><code>set scheduler-locking on</code></td>
<td>å•çº¿ç¨‹é”æ­¥</td>
</tr>
<tr>
<td>8</td>
<td><code>watch *ptr</code></td>
<td>æ·»åŠ  watchpoint</td>
</tr>
<tr>
<td>9</td>
<td><code>info registers</code></td>
<td>æŸ¥çœ‹å¯„å­˜å™¨</td>
</tr>
<tr>
<td>10</td>
<td><code>disassemble /m main</code></td>
<td>æ··åˆæ±‡ç¼–æºç </td>
</tr>
<tr>
<td>11</td>
<td><code>x/32gx $rsp</code></td>
<td>æŸ¥çœ‹å½“å‰æ ˆ 256B</td>
</tr>
<tr>
<td>12</td>
<td><code>info locals</code></td>
<td>å±€éƒ¨å˜é‡</td>
</tr>
<tr>
<td>13</td>
<td><code>call debug_dump()</code></td>
<td>è°ƒç”¨è‡ªå®šä¹‰å‡½æ•°</td>
</tr>
<tr>
<td>14</td>
<td><code>layout src</code></td>
<td>æ‰“å¼€æºç è§†å›¾</td>
</tr>
<tr>
<td>15</td>
<td><code>source script.gdb</code></td>
<td>åŠ è½½è„šæœ¬</td>
</tr>
<tr>
<td>16</td>
<td><code>set logging on</code></td>
<td>è‡ªåŠ¨ä¿å­˜è¾“å‡º</td>
</tr>
<tr>
<td>17</td>
<td><code>attach 1234</code></td>
<td>é™„åŠ è°ƒè¯•</td>
</tr>
<tr>
<td>18</td>
<td><code>detach</code></td>
<td>åˆ†ç¦»ç›®æ ‡</td>
</tr>
<tr>
<td>19</td>
<td><code>bt full</code></td>
<td>æŠ¥é”™å›æº¯</td>
</tr>
<tr>
<td>20</td>
<td><code>quit</code></td>
<td>é€€å‡ºè°ƒè¯•å™¨</td>
</tr>
</tbody></table>
<hr>
<h2 id="åä¹ã€é«˜å±å‘½ä»¤æ³¨æ„"><a href="#åä¹ã€é«˜å±å‘½ä»¤æ³¨æ„" class="headerlink" title="åä¹ã€é«˜å±å‘½ä»¤æ³¨æ„"></a>åä¹ã€é«˜å±å‘½ä»¤æ³¨æ„</h2><ul>
<li><code>jump</code> &#x2F; <code>set $rip</code> â†’ æ”¹å˜æ‰§è¡Œæµï¼Œå¯èƒ½ç ´åå †æ ˆ  </li>
<li><code>call</code> â†’ è°ƒç”¨ç›®æ ‡ä»£ç å¯æœ‰å‰¯ä½œç”¨  </li>
<li><code>set var</code> â†’ ä¿®æ”¹å…³é”®é€»è¾‘éœ€è°¨æ…  </li>
<li><code>detach</code> â†’ ä¼šæ¢å¤æ‰§è¡Œï¼Œè¯·ç¡®ä¿å®‰å…¨  </li>
<li><code>signal</code> â†’ å¯èƒ½å¯¼è‡´å³æ—¶ç»ˆæ­¢æˆ–å¼‚å¸¸</li>
</ul>
<hr>
<h2 id="äºŒåã€è°ƒè¯•å¿ƒæ³•å°ç»“"><a href="#äºŒåã€è°ƒè¯•å¿ƒæ³•å°ç»“" class="headerlink" title="äºŒåã€è°ƒè¯•å¿ƒæ³•å°ç»“"></a>äºŒåã€è°ƒè¯•å¿ƒæ³•å°ç»“</h2><ol>
<li><strong>æ‰€æœ‰å‘½ä»¤çš†ä¸ºå·¥å…·ï¼Œä¸ä¸ºè¡¨æ¼”</strong> â€”â€” ä¼˜å…ˆå½•åˆ¶è‡ªåŠ¨åŒ–ã€‚  </li>
<li><strong>å…ˆè¿½æ¡ä»¶ï¼Œå†æ–­è¡Œä¸º</strong> â€”â€” ç”¨ <code>break if</code> ä¸è¦æ’’ç½‘ã€‚  </li>
<li><strong>å¤šçº¿ç¨‹æ°¸è¿œé‡‡é›†å…¨æ™¯</strong> â€”â€” ä¸€çº¿ç¨‹å¼‚å¸¸å¤šçº¿ç¨‹æœ‰å› ã€‚  </li>
<li><strong>å–„ç”¨è„šæœ¬è®°å½•å¯é‡å¤æ€§ã€‚</strong>  </li>
<li><strong>core æ˜¯çœŸç›¸ï¼Œä¸ä¾èµ–å¤ç°ã€‚</strong>  </li>
<li><strong>æºç  + æ±‡ç¼– &#x3D; çœŸå›¾è°±ã€‚</strong>  </li>
<li><strong>è¶Šè‡ªåŠ¨è¶Šä½é£é™©ã€‚</strong>  </li>
<li><strong>æ°¸ä¸åœ¨ç”Ÿäº§ attach é•¿æ—¶ã€‚</strong>  </li>
<li><strong>å¤šç”¨ batch æ¨¡å¼é‡‡æ ·ã€‚</strong>  </li>
<li><strong>ç¦»çº¿åˆ†æï¼Œå®‰å…¨ä¼˜å…ˆã€‚</strong></li>
</ol>
<hr>
]]></content>
  </entry>
  <entry>
    <title>linuxå†…æ ¸æ¢ç§˜pdf</title>
    <url>/linux%E5%86%85%E6%A0%B8%E6%8E%A2%E7%A7%98pdf/</url>
    <content><![CDATA[<span id="more"></span>
<embed src="linux-filesystem-driver.pdf" width="100%" height="1000" type="application/pdf">


]]></content>
  </entry>
  <entry>
    <title>CMAKEå®Œå…¨æ‰‹å†Œ</title>
    <url>/CMAKE%E5%AE%8C%E5%85%A8%E6%89%8B%E5%86%8C/</url>
    <content><![CDATA[<p>é…åˆCMakeç®€æ˜æ•™ç¨‹ä½¿ç”¨ï¼Œç»†èŠ‚æ›´å¤š, æ—¥å¸¸å°é¡¹ç›®ï¼Œç®€æ˜æ‰‹å†Œçš„å·¥ç¨‹æ¨¡æ¿å®Œå…¨å¤Ÿç”¨,è¿™ä¸ªæ•™ç¨‹æœ«å°¾çš„æ¨¡æ¿å°±æ˜¯æ›´ç¬¦åˆå›½é™…æƒ¯ä¾‹ä¸€äº›</p>
<span id="more"></span>

<hr>
<h1 id="ğŸ§±-ç¬¬-1-ç« -CMake-å˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆè„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰"><a href="#ğŸ§±-ç¬¬-1-ç« -CMake-å˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆè„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰" class="headerlink" title="ğŸ§±â€¯ç¬¬â€¯1â€¯ç« â€¯|â€¯CMakeâ€¯å˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆè„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰"></a>ğŸ§±â€¯ç¬¬â€¯1â€¯ç« â€¯|â€¯CMakeâ€¯å˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆè„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰</h1><hr>
<h2 id="1-å˜é‡ç±»å‹ä¸å®šä¹‰è§„åˆ™"><a href="#1-å˜é‡ç±»å‹ä¸å®šä¹‰è§„åˆ™" class="headerlink" title="1.â€¯å˜é‡ç±»å‹ä¸å®šä¹‰è§„åˆ™"></a>1.â€¯å˜é‡ç±»å‹ä¸å®šä¹‰è§„åˆ™</h2><p>CMakeâ€¯çš„è„šæœ¬ä¸–ç•Œé‡Œï¼Œä¸€åˆ‡éƒ½æ˜¯å­—ç¬¦ä¸²å˜é‡ï¼ˆæ— æ˜¾å¼æ•°æ®ç±»å‹ï¼‰ã€‚<br>è¯­æ³•ç»“æ„ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(&lt;å˜é‡å&gt; &lt;å€¼&gt; [CACHE &lt;ç±»å‹&gt; &lt;æè¿°&gt; [FORCE]])</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(MY_NAME <span class="string">&quot;Alice&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;name = $&#123;MY_NAME&#125;&quot;</span>)  <span class="comment"># è¾“å‡ºï¼šname = Alice</span></span><br></pre></td></tr></table></figure>

<p><strong>è¯´æ˜ï¼š</strong>  </p>
<ul>
<li>å˜é‡åŒºåˆ†å¤§å°å†™ï¼›  </li>
<li>é»˜è®¤ä½œç”¨åŸŸæ˜¯å½“å‰æ–‡ä»¶ï¼›  </li>
<li>åœ¨å‡½æ•°â€¯functionâ€¯å†…æ˜¯å±€éƒ¨ä½œç”¨åŸŸï¼›åœ¨â€¯macroâ€¯åˆ™å…±äº«å¤–å±‚ï¼›  </li>
<li><code>$&#123;å˜é‡å&#125;</code>â€¯å–å€¼ï¼Œä¸èƒ½çœâ€¯<code>$&#123;&#125;</code>ã€‚</li>
</ul>
<hr>
<h2 id="2-ä¸‰ç±»ä¸»è¦å˜é‡"><a href="#2-ä¸‰ç±»ä¸»è¦å˜é‡" class="headerlink" title="2.â€¯ä¸‰ç±»ä¸»è¦å˜é‡"></a>2.â€¯ä¸‰ç±»ä¸»è¦å˜é‡</h2><table>
<thead>
<tr>
<th>åˆ†ç±»</th>
<th>å®šä¹‰æ–¹å¼</th>
<th>ç”Ÿå‘½å‘¨æœŸ &#x2F; å­˜å‚¨ä½ç½®</th>
<th>ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>æ™®é€šå˜é‡</td>
<td><code>set(VAR val)</code></td>
<td>å½“å‰ä½œç”¨åŸŸ</td>
<td><code>set(Aâ€¯5)</code></td>
</tr>
<tr>
<td>ç¼“å­˜å˜é‡</td>
<td><code>set(VAR val CACHE TYPE DESC)</code></td>
<td>å†™å…¥â€¯CMakeCache.txt</td>
<td>æ„å»ºé…ç½®é€‰é¡¹</td>
</tr>
<tr>
<td>ç¯å¢ƒå˜é‡</td>
<td><code>set(ENV&#123;VAR&#125; val)</code></td>
<td>ä¼ é€’ç»™å¤–éƒ¨å‘½ä»¤ç¯å¢ƒ</td>
<td><code>set(ENV&#123;PATH&#125; /opt/bin:$ENV&#123;PATH&#125;)</code></td>
</tr>
</tbody></table>
<p>ğŸ”¹â€¯<strong>ç¯å¢ƒå˜é‡ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(<span class="string">&quot;before = $ENV&#123;PATH&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(ENV&#123;PATH&#125; <span class="string">&quot;/extra:$ENV&#123;PATH&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">execute_process</span>(<span class="keyword">COMMAND</span> env)  <span class="comment"># ç”Ÿæˆè¿‡ç¨‹ä¸­çš„ç¯å¢ƒå¯ç”¨</span></span><br></pre></td></tr></table></figure>

<p>ğŸ”¹â€¯<strong>ç¼“å­˜å˜é‡ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(BUILD_VERBOSE <span class="keyword">ON</span> CACHE BOOL <span class="string">&quot;Show build details&quot;</span>)</span><br><span class="line"><span class="comment"># å‘½ä»¤è¡Œï¼šcmake -DBUILD_VERBOSE=ON ..</span></span><br></pre></td></tr></table></figure>

<p>ç¼“å­˜å˜é‡å¯ç”¨äºç”Ÿæˆé…ç½®é€‰é¡¹ç•Œé¢ï¼ˆccmake &#x2F; CMakeâ€¯GUIï¼‰ï¼Œå€¼æŒä¹…åŒ–åœ¨å½“å‰â€¯buildâ€¯ç›®å½•ï¼Œé™¤éåŠ â€¯FORCEâ€¯æ‰ä¼šè¦†ç›–ã€‚</p>
<hr>
<h2 id="3-å˜é‡ä½œç”¨åŸŸç¤ºä¾‹"><a href="#3-å˜é‡ä½œç”¨åŸŸç¤ºä¾‹" class="headerlink" title="3.â€¯å˜é‡ä½œç”¨åŸŸç¤ºä¾‹"></a>3.â€¯å˜é‡ä½œç”¨åŸŸç¤ºä¾‹</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(V outer)</span><br><span class="line"><span class="keyword">function</span>(<span class="keyword">test</span>)</span><br><span class="line">  <span class="keyword">set</span>(V inner)</span><br><span class="line">  <span class="keyword">message</span>(<span class="string">&quot;in function: $&#123;V&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"><span class="keyword">test</span>()</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;outside: $&#123;V&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">in function: inner</span><br><span class="line">outside: outer</span><br></pre></td></tr></table></figure>

<p>functionâ€¯å†…éƒ¨ä¸ä¼šä¿®æ”¹å¤–å±‚ï¼›<br>è‹¥ç”¨â€¯macroâ€¯å®šä¹‰ï¼Œåˆ™ä½œç”¨åŸŸå…±äº«ï¼Œä¼šæ”¹åŠ¨å¤–å±‚ã€‚  </p>
<hr>
<h2 id="4-åˆ—è¡¨ä¸å­—ç¬¦ä¸²æ“ä½œ"><a href="#4-åˆ—è¡¨ä¸å­—ç¬¦ä¸²æ“ä½œ" class="headerlink" title="4.â€¯åˆ—è¡¨ä¸å­—ç¬¦ä¸²æ“ä½œ"></a>4.â€¯åˆ—è¡¨ä¸å­—ç¬¦ä¸²æ“ä½œ</h2><h3 id="4-1-åˆ—è¡¨åŸºç¡€"><a href="#4-1-åˆ—è¡¨åŸºç¡€" class="headerlink" title="4.1â€¯åˆ—è¡¨åŸºç¡€"></a>4.1â€¯åˆ—è¡¨åŸºç¡€</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(MYLIST A B C)</span><br><span class="line"><span class="keyword">list</span>(APPEND MYLIST D)</span><br><span class="line"><span class="keyword">foreach</span>(item IN LISTS MYLIST)</span><br><span class="line">  <span class="keyword">message</span>(<span class="string">&quot;item=$&#123;item&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<h3 id="4-2-å¸¸ç”¨-list-å­å‘½ä»¤"><a href="#4-2-å¸¸ç”¨-list-å­å‘½ä»¤" class="headerlink" title="4.2â€¯å¸¸ç”¨â€¯list()â€¯å­å‘½ä»¤"></a>4.2â€¯å¸¸ç”¨â€¯list()â€¯å­å‘½ä»¤</h3><table>
<thead>
<tr>
<th>å­å‘½ä»¤</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td>APPEND</td>
<td>è¿½åŠ </td>
</tr>
<tr>
<td>LENGTH</td>
<td>è·å–é•¿åº¦</td>
</tr>
<tr>
<td>GET i</td>
<td>å–å…ƒç´ </td>
</tr>
<tr>
<td>REMOVE_ITEM</td>
<td>åˆ é™¤åŒ¹é…é¡¹</td>
</tr>
<tr>
<td>JOIN</td>
<td>åˆå¹¶ä¸ºå­—ç¬¦ä¸²</td>
</tr>
</tbody></table>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">list</span>(JOIN MYLIST <span class="string">&quot;,&quot;</span> JOINED)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;$&#123;JOINED&#125;&quot;</span>)  <span class="comment"># â†’ A,B,C,D</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="4-3-å­—ç¬¦ä¸²å¤„ç†"><a href="#4-3-å­—ç¬¦ä¸²å¤„ç†" class="headerlink" title="4.3â€¯å­—ç¬¦ä¸²å¤„ç†"></a>4.3â€¯å­—ç¬¦ä¸²å¤„ç†</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(TOUPPER <span class="string">&quot;abc&quot;</span> OUT)     <span class="comment"># å˜å¤§å†™</span></span><br><span class="line"><span class="keyword">string</span>(SUBSTRING <span class="string">&quot;abcdef&quot;</span> <span class="number">0</span> <span class="number">3</span> FIRST)</span><br><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">&quot;a&quot;</span> <span class="string">&quot;x&quot;</span> CHANGED <span class="string">&quot;$&#123;VAR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">string</span>(FIND <span class="string">&quot;$&#123;TEXT&#125;&quot;</span> <span class="string">&quot;key&quot;</span> POS)</span><br></pre></td></tr></table></figure>

<p>ğŸ“˜â€¯CMakeâ€¯å­—ç¬¦ä¸²æ“ä½œç»Ÿç»Ÿç”Ÿæˆæ–°å˜é‡ï¼Œä¸ä¼šåŸåœ°ä¿®æ”¹ã€‚  </p>
<hr>
<h2 id="5-é¢„å®šä¹‰è·¯å¾„å˜é‡ï¼ˆå¿…é¡»ç†Ÿï¼‰"><a href="#5-é¢„å®šä¹‰è·¯å¾„å˜é‡ï¼ˆå¿…é¡»ç†Ÿï¼‰" class="headerlink" title="5.â€¯é¢„å®šä¹‰è·¯å¾„å˜é‡ï¼ˆå¿…é¡»ç†Ÿï¼‰"></a>5.â€¯é¢„å®šä¹‰è·¯å¾„å˜é‡ï¼ˆå¿…é¡»ç†Ÿï¼‰</h2><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>è§£é‡Š</th>
<th>å…¸å‹å€¼</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_SOURCE_DIR</code></td>
<td>é¡¶å±‚â€¯CMakeLists.txtâ€¯æ‰€åœ¨æºç æ ¹</td>
<td><code>/home/user/demo</code></td>
</tr>
<tr>
<td><code>CMAKE_CURRENT_SOURCE_DIR</code></td>
<td>å½“å‰â€¯CMakeListsâ€¯æ‰€åœ¨æºç ç›®å½•</td>
<td><code>/home/user/demo/Core</code></td>
</tr>
<tr>
<td><code>CMAKE_BINARY_DIR</code></td>
<td>é¡¶å±‚æ„å»ºç›®å½•</td>
<td><code>/home/user/demo/build</code></td>
</tr>
<tr>
<td><code>CMAKE_CURRENT_BINARY_DIR</code></td>
<td>å½“å‰å­ç›®å½•æ„å»ºç›®å½•</td>
<td><code>/home/user/demo/build/Core</code></td>
</tr>
<tr>
<td><code>PROJECT_SOURCE_DIR</code></td>
<td>å®šä¹‰â€¯project()â€¯çš„ç›®å½•</td>
<td>åŒâ€¯CMAKE_SOURCE_DIR</td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_PREFIX</code></td>
<td>å®‰è£…ç›®æ ‡æ ¹ç›®å½•</td>
<td><code>/usr/local</code>â€¯æˆ–æ‰‹åŠ¨â€¯-prefix</td>
</tr>
<tr>
<td><code>CMAKE_RUNTIME_OUTPUT_DIRECTORY</code></td>
<td>å¯æ‰§è¡Œè¾“å‡ºè·¯å¾„</td>
<td><code>$&#123;CMAKE_SOURCE_DIR&#125;/bin</code></td>
</tr>
<tr>
<td><code>CMAKE_LIBRARY_OUTPUT_DIRECTORY</code></td>
<td>åŠ¨æ€åº“è¾“å‡ºè·¯å¾„</td>
<td><code>$&#123;CMAKE_SOURCE_DIR&#125;/bin/lib</code></td>
</tr>
<tr>
<td><code>CMAKE_ARCHIVE_OUTPUT_DIRECTORY</code></td>
<td>é™æ€åº“è¾“å‡ºè·¯å¾„</td>
<td><code>$&#123;CMAKE_SOURCE_DIR&#125;/bin/lib</code></td>
</tr>
</tbody></table>
<p><strong>èŒƒä¾‹ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin)</span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br></pre></td></tr></table></figure>
<p>â†’â€¯<code>bin/app</code>â€¯ç”Ÿæˆåœ¨æºç çš„â€¯binâ€¯ç›®å½•ã€‚</p>
<hr>
<h2 id="6-è·¯å¾„ä¸æ–‡ä»¶è¾…åŠ©å˜é‡"><a href="#6-è·¯å¾„ä¸æ–‡ä»¶è¾…åŠ©å˜é‡" class="headerlink" title="6.â€¯è·¯å¾„ä¸æ–‡ä»¶è¾…åŠ©å˜é‡"></a>6.â€¯è·¯å¾„ä¸æ–‡ä»¶è¾…åŠ©å˜é‡</h2><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>å†…å®¹</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_CURRENT_FUNCTION_LIST_DIR</code></td>
<td>å½“å‰å‡½æ•°æ‰€åœ¨æ–‡ä»¶è·¯å¾„</td>
<td>æ¨¡å—å†…å¼•å…¥ç›¸å¯¹è·¯å¾„</td>
</tr>
<tr>
<td><code>CMAKE_COMMAND</code></td>
<td>å½“å‰â€¯cmakeâ€¯å¯æ‰§è¡Œè·¯å¾„</td>
<td>ç”¨äºâ€¯add_custom_commandâ€¯è°ƒç”¨</td>
</tr>
<tr>
<td><code>CMAKE_MODULE_PATH</code></td>
<td>æœç´¢â€¯FindXXX.cmakeâ€¯çš„é¢å¤–ç›®å½•</td>
<td><code>set(CMAKE_MODULE_PATH &quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake&quot;)</code></td>
</tr>
<tr>
<td><code>CMAKE_GENERATOR</code></td>
<td>å½“å‰ç”Ÿæˆå™¨ï¼ˆNinja &#x2F; Makefiles &#x2F; MSVCï¼‰</td>
<td>æ¡ä»¶åˆ¤æ–­</td>
</tr>
<tr>
<td><code>CMAKE_SYSTEM_NAME</code></td>
<td>æ“ä½œç³»ç»Ÿæ ‡è¯†</td>
<td>äº¤å‰ç¼–è¯‘åˆ¤æ–­</td>
</tr>
<tr>
<td><code>CMAKE_CXX_COMPILER_ID</code></td>
<td>ç¼–è¯‘å™¨æ ‡è¯†</td>
<td>GCC &#x2F; Clang &#x2F; MSVC</td>
</tr>
<tr>
<td><code>CMAKE_BUILD_TYPE</code></td>
<td>æ„å»ºç±»å‹</td>
<td>Debug &#x2F; Releaseâ€¯â€¦</td>
</tr>
</tbody></table>
<hr>
<h2 id="7-å˜é‡å­˜åœ¨æ€§ä¸é»˜è®¤å€¼å¤„ç†"><a href="#7-å˜é‡å­˜åœ¨æ€§ä¸é»˜è®¤å€¼å¤„ç†" class="headerlink" title="7.â€¯å˜é‡å­˜åœ¨æ€§ä¸é»˜è®¤å€¼å¤„ç†"></a>7.â€¯å˜é‡å­˜åœ¨æ€§ä¸é»˜è®¤å€¼å¤„ç†</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">DEFINED</span> VAR)</span><br><span class="line">  <span class="keyword">message</span>(<span class="string">&quot;VAR is defined&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">NOT</span> <span class="keyword">DEFINED</span> SOME_OPTION)</span><br><span class="line">  <span class="keyword">set</span>(SOME_OPTION <span class="keyword">OFF</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-é«˜çº§æŠ€å·§ï¼šçˆ¶ä½œç”¨åŸŸ-å¤åˆè·¯å¾„"><a href="#8-é«˜çº§æŠ€å·§ï¼šçˆ¶ä½œç”¨åŸŸ-å¤åˆè·¯å¾„" class="headerlink" title="8.â€¯é«˜çº§æŠ€å·§ï¼šçˆ¶ä½œç”¨åŸŸ &amp; å¤åˆè·¯å¾„"></a>8.â€¯é«˜çº§æŠ€å·§ï¼šçˆ¶ä½œç”¨åŸŸ &amp; å¤åˆè·¯å¾„</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨å­å‡½æ•°ä¿®æ”¹å¤–å±‚å€¼</span></span><br><span class="line"><span class="keyword">function</span>(setFlag)</span><br><span class="line">  <span class="keyword">set</span>(MODE ready PARENT_SCOPE)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line">setFlag()</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;MODE=$&#123;MODE&#125;&quot;</span>)  <span class="comment"># â†’ ready</span></span><br></pre></td></tr></table></figure>

<p>å¤åˆè·¯å¾„æ„å»ºï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(DIR /home)</span><br><span class="line"><span class="keyword">set</span>(PATH <span class="variable">$&#123;DIR&#125;</span>/<span class="keyword">project</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-å°ç»“ä¸å¸¸è§è¯¯åŒº"><a href="#9-å°ç»“ä¸å¸¸è§è¯¯åŒº" class="headerlink" title="9.â€¯å°ç»“ä¸å¸¸è§è¯¯åŒº"></a>9.â€¯å°ç»“ä¸å¸¸è§è¯¯åŒº</h2><table>
<thead>
<tr>
<th>æƒ…å½¢</th>
<th>é—®é¢˜</th>
<th>ä¿®å¤æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>ä½¿ç”¨ <code>$VAR</code>â€¯è€Œéâ€¯<code>$&#123;VAR&#125;</code></td>
<td>è§£é‡Šä¸ºç©ºå­—ç¬¦ä¸²</td>
<td>å§‹ç»ˆåŠ èŠ±æ‹¬å·</td>
</tr>
<tr>
<td>æƒ³æ”¹çˆ¶ä½œç”¨åŸŸå˜é‡ä¸èµ·ä½œç”¨</td>
<td>functionâ€¯æœ‰å±€éƒ¨ä½œç”¨åŸŸ</td>
<td>ä½¿ç”¨â€¯PARENT_SCOPE</td>
</tr>
<tr>
<td>æ–°æ–‡ä»¶æœªè¢«æ£€æµ‹åˆ°</td>
<td>ä½¿ç”¨â€¯file(GLOB)</td>
<td>æ˜¾å¼åˆ—æºç æˆ–è§¦å‘â€¯reconfigure</td>
</tr>
<tr>
<td>æƒ³è·¨â€¯buildâ€¯ä¿å­˜è®¾ç½®</td>
<td>ç”¨â€¯CACHEâ€¯å˜é‡</td>
<td><code>set(VAR val CACHE ...)</code></td>
</tr>
<tr>
<td>éœ€è¦ç¯å¢ƒå˜é‡æ›´æ–°</td>
<td>éœ€åœ¨æ‰§è¡Œå‘½ä»¤å‰â€¯set(ENV{})</td>
<td>å¦åˆ™å·²å¯åŠ¨çš„æ„å»ºä¸ä¼šç»§æ‰¿</td>
</tr>
</tbody></table>
<hr>
<p>åˆ°æ­¤ï¼Œç¬¬â€¯1â€¯ç« è¦†ç›–ï¼š</p>
<ul>
<li>å˜é‡å®šä¹‰ä¸3ç§ç±»å‹  </li>
<li>ä½œç”¨åŸŸä¸å‡½æ•°&#x2F;å®å·®å¼‚  </li>
<li>listâ€¯&#x2F;â€¯stringâ€¯å¸¸ç”¨æ“ä½œ  </li>
<li>é¢„å®šä¹‰è·¯å¾„ä¸ç³»ç»Ÿå˜é‡  </li>
<li>ç¼“å­˜ã€ç¯å¢ƒåŠçˆ¶ä½œç”¨åŸŸæŠ€å·§</li>
</ul>
<hr>
<hr>
<h1 id="âš™ï¸-ç¬¬-2-ç« -CMake-ç›®æ ‡-Target-ä½“ç³»ä¸ä¾èµ–æœºåˆ¶å…¨è§£"><a href="#âš™ï¸-ç¬¬-2-ç« -CMake-ç›®æ ‡-Target-ä½“ç³»ä¸ä¾èµ–æœºåˆ¶å…¨è§£" class="headerlink" title="âš™ï¸â€¯ç¬¬â€¯2â€¯ç« â€¯|â€¯CMakeâ€¯ç›®æ ‡â€¯(Target)â€¯ä½“ç³»ä¸ä¾èµ–æœºåˆ¶å…¨è§£"></a>âš™ï¸â€¯ç¬¬â€¯2â€¯ç« â€¯|â€¯CMakeâ€¯ç›®æ ‡â€¯(Target)â€¯ä½“ç³»ä¸ä¾èµ–æœºåˆ¶å…¨è§£</h1><hr>
<h2 id="2-1-Target-æ˜¯ä»€ä¹ˆ"><a href="#2-1-Target-æ˜¯ä»€ä¹ˆ" class="headerlink" title="2.1â€¯Targetâ€¯æ˜¯ä»€ä¹ˆ"></a>2.1â€¯Targetâ€¯æ˜¯ä»€ä¹ˆ</h2><p>åœ¨â€¯CMakeâ€¯é‡Œï¼Œ<strong>ç›®æ ‡(Target)</strong>â€¯æ˜¯ä¸€ç§ã€Œå¯æ„å»ºå®ä½“ã€ã€‚<br>æ¯ä¸€ä¸ªâ€¯<code>add_executable()</code>ã€<code>add_library()</code>â€¯è°ƒç”¨åï¼Œéƒ½ä¼šåœ¨å†…éƒ¨äº§ç”Ÿä¸€ä¸ªâ€¯Targetâ€¯å¯¹è±¡ï¼Œè®°å½•å®ƒçš„ï¼š</p>
<ul>
<li>æºæ–‡ä»¶é›†åˆ  </li>
<li>ç¼–è¯‘&#x2F;é“¾æ¥å‚æ•°  </li>
<li>å¯¼å‡ºåç§°  </li>
<li>å®‰è£…ä½ç½®  </li>
<li>ä¸å…¶ä»–â€¯Targetâ€¯çš„å…³ç³»</li>
</ul>
<p>è¿™äº›ç›®æ ‡è¢«ç¼–è¯‘å·¥å…·ï¼ˆNinja &#x2F; Makefile &#x2F; MSVC â€¦ï¼‰æ˜ å°„æˆçœŸå®çš„æ„å»ºå•å…ƒã€‚<br>æ‰€æœ‰ä¾èµ–å…³ç³»ã€å¤´æ–‡ä»¶è·¯å¾„ã€å®å®šä¹‰ï¼Œæœ€ç»ˆéƒ½ç»‘å®šåœ¨Targetâ€¯ä¸Šã€‚</p>
<hr>
<h3 id="2-1-1-åˆ›å»ºç›®æ ‡"><a href="#2-1-1-åˆ›å»ºç›®æ ‡" class="headerlink" title="2.1.1â€¯åˆ›å»ºç›®æ ‡"></a>2.1.1â€¯åˆ›å»ºç›®æ ‡</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">add_library</span>(core STATIC core.cpp)</span><br><span class="line"><span class="keyword">add_library</span>(net SHARED net.cpp)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
<th>è¾“å‡ºå½¢å¼</th>
</tr>
</thead>
<tbody><tr>
<td><code>STATIC</code></td>
<td>é™æ€åº“</td>
<td>libcore.a &#x2F; core.lib</td>
</tr>
<tr>
<td><code>SHARED</code></td>
<td>åŠ¨æ€åº“</td>
<td>libnet.so &#x2F; net.dll</td>
</tr>
<tr>
<td><code>MODULE</code></td>
<td>æ’ä»¶æ¨¡å—åº“</td>
<td>ä»… <code>dlopen</code>&#x2F;<code>LoadLibrary</code> è°ƒç”¨åŠ è½½</td>
</tr>
<tr>
<td><em>(æ— ç±»å‹)</em></td>
<td>ç”±å˜é‡â€¯<code>BUILD_SHARED_LIBS</code>â€¯æ§åˆ¶</td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>âš™ï¸â€¯<code>add_library(core core.cpp)</code>â€¯ä¼šåœ¨å˜é‡â€¯<code>BUILD_SHARED_LIBS</code>â€¯ä¸ºâ€¯ONâ€¯æ—¶è‡ªåŠ¨ç”Ÿæˆå…±äº«åº“ã€‚  </p>
</blockquote>
<hr>
<h3 id="2-1-2-ç›®æ ‡å‘½åä¸è·¯å¾„å±æ€§"><a href="#2-1-2-ç›®æ ‡å‘½åä¸è·¯å¾„å±æ€§" class="headerlink" title="2.1.2â€¯ç›®æ ‡å‘½åä¸è·¯å¾„å±æ€§"></a>2.1.2â€¯ç›®æ ‡å‘½åä¸è·¯å¾„å±æ€§</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(core PROPERTIES</span><br><span class="line">  OUTPUT_NAME <span class="string">&quot;MyCore&quot;</span>            <span class="comment"># ç”Ÿæˆæ–‡ä»¶å</span></span><br><span class="line">  ARCHIVE_OUTPUT_DIRECTORY lib    <span class="comment"># é™æ€åº“è·¯å¾„</span></span><br><span class="line">  LIBRARY_OUTPUT_DIRECTORY lib    <span class="comment"># åŠ¨æ€åº“è·¯å¾„</span></span><br><span class="line">  RUNTIME_OUTPUT_DIRECTORY bin    <span class="comment"># å¯æ‰§è¡Œè¾“å‡ºè·¯å¾„</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>ğŸ“˜â€¯å±æ€§æ§åˆ¶å•ä¸ªç›®æ ‡çš„ç”Ÿæˆè¡Œä¸ºã€‚å¯éšæ—¶â€¯<code>get_target_property()</code>â€¯è¯»å–ã€‚</p>
<hr>
<h2 id="2-2-target-link-librariesï¼šå»ºç«‹ä¾èµ–å…³ç³»"><a href="#2-2-target-link-librariesï¼šå»ºç«‹ä¾èµ–å…³ç³»" class="headerlink" title="2.2â€¯target_link_librariesï¼šå»ºç«‹ä¾èµ–å…³ç³»"></a>2.2â€¯target_link_librariesï¼šå»ºç«‹ä¾èµ–å…³ç³»</h2><p>è¿™æ˜¯æœ€å¸¸ç”¨å‘½ä»¤ï¼Œç”¨äºå‘Šè¯‰â€¯CMakeâ€¯å¦‚ä½•æŠŠä¸€ä¸ªç›®æ ‡è¿æ¥åˆ°å¦ä¸€ä¸ªç›®æ ‡æˆ–ç³»ç»Ÿåº“ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE core pthread)</span><br></pre></td></tr></table></figure>

<p><strong>å®Œæ•´è¯­æ³•ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(&lt;<span class="keyword">target</span>&gt;</span><br><span class="line">  [PRIVATE|PUBLIC|INTERFACE] &lt;item&gt; [&lt;item&gt;...])</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
<th>ä¼ æ’­æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>PRIVATE</td>
<td>ä»…å½“å‰ç›®æ ‡ç”Ÿæ•ˆ</td>
<td>ä¸ä¼ æ’­</td>
</tr>
<tr>
<td>PUBLIC</td>
<td>å½“å‰ç›®æ ‡åŠå…¶ä¾èµ–çš„ä¸‹æ¸¸ç›®æ ‡</td>
<td>ä¼ æ’­</td>
</tr>
<tr>
<td>INTERFACE</td>
<td>æœ¬ç›®æ ‡ä¸ä½¿ç”¨ï¼Œä½†ä¸‹æ¸¸ä½¿ç”¨</td>
<td>ä»…ä¼ æ’­</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(A a.cpp)</span><br><span class="line"><span class="keyword">add_library</span>(B b.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(B PUBLIC A)</span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE B)</span><br><span class="line"><span class="comment"># app è‡ªåŠ¨è·å¾—å¯¹ A çš„é“¾æ¥ï¼šB å…¬å¸ƒäº† A ä½œä¸º PUBLIC ä¾èµ–</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="å¸¸è§åœºæ™¯ä¸¾ä¾‹"><a href="#å¸¸è§åœºæ™¯ä¸¾ä¾‹" class="headerlink" title="å¸¸è§åœºæ™¯ä¸¾ä¾‹"></a>å¸¸è§åœºæ™¯ä¸¾ä¾‹</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Header-only åº“</span></span><br><span class="line"><span class="keyword">add_library</span>(utils INTERFACE)</span><br><span class="line"><span class="keyword">target_include_directories</span>(utils INTERFACE <span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ™®é€šåº“åº”ç”¨</span></span><br><span class="line"><span class="keyword">add_library</span>(core src/core.cpp)</span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE core utils)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-3-target-include-directoriesï¼šå¤´æ–‡ä»¶è·¯å¾„"><a href="#2-3-target-include-directoriesï¼šå¤´æ–‡ä»¶è·¯å¾„" class="headerlink" title="2.3â€¯target_include_directoriesï¼šå¤´æ–‡ä»¶è·¯å¾„"></a>2.3â€¯target_include_directoriesï¼šå¤´æ–‡ä»¶è·¯å¾„</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(core</span><br><span class="line">  PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ä¿®é¥°ç¬¦</th>
<th>ä½œç”¨èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td>PRIVATE</td>
<td>æœ¬ç›®æ ‡å¯è§</td>
</tr>
<tr>
<td>INTERFACE</td>
<td>ä»…ä¾èµ–è€…å¯è§</td>
</tr>
<tr>
<td>PUBLIC</td>
<td>ä¸¤è€…éƒ½å¯è§</td>
</tr>
</tbody></table>
<p>ğŸ“˜â€¯æ¨èåšæ³•ï¼šæ¯ä¸ªåº“åœ¨è‡ªå·±çš„â€¯CMakeListsâ€¯é‡Œé€šè¿‡â€¯target_include_directoriesâ€¯å…¬å¸ƒè·¯å¾„ï¼Œè€Œä¸æ˜¯å…¨å±€â€¯include_directories()ã€‚  </p>
<hr>
<h2 id="2-4-target-compile-definitionsï¼šç¼–è¯‘å®"><a href="#2-4-target-compile-definitionsï¼šç¼–è¯‘å®" class="headerlink" title="2.4â€¯target_compile_definitionsï¼šç¼–è¯‘å®"></a>2.4â€¯target_compile_definitionsï¼šç¼–è¯‘å®</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_compile_definitions</span>(core</span><br><span class="line">  PRIVATE CORE_EXPORTS</span><br><span class="line">  PUBLIC CORE_API_LEVEL=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>ç›¸å½“äºç¼–è¯‘å‘½ä»¤ä¸­å¢åŠ â€¯<code>-DCORE_EXPORTS</code>â€¯&#x2F;â€¯<code>-DCORE_API_LEVEL=2</code>ã€‚<br>ä½¿ç”¨ä¿®é¥°ç¬¦æ§åˆ¶ä¼ æ’­èŒƒå›´ã€‚</p>
<hr>
<h2 id="2-5-target-compile-optionsï¼šæ·»åŠ ç¼–è¯‘å™¨æ ‡å¿—"><a href="#2-5-target-compile-optionsï¼šæ·»åŠ ç¼–è¯‘å™¨æ ‡å¿—" class="headerlink" title="2.5â€¯target_compile_optionsï¼šæ·»åŠ ç¼–è¯‘å™¨æ ‡å¿—"></a>2.5â€¯target_compile_optionsï¼šæ·»åŠ ç¼–è¯‘å™¨æ ‡å¿—</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_compile_options</span>(core PRIVATEWall -Wextra)</span><br><span class="line"><span class="keyword">target_compile_options</span>(app PUBLIC -O2)</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯ä¸ºä¸åŒç›®æ ‡å®šä¹‰ä¸åŒç¼–è¯‘å‚æ•°ï¼›  </li>
<li>æ”¯æŒâ€¯PRIVATE &#x2F; PUBLICâ€¯åŒæ ·ä¿®é¥°è¯ã€‚</li>
</ul>
<hr>
<h2 id="2-6-ç›®æ ‡å±æ€§-ä¸-get-set"><a href="#2-6-ç›®æ ‡å±æ€§-ä¸-get-set" class="headerlink" title="2.6â€¯ç›®æ ‡å±æ€§â€¯ä¸â€¯get&#x2F;set"></a>2.6â€¯ç›®æ ‡å±æ€§â€¯ä¸â€¯get&#x2F;set</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set_target_properties</span>(app PROPERTIES CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">get_target_property</span>(standard app CXX_STANDARD)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;C++ standard for app = $&#123;standard&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å¸¸ç”¨å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§å</th>
<th>åŠŸèƒ½</th>
<th>å–å€¼</th>
</tr>
</thead>
<tbody><tr>
<td>CXX_STANDARD</td>
<td>++â€¯æ ‡å‡†ç‰ˆæœ¬</td>
<td>11â€¯&#x2F;â€¯14â€¯&#x2F;â€¯17â€¯&#x2F;â€¯20â€¯â€¦</td>
</tr>
<tr>
<td>POSITION_INDEPENDENT_CODE</td>
<td>æ§åˆ¶â€¯fPIC</td>
<td>ONâ€¯&#x2F;â€¯OFF</td>
</tr>
<tr>
<td>LINKER_LANGUAGE</td>
<td>æŒ‡å®šé“¾æ¥è¯­è¨€</td>
<td>Câ€¯&#x2F;â€¯CXX</td>
</tr>
<tr>
<td>OUTPUT_NAME</td>
<td>è¾“å‡ºå</td>
<td>ä¾‹å¦‚â€¯MyApp</td>
</tr>
</tbody></table>
<hr>
<h2 id="2-7-å¯¼å…¥ä¸æ¥å£ç›®æ ‡"><a href="#2-7-å¯¼å…¥ä¸æ¥å£ç›®æ ‡" class="headerlink" title="2.7â€¯å¯¼å…¥ä¸æ¥å£ç›®æ ‡"></a>2.7â€¯å¯¼å…¥ä¸æ¥å£ç›®æ ‡</h2><h3 id="2-7-1-IMPORTED"><a href="#2-7-1-IMPORTED" class="headerlink" title="2.7.1â€¯IMPORTED"></a>2.7.1â€¯IMPORTED</h3><p>ä»£è¡¨å¤–éƒ¨å·²å­˜åœ¨çš„åº“ï¼Œä¸å‚ä¸æ„å»ºï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(MyExternal UNKNOWN IMPORTED)</span><br><span class="line"><span class="keyword">set_target_properties</span>(MyExternal PROPERTIES</span><br><span class="line">  IMPORTED_LOCATION /usr/lib/libext.so</span><br><span class="line">  INTERFACE_INCLUDE_DIRECTORIES /usr/<span class="keyword">include</span>/ext)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE MyExternal)</span><br></pre></td></tr></table></figure>

<h3 id="2-7-2-INTERFACE"><a href="#2-7-2-INTERFACE" class="headerlink" title="2.7.2â€¯INTERFACE"></a>2.7.2â€¯INTERFACE</h3><p>Headerâ€‘onlyâ€¯æˆ–çº¯æ¥å£ç›®æ ‡ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(header_only INTERFACE)</span><br><span class="line"><span class="keyword">target_include_directories</span>(header_only INTERFACE <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<p>ä¸ä¼šç¼–è¯‘ï¼Œåªæœ‰æ¥å£å±æ€§ã€‚</p>
<hr>
<h2 id="2-8-å‘½åç©ºé—´-NAMESPACE"><a href="#2-8-å‘½åç©ºé—´-NAMESPACE" class="headerlink" title="2.8â€¯å‘½åç©ºé—´â€¯(NAMESPACE)"></a>2.8â€¯å‘½åç©ºé—´â€¯(NAMESPACE)</h2><p>CMakeâ€¯å»ºè®®ä¸ºå¯¼å‡ºçš„ target ä½¿ç”¨ã€Œå‘½åç©ºé—´::åç§°ã€æ ¼å¼ã€‚<br>ä¾‹å¦‚â€¯<code>find_package(OpenCV)</code>â€¯åå¯ä½¿ç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE OpenCV::core)</span><br></pre></td></tr></table></figure>

<p>å½“ä½ è‡ªå·±çš„é¡¹ç›®å¯¼å‡ºæ—¶ï¼ŒåŒæ ·å¯å®šä¹‰ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjTargets</span><br><span class="line">  NAMESPACE MyProj::</span><br><span class="line">  DESTINATION lib/cmake/MyProj)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ–¹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(MyProj)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE MyProj::core)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="2-9-å¸¸è§é”™è¯¯ä¸æ’æŸ¥"><a href="#2-9-å¸¸è§é”™è¯¯ä¸æ’æŸ¥" class="headerlink" title="2.9â€¯å¸¸è§é”™è¯¯ä¸æ’æŸ¥"></a>2.9â€¯å¸¸è§é”™è¯¯ä¸æ’æŸ¥</h2><table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>ç°è±¡</th>
<th>è§£å†³</th>
</tr>
</thead>
<tbody><tr>
<td>æœªæ‰¾åˆ°æŸåº“</td>
<td>é“¾æ¥é˜¶æ®µâ€¯undefinedâ€¯reference</td>
<td>ç¡®è®¤â€¯target_link_librariesâ€¯é¡ºåºä¸ä¿®é¥°ç¬¦</td>
</tr>
<tr>
<td>includeâ€¯æ— æ•ˆ</td>
<td>ç¼–è¯‘æ—¶æŠ¥å¤´æ‰¾ä¸åˆ°</td>
<td>æ£€æŸ¥â€¯target_include_directoriesâ€¯ä¿®é¥°ç¬¦</td>
</tr>
<tr>
<td>å±æ€§æœªç”Ÿæ•ˆ</td>
<td>è¯­æ³•æ­£ç¡®ä½†ä¸æ‰§è¡Œ</td>
<td>çŠ¶æ€æ˜¯å¦è®¾ç½®åˆ°æ­£ç¡®ç›®æ ‡</td>
</tr>
<tr>
<td>æ— æ³•å¯¼å‡ºâ€¯INTERFACEâ€¯ç›®æ ‡</td>
<td>é”™è¯¯æç¤ºâ€¯â€œtarget not builtâ€</td>
<td>åŠ ä¸Šâ€¯EXPORTâ€¯å’Œâ€¯install(EXPORTâ€¯â€¦)â€¯ä¸€èµ·ä½¿ç”¨</td>
</tr>
</tbody></table>
<hr>
<h2 id="2-10-ç« èŠ‚å°ç»“"><a href="#2-10-ç« èŠ‚å°ç»“" class="headerlink" title="2.10â€¯ç« èŠ‚å°ç»“"></a>2.10â€¯ç« èŠ‚å°ç»“</h2><blockquote>
<p>ä¸€åˆ‡ç¼–è¯‘ä¸é“¾æ¥ä¿¡æ¯éƒ½ç»‘å®šåœ¨â€¯Targetâ€¯å¯¹è±¡ä¸Šã€‚  </p>
</blockquote>
<p><strong>æ„å»ºä¾èµ–é“¾ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">add_library(A)</span><br><span class="line">add_library(B)</span><br><span class="line">target_link_libraries(B PUBLIC A)</span><br><span class="line">add_executable(app)</span><br><span class="line">target_link_libraries(app PRIVATE B)</span><br></pre></td></tr></table></figure>
<p>ğŸ”â€¯CMakeâ€¯è‡ªåŠ¨æ¨å¯¼â€¯appâ€¯â†’â€¯Bâ€¯â†’â€¯Aâ€¯å®Œæ•´ä¾èµ–ï¼›<br>å¤´æ–‡ä»¶è·¯å¾„ä¸å®å®šä¹‰æŒ‰â€¯PUBLIC&#x2F;INTERFACEâ€¯ä¼ æ’­ã€‚</p>
<hr>
<p>ğŸŸ¢â€¯ç¬¬â€¯2â€¯ç« è®²å®Œï¼Œç°åœ¨ä½ æ‹¥æœ‰ï¼š</p>
<ul>
<li>å®Œæ•´â€¯Targetâ€¯å®šä¹‰æ–¹å¼  </li>
<li>é“¾æ¥ä¾èµ–çš„ä¸‰å±‚ä¿®é¥°ç¬¦è¯­ä¹‰  </li>
<li>includeâ€¯&#x2F;â€¯compileâ€¯&#x2F;â€¯macroâ€¯å±æ€§ç»‘å®š  </li>
<li>å¯¼å…¥ç›®æ ‡ä¸å‘½åç©ºé—´ç†è§£</li>
</ul>
<hr>
<hr>
<h1 id="ğŸ§©-ç¬¬-3-ç« -install-ä¸-export-æœºåˆ¶è¯¦è§£"><a href="#ğŸ§©-ç¬¬-3-ç« -install-ä¸-export-æœºåˆ¶è¯¦è§£" class="headerlink" title="ğŸ§© ç¬¬â€¯3â€¯ç« â€¯|â€¯install()â€¯ä¸â€¯export()â€¯æœºåˆ¶è¯¦è§£"></a>ğŸ§© ç¬¬â€¯3â€¯ç« â€¯|â€¯install()â€¯ä¸â€¯export()â€¯æœºåˆ¶è¯¦è§£</h1><hr>
<h2 id="3-1-ä¸ºä»€ä¹ˆè¦-install"><a href="#3-1-ä¸ºä»€ä¹ˆè¦-install" class="headerlink" title="3.1â€¯ä¸ºä»€ä¹ˆè¦â€¯install()"></a>3.1â€¯ä¸ºä»€ä¹ˆè¦â€¯install()</h2><blockquote>
<p>æ„å»ºå™¨äº§ç‰© (å¯æ‰§è¡Œæ–‡ä»¶ã€é™æ€&#x2F;åŠ¨æ€åº“ã€å¤´æ–‡ä»¶ç­‰) ä¸€èˆ¬ä¼šåˆ†å‘ç»™å…¶ä»–é¡¹ç›®æˆ–ç”¨æˆ·ä½¿ç”¨ï¼Œ<br>CMakeâ€¯çš„â€¯<code>install()</code>â€¯ç”¨äºå®šä¹‰â€œå“ªäº›æ–‡ä»¶ã€æ”¾åˆ°å“ªé‡Œã€è£…æˆä»€ä¹ˆç»“æ„â€ã€‚</p>
</blockquote>
<hr>
<h2 id="3-2-åŸºæœ¬è¯­æ³•åˆ†ç±»"><a href="#3-2-åŸºæœ¬è¯­æ³•åˆ†ç±»" class="headerlink" title="3.2â€¯åŸºæœ¬è¯­æ³•åˆ†ç±»"></a>3.2â€¯åŸºæœ¬è¯­æ³•åˆ†ç±»</h2><ol>
<li><strong>å®‰è£…ç›®æ ‡</strong><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS &lt;targets&gt; [<span class="keyword">EXPORT</span> &lt;<span class="keyword">export</span>-<span class="keyword">set</span>&gt;]</span><br><span class="line">        [RUNTIME DESTINATION &lt;dir&gt;]</span><br><span class="line">        [LIBRARY DESTINATION &lt;dir&gt;]</span><br><span class="line">        [ARCHIVE DESTINATION &lt;dir&gt;]</span><br><span class="line">        [PUBLIC_HEADER DESTINATION &lt;dir&gt;]</span><br><span class="line">        [INCLUDES DESTINATION &lt;dir&gt;])</span><br></pre></td></tr></table></figure></li>
<li><strong>å®‰è£…æ™®é€šæ–‡ä»¶</strong><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(FILES &lt;files&gt; DESTINATION &lt;dir&gt;)</span><br></pre></td></tr></table></figure></li>
<li><strong>å®‰è£…æ•´ä¸ªç›®å½•</strong><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(DIRECTORY &lt;path&gt; DESTINATION &lt;dir&gt; [FILES_MATCHING PATTERN <span class="string">&quot;*.h&quot;</span>])</span><br></pre></td></tr></table></figure></li>
<li><strong>å®‰è£…å¯¼å‡ºæ¸…å•ï¼ˆç”Ÿæˆ Config åŒ…ï¼‰</strong><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> &lt;<span class="keyword">export</span>-<span class="keyword">set</span>&gt;</span><br><span class="line">        <span class="keyword">FILE</span> &lt;config.cmake&gt;</span><br><span class="line">        NAMESPACE &lt;ns&gt;::</span><br><span class="line">        DESTINATION &lt;path&gt;)</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="3-3-ä¸»è¦å‚æ•°è¯´æ˜"><a href="#3-3-ä¸»è¦å‚æ•°è¯´æ˜" class="headerlink" title="3.3â€¯ä¸»è¦å‚æ•°è¯´æ˜"></a>3.3â€¯ä¸»è¦å‚æ•°è¯´æ˜</h2><table>
<thead>
<tr>
<th>å­å…³é”®å­—</th>
<th>è¯´æ˜</th>
<th>å…¸å‹å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td><strong>RUNTIME</strong></td>
<td>å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºè·¯å¾„</td>
<td><code>$&#123;CMAKE_INSTALL_BINDIR&#125;</code> (<code>bin</code>)</td>
</tr>
<tr>
<td><strong>LIBRARY</strong></td>
<td>åŠ¨æ€åº“(<code>.so/.dll</code>)è·¯å¾„</td>
<td><code>$&#123;CMAKE_INSTALL_LIBDIR&#125;</code></td>
</tr>
<tr>
<td><strong>ARCHIVE</strong></td>
<td>é™æ€åº“(<code>.a/.lib</code>)è·¯å¾„</td>
<td>åŒä¸Š</td>
</tr>
<tr>
<td><strong>PUBLIC_HEADER</strong></td>
<td>å…¬å…±å¤´æ–‡ä»¶å®‰è£…ç›®å½•</td>
<td><code>$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</code></td>
</tr>
<tr>
<td><strong>INCLUDES</strong></td>
<td>å¤´æ–‡ä»¶åŒ…å«ç›®å½•æç¤º</td>
<td>ä¾›â€¯<code>EXPORT</code>â€¯ç”Ÿæˆä¿¡æ¯ä½¿ç”¨</td>
</tr>
</tbody></table>
<p>ğŸ§ â€¯æç¤ºï¼š<br><code>include(GNUInstallDirs)</code>â€¯å¯è·å¾—æ ‡å‡†ç›®å½•å˜é‡ï¼Œå¦‚â€¯<code>CMAKE_INSTALL_BINDIR</code>ã€<code>LIBDIR</code>ã€<code>INCLUDEDIR</code>â€¯ç­‰ï¼Œä¾¿äºè·¨å¹³å°ç»Ÿä¸€ã€‚</p>
<hr>
<h2 id="3-4-ç¤ºä¾‹ï¼šå®‰è£…åº“ä¸å¯æ‰§è¡Œæ–‡ä»¶"><a href="#3-4-ç¤ºä¾‹ï¼šå®‰è£…åº“ä¸å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="3.4â€¯ç¤ºä¾‹ï¼šå®‰è£…åº“ä¸å¯æ‰§è¡Œæ–‡ä»¶"></a>3.4â€¯ç¤ºä¾‹ï¼šå®‰è£…åº“ä¸å¯æ‰§è¡Œæ–‡ä»¶</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(GNUInstallDirs)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(core SHARED core.cpp)</span><br><span class="line"><span class="keyword">target_include_directories</span>(core PUBLIC <span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE core)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(TARGETS core app</span><br><span class="line">  RUNTIME DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_BINDIR&#125;</span></span><br><span class="line">  LIBRARY DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">  PUBLIC_HEADER DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span>/core)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --install build --prefix ./install</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">install/</span><br><span class="line">â”œâ”€ bin/app</span><br><span class="line">â”œâ”€ lib/libcore.so</span><br><span class="line">â””â”€ include/core/core.h</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-5-install-EXPORT-ç”Ÿæˆ-Config-åŒ…"><a href="#3-5-install-EXPORT-ç”Ÿæˆ-Config-åŒ…" class="headerlink" title="3.5â€¯install(EXPORT)â€¯ç”Ÿæˆâ€¯Configâ€¯åŒ…"></a>3.5â€¯install(EXPORT)â€¯ç”Ÿæˆâ€¯Configâ€¯åŒ…</h2><p>è®©åˆ«çš„é¡¹ç›®å¯ä»¥ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(MyProj REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(other PRIVATE MyProj::core)</span><br></pre></td></tr></table></figure>

<p>å°±å¿…é¡»å¯¼å‡ºè‡ªèº«çš„ç›®æ ‡æè¿°æ–‡ä»¶ã€‚</p>
<h3 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h3><p>1ï¸âƒ£ æ³¨å†Œå¯¼å‡ºæ¸…å•åï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS core <span class="keyword">EXPORT</span> MyProjTargets</span><br><span class="line">        LIBRARY DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">        PUBLIC_HEADER DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span>/core)</span><br></pre></td></tr></table></figure>
<p>2ï¸âƒ£ å†™å‡ºæ¸…å•åˆ°â€¯cmake&#x2F;â€¯ç›®å½•ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjTargets</span><br><span class="line">        <span class="keyword">FILE</span> MyProjTargets.cmake</span><br><span class="line">        NAMESPACE MyProj::</span><br><span class="line">        DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/MyProj)</span><br></pre></td></tr></table></figure>
<p>3ï¸âƒ£ ç”Ÿæˆé¡¶å±‚â€¯Configâ€¯æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">configure_file</span>(MyProjConfig.cmake.in</span><br><span class="line">               <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjConfig.cmake&quot;</span> @ONLY)</span><br><span class="line"><span class="keyword">install</span>(FILES <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjConfig.cmake&quot;</span></span><br><span class="line">        DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/MyProj)</span><br></pre></td></tr></table></figure>

<p>ä¹‹åï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --install build --prefix ./package</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ä¸ªå·¥ç¨‹ä¸­ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(MyProj_DIR <span class="string">&quot;/path/to/package/lib/cmake/MyProj&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(MyProj)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(userApp PRIVATE MyProj::core)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-6-å¯¼å‡ºæ¸…å•ä¸å‘½åç©ºé—´ï¼ˆNAMESPACEï¼‰"><a href="#3-6-å¯¼å‡ºæ¸…å•ä¸å‘½åç©ºé—´ï¼ˆNAMESPACEï¼‰" class="headerlink" title="3.6â€¯å¯¼å‡ºæ¸…å•ä¸å‘½åç©ºé—´ï¼ˆNAMESPACEï¼‰"></a>3.6â€¯å¯¼å‡ºæ¸…å•ä¸å‘½åç©ºé—´ï¼ˆNAMESPACEï¼‰</h2><ul>
<li><code>EXPORT &lt;name&gt;</code>â€¯åªæ˜¯ä¸€ä¸ªæ”¶é›†å™¨æ¸…å•ã€‚  </li>
<li><code>NAMESPACE</code>â€¯å®šä¹‰å¯¼å…¥ç›®æ ‡å‰ç¼€ï¼Œç”¨äºé˜²æ­¢å‘½åå†²çªã€‚</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MathKitTargets</span><br><span class="line">        <span class="keyword">FILE</span> MathKitConfig.cmake</span><br><span class="line">        NAMESPACE MathKit::</span><br><span class="line">        DESTINATION lib/cmake/MathKit)</span><br></pre></td></tr></table></figure>

<p>æ¶ˆè´¹è€…å·¥ç¨‹å³å¯å®‰å…¨è°ƒç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE MathKit::algebra)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-7-install-FILES-DIRECTORY-å¸¸è§„ç”¨é€”"><a href="#3-7-install-FILES-DIRECTORY-å¸¸è§„ç”¨é€”" class="headerlink" title="3.7â€¯install(FILES | DIRECTORY)â€¯å¸¸è§„ç”¨é€”"></a>3.7â€¯install(FILES | DIRECTORY)â€¯å¸¸è§„ç”¨é€”</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç”¨é€”</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>FILES</td>
<td>å®‰è£…è‹¥å¹²æ–‡ä»¶</td>
<td><code>install(FILES config.toml DESTINATION etc)</code></td>
</tr>
<tr>
<td>DIRECTORY</td>
<td>æ‹·è´æ•´ä¸ªç›®å½•</td>
<td><code>install(DIRECTORY shaders DESTINATION share)</code></td>
</tr>
<tr>
<td>DIRECTORYâ€¯+â€¯è¿‡æ»¤</td>
<td>ä»…åŒ¹é…ç‰¹å®šæ–‡ä»¶</td>
<td><code>install(DIRECTORY include/ DESTINATION include FILES_MATCHING PATTERN &quot;*.h&quot;)</code></td>
</tr>
</tbody></table>
<hr>
<h2 id="3-8-é…ç½®æ–‡ä»¶æ¨¡æ¿-configure-file"><a href="#3-8-é…ç½®æ–‡ä»¶æ¨¡æ¿-configure-file" class="headerlink" title="3.8â€¯é…ç½®æ–‡ä»¶æ¨¡æ¿â€¯configure_file()"></a>3.8â€¯é…ç½®æ–‡ä»¶æ¨¡æ¿â€¯configure_file()</h2><p>åœ¨â€¯installâ€¯ç”Ÿæˆâ€¯Configâ€¯è¿‡ç¨‹ä¸­å¸¸éœ€è¦å†™å…¥è·¯å¾„ä¿¡æ¯ã€‚  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">configure_file</span>(</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake/MyProjConfig.cmake.in&quot;</span></span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/MyProjConfig.cmake&quot;</span></span><br><span class="line">  @ONLY)</span><br></pre></td></tr></table></figure>

<p><strong>æ¨¡æ¿å†…å®¹ç¤ºæ„ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MyProjConfig.cmake.in</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/MyProjTargets.cmake&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(MyProj_VERSION <span class="string">&quot;@PROJECT_VERSION@&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­â€¯<code>@PROJECT_VERSION@</code>â€¯ç­‰å ä½ç¬¦ä¼šè¢«æ›¿æ¢ã€‚</p>
<hr>
<h2 id="3-9-å¸¸è§-install-å˜é‡"><a href="#3-9-å¸¸è§-install-å˜é‡" class="headerlink" title="3.9â€¯å¸¸è§ install å˜é‡"></a>3.9â€¯å¸¸è§ install å˜é‡</h2><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_INSTALL_PREFIX</code></td>
<td>å®‰è£…æ ¹è·¯å¾„</td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_BINDIR</code></td>
<td>é»˜è®¤ <code>bin</code></td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_LIBDIR</code></td>
<td>é»˜è®¤ <code>lib</code> &#x2F; <code>lib64</code></td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_INCLUDEDIR</code></td>
<td>é»˜è®¤ <code>include</code></td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_DATADIR</code></td>
<td><code>share</code></td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_SYSCONFDIR</code></td>
<td><code>etc</code></td>
</tr>
</tbody></table>
<p>å‘½ä»¤è¡Œè¦†å†™ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --install build --prefix /opt/MyProj</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="3-10-å¸¸è§é—®é¢˜-Q-A"><a href="#3-10-å¸¸è§é—®é¢˜-Q-A" class="headerlink" title="3.10â€¯å¸¸è§é—®é¢˜â€¯Q&amp;A"></a>3.10â€¯å¸¸è§é—®é¢˜â€¯Q&amp;A</h2><table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>åŸå› </th>
<th>è§£å†³</th>
</tr>
</thead>
<tbody><tr>
<td>å®‰è£…è·¯å¾„ä¸å¯¹</td>
<td>å¿˜è®°åŒ…å«â€¯GNUInstallDirs</td>
<td><code>include(GNUInstallDirs)</code></td>
</tr>
<tr>
<td>find_packageâ€¯æ‰¾ä¸åˆ°</td>
<td>æœªç”Ÿæˆâ€¯Config.cmake</td>
<td>è¯·åŠ â€¯install(EXPORTâ€¦)</td>
</tr>
<tr>
<td>Headerâ€¯æœªéšåº“å®‰è£…</td>
<td>æœªæŒ‡å®šâ€¯PUBLIC_HEADER&#x2F;FILESâ€¯æˆ–è·¯å¾„é”™è¯¯</td>
<td>ç¡®è®¤â€¯ç›®æ ‡â€¯PUBLIC_HEADERâ€¯æˆ–æ˜¾å¼â€¯install(FILES)</td>
</tr>
<tr>
<td>namespaceâ€¯å¤±æ•ˆ</td>
<td>æ²¡åœ¨â€¯install(EXPORT)â€¯é‡Œå£°æ˜â€¯NAMESPACE</td>
<td>è¡¥åŠ â€¯NAMESPACEâ€¯MyProj::</td>
</tr>
</tbody></table>
<hr>
<h2 id="3-11-ç« èŠ‚å°ç»“"><a href="#3-11-ç« èŠ‚å°ç»“" class="headerlink" title="3.11â€¯ç« èŠ‚å°ç»“"></a>3.11â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯æœ¬ç« ä½ åº”æŒæ¡ï¼š</p>
<ul>
<li>installâ€¯ä¸‰å¤§ç”¨æ³•:â€¯(TARGETS &#x2F; FILES &#x2F; DIRECTORY)  </li>
<li>exportâ€¯å¯¼å‡ºæœºåˆ¶â€¯+â€¯ç”Ÿæˆâ€¯Configâ€¯åŒ…æ­¥éª¤  </li>
<li>GNUInstallDirsâ€¯æ ‡å‡†è·¯å¾„é›†åˆ  </li>
<li>namespaceâ€¯çš„æ„ä¹‰ä¸ä½¿ç”¨  </li>
<li>å¸¸è§é”™è¯¯å®šä½</li>
</ul>
<hr>
<hr>
<h1 id="ğŸ”-ç¬¬-4-ç« -find-package-ä¸-CMake-åŒ…ï¼ˆPackageï¼‰æœºåˆ¶å®æˆ˜"><a href="#ğŸ”-ç¬¬-4-ç« -find-package-ä¸-CMake-åŒ…ï¼ˆPackageï¼‰æœºåˆ¶å®æˆ˜" class="headerlink" title="ğŸ” ç¬¬â€¯4â€¯ç« â€¯|â€¯find_package()â€¯ä¸â€¯CMakeâ€¯åŒ…ï¼ˆPackageï¼‰æœºåˆ¶å®æˆ˜"></a>ğŸ” ç¬¬â€¯4â€¯ç« â€¯|â€¯find_package()â€¯ä¸â€¯CMakeâ€¯åŒ…ï¼ˆPackageï¼‰æœºåˆ¶å®æˆ˜</h1><hr>
<h2 id="4-1-find-package-çš„ä½¿å‘½"><a href="#4-1-find-package-çš„ä½¿å‘½" class="headerlink" title="4.1â€¯find_packageâ€¯çš„ä½¿å‘½"></a>4.1â€¯find_packageâ€¯çš„ä½¿å‘½</h2><blockquote>
<p>CMakeâ€¯å…è®¸ä½ å¤ç”¨å¤–éƒ¨åº“ï¼Œä½†å®ƒå¿…é¡»<strong>çŸ¥é“æ€ä¹ˆæ‰¾åˆ°è¿™äº›åº“</strong>ã€‚<br><code>find_package()</code>â€¯å°±æ˜¯è¿æ¥é¡¹ç›®ä¾èµ–ä¸å®é™…è·¯å¾„çš„æ¡¥æ¢ã€‚  </p>
</blockquote>
<p>å®ƒä¼šå»ç³»ç»Ÿè·¯å¾„åŠç”¨æˆ·æŒ‡å®šè·¯å¾„æœç´¢åŒ¹é…çš„æè¿°æ–‡ä»¶æ¥å®šä½å¹¶å¯¼å…¥åº“çš„ Targetsã€‚  </p>
<hr>
<h2 id="4-2-ä¸¤ç§åŒ…æ¨¡å¼"><a href="#4-2-ä¸¤ç§åŒ…æ¨¡å¼" class="headerlink" title="4.2â€¯ä¸¤ç§åŒ…æ¨¡å¼"></a>4.2â€¯ä¸¤ç§åŒ…æ¨¡å¼</h2><table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>æ–‡ä»¶ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Config æ¨¡å¼</strong></td>
<td><code>&lt;Name&gt;Config.cmake</code>â€¯&#x2F; <code>&lt;Name&gt;-config.cmake</code></td>
<td>æ¨èã€ç°ä»£é¡¹ç›®ï¼ˆä½¿ç”¨â€¯targetï¼‰å¯¼å‡ºä½¿ç”¨</td>
</tr>
<tr>
<td><strong>Module æ¨¡å¼</strong></td>
<td><code>Find&lt;Name&gt;.cmake</code></td>
<td>ä¼ ç»Ÿæ‰‹å†™æœç´¢è„šæœ¬</td>
</tr>
</tbody></table>
<p><code>find_package(MyProj)</code>â€¯ä¾æ¬¡å°è¯•ï¼š<br>1ï¸âƒ£â€¯åœ¨è·¯å¾„ä¸­æŸ¥æ‰¾â€¯<code>MyProjConfig.cmake</code>â€¯æˆ–â€¯<code>MyProj-config.cmake</code>;<br>2ï¸âƒ£â€¯è‹¥æ‰¾ä¸åˆ°ï¼Œå†æŸ¥æ˜¯å¦æœ‰â€¯<code>FindMyProj.cmake</code>â€¯æ¨¡å—ã€‚  </p>
<hr>
<h2 id="4-3-Config-æ¨¡å¼å·¥ä½œåŸç†"><a href="#4-3-Config-æ¨¡å¼å·¥ä½œåŸç†" class="headerlink" title="4.3â€¯Config æ¨¡å¼å·¥ä½œåŸç†"></a>4.3â€¯Config æ¨¡å¼å·¥ä½œåŸç†</h2><p>å½“æˆ‘ä»¬ä¸Šä¸€ç« é€šè¿‡  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjTargets</span><br><span class="line">        <span class="keyword">FILE</span> MyProjTargets.cmake</span><br><span class="line">        NAMESPACE MyProj::</span><br><span class="line">        DESTINATION lib/cmake/MyProj)</span><br><span class="line"><span class="keyword">install</span>(FILES MyProjConfig.cmake DESTINATION lib/cmake/MyProj)</span><br><span class="line">```  </span><br><span class="line">ç”Ÿæˆè¿™äº›æ–‡ä»¶åï¼Œ  </span><br><span class="line">å¤–éƒ¨é¡¹ç›®è°ƒç”¨ï¼š</span><br><span class="line"></span><br><span class="line">```cmake</span><br><span class="line"><span class="keyword">find_package</span>(MyProj REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE MyProj::core)</span><br></pre></td></tr></table></figure>

<p>CMake æŸ¥æ‰¾é¡ºåºï¼ˆç®€ç•¥ï¼‰ï¼š</p>
<ol>
<li>å˜é‡â€¯<code>MyProj_DIR</code>â€¯æŒ‡å®šçš„ç›®å½•  </li>
<li>ç³»ç»Ÿè·¯å¾„ <code>/usr/lib/cmake/MyProj</code>â€¯ç­‰  </li>
<li>ç”¨æˆ·è‡ªå®šä¹‰åŒ…æ³¨å†Œè·¯å¾„</li>
</ol>
<p>æ‰¾åˆ°â€¯<code>MyProjConfig.cmake</code>â€¯åï¼Œè¯¥æ–‡ä»¶æ‰§è¡Œâ€¯<code>include(MyProjTargets.cmake)</code>â€¯ï¼Œä»è€Œå¯¼å…¥â€¯MyProj::coreã€‚  </p>
<hr>
<h3 id="4-3-1-Config-æ–‡ä»¶æ¨¡æ¿å¿«é€Ÿç¤ºä¾‹"><a href="#4-3-1-Config-æ–‡ä»¶æ¨¡æ¿å¿«é€Ÿç¤ºä¾‹" class="headerlink" title="4.3.1â€¯Config æ–‡ä»¶æ¨¡æ¿å¿«é€Ÿç¤ºä¾‹"></a>4.3.1â€¯Config æ–‡ä»¶æ¨¡æ¿å¿«é€Ÿç¤ºä¾‹</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># MyProjConfig.cmake.in</span></span><br><span class="line">@PACKAGE_INIT@</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/MyProjTargets.cmake&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(MyProj_VERSION <span class="string">&quot;@PROJECT_VERSION@&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">configure_package_config_file(</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/MyProjConfig.cmake.in&quot;</span></span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjConfig.cmake&quot;</span></span><br><span class="line">  INSTALL_DESTINATION lib/cmake/MyProj)</span><br><span class="line"><span class="keyword">install</span>(FILES <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjConfig.cmake&quot;</span></span><br><span class="line">        DESTINATION lib/cmake/MyProj)</span><br></pre></td></tr></table></figure>

<p>ğŸ“˜ <code>configure_package_config_file</code>â€¯æ˜¯å®˜æ–¹å®ï¼ˆæ¥è‡ªâ€¯CMakePackageConfigHelpersï¼‰ï¼Œ<br>ä¼šè‡ªåŠ¨å¡«å……ç‰ˆæœ¬ä¸è·¯å¾„ç­‰ä¿¡æ¯ã€‚</p>
<hr>
<h2 id="4-4-Find-æ¨¡å¼å·¥ä½œåŸç†"><a href="#4-4-Find-æ¨¡å¼å·¥ä½œåŸç†" class="headerlink" title="4.4â€¯Find æ¨¡å¼å·¥ä½œåŸç†"></a>4.4â€¯Find æ¨¡å¼å·¥ä½œåŸç†</h2><p>æ—§å¼é¡¹ç›®æˆ–ç³»ç»Ÿåº“é€šå¸¸åªæä¾›â€¯<code>FindXXX.cmake</code>ï¼š</p>
<p>å­˜æ”¾åœ¨ <code>$CMAKE_MODULE_PATH</code>â€¯&#x2F;â€¯ç³»ç»Ÿâ€¯Modulesâ€¯è·¯å¾„ä¸‹ã€‚  </p>
<p>ç¤ºä¾‹ï¼ˆç³»ç»Ÿè‡ªå¸¦ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FindThreads.cmake</span><br><span class="line">FindPkgConfig.cmake</span><br><span class="line">FindOpenGL.cmake</span><br><span class="line">FindPython3.cmake</span><br></pre></td></tr></table></figure>

<p>å†…éƒ¨åŸºæœ¬æµç¨‹ï¼š</p>
<ol>
<li>å°è¯•ä½¿ç”¨â€¯pkg-configã€ç³»ç»Ÿå˜é‡ã€é»˜è®¤è·¯å¾„æœç´¢å¤´æ–‡ä»¶ä¸åº“ï¼›</li>
<li>è‹¥æˆåŠŸè®¾ç½®ä»¥ä¸‹å˜é‡ï¼š<ul>
<li><code>&lt;Pkg&gt;_FOUND</code></li>
<li><code>&lt;Pkg&gt;_INCLUDE_DIRS</code></li>
<li><code>&lt;Pkg&gt;_LIBRARIES</code></li>
</ul>
</li>
<li>ä½¿ç”¨ç¤ºä¾‹ï¼š<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(OpenGL REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE OpenGL::GL)</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="4-5-æœç´¢è·¯å¾„ä¸æ§åˆ¶å˜é‡"><a href="#4-5-æœç´¢è·¯å¾„ä¸æ§åˆ¶å˜é‡" class="headerlink" title="4.5â€¯æœç´¢è·¯å¾„ä¸æ§åˆ¶å˜é‡"></a>4.5â€¯æœç´¢è·¯å¾„ä¸æ§åˆ¶å˜é‡</h2><table>
<thead>
<tr>
<th>å˜é‡ &#x2F;é€‰é¡¹</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;Pkg&gt;_DIR</code></td>
<td>æŒ‡å®š Config æ–‡ä»¶ç›®å½•</td>
</tr>
<tr>
<td><code>CMAKE_PREFIX_PATH</code></td>
<td>é™„åŠ æœç´¢æ ¹</td>
</tr>
<tr>
<td><code>CMAKE_MODULE_PATH</code></td>
<td>é™„åŠ æ¨¡å—æœç´¢è·¯å¾„</td>
</tr>
<tr>
<td><code>CMAKE_FIND_ROOT_PATH</code></td>
<td>äº¤å‰ç¼–è¯‘æ ¹è·¯å¾„</td>
</tr>
<tr>
<td><code>NO_DEFAULT_PATH</code></td>
<td>å…³é—­é»˜è®¤è·¯å¾„æœç´¢</td>
</tr>
<tr>
<td><code>PATHS</code> &#x2F; <code>HINTS</code></td>
<td>ä¸´æ—¶æŒ‡æ˜å€™é€‰è·¯å¾„</td>
</tr>
</tbody></table>
<p>ğŸ’¡ å¸¸ç”¨ä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_PREFIX_PATH <span class="string">&quot;/opt/mylibs;/usr/local&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(MyProj REQUIRED)</span><br></pre></td></tr></table></figure>
<p>æˆ–å‘½ä»¤è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_PREFIX_PATH=/opt/mylibs ..</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-6-ç‰ˆæœ¬ä¸å¯é€‰é¡¹"><a href="#4-6-ç‰ˆæœ¬ä¸å¯é€‰é¡¹" class="headerlink" title="4.6â€¯ç‰ˆæœ¬ä¸å¯é€‰é¡¹"></a>4.6â€¯ç‰ˆæœ¬ä¸å¯é€‰é¡¹</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Qt6 <span class="number">6.5</span> COMPONENTS Core Gui Widgets REQUIRED)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><strong><code>&lt;Name&gt;</code></strong></td>
<td>åŒ…å</td>
</tr>
<tr>
<td><strong><code>&lt;Version&gt;</code></strong></td>
<td>æœ€ä½ç‰ˆæœ¬è¦æ±‚</td>
</tr>
<tr>
<td><strong>COMPONENTS</strong></td>
<td>æŒ‡å®šå­æ¨¡å—</td>
</tr>
<tr>
<td><strong>CONFIG &#x2F; MODULE</strong></td>
<td>æŒ‡å®šæœç´¢æ¨¡å¼</td>
</tr>
<tr>
<td><strong>REQUIRED</strong></td>
<td>æ‰¾ä¸åˆ°åˆ™ç«‹å³æŠ¥é”™</td>
</tr>
<tr>
<td><strong>QUIET</strong></td>
<td>é™é»˜æœç´¢ï¼Œä¸æç¤º</td>
</tr>
</tbody></table>
<p>Package æ–‡ä»¶å¯æä¾›ï¼š</p>
<ul>
<li><code>&lt;Name&gt;_FOUND</code></li>
<li><code>&lt;Name&gt;_VERSION</code></li>
<li><code>&lt;Name&gt;_COMPONENTS_FOUND</code></li>
</ul>
<hr>
<h2 id="4-7-CMakePackageConfigHelpers-å·¥å…·"><a href="#4-7-CMakePackageConfigHelpers-å·¥å…·" class="headerlink" title="4.7â€¯CMakePackageConfigHelpers å·¥å…·"></a>4.7â€¯CMakePackageConfigHelpers å·¥å…·</h2><p>æä¾›ä¸¤ä¸ªæ ¸å¿ƒå®ï¼š</p>
<ol>
<li><code>configure_package_config_file()</code>  </li>
<li><code>write_basic_package_version_file()</code></li>
</ol>
<p>ç”ŸæˆåŸºç¡€â€¯Configâ€¯ä¸â€¯Versionâ€¯æ–‡ä»¶ï¼Œè®©é¡¹ç›®è‡ªåŠ¨æ”¯æŒç‰ˆæœ¬æ£€æµ‹ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(CMakePackageConfigHelpers)</span><br><span class="line"></span><br><span class="line">write_basic_package_version_file(</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjConfigVersion.cmake&quot;</span></span><br><span class="line">  VERSION <span class="variable">$&#123;PROJECT_VERSION&#125;</span></span><br><span class="line">  COMPATIBILITY SameMajorVersion)</span><br><span class="line"><span class="keyword">install</span>(FILES</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjConfigVersion.cmake&quot;</span></span><br><span class="line">  DESTINATION lib/cmake/MyProj)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-8-è·¨å¹³å°-Find-å®æˆ˜ä¸¾ä¾‹"><a href="#4-8-è·¨å¹³å°-Find-å®æˆ˜ä¸¾ä¾‹" class="headerlink" title="4.8â€¯è·¨å¹³å° Find å®æˆ˜ä¸¾ä¾‹"></a>4.8â€¯è·¨å¹³å° Find å®æˆ˜ä¸¾ä¾‹</h2><h3 id="1-æŸ¥æ‰¾ç³»ç»Ÿåº“-OpenSSL"><a href="#1-æŸ¥æ‰¾ç³»ç»Ÿåº“-OpenSSL" class="headerlink" title="(1)â€¯æŸ¥æ‰¾ç³»ç»Ÿåº“ OpenSSL"></a>(1)â€¯æŸ¥æ‰¾ç³»ç»Ÿåº“ OpenSSL</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(OpenSSL REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE OpenSSL::SSL OpenSSL::Crypto)</span><br></pre></td></tr></table></figure>

<h3 id="2-æŸ¥æ‰¾è‡ªå®šä¹‰åŒ…è·¯å¾„"><a href="#2-æŸ¥æ‰¾è‡ªå®šä¹‰åŒ…è·¯å¾„" class="headerlink" title="(2)â€¯æŸ¥æ‰¾è‡ªå®šä¹‰åŒ…è·¯å¾„"></a>(2)â€¯æŸ¥æ‰¾è‡ªå®šä¹‰åŒ…è·¯å¾„</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(MyLib_DIR <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/third_party/mylib&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(MyLib CONFIG REQUIRED)</span><br></pre></td></tr></table></figure>

<h3 id="3-ä½¿ç”¨-pkg-config-æ¨¡å¼"><a href="#3-ä½¿ç”¨-pkg-config-æ¨¡å¼" class="headerlink" title="(3)â€¯ä½¿ç”¨â€¯pkg-configâ€¯æ¨¡å¼"></a>(3)â€¯ä½¿ç”¨â€¯pkg-configâ€¯æ¨¡å¼</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(PkgConfig REQUIRED)</span><br><span class="line">pkg_check_modules(ZLIB REQUIRED zlib)</span><br><span class="line"><span class="keyword">target_include_directories</span>(app PRIVATE <span class="variable">$&#123;ZLIB_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE <span class="variable">$&#123;ZLIB_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="4-9-æŸ¥æ‰¾ä¼˜å…ˆçº§ç®€åŒ–æµç¨‹"><a href="#4-9-æŸ¥æ‰¾ä¼˜å…ˆçº§ç®€åŒ–æµç¨‹" class="headerlink" title="4.9â€¯æŸ¥æ‰¾ä¼˜å…ˆçº§ç®€åŒ–æµç¨‹"></a>4.9â€¯æŸ¥æ‰¾ä¼˜å…ˆçº§ç®€åŒ–æµç¨‹</h2><p>1ï¸âƒ£ ç›´æ¥æŒ‡å®š <code>&lt;Pkg&gt;_DIR</code><br>2ï¸âƒ£ æŸ¥â€¯CMAKE_PREFIX_PATH<br>3ï¸âƒ£ æŸ¥â€¯ç³»ç»Ÿé»˜è®¤è·¯å¾„â€¯(&#x2F;usr&#x2F;lib&#x2F;cmake&#x2F;<Pkg>)<br>4ï¸âƒ£ æŸ¥â€¯CMAKE_MODULE_PATH<br>â¡ï¸ æœ€å fallback åˆ°å†…ç½®â€¯FindXXX.cmake  </p>
<hr>
<h2 id="4-10-å¸¸è§é—®é¢˜ä¸ç»éªŒ"><a href="#4-10-å¸¸è§é—®é¢˜ä¸ç»éªŒ" class="headerlink" title="4.10â€¯å¸¸è§é—®é¢˜ä¸ç»éªŒ"></a>4.10â€¯å¸¸è§é—®é¢˜ä¸ç»éªŒ</h2><table>
<thead>
<tr>
<th>é—®é¢˜</th>
<th>åŸå› </th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td>åŒ…æ‰¾ä¸åˆ°</td>
<td>æœç´¢è·¯å¾„æœªåŒ…å«å®‰è£…ç›®å½•</td>
<td>è®¾ç½®â€¯<code>&lt;Pkg&gt;_DIR</code>â€¯æˆ–â€¯<code>CMAKE_PREFIX_PATH</code></td>
</tr>
<tr>
<td>é“¾æ¥æŠ¥é”™</td>
<td>æœªä½¿ç”¨â€¯targetâ€¯æ¥å£</td>
<td>ç¡®ä¿ç›®æ ‡å¯¼å‡ºâ€¯namespaceâ€¯å¹¶ä½¿ç”¨â€¯target_link_libraries</td>
</tr>
<tr>
<td>æ‰¾åˆ°äº†æ—§ç‰ˆæœ¬åŒ…</td>
<td>å­˜åœ¨å¤šä¸ªå®‰è£…è·¯å¾„</td>
<td>æ˜¾å¼æŒ‡å®šç‰ˆæœ¬æˆ–è·¯å¾„</td>
</tr>
<tr>
<td>â€œfound falseâ€â€¯ä½†å¤´æ–‡ä»¶å­˜åœ¨</td>
<td>æ— æ­£ç¡®â€¯Configâ€¯æˆ–â€¯Findâ€¯æ¨¡å—</td>
<td>è‡ªå·±å†™â€¯Findâ€¯è„šæœ¬æˆ–åˆ‡æ¢â€¯CONFIGâ€¯æ¨¡å¼</td>
</tr>
<tr>
<td>äº¤å‰ç¼–è¯‘ä¸­æ‰¾é”™ä½“ç³»åº“</td>
<td>PATHâ€¯æœªé‡å®šä½</td>
<td>è®¾ç½®â€¯<code>CMAKE_FIND_ROOT_PATH_MODE_*</code>â€¯ç­–ç•¥</td>
</tr>
</tbody></table>
<hr>
<h2 id="4-11-ç« èŠ‚å°ç»“"><a href="#4-11-ç« èŠ‚å°ç»“" class="headerlink" title="4.11â€¯ç« èŠ‚å°ç»“"></a>4.11â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯æœ¬ç« è¦ç‚¹ï¼š  </p>
<ul>
<li><strong>ä¸¤ç§åŒ…æ¨¡å¼</strong>ï¼šConfigâ€¯(ç°ä»£)â€¯vsâ€¯Moduleâ€¯(ä¼ ç»Ÿ)  </li>
<li><strong>find_package</strong>â€¯æœç´¢è·¯å¾„ä¸å˜é‡æ§åˆ¶  </li>
<li><strong>Config&#x2F;Version</strong>â€¯æ–‡ä»¶ç”Ÿæˆå®ä¸ä½¿ç”¨  </li>
<li><strong>ä¼ æ’­ç›®æ ‡</strong>ï¼šé€šè¿‡â€¯namespaceâ€¯å¯¼å‡ºçš„â€¯Target  </li>
<li><strong>å¸¸è§é”™è¯¯æ’æŸ¥æ–¹æ³•</strong></li>
</ul>
<hr>
<hr>
<h1 id="ğŸ§±-ç¬¬-5-å¤šç›®å½•ä¸å­é¡¹ç›®ç®¡ç†ï¼šadd-subdirectory-ä¸-FetchContent-å®æˆ˜"><a href="#ğŸ§±-ç¬¬-5-å¤šç›®å½•ä¸å­é¡¹ç›®ç®¡ç†ï¼šadd-subdirectory-ä¸-FetchContent-å®æˆ˜" class="headerlink" title="ğŸ§± ç¬¬â€¯5â€¯â€¯|â€¯å¤šç›®å½•ä¸å­é¡¹ç›®ç®¡ç†ï¼šadd_subdirectory()â€¯ä¸â€¯FetchContentâ€¯å®æˆ˜"></a>ğŸ§± ç¬¬â€¯5â€¯â€¯|â€¯å¤šç›®å½•ä¸å­é¡¹ç›®ç®¡ç†ï¼šadd_subdirectory()â€¯ä¸â€¯FetchContentâ€¯å®æˆ˜</h1><hr>
<h2 id="5-1-å¤šç›®å½•é¡¹ç›®ç»“æ„çš„æ„ä¹‰"><a href="#5-1-å¤šç›®å½•é¡¹ç›®ç»“æ„çš„æ„ä¹‰" class="headerlink" title="5.1â€¯å¤šç›®å½•é¡¹ç›®ç»“æ„çš„æ„ä¹‰"></a>5.1â€¯å¤šç›®å½•é¡¹ç›®ç»“æ„çš„æ„ä¹‰</h2><p>å½“é¡¹ç›®å˜å¤§æ—¶ï¼Œå•ä¸ªâ€¯CMakeLists.txtâ€¯å·²ç»éš¾ä»¥ç»´æŠ¤ã€‚<br><strong>å¤šå±‚ç›®å½•ç»“æ„</strong>å¯ä»¥å®ç°ï¼š</p>
<ul>
<li>æ¨¡å—åŒ–ç®¡ç†ï¼ˆåº“â€¯coreã€ç½‘ç»œâ€¯netã€åº”ç”¨â€¯appâ€¯åˆ†å±‚ï¼‰</li>
<li>ç»„ä»¶ç‹¬ç«‹ç¼–è¯‘ã€å¤ç”¨ã€å•å…ƒæµ‹è¯•</li>
<li>æ¸…æ™°çš„ä¾èµ–é“¾ä¸ä½œç”¨åŸŸè¾¹ç•Œ</li>
</ul>
<p>å…¸å‹ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyProj/</span><br><span class="line">â”œâ”€ CMakeLists.txt            # é¡¶å±‚</span><br><span class="line">â”œâ”€ src/</span><br><span class="line">â”‚  â”œâ”€ CMakeLists.txt         # å­ç›®å½•æ„å»ºæ ¸å¿ƒåº“</span><br><span class="line">â”‚  â””â”€ core/</span><br><span class="line">â”‚     â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚     â””â”€ core.cpp</span><br><span class="line">â”œâ”€ app/</span><br><span class="line">â”‚  â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚  â””â”€ main.cpp</span><br><span class="line">â””â”€ tests/</span><br><span class="line">   â””â”€ CMakeLists.txt</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-2-add-subdirectory"><a href="#5-2-add-subdirectory" class="headerlink" title="5.2â€¯add_subdirectory()"></a>5.2â€¯add_subdirectory()</h2><p>é¡¶å±‚â€¯CMakeListsâ€¯ä¸­æ³¨å†Œæ„å»ºçš„å­ç›®å½•ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(src)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(app)</span><br><span class="line"><span class="keyword">enable_testing</span>()</span><br><span class="line"><span class="keyword">add_subdirectory</span>(tests)</span><br></pre></td></tr></table></figure>

<p>è¯­æ³•ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">add_sub(&lt;dir&gt; [binary_dir] [EXCLUDE_FROM_ALL])</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>åŠŸèƒ½</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;dir&gt;</code></td>
<td>å­ç›®å½•ç›¸å¯¹è·¯å¾„</td>
</tr>
<tr>
<td><code>binary_dir</code></td>
<td>æŒ‡å®šæ„å»ºè¾“å‡ºç›®å½•ï¼ˆé»˜è®¤â€¯buildâ€¯æ ‘å†…åŒè·¯å¾„ï¼‰</td>
</tr>
<tr>
<td>&#96;EXCLUDE_FROM_ALL</td>
<td>å­é¡¹ç›®ä¸ä¼šéšä¸»é¡¹ç›®é»˜è®¤ç›®æ ‡ç¼–è¯‘</td>
</tr>
</tbody></table>
<p>âš™ï¸â€¯æ¯ä¸ªå­ç›®å½•éƒ½å¯ä»¥åƒç‹¬ç«‹é¡¹ç›®ä¸€æ ·ä½¿ç”¨â€¯add_libraryã€add_executableâ€¯ç­‰å‘½ä»¤ï¼Œ<br>ä¸”ç»§æ‰¿é¡¶å±‚çš„â€¯å˜é‡ã€ç¼“å­˜ã€é€‰é¡¹ã€‚  </p>
<hr>
<h2 id="5-3-ä½œç”¨åŸŸä¸å˜é‡ä¼ æ’­è§„åˆ™"><a href="#5-3-ä½œç”¨åŸŸä¸å˜é‡ä¼ æ’­è§„åˆ™" class="headerlink" title="5.3â€¯ä½œç”¨åŸŸä¸å˜é‡ä¼ æ’­è§„åˆ™"></a>5.3â€¯ä½œç”¨åŸŸä¸å˜é‡ä¼ æ’­è§„åˆ™</h2><ul>
<li><strong>å˜é‡</strong>ï¼š<code>set(VAR value)</code>â€¯é»˜è®¤åªåœ¨å½“å‰æ–‡ä»¶å’Œæ›´ä½å±‚â€¯å¯è§ï¼Œé™¤éå£°æ˜â€¯<code>CACHE</code>â€¯æˆ–â€¯<code>PARENT_SCOPE</code>ã€‚  </li>
<li><strong>ç›®æ ‡</strong>ï¼šæ‰€æœ‰å­ç›®å½•â€¯add_library&#x2F;add_executableâ€¯äº§ç”Ÿçš„ Targetâ€¯åœ¨å…¨å±€å¯è§ï¼ˆå¯è·¨ç›®å½•ä½¿ç”¨â€¯target_link_librariesï¼‰ã€‚  </li>
<li>**é€‰é¡¹(Option)**ï¼šé¡¶å±‚â€¯option()â€¯å®šä¹‰åï¼Œå­ç›®å½•éƒ½å¯â€¯ON&#x2F;OFFâ€¯æ§åˆ¶ã€‚</li>
</ul>
<p>ä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¡¶å±‚</span></span><br><span class="line"><span class="keyword">option</span>(ENABLE_NET <span class="string">&quot;Build net module&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">if</span>(ENABLE_NET)</span><br><span class="line">  <span class="keyword">add_subdirectory</span>(src/net)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-4-å­é¡¹ç›®é—´ä¾èµ–"><a href="#5-4-å­é¡¹ç›®é—´ä¾èµ–" class="headerlink" title="5.4â€¯å­é¡¹ç›®é—´ä¾èµ–"></a>5.4â€¯å­é¡¹ç›®é—´ä¾èµ–</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># src/core/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">add_library</span>(core core.cpp core.h)</span><br><span class="line"><span class="keyword">target_include_directories</span>(core PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># app/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE core)</span><br></pre></td></tr></table></figure>
<p>â®•â€¯è¿™æ ·å³å¯åœ¨é¡¶å±‚æ„å»ºæ—¶è‡ªåŠ¨æŒ‰ä¾èµ–é¡ºåºç¼–è¯‘ã€‚</p>
<hr>
<h2 id="5-5-EXCLUDE-FROM-ALL-çš„ä½¿ç”¨åœºæ™¯"><a href="#5-5-EXCLUDE-FROM-ALL-çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="5.5â€¯EXCLUDE_FROM_ALLâ€¯çš„ä½¿ç”¨åœºæ™¯"></a>5.5â€¯EXCLUDE_FROM_ALLâ€¯çš„ä½¿ç”¨åœºæ™¯</h2><p>æŸäº›å­æ¨¡å—ï¼ˆä¾‹å¦‚æµ‹è¯•ã€å·¥å…·ï¼‰åªåœ¨éœ€è¦æ—¶ç¼–è¯‘:</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(tools EXCLUDE_FROM_ALL)</span><br></pre></td></tr></table></figure>
<p>é™¤éæ˜¾å¼è°ƒç”¨â€¯<code>cmake --build . --target toolname</code>ï¼Œå¦åˆ™ä¸ä¼šå‚ä¸é»˜è®¤â€¯<code>all</code>â€¯ç›®æ ‡ã€‚</p>
<hr>
<h2 id="5-6-å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆä¸€ï¼šadd-subdirectory-FetchContent"><a href="#5-6-å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆä¸€ï¼šadd-subdirectory-FetchContent" class="headerlink" title="5.6â€¯å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆä¸€ï¼šadd_subdirectory + FetchContent"></a>5.6â€¯å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆä¸€ï¼šadd_subdirectory + FetchContent</h2><blockquote>
<p>â€œä¸å®‰è£…å¤–éƒ¨ä¾èµ–ï¼Œä¹Ÿèƒ½è¾¾æˆè·¨é¡¹ç›®æ„å»ºâ€  </p>
</blockquote>
<p>ä»â€¯CMakeâ€¯3.11â€¯å¼€å§‹æä¾›çš„ <strong>FetchContent</strong> æ¨¡å—ï¼Œè®©ä½ åœ¨é…ç½®é˜¶æ®µä¸‹è½½å¹¶æ·»åŠ å¤–éƒ¨æºç ã€‚</p>
<hr>
<h3 id="5-6-1-åŸºæœ¬æµç¨‹"><a href="#5-6-1-åŸºæœ¬æµç¨‹" class="headerlink" title="5.6.1â€¯åŸºæœ¬æµç¨‹"></a>5.6.1â€¯åŸºæœ¬æµç¨‹</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(FetchContent)</span><br><span class="line"></span><br><span class="line">FetchContent_Declare(</span><br><span class="line">  spdlog</span><br><span class="line">  GIT_REPOSITORY https://github.com/gabime/spdlog.git</span><br><span class="line">  GIT_TAG        v1.<span class="number">11.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨ä¸‹è½½ + add_subdirectory</span></span><br><span class="line">FetchContent_MakeAvailable(spdlog)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸€æ—¦æ‰§è¡Œåï¼Œä½ å°±å¯ä»¥ç›´æ¥ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE spdlog::spdlog)</span><br></pre></td></tr></table></figure>
<p>æ— éœ€é¢å¤–â€¯find_packageã€‚</p>
</blockquote>
<hr>
<h3 id="5-6-2-å¯é€‰å‚æ•°"><a href="#5-6-2-å¯é€‰å‚æ•°" class="headerlink" title="5.6.2â€¯å¯é€‰å‚æ•°"></a>5.6.2â€¯å¯é€‰å‚æ•°</h3><table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>URL</code>â€¯&#x2F;â€¯<code>URL_HASH</code></td>
<td>HTTPâ€¯åŒ…ä¸‹è½½ï¼ˆzip&#x2F;tar.gzï¼‰</td>
</tr>
<tr>
<td><code>GIT_REPOSITORY</code>â€¯&#x2F;â€¯<code>GIT_TAG</code></td>
<td>Gitâ€¯ä»“åº“æºç </td>
</tr>
<tr>
<td><code>SOURCE_DIR</code></td>
<td>å·²æœ‰æºç è·¯å¾„ï¼Œå¯è·³è¿‡ä¸‹è½½</td>
</tr>
<tr>
<td><code>SYSTEM</code></td>
<td>å°†ç›®å½•æ ‡è®°ä¸ºç³»ç»Ÿåº“è·¯å¾„ï¼ˆé¿å…è­¦å‘Šï¼‰</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ â€” ä¸‹è½½ fmtï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">FetchContent_Declare(fmt</span><br><span class="line">  URL https://github.com/fmtlib/fmt/archive/<span class="number">9.1</span>.<span class="number">0</span>.tar.gz)</span><br><span class="line">FetchContent_MakeAvailable(fmt)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-7-å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆäºŒï¼šExternalProject-Add"><a href="#5-7-å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆäºŒï¼šExternalProject-Add" class="headerlink" title="5.7â€¯å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆäºŒï¼šExternalProject_Add"></a>5.7â€¯å¤–éƒ¨å­é¡¹ç›®ç®¡ç†æ–¹æ¡ˆäºŒï¼šExternalProject_Add</h2><p>åŒºåˆ«ï¼š  </p>
<ul>
<li><strong>ExternalProject_Add</strong>â€¯åœ¨ <em>æ„å»ºé˜¶æ®µ</em> ä¸‹è½½å¹¶å•ç‹¬æ‰§è¡Œå®‰è£…ï¼ˆä¸ä¼šç›´æ¥ä½œä¸ºå­ç›®å½•ï¼‰ã€‚  </li>
<li><strong>FetchContent</strong>â€¯åœ¨ <em>é…ç½®é˜¶æ®µ</em> ä¸‹è½½å¹¶ç›´æ¥ç¼–å…¥å½“å‰æ„å»ºæ ‘ã€‚</li>
</ul>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>FetchContent</th>
<th>ExternalProject_Add</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸‹è½½æ—¶æœº</td>
<td>é…ç½®é˜¶æ®µ</td>
<td>æ„å»ºé˜¶æ®µ</td>
</tr>
<tr>
<td>æ˜¯å¦å˜æˆæœ¬åœ° target</td>
<td>âœ…â€¯æ˜¯ï¼ˆadd_subdirectoryï¼‰</td>
<td>âŒâ€¯ç‹¬ç«‹</td>
</tr>
<tr>
<td>ç¼–è¯‘ä¾èµ–è‡ªåŠ¨ä¼ æ’­</td>
<td>âœ…</td>
<td>âŒï¼ˆè¦æ‰‹åŠ¨å¯¼å…¥ï¼‰</td>
</tr>
<tr>
<td>ç”¨é€”</td>
<td>Header-onlyã€å°ä¸­å‹åº“</td>
<td>å·¨å‹å·¥ç¨‹ã€ç¬¬ä¸‰æ–¹å·¥å…·é“¾</td>
</tr>
</tbody></table>
<p>ç¤ºæ„ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(ExternalProject)</span><br><span class="line">ExternalProject_Add(googletest</span><br><span class="line">  GIT_REPOSITORY https://github.com/google/googletest.git</span><br><span class="line">  GIT_TAG release-<span class="number">1.13</span>.<span class="number">0</span></span><br><span class="line">  PREFIX <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/_deps</span><br><span class="line">  INSTALL_COMMAND <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-8-å¤šç›®å½•é¡¹ç›®å®è·µç¤ºä¾‹"><a href="#5-8-å¤šç›®å½•é¡¹ç›®å®è·µç¤ºä¾‹" class="headerlink" title="5.8â€¯å¤šç›®å½•é¡¹ç›®å®è·µç¤ºä¾‹"></a>5.8â€¯å¤šç›®å½•é¡¹ç›®å®è·µç¤ºä¾‹</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é¡¶å±‚ CMakeLists.txt</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.22</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProj VERSION <span class="number">1.0</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(FetchContent)</span><br><span class="line">FetchContent_Declare(spdlog</span><br><span class="line">  GIT_REPOSITORY https://github.com/gabime/spdlog.git</span><br><span class="line">  GIT_TAG v1.<span class="number">11.0</span>)</span><br><span class="line">FetchContent_MakeAvailable(spdlog)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(src)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(app)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># src/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">add_library</span>(core core.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(core PUBLIC spdlog::spdlog)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># app/CMakeLists.txt</span></span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE core)</span><br></pre></td></tr></table></figure>

<p>æ„å»ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -S . -B build</span><br><span class="line">cmake --build build -j</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="5-9-å¤šç›®å½•ç»„ç»‡ç»éªŒ"><a href="#5-9-å¤šç›®å½•ç»„ç»‡ç»éªŒ" class="headerlink" title="5.9â€¯å¤šç›®å½•ç»„ç»‡ç»éªŒ"></a>5.9â€¯å¤šç›®å½•ç»„ç»‡ç»éªŒ</h2><ul>
<li>æ¯å±‚çš„â€¯CMakeLists.txtâ€¯èŒè´£æ¸…æ™°ï¼Œå°½é‡åªæè¿°å½“å‰å±‚ç›®æ ‡ã€‚  </li>
<li>å˜é‡å’Œå¸¸é‡å°½é‡åœ¨é¡¶å±‚è®¾ç½®ï¼ˆç¼–è¯‘é€‰é¡¹ã€å…¨å±€å®šä¹‰ç­‰ï¼‰ã€‚  </li>
<li>ä½¿ç”¨ <code>PRIVATE/PUBLIC/INTERFACE</code>â€¯æ§åˆ¶å±æ€§ä¼ æ’­èŒƒå›´ã€‚  </li>
<li>å¤§å‹é¡¹ç›®å»ºè®®é…åˆâ€¯install&#x2F;exportâ€¯ç”Ÿæˆç»Ÿä¸€â€¯Configâ€¯åŒ…ã€‚  </li>
<li>å¤–éƒ¨ä¾èµ–æ¨èâ€¯FetchContentâ€¯æˆ–â€¯å·²ç»â€¯Configâ€¯åŒ–â€¯çš„åº“ã€‚  </li>
<li>è‹¥è¢«å¤šé¡¹ç›®å¤ç”¨ï¼Œå¯å•ç‹¬ç»´æŠ¤ä¸º git å­æ¨¡å— +â€¯add_subdirectoryã€‚</li>
</ul>
<hr>
<h2 id="5-10-ç« èŠ‚å°ç»“"><a href="#5-10-ç« èŠ‚å°ç»“" class="headerlink" title="5.10â€¯ç« èŠ‚å°ç»“"></a>5.10â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯æœ¬ç« æŒæ¡ï¼š</p>
<ul>
<li><strong>å¤šç›®å½•ç»“æ„</strong>â€¯åŠå…¶å±‚æ¬¡åŒ–ç®¡ç†æ¨¡å¼  </li>
<li><strong>add_subdirectory</strong>â€¯ç®¡ç†å†…éƒ¨ç»„ä»¶  </li>
<li><strong>ä½œç”¨åŸŸä¸å˜é‡ä¼ é€’è§„åˆ™</strong>  </li>
<li><strong>EXCLUDE_FROM_ALL</strong>â€¯é€‰é¡¹åº”ç”¨  </li>
<li><strong>FetchContent</strong>â€¯å¿«é€Ÿæ‹‰å–å¤–éƒ¨ä¾èµ–  </li>
<li><strong>ExternalProject_Add</strong>â€¯ç‹¬ç«‹å¤–éƒ¨æ„å»ºæ–¹æ¡ˆ  </li>
<li>ç»„ç»‡å¤§å‹å·¥ç¨‹çš„å¸¸è§å»ºè®®</li>
</ul>
<hr>
<hr>
<h1 id="âš™ï¸-ç¬¬-6-ç« -æ„å»ºç±»å‹ï¼ˆDebug-Releaseï¼‰ä¸å¤šé…ç½®ã€å¤šå¹³å°ç­–ç•¥"><a href="#âš™ï¸-ç¬¬-6-ç« -æ„å»ºç±»å‹ï¼ˆDebug-Releaseï¼‰ä¸å¤šé…ç½®ã€å¤šå¹³å°ç­–ç•¥" class="headerlink" title="âš™ï¸ ç¬¬â€¯6â€¯ç« â€¯|â€¯æ„å»ºç±»å‹ï¼ˆDebug&#x2F;Releaseï¼‰ä¸å¤šé…ç½®ã€å¤šå¹³å°ç­–ç•¥"></a>âš™ï¸ ç¬¬â€¯6â€¯ç« â€¯|â€¯æ„å»ºç±»å‹ï¼ˆDebug&#x2F;Releaseï¼‰ä¸å¤šé…ç½®ã€å¤šå¹³å°ç­–ç•¥</h1><hr>
<h2 id="6-1-æ„å»ºç±»å‹çš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#6-1-æ„å»ºç±»å‹çš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="6.1â€¯æ„å»ºç±»å‹çš„æ ¸å¿ƒæ¦‚å¿µ"></a>6.1â€¯æ„å»ºç±»å‹çš„æ ¸å¿ƒæ¦‚å¿µ</h2><blockquote>
<p>â€œæ„å»ºç±»å‹â€å†³å®šç¼–è¯‘ä¼˜åŒ–çº§åˆ«ã€è°ƒè¯•ç¬¦å·ã€å®å®šä¹‰ç­‰ç¼–è¯‘æ¡ä»¶ã€‚<br>åœ¨ CMake ä¸­ï¼Œå®ƒç”±å˜é‡ <code>CMAKE_BUILD_TYPE</code> æˆ–å¤šé…ç½®ç”Ÿæˆå™¨æ§åˆ¶ã€‚  </p>
</blockquote>
<hr>
<h2 id="6-2-å•é…ç½®ç”Ÿæˆå™¨-ğŸ§©"><a href="#6-2-å•é…ç½®ç”Ÿæˆå™¨-ğŸ§©" class="headerlink" title="6.2â€¯å•é…ç½®ç”Ÿæˆå™¨ ğŸ§©"></a>6.2â€¯å•é…ç½®ç”Ÿæˆå™¨ ğŸ§©</h2><p>å…¸å‹ä»£è¡¨ï¼š<br>GCCã€Clangã€Makefilesã€Ninja  </p>
<p>ğŸ“„ åœ¨è¿™ç§ç”Ÿæˆå™¨ä¸‹ï¼Œæ„å»ºç±»å‹é€šè¿‡å˜é‡  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</span><br><span class="line">```  </span><br><span class="line">åœ¨â€¯**é…ç½®é˜¶æ®µå›ºå®š**ï¼Œæ¥ç€ç¼–è¯‘æ—¶ä»…å­˜åœ¨è¿™ä¸€ç§ã€‚  </span><br><span class="line"></span><br><span class="line">| å¸¸ç”¨æ„å»ºç±»å‹ | é»˜è®¤å® | ä¼˜åŒ–çŠ¶æ€ |</span><br><span class="line">|---------------|---------|----------|</span><br><span class="line">| Debug | `DEBUG`, `NDEBUG`â€¯æœªå®šä¹‰ | æ— ä¼˜åŒ– + è°ƒè¯•ç¬¦å· |</span><br><span class="line">| Release | `NDEBUG` | é«˜ä¼˜åŒ–ã€å»ç¬¦å· |</span><br><span class="line">| RelWithDebInfo | `NDEBUG` | ä¼˜åŒ– + è°ƒè¯•ç¬¦å· |</span><br><span class="line">| MinSizeRel | `NDEBUG` | å¾®ä¼˜åŒ–ä½“ç§¯ |</span><br><span class="line"></span><br><span class="line">å¯æŸ¥çœ‹å†…ç½®é€‰é¡¹ï¼š</span><br><span class="line">```bash</span><br><span class="line">cmake --help-variable CMAKE_BUILD_TYPE</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-3-å¤šé…ç½®ç”Ÿæˆå™¨-ğŸ§©"><a href="#6-3-å¤šé…ç½®ç”Ÿæˆå™¨-ğŸ§©" class="headerlink" title="6.3â€¯å¤šé…ç½®ç”Ÿæˆå™¨ ğŸ§©"></a>6.3â€¯å¤šé…ç½®ç”Ÿæˆå™¨ ğŸ§©</h2><p>å…¸å‹ä»£è¡¨ï¼š<br>Visualâ€¯Studioã€Xcodeã€Ninjaâ€¯Multi-Config  </p>
<p>ğŸ“¦ åœ¨è¿™ç§ç”Ÿæˆå™¨ä¸­ CMake ä¸€æ¬¡ç”Ÿæˆæ‰€æœ‰é…ç½®ï¼Œ<br>æ„å»ºæ—¶å†æŒ‡å®šé…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --build build --config Debug</span><br><span class="line">cmake --build build --config Release</span><br></pre></td></tr></table></figure>

<p>æ— éœ€å†è®¾ç½®â€¯<code>CMAKE_BUILD_TYPE</code>ã€‚</p>
<hr>
<h2 id="6-4-å®šä¹‰è‡ªå®šä¹‰æ„å»ºç±»å‹ï¼ˆè¿›é˜¶ï¼‰"><a href="#6-4-å®šä¹‰è‡ªå®šä¹‰æ„å»ºç±»å‹ï¼ˆè¿›é˜¶ï¼‰" class="headerlink" title="6.4â€¯å®šä¹‰è‡ªå®šä¹‰æ„å»ºç±»å‹ï¼ˆè¿›é˜¶ï¼‰"></a>6.4â€¯å®šä¹‰è‡ªå®šä¹‰æ„å»ºç±»å‹ï¼ˆè¿›é˜¶ï¼‰</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CONFIGURATION_TYPES <span class="string">&quot;Debug;Release;ASan&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;&quot;</span> FORCE)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_ASan <span class="string">&quot;-fsanitize=address -O1 -g&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;&quot;</span> FORCE)</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤šé…ç½®ä¸‹ä¼šå¤šå‡ºâ€¯ASanâ€¯é€‰é¡¹ã€‚</p>
<hr>
<h2 id="6-5-å¸¸è§ç¼–è¯‘é€‰é¡¹å˜é‡"><a href="#6-5-å¸¸è§ç¼–è¯‘é€‰é¡¹å˜é‡" class="headerlink" title="6.5â€¯å¸¸è§ç¼–è¯‘é€‰é¡¹å˜é‡"></a>6.5â€¯å¸¸è§ç¼–è¯‘é€‰é¡¹å˜é‡</h2><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_C_FLAGS_&lt;CONFIG&gt;</code></td>
<td>C è¯­è¨€ç‰¹å®šç¼–è¯‘é€‰é¡¹</td>
</tr>
<tr>
<td><code>CMAKE_CXX_FLAGS_&lt;CONFIG&gt;</code></td>
<td>C++ ç¼–è¯‘é€‰é¡¹</td>
</tr>
<tr>
<td><code>&lt;LANG&gt;_COMPILER_LAUNCHER</code></td>
<td>åŒ…è£…å™¨ï¼ˆccache, distccï¼‰</td>
</tr>
<tr>
<td><code>CMAKE_EXE_LINKER_FLAGS_&lt;CONFIG&gt;</code></td>
<td>é“¾æ¥å™¨å‚æ•°</td>
</tr>
<tr>
<td><code>CMAKE_&lt;LANG&gt;_FLAGS_INIT</code></td>
<td>é»˜è®¤åˆå§‹å€¼</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot;-g -O0&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_RELEASE <span class="string">&quot;-O3 -DNDEBUG&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-6-é’ˆå¯¹ç›®æ ‡çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼"><a href="#6-6-é’ˆå¯¹ç›®æ ‡çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼" class="headerlink" title="6.6â€¯é’ˆå¯¹ç›®æ ‡çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼"></a>6.6â€¯é’ˆå¯¹ç›®æ ‡çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼</h2><p>CMake æä¾›å¸¦ <code>$&lt;CONFIG:...&gt;</code>â€¯çš„è¡¨è¾¾å¼åŒºåˆ†é…ç½®ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_compile_definitions</span>(app PRIVATE</span><br><span class="line">  $&lt;$&lt;CONFIG:Debug&gt;:DEBUG_MODE&gt;</span><br><span class="line">  $&lt;$&lt;CONFIG:Release&gt;:NDEBUG&gt;)</span><br></pre></td></tr></table></figure>

<p>æˆ–è·¯å¾„åŒºåˆ†ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_directories</span>(app PRIVATE</span><br><span class="line">  $&lt;$&lt;CONFIG:Debug&gt;:<span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/lib/Debug&gt;</span><br><span class="line">  $&lt;$&lt;CONFIG:Release&gt;:<span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>/lib/Release&gt;)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-7-è·¨å¹³å°å˜é‡ä¸å®"><a href="#6-7-è·¨å¹³å°å˜é‡ä¸å®" class="headerlink" title="6.7â€¯è·¨å¹³å°å˜é‡ä¸å®"></a>6.7â€¯è·¨å¹³å°å˜é‡ä¸å®</h2><table>
<thead>
<tr>
<th>å¹³å°å®</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>WIN32</code></td>
<td>Windows</td>
</tr>
<tr>
<td><code>UNIX</code>â€¯(å«â€¯macOS,â€¯Linux)</td>
<td>ç±» Unix</td>
</tr>
<tr>
<td><code>APPLE</code></td>
<td>macOS</td>
</tr>
<tr>
<td><code>MSVC</code></td>
<td>Microsoftâ€¯VCâ€¯ç¼–è¯‘å™¨</td>
</tr>
<tr>
<td><code>MINGW</code></td>
<td>MinGW</td>
</tr>
<tr>
<td><code>CMAKE_SYSTEM_NAME</code></td>
<td>æ“ä½œç³»ç»Ÿåç§°</td>
</tr>
<tr>
<td><code>CMAKE_HOST_SYSTEM_NAME</code></td>
<td>ä¸»æœºç³»ç»Ÿåç§°</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(WIN32)</span><br><span class="line">  <span class="keyword">add_definitions</span>(-DPLATFORM_WINDOWS)</span><br><span class="line"><span class="keyword">elseif</span>(APPLE)</span><br><span class="line">  <span class="keyword">add_definitions</span>(-DPLATFORM_MAC)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-8-å¤šå¹³å°ç¼–è¯‘å™¨é€‚é…"><a href="#6-8-å¤šå¹³å°ç¼–è¯‘å™¨é€‚é…" class="headerlink" title="6.8â€¯å¤šå¹³å°ç¼–è¯‘å™¨é€‚é…"></a>6.8â€¯å¤šå¹³å°ç¼–è¯‘å™¨é€‚é…</h2><p>æ ¹æ®ç¼–è¯‘å™¨è®¾ç½®é€‰é¡¹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(MSVC)</span><br><span class="line">  <span class="keyword">target_compile_options</span>(app PRIVATE /W4 /permissive-)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">target_compile_options</span>(app PRIVATE -Wall -Wextra -pedantic)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>å–„ç”¨â€¯<code>generator expressions</code>â€¯åŒºåˆ†å¿«æ·ã€‚</p>
<hr>
<h2 id="6-9-è·¨ç¼–è¯‘ï¼ˆCross-Compilationï¼‰ç®€è¿°"><a href="#6-9-è·¨ç¼–è¯‘ï¼ˆCross-Compilationï¼‰ç®€è¿°" class="headerlink" title="6.9â€¯è·¨ç¼–è¯‘ï¼ˆCrossâ€¯Compilationï¼‰ç®€è¿°"></a>6.9â€¯è·¨ç¼–è¯‘ï¼ˆCrossâ€¯Compilationï¼‰ç®€è¿°</h2><p>è·¨ç¼–è¯‘ä¸»è¦ä¾é â€œ<strong>Toolchainâ€¯æ–‡ä»¶</strong>â€ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_TOOLCHAIN_FILE=armgcc-toolchain.cmake -DCMAKE_BUILD_TYPE=Release ..</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹â€¯toolchainâ€¯æ–‡ä»¶ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_NAME Linux)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_SYSTEM_PROCESSOR arm)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_COMPILER arm-linux-gnueabihf-gcc)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_COMPILER arm-linux-gnueabihf-g++)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_FIND_ROOT_PATH /opt/arm-sysroot)</span><br></pre></td></tr></table></figure>
<p>CMake æ®æ­¤è°ƒæ•´ç³»ç»Ÿæœç´¢è·¯å¾„ä¸äº¤å‰å·¥å…·é“¾ã€‚  </p>
<hr>
<h2 id="6-10-é»˜è®¤è¾“å‡ºç›®å½•æŒ‰é…ç½®åˆ†ç±»"><a href="#6-10-é»˜è®¤è¾“å‡ºç›®å½•æŒ‰é…ç½®åˆ†ç±»" class="headerlink" title="6.10â€¯é»˜è®¤è¾“å‡ºç›®å½•æŒ‰é…ç½®åˆ†ç±»"></a>6.10â€¯é»˜è®¤è¾“å‡ºç›®å½•æŒ‰é…ç½®åˆ†ç±»</h2><p>æ¨èå†™æ³•ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/bin&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/lib&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/lib&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(OUTPUTCONFIG IN LISTS CMAKE_CONFIGURATION_TYPES)</span><br><span class="line">  <span class="keyword">string</span>(TOUPPER <span class="variable">$&#123;OUTPUTCONFIG&#125;</span> OUTPUTCONFIG)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY_<span class="variable">$&#123;OUTPUTCONFIG&#125;</span> <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/bin/$&#123;OUTPUTCONFIG&#125;&quot;</span>)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY_<span class="variable">$&#123;OUTPUTCONFIG&#125;</span> <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/lib/$&#123;OUTPUTCONFIG&#125;&quot;</span>)</span><br><span class="line">  <span class="keyword">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY_<span class="variable">$&#123;OUTPUTCONFIG&#125;</span> <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;/lib/$&#123;OUTPUTCONFIG&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·â€¯Debug&#x2F;Releaseâ€¯ä¾¿ä¼šåˆ†ç›®å½•ä¿å­˜ã€‚</p>
<hr>
<h2 id="6-11-å¤šå¹³å°ç­–ç•¥ç»éªŒæ€»ç»“"><a href="#6-11-å¤šå¹³å°ç­–ç•¥ç»éªŒæ€»ç»“" class="headerlink" title="6.11â€¯å¤šå¹³å°ç­–ç•¥ç»éªŒæ€»ç»“"></a>6.11â€¯å¤šå¹³å°ç­–ç•¥ç»éªŒæ€»ç»“</h2><p>1ï¸âƒ£ <strong>ä¸æ»¥ç”¨â€¯if(PLATFORM)</strong><br>å°½é‡æ”¾å…¥å•ç‹¬â€¯cmakeâ€¯æ¨¡å—æ–‡ä»¶ã€‚<br>ä¾‹å¦‚â€¯<code>platform/windows.cmake</code>ã€<code>platform/linux.cmake</code>ã€‚  </p>
<p>2ï¸âƒ£ <em><em>ä½¿ç”¨â€¯target_</em>â€¯å±æ€§æ¥å£åŒ–</em>*<br>è€Œéç›´æ¥å…¨å±€è®¾ç½®â€¯CMAKE_CXX_FLAGSã€‚  </p>
<p>3ï¸âƒ£ <strong>ç¡®ä¿è·¨ç¼–è¯‘å·¥å…·é“¾è‡ªæ´½</strong><br>ä¸è¦åœ¨ toolchainâ€¯é‡Œç¡¬ç¼–ç â€¯hostâ€¯è·¯å¾„ï¼›ä¿æŒå¹²å‡€çš„ sysrootã€‚  </p>
<p>4ï¸âƒ£ <strong>åˆ©ç”¨ç¼“å­˜å˜é‡åŒºåˆ†ç¯å¢ƒ</strong><br>å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_TOOLCHAIN_FILE=... -DPLATFORM_RPI=ON</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="6-12-ç« èŠ‚å°ç»“"><a href="#6-12-ç« èŠ‚å°ç»“" class="headerlink" title="6.12â€¯ç« èŠ‚å°ç»“"></a>6.12â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯æœ¬ç« ä½ å·²ç»æŒæ¡ï¼š  </p>
<ul>
<li>å•é…ç½®â€¯vsâ€¯å¤šé…ç½®â€¯æ„å»ºæœºåˆ¶  </li>
<li><code>CMAKE_BUILD_TYPE</code>â€¯çš„æ„ä¹‰  </li>
<li>å„ä¸ªç±»å‹çš„ä¼˜åŒ–ä¸å®æ§åˆ¶  </li>
<li>åœ¨â€¯targetâ€¯å±‚ä½¿ç”¨â€¯generatorâ€¯è¡¨è¾¾å¼å®ç°å¤šé…ç½®å·®å¼‚  </li>
<li>ç”¨â€¯toolchainâ€¯æ–‡ä»¶è·¨å¹³å°æ„å»ºå·¥ç¨‹  </li>
<li>å¤šå¹³å°ç¼–è¯‘å™¨é€‰é¡¹ä¸è¾“å‡ºç›®å½•è§„èŒƒ</li>
</ul>
<hr>
<hr>
<h1 id="ğŸ”§-ç¬¬-7-ç« -è‡ªå®šä¹‰å‘½ä»¤-ä¸-è‡ªå®šä¹‰ç›®æ ‡ï¼šadd-custom-command-add-custom-target"><a href="#ğŸ”§-ç¬¬-7-ç« -è‡ªå®šä¹‰å‘½ä»¤-ä¸-è‡ªå®šä¹‰ç›®æ ‡ï¼šadd-custom-command-add-custom-target" class="headerlink" title="ğŸ”§ ç¬¬â€¯7â€¯ç« â€¯|â€¯è‡ªå®šä¹‰å‘½ä»¤â€¯ä¸â€¯è‡ªå®šä¹‰ç›®æ ‡ï¼šadd_custom_command()â€¯&amp;â€¯add_custom_target()"></a>ğŸ”§ ç¬¬â€¯7â€¯ç« â€¯|â€¯è‡ªå®šä¹‰å‘½ä»¤â€¯ä¸â€¯è‡ªå®šä¹‰ç›®æ ‡ï¼šadd_custom_command()â€¯&amp;â€¯add_custom_target()</h1><hr>
<h2 id="7-1-æ ¸å¿ƒæ¦‚å¿µ"><a href="#7-1-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="7.1â€¯æ ¸å¿ƒæ¦‚å¿µ"></a>7.1â€¯æ ¸å¿ƒæ¦‚å¿µ</h2><blockquote>
<p><strong>CMake ä¸åªä¼šç¼–è¯‘ä»£ç </strong>ï¼Œå®ƒåŒæ ·èƒ½é©±åŠ¨å„ç§å¤–éƒ¨å‘½ä»¤ã€ä»£ç ç”Ÿæˆã€æ‰“åŒ…ã€å¤åˆ¶ã€æ¸…ç†ç­‰ä»»åŠ¡ã€‚<br>è¿™å°±ä¾èµ–äºâ€¯<code>add_custom_command()</code>â€¯å’Œâ€¯<code>add_custom_target()</code>ã€‚  </p>
</blockquote>
<ul>
<li><strong><code>add_custom_command()</code></strong>â€¯â†’â€¯å®šåˆ¶ç”Ÿæˆè§„åˆ™ï¼ˆäº§ç”Ÿæ–‡ä»¶ï¼‰  </li>
<li><strong><code>add_custom_target()</code></strong>â€¯â†’â€¯å®šä¹‰ç‹¬ç«‹ç›®æ ‡ï¼ˆä¸ä¸€å®šç”Ÿæˆæ–‡ä»¶ï¼‰</li>
</ul>
<hr>
<h2 id="7-2-add-custom-command-ç”Ÿæˆå‹å‘½ä»¤"><a href="#7-2-add-custom-command-ç”Ÿæˆå‹å‘½ä»¤" class="headerlink" title="7.2â€¯add_custom_command()â€¯ç”Ÿæˆå‹å‘½ä»¤"></a>7.2â€¯add_custom_command()â€¯ç”Ÿæˆå‹å‘½ä»¤</h2><p>è¯­æ³•ä¸€ï¼ˆè¾“å‡ºæ–‡ä»¶ï¼‰ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  OUTPUT  generated.cpp</span><br><span class="line">  <span class="keyword">COMMAND</span> python3 gen.py input.idl -o generated.cpp</span><br><span class="line">  DEPENDS input.idl gen.py</span><br><span class="line">  COMMENT <span class="string">&quot;ç”Ÿæˆä»£ç æ–‡ä»¶ generated.cpp&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>OUTPUT</code></td>
<td>æ‰§è¡Œå‘½ä»¤åç”Ÿæˆçš„æ–‡ä»¶</td>
</tr>
<tr>
<td><code>COMMAND</code></td>
<td>å…·ä½“æ‰§è¡Œçš„å‘½ä»¤</td>
</tr>
<tr>
<td><code>DEPENDS</code></td>
<td>æ–‡ä»¶æˆ–ç›®æ ‡ä¾èµ–</td>
</tr>
<tr>
<td><code>WORKING_DIRECTORY</code></td>
<td>è¿è¡Œç›®å½•</td>
</tr>
<tr>
<td><code>COMMENT</code></td>
<td>æ—¥å¿—æ˜¾ç¤º</td>
</tr>
<tr>
<td><code>BYPRODUCTS</code></td>
<td>é™¤ OUTPUT å¤–äº§ç”Ÿçš„å…¶ä»–æ–‡ä»¶</td>
</tr>
<tr>
<td><code>VERBATIM</code></td>
<td>è‡ªåŠ¨å®‰å…¨è½¬ä¹‰å­—ç¬¦ä¸²</td>
</tr>
</tbody></table>
<p>ğŸ”¹â€¯æ‰§è¡Œæœºåˆ¶ï¼šå½“â€¯CMake å‘ç°â€¯<code>OUTPUT</code>â€¯ç¼ºå¤±æˆ–â€¯<code>DEPENDS</code>â€¯æ›´æ–°æ—¶ï¼Œè¯¥å‘½ä»¤è§¦å‘ã€‚</p>
<hr>
<h3 id="ä¸-target-å»ºç«‹å…³ç³»"><a href="#ä¸-target-å»ºç«‹å…³ç³»" class="headerlink" title="ä¸ target å»ºç«‹å…³ç³»"></a>ä¸ target å»ºç«‹å…³ç³»</h3><p>ä¸Šé¢åªæ˜¯è§„åˆ™ï¼Œè¦è®©å®ƒç”Ÿæ•ˆï¼Œå¿…é¡»è®©æŸç›®æ ‡ä¾èµ–å®ƒï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(app main.cpp generated.cpp)</span><br><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  OUTPUT generated.cpp</span><br><span class="line">  <span class="keyword">COMMAND</span> python3 gen.py input.idl -o generated.cpp</span><br><span class="line">  DEPENDS input.idl gen.py</span><br><span class="line">  COMMENT <span class="string">&quot;ç”Ÿæˆæ¥å£æ–‡ä»¶&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>CMake è‡ªåŠ¨åœ¨ç¼–è¯‘â€¯appâ€¯å‰æ‰§è¡Œä»£ç ç”Ÿæˆã€‚</p>
<p>è‹¥ç‹¬ç«‹ç”Ÿæˆå¤šä¸ªæ–‡ä»¶å¯ç»„åˆï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  OUTPUT a.h b.h</span><br><span class="line">  <span class="keyword">COMMAND</span> gen_headers.sh <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span></span><br><span class="line">  DEPENDS defs.json</span><br><span class="line">  BYPRODUCTS temp.log)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-3-add-custom-target-è‡ªå®šä¹‰ç›®æ ‡"><a href="#7-3-add-custom-target-è‡ªå®šä¹‰ç›®æ ‡" class="headerlink" title="7.3â€¯add_custom_target()â€¯è‡ªå®šä¹‰ç›®æ ‡"></a>7.3â€¯add_custom_target()â€¯è‡ªå®šä¹‰ç›®æ ‡</h2><p>è¯­æ³•ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(&lt;name&gt; [ALL]</span><br><span class="line">  <span class="keyword">COMMAND</span> &lt;cmd1&gt; [ARGS...]</span><br><span class="line">  DEPENDS &lt;other_target(s)&gt; &lt;<span class="keyword">file</span>(s)&gt;</span><br><span class="line">  COMMENT <span class="string">&quot;some text&quot;</span>)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>ALL</code></td>
<td>ç¼–å…¥é»˜è®¤â€¯<code>all</code>â€¯ç›®æ ‡</td>
</tr>
<tr>
<td><code>COMMAND</code></td>
<td>å¯å¤šæ¡</td>
</tr>
<tr>
<td><code>DEPENDS</code></td>
<td>å¯æ˜¯æ–‡ä»¶æˆ–ç›®æ ‡</td>
</tr>
<tr>
<td><code>WORKING_DIRECTORY</code></td>
<td>æ‰§è¡Œä½ç½®</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(run ALL</span><br><span class="line">  <span class="keyword">COMMAND</span> app</span><br><span class="line">  DEPENDS app</span><br><span class="line">  COMMENT <span class="string">&quot;æ‰§è¡Œåº”ç”¨ç¨‹åº&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œï¼š<code>cmake --build . --target run</code></p>
<hr>
<h2 id="7-4-add-custom-target-VS-add-custom-command"><a href="#7-4-add-custom-target-VS-add-custom-command" class="headerlink" title="7.4â€¯add_custom_targetâ€¯VSâ€¯add_custom_command"></a>7.4â€¯add_custom_targetâ€¯VSâ€¯add_custom_command</h2><table>
<thead>
<tr>
<th>åŠŸèƒ½å·®å¼‚</th>
<th>add_custom_command</th>
<th>add_custom_target</th>
</tr>
</thead>
<tbody><tr>
<td>æ˜¯å¦ç”Ÿæˆæ–‡ä»¶</td>
<td>âœ…</td>
<td>âŒ</td>
</tr>
<tr>
<td>èƒ½å¦ä¾èµ–äºç›®æ ‡</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>å¯å¦åŠ å…¥é»˜è®¤ç¼–è¯‘</td>
<td>å¦ï¼ˆéœ€è¢«å…¶ä»–ç›®æ ‡ä¾èµ–ï¼‰</td>
<td>å¯é€‰â€¯ALL</td>
</tr>
<tr>
<td>å¸¸è§ç”¨é€”</td>
<td>ä»£ç ç”Ÿæˆã€èµ„æºæ‹·è´ç­‰</td>
<td>è¿è¡Œè„šæœ¬ã€æµ‹è¯•ã€æ‰“åŒ…</td>
</tr>
</tbody></table>
<p>ç»„åˆä½¿ç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(OUTPUT generated.h</span><br><span class="line">  <span class="keyword">COMMAND</span> gen_header tool.idl -o generated.h</span><br><span class="line">  DEPENDS tool.idl)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_custom_target</span>(generate ALL</span><br><span class="line">  DEPENDS generated.h)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-5-å…¸å‹ç”¨é€”ç¤ºä¾‹"><a href="#7-5-å…¸å‹ç”¨é€”ç¤ºä¾‹" class="headerlink" title="7.5â€¯å…¸å‹ç”¨é€”ç¤ºä¾‹"></a>7.5â€¯å…¸å‹ç”¨é€”ç¤ºä¾‹</h2><h3 id="1-èµ„æºæ‹·è´"><a href="#1-èµ„æºæ‹·è´" class="headerlink" title="(1)â€¯èµ„æºæ‹·è´"></a>(1)â€¯èµ„æºæ‹·è´</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  <span class="keyword">TARGET</span> app POST_BUILD</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E copy</span><br><span class="line">          <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/config.json</span><br><span class="line">          $&lt;TARGET_FILE_DIR:app&gt;/config.json)</span><br></pre></td></tr></table></figure>

<p>ğŸ’¬â€¯è¯­æ³•â€¯2â€¯ï¼šå½“å‘½ä»¤ä¸å·²æœ‰ç›®æ ‡å…³è”æ—¶ï¼Œå¯ä»¥çœå»â€¯OUTPUTã€‚</p>
<hr>
<h3 id="2-ä»£ç ç”Ÿæˆ-â†’-Protobuf"><a href="#2-ä»£ç ç”Ÿæˆ-â†’-Protobuf" class="headerlink" title="(2)â€¯ä»£ç ç”Ÿæˆ â†’ Protobuf"></a>(2)â€¯ä»£ç ç”Ÿæˆ â†’ Protobuf</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  OUTPUT address.pb.cc address.pb.h</span><br><span class="line">  <span class="keyword">COMMAND</span> protoc --cpp_out=. <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/address.proto</span><br><span class="line">  DEPENDS <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/address.proto)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_library</span>(proto address.pb.cc)</span><br><span class="line"><span class="keyword">target_include_directories</span>(proto PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_BINARY_DIR&#125;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="3-æ‰“åŒ…ç›®æ ‡"><a href="#3-æ‰“åŒ…ç›®æ ‡" class="headerlink" title="(3)â€¯æ‰“åŒ…ç›®æ ‡"></a>(3)â€¯æ‰“åŒ…ç›®æ ‡</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(package_zip ALL</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E <span class="keyword">make_directory</span> <span class="variable">$&#123;CMAKE_BINARY_DIR&#125;</span>/dist</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E tar <span class="string">&quot;cfv&quot;</span> dist/app.zip --format=zip</span><br><span class="line">          app.exe config.json</span><br><span class="line">  COMMENT <span class="string">&quot;æ‰“åŒ…é¡¹ç›®&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-6-CMake-å†…ç½®è¾…åŠ©å‘½ä»¤"><a href="#7-6-CMake-å†…ç½®è¾…åŠ©å‘½ä»¤" class="headerlink" title="7.6â€¯CMake å†…ç½®è¾…åŠ©å‘½ä»¤"></a>7.6â€¯CMake å†…ç½®è¾…åŠ©å‘½ä»¤</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>cmake -E copy</code></td>
<td>å¤åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td><code>cmake -E remove</code></td>
<td>åˆ é™¤æ–‡ä»¶</td>
</tr>
<tr>
<td><code>cmake -E tar</code></td>
<td>æ‰“åŒ…&#x2F;è§£åŒ…</td>
</tr>
<tr>
<td><code>cmake -E echo</code></td>
<td>æ‰“å°ä¿¡æ¯</td>
</tr>
<tr>
<td><code>cmake -E env</code></td>
<td>è®¾ç½®ä¸´æ—¶ç¯å¢ƒå˜é‡</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(print_env</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E env MY_VAR=<span class="number">123</span> bash -c <span class="string">&quot;echo $MY_VAR&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-7-æ„å»ºäº‹ä»¶ä¸é˜¶æ®µ"><a href="#7-7-æ„å»ºäº‹ä»¶ä¸é˜¶æ®µ" class="headerlink" title="7.7â€¯æ„å»ºäº‹ä»¶ä¸é˜¶æ®µ"></a>7.7â€¯æ„å»ºäº‹ä»¶ä¸é˜¶æ®µ</h2><p>CMake æ”¯æŒåœ¨ç›®æ ‡çš„ä¸åŒé˜¶æ®µæ’å…¥å‘½ä»¤ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  <span class="keyword">TARGET</span> app</span><br><span class="line">  PRE_BUILD   <span class="keyword">COMMAND</span> &lt;cmd&gt;  <span class="comment"># Windows only</span></span><br><span class="line">  PRE_LINK    <span class="keyword">COMMAND</span> &lt;cmd&gt;</span><br><span class="line">  POST_BUILD  <span class="keyword">COMMAND</span> &lt;cmd&gt;)</span><br></pre></td></tr></table></figure>

<p>Linux ä¸‹é€šå¸¸ä½¿ç”¨â€¯POST_BUILDâ€¯å³å¯ã€‚</p>
<hr>
<h2 id="7-8-è‡ªå®šä¹‰æ¸…ç†ä¸æ ¼å¼åŒ–"><a href="#7-8-è‡ªå®šä¹‰æ¸…ç†ä¸æ ¼å¼åŒ–" class="headerlink" title="7.8â€¯è‡ªå®šä¹‰æ¸…ç†ä¸æ ¼å¼åŒ–"></a>7.8â€¯è‡ªå®šä¹‰æ¸…ç†ä¸æ ¼å¼åŒ–</h2><h3 id="æ¸…ç†ç”Ÿæˆæ–‡ä»¶ï¼š"><a href="#æ¸…ç†ç”Ÿæˆæ–‡ä»¶ï¼š" class="headerlink" title="æ¸…ç†ç”Ÿæˆæ–‡ä»¶ï¼š"></a>æ¸…ç†ç”Ÿæˆæ–‡ä»¶ï¼š</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(clean_gen</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E rm -f generated.*</span><br><span class="line">  COMMENT <span class="string">&quot;æ¸…ç†ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ä¸€é”®æ ¼å¼åŒ–æºä»£ç ï¼š"><a href="#ä¸€é”®æ ¼å¼åŒ–æºä»£ç ï¼š" class="headerlink" title="ä¸€é”®æ ¼å¼åŒ–æºä»£ç ï¼š"></a>ä¸€é”®æ ¼å¼åŒ–æºä»£ç ï¼š</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_target</span>(format</span><br><span class="line">  <span class="keyword">COMMAND</span> clang-format -i <span class="variable">$&#123;ALL_SOURCE_FILES&#125;</span></span><br><span class="line">  COMMENT <span class="string">&quot;æºä»£ç æ ¼å¼åŒ–&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="7-9-ç»¼åˆå®ä¾‹ï¼šé›†æˆè‡ªåŠ¨ä»£ç ç”Ÿæˆ"><a href="#7-9-ç»¼åˆå®ä¾‹ï¼šé›†æˆè‡ªåŠ¨ä»£ç ç”Ÿæˆ" class="headerlink" title="7.9â€¯ç»¼åˆå®ä¾‹ï¼šé›†æˆè‡ªåŠ¨ä»£ç ç”Ÿæˆ"></a>7.9â€¯ç»¼åˆå®ä¾‹ï¼šé›†æˆè‡ªåŠ¨ä»£ç ç”Ÿæˆ</h2><p>ç›®å½•ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tool/</span><br><span class="line">â”œâ”€ gen.py</span><br><span class="line">â”œâ”€ input.msg</span><br><span class="line">â””â”€ main.cpp</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  OUTPUT <span class="keyword">message</span>.hpp</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;Python3_EXECUTABLE&#125;</span> <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/gen.py <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/input.msg &gt; <span class="keyword">message</span>.hpp</span><br><span class="line">  DEPENDS gen.py input.msg</span><br><span class="line">  COMMENT <span class="string">&quot;ç”Ÿæˆ message.hpp&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(tool main.cpp <span class="keyword">message</span>.hpp)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œæ„å»ºæ—¶ï¼Œå¦‚æœè¾“å…¥æœ‰æ›´æ–°ï¼ŒCMake ä¼šè‡ªåŠ¨é‡æ–°æ‰§è¡Œâ€¯gen.pyã€‚</p>
<hr>
<h2 id="7-10-ç« èŠ‚å°ç»“"><a href="#7-10-ç« èŠ‚å°ç»“" class="headerlink" title="7.10â€¯ç« èŠ‚å°ç»“"></a>7.10â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯ä½ å·²æŒæ¡ï¼š</p>
<ul>
<li><code>add_custom_command()</code>â€¯ç”¨äºç”Ÿæˆæ–‡ä»¶æˆ–é™„åŠ å‘½ä»¤  </li>
<li><code>add_custom_target()</code>â€¯ç”¨äºå®šä¹‰é€»è¾‘ç›®æ ‡  </li>
<li>å¦‚ä½•åœ¨â€¯ç›®æ ‡â€¯ä¸åŒé˜¶æ®µâ€¯æ‰§è¡Œå‘½ä»¤ï¼ˆPRE&#x2F;POST_BUILDï¼‰  </li>
<li>åˆ©ç”¨â€¯cmakeâ€¯å†…ç½®æ‰§è¡Œå‘½ä»¤â€¯<code>cmake -E</code>â€¯å®Œæˆé€šç”¨ä»»åŠ¡  </li>
<li>è‡ªå®šä¹‰æ ¼å¼åŒ–ã€æ‰“åŒ…ã€æ¸…ç†ã€ä»£ç ç”Ÿæˆä»»åŠ¡å®è·µ</li>
</ul>
<hr>
<hr>
<h1 id="ğŸ§ª-ç¬¬-8-ç« -æµ‹è¯•ä¸æŒç»­é›†æˆï¼šCTest-ä¸-CDash-ä½¿ç”¨"><a href="#ğŸ§ª-ç¬¬-8-ç« -æµ‹è¯•ä¸æŒç»­é›†æˆï¼šCTest-ä¸-CDash-ä½¿ç”¨" class="headerlink" title="ğŸ§ª ç¬¬â€¯8â€¯ç« â€¯|â€¯æµ‹è¯•ä¸æŒç»­é›†æˆï¼šCTestâ€¯ä¸â€¯CDashâ€¯ä½¿ç”¨"></a>ğŸ§ª ç¬¬â€¯8â€¯ç« â€¯|â€¯æµ‹è¯•ä¸æŒç»­é›†æˆï¼šCTestâ€¯ä¸â€¯CDashâ€¯ä½¿ç”¨</h1><hr>
<h2 id="8-1-CMake-ä¸-CTest-çš„å…³ç³»"><a href="#8-1-CMake-ä¸-CTest-çš„å…³ç³»" class="headerlink" title="8.1â€¯CMakeâ€¯ä¸â€¯CTestâ€¯çš„å…³ç³»"></a>8.1â€¯CMakeâ€¯ä¸â€¯CTestâ€¯çš„å…³ç³»</h2><p>CMakeâ€¯å¹¶ä¸ä»…ç”Ÿæˆæ„å»ºç³»ç»Ÿï¼Œè¿˜åŒ…å«è‡ªå·±çš„æµ‹è¯•é©±åŠ¨æ¡†æ¶ â€”â€”â€¯<strong>CTest</strong>ã€‚<br>å®ƒå…è®¸ä½ åœ¨ç¼–è¯‘åè‡ªåŠ¨æ‰§è¡Œå•å…ƒæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ï¼Œå¹¶æŠŠç»“æœæäº¤ç»™â€¯CDashâ€¯ä»ªè¡¨ç›˜ã€‚  </p>
<blockquote>
<p>âœ… æ ¸å¿ƒä¼˜åŠ¿  </p>
<ul>
<li>è·¨å¹³å°æµ‹è¯•å…¥å£ä¸€è‡´ï¼š<code>ctest</code>  </li>
<li>å¯ä¸â€¯CTestâ€¯å‘½ä»¤ã€CTestConfig.cmakeã€CDashâ€¯æ— ç¼é›†æˆ  </li>
<li>åŒæ—¶æ”¯æŒâ€¯GoogleTestã€Catch2ã€doctestâ€¯ç­‰æ¡†æ¶</li>
</ul>
</blockquote>
<hr>
<h2 id="8-2-å¯ç”¨æµ‹è¯•"><a href="#8-2-å¯ç”¨æµ‹è¯•" class="headerlink" title="8.2â€¯å¯ç”¨æµ‹è¯•"></a>8.2â€¯å¯ç”¨æµ‹è¯•</h2><p>åœ¨é¡¶å±‚â€¯CMakeLists.txtâ€¯å†…åŠ å…¥ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enable_testing</span>()</span><br></pre></td></tr></table></figure>
<p>æ­¤å‘½ä¼šè‡ªåŠ¨ç”Ÿæˆâ€¯CTestTestfile.cmakeï¼Œ<br>å¹¶å…è®¸ä½¿ç”¨â€¯<code>add_test()</code>â€¯æ·»åŠ æµ‹è¯•ç›®æ ‡ã€‚  </p>
<hr>
<h2 id="8-3-add-test-åŸºç¡€è¯­æ³•"><a href="#8-3-add-test-åŸºç¡€è¯­æ³•" class="headerlink" title="8.3â€¯add_test()â€¯åŸºç¡€è¯­æ³•"></a>8.3â€¯add_test()â€¯åŸºç¡€è¯­æ³•</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_test</span>(NAME &lt;test_name&gt;</span><br><span class="line">         <span class="keyword">COMMAND</span> &lt;executable&gt; [args...])</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(mytests test_main.cpp)</span><br><span class="line"><span class="keyword">add_test</span>(NAME basic <span class="keyword">COMMAND</span> mytests)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¹‹åå³å¯åœ¨æ„å»ºç›®å½•ä¸‹è¿è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ctest</span><br><span class="line">ctest -V   <span class="comment"># verbose è¾“å‡º</span></span><br><span class="line">ctest -R basic  <span class="comment"># æŒ‰åç§°ç­›é€‰</span></span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h2 id="8-4-test-å±æ€§ä¸é…ç½®"><a href="#8-4-test-å±æ€§ä¸é…ç½®" class="headerlink" title="8.4â€¯testâ€¯å±æ€§ä¸é…ç½®"></a>8.4â€¯testâ€¯å±æ€§ä¸é…ç½®</h2><table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>WORKING_DIRECTORY</td>
<td>æ›´æ”¹æµ‹è¯•æ‰§è¡Œç›®å½•</td>
</tr>
<tr>
<td>TIMEOUT</td>
<td>æŒ‡å®šè¶…æ—¶(ç§’)</td>
</tr>
<tr>
<td>ENVIRONMENT</td>
<td>è®¾ç½®ç¯å¢ƒå˜é‡</td>
</tr>
<tr>
<td>LABELS</td>
<td>æ·»åŠ æ ‡ç­¾åˆ†ç±»</td>
</tr>
<tr>
<td>DEPENDS</td>
<td>ä¾èµ–å…¶ä»–æµ‹è¯•å®Œæˆ</td>
</tr>
</tbody></table>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_test</span>(NAME net_ping</span><br><span class="line">  <span class="keyword">COMMAND</span> ping_app --url=https://example.com)</span><br><span class="line"><span class="keyword">set_tests_properties</span>(net_ping PROPERTIES</span><br><span class="line">  TIMEOUT <span class="number">15</span></span><br><span class="line">  LABELS <span class="string">&quot;network;integration&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-5-ä¸-GoogleTest-é›†æˆ"><a href="#8-5-ä¸-GoogleTest-é›†æˆ" class="headerlink" title="8.5â€¯ä¸â€¯GoogleTestâ€¯é›†æˆ"></a>8.5â€¯ä¸â€¯GoogleTestâ€¯é›†æˆ</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(FetchContent)</span><br><span class="line">FetchContent_Declare(</span><br><span class="line">  googletest</span><br><span class="line">  GIT_REPOSITORY https://github.com/google/googletest.git</span><br><span class="line">  GIT_TAG release-<span class="number">1.14</span>.<span class="number">0</span>)</span><br><span class="line">FetchContent_MakeAvailable(googletest)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(unit_tests test_math.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(unit_tests PRIVATE GTest::gtest_main)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(GoogleTest)</span><br><span class="line">gtest_discover_tests(unit_tests)</span><br></pre></td></tr></table></figure>

<p>æ‰§è¡Œï¼š  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ctest -V</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>gtest_discover_tests()</code>â€¯ä¼šåœ¨é…ç½®æ—¶è‡ªåŠ¨æšä¸¾â€¯TEST()â€¯å®ç”Ÿæˆçš„å­æµ‹è¯•ã€‚</p>
</blockquote>
<hr>
<h2 id="8-6-è¾“å‡ºä¸æ—¥å¿—"><a href="#8-6-è¾“å‡ºä¸æ—¥å¿—" class="headerlink" title="8.6â€¯è¾“å‡ºä¸æ—¥å¿—"></a>8.6â€¯è¾“å‡ºä¸æ—¥å¿—</h2><table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>-V</code></td>
<td>è¯¦ç»†ä¿¡æ¯</td>
</tr>
<tr>
<td><code>-N</code></td>
<td>åªåˆ—å‡ºè€Œä¸æ‰§è¡Œ</td>
</tr>
<tr>
<td><code>--output-on-failure</code></td>
<td>å¤±è´¥æ—¶è¾“å‡ºè¯¦æƒ…</td>
</tr>
<tr>
<td><code>--repeat until-fail:3</code></td>
<td>é‡è¯•å¤±è´¥æµ‹è¯•</td>
</tr>
<tr>
<td><code>-R pattern</code></td>
<td>æŒ‰åç§°æ­£åˆ™ç­›é€‰</td>
</tr>
</tbody></table>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ctest --output-on-failure -R net</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-7-åˆ†ç»„ä¸æ ‡ç­¾ç®¡ç†"><a href="#8-7-åˆ†ç»„ä¸æ ‡ç­¾ç®¡ç†" class="headerlink" title="8.7â€¯åˆ†ç»„ä¸æ ‡ç­¾ç®¡ç†"></a>8.7â€¯åˆ†ç»„ä¸æ ‡ç­¾ç®¡ç†</h2><p>å¯é€šè¿‡æ ‡ç­¾æ§åˆ¶æµ‹è¯•é›†åˆï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set_tests_properties</span>(api_test PROPERTIES LABELS <span class="string">&quot;integration&quot;</span>)</span><br><span class="line"><span class="keyword">set_tests_properties</span>(math_test PROPERTIES LABELS <span class="string">&quot;unit&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œåˆ†ç»„ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ctest -L unit</span><br></pre></td></tr></table></figure>

<p>æˆ–æ’é™¤ï¼š  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ctest -LE integration</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="8-8-CTest-é…ç½®æ–‡ä»¶"><a href="#8-8-CTest-é…ç½®æ–‡ä»¶" class="headerlink" title="8.8â€¯CTestâ€¯é…ç½®æ–‡ä»¶"></a>8.8â€¯CTestâ€¯é…ç½®æ–‡ä»¶</h2><p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºâ€¯<code>CTestConfig.cmake</code>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CTEST_PROJECT_NAME <span class="string">&quot;MyProj&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CTEST_NIGHTLY_START_TIME <span class="string">&quot;00:00:00 UTC&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CTEST_DROP_METHOD <span class="string">&quot;https&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CTEST_DROP_SITE <span class="string">&quot;cdash.myserver.com&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CTEST_DROP_LOCATION <span class="string">&quot;/submit.php?project=MyProj&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CTEST_DROP_SITE_CDASH <span class="keyword">TRUE</span>)</span><br></pre></td></tr></table></figure>

<p>è¯¥æ–‡ä»¶ä¸ºâ€¯CDashâ€¯ä¸Šä¼ é…ç½®æä¾›é»˜è®¤å€¼ã€‚</p>
<hr>
<h2 id="8-9-CTest-é©±åŠ¨è„šæœ¬æ¨¡å¼"><a href="#8-9-CTest-é©±åŠ¨è„šæœ¬æ¨¡å¼" class="headerlink" title="8.9â€¯CTestâ€¯é©±åŠ¨è„šæœ¬æ¨¡å¼"></a>8.9â€¯CTestâ€¯é©±åŠ¨è„šæœ¬æ¨¡å¼</h2><blockquote>
<p>é€šè¿‡â€¯<code>ctest -S script.cmake</code>â€¯è¿è¡Œå¯è‡ªåŠ¨å®Œæˆï¼šé…ç½®â€¯â†’â€¯ç¼–è¯‘â€¯â†’â€¯æµ‹è¯•â€¯â†’â€¯ä¸Šä¼ ã€‚  </p>
</blockquote>
<p>ç¤ºä¾‹â€¯<code>script.cmake</code>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ctest_start</span>(Experimental)</span><br><span class="line"><span class="keyword">ctest_configure</span>(BUILD <span class="string">&quot;$&#123;CMAKE_BINARY_DIR&#125;&quot;</span> SOURCE <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">ctest_build</span>()</span><br><span class="line"><span class="keyword">ctest_test</span>(REPORT_FORMAT xml OUTPUT_JUNIT results.xml)</span><br><span class="line"><span class="keyword">ctest_submit</span>()</span><br></pre></td></tr></table></figure>

<p>å¯é…åˆâ€¯cronâ€¯æˆ–â€¯CI&#x2F;CDâ€¯å®šæœŸæ‰§è¡Œã€‚</p>
<hr>
<h2 id="8-10-CDash-ä»ªè¡¨ç›˜ç®€ä»‹"><a href="#8-10-CDash-ä»ªè¡¨ç›˜ç®€ä»‹" class="headerlink" title="8.10â€¯CDashâ€¯ä»ªè¡¨ç›˜ç®€ä»‹"></a>8.10â€¯CDashâ€¯ä»ªè¡¨ç›˜ç®€ä»‹</h2><p><strong>CDash</strong>â€¯æ˜¯â€¯Kitwareâ€¯æä¾›çš„ Webâ€¯æµ‹è¯•ç»“æœå±•ç¤ºå¹³å°ã€‚  </p>
<p>ä½ å¯ä»¥ï¼š</p>
<ul>
<li>èšåˆå„ä¸ªæ„å»ºæœºçš„â€¯Build&#x2F;Testâ€¯ç»“æœ</li>
<li>å¯è§†åŒ–æ€§èƒ½&#x2F;è¦†ç›–ç‡å˜åŒ–</li>
<li>è¿½è¸ªå›å½’</li>
</ul>
<p>å®‰è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8081:80 kitware/cdash</span><br></pre></td></tr></table></figure>
<p>è®¿é—®ï¼š<a href="http://localhost:8081/">http://localhost:8081</a><br>ç„¶ååœ¨â€¯CTestConfig.cmakeâ€¯ä¸­å¡«å†™ç›¸åº”çš„â€¯DROPâ€¯åœ°å€ã€‚</p>
<hr>
<h2 id="8-11-æµ‹è¯•è¦†ç›–ç‡ä¸å†…å­˜æ£€æŸ¥"><a href="#8-11-æµ‹è¯•è¦†ç›–ç‡ä¸å†…å­˜æ£€æŸ¥" class="headerlink" title="8.11â€¯æµ‹è¯•è¦†ç›–ç‡ä¸å†…å­˜æ£€æŸ¥"></a>8.11â€¯æµ‹è¯•è¦†ç›–ç‡ä¸å†…å­˜æ£€æŸ¥</h2><h3 id="è¦†ç›–ç‡"><a href="#è¦†ç›–ç‡" class="headerlink" title="è¦†ç›–ç‡"></a>è¦†ç›–ç‡</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DENABLE_COVERAGE=ON ..</span><br><span class="line">make coverage</span><br></pre></td></tr></table></figure>
<p>ç»“åˆå·¥å…·å¦‚ <code>gcovr</code> &#x2F; <code>llvm-cov</code>ã€‚  </p>
<h3 id="å†…å­˜æ³„æ¼æ£€æŸ¥"><a href="#å†…å­˜æ³„æ¼æ£€æŸ¥" class="headerlink" title="å†…å­˜æ³„æ¼æ£€æŸ¥"></a>å†…å­˜æ³„æ¼æ£€æŸ¥</h3><p>åœ¨æµ‹è¯•å‘½ä»¤ä¸­åŠ ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_test</span>(NAME memcheck</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E env ASAN_OPTIONS=detect_leaks=<span class="number">1</span> ctest)</span><br></pre></td></tr></table></figure>
<p>æˆ–ä½¿ç”¨ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ctest -T MemCheck</span><br></pre></td></tr></table></figure>
<p>CMake ä¼šè‡ªåŠ¨åœ¨æµ‹è¯•ä¸‹è¿è¡Œâ€¯Valgrindâ€¯æˆ–â€¯Dr.Memoryã€‚</p>
<hr>
<h2 id="8-12-ä¸-CI-ç³»ç»Ÿç»“åˆ"><a href="#8-12-ä¸-CI-ç³»ç»Ÿç»“åˆ" class="headerlink" title="8.12â€¯ä¸ CI ç³»ç»Ÿç»“åˆ"></a>8.12â€¯ä¸ CI ç³»ç»Ÿç»“åˆ</h2><p>å¸¸è§æ–¹å¼ï¼š<br>1ï¸âƒ£ <strong>GitHubâ€¯Actions</strong><br>   <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">cmake</span> <span class="string">-S</span> <span class="string">.</span> <span class="string">-B</span> <span class="string">build</span> <span class="string">-DCMAKE_BUILD_TYPE=Release</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">cmake</span> <span class="string">--build</span> <span class="string">build</span> <span class="string">-j</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">run:</span> <span class="string">ctest</span> <span class="string">--test-dir</span> <span class="string">build</span> <span class="string">--output-on-failure</span></span><br></pre></td></tr></table></figure></p>
<p>2ï¸âƒ£ <strong>GitLabâ€¯CI</strong><br>   <figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">script:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cmake</span> <span class="string">-S</span> <span class="string">.</span> <span class="string">-B</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cmake</span> <span class="string">--build</span> <span class="string">build</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cd</span> <span class="string">build</span> <span class="string">&amp;&amp;</span> <span class="string">ctest</span> <span class="string">-V</span></span><br></pre></td></tr></table></figure></p>
<p>3ï¸âƒ£ <strong>Jenkins &#x2F; TeamCity</strong></p>
<blockquote>
<p>å¯ç›´æ¥æ‰§è¡Œâ€¯ctestâ€¯æˆ–è°ƒç”¨â€¯CTestâ€¯è„šæœ¬æ¨¡å¼ã€‚  </p>
</blockquote>
<hr>
<h2 id="8-13-ç« èŠ‚å°ç»“"><a href="#8-13-ç« èŠ‚å°ç»“" class="headerlink" title="8.13â€¯ç« èŠ‚å°ç»“"></a>8.13â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯ä½ ç°åœ¨ä¼šï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>enable_testing()</code>â€¯å¯ç”¨æµ‹è¯•  </li>
<li>å€ŸåŠ©â€¯<code>add_test()</code>â€¯æ·»åŠ å•å…ƒæµ‹è¯•  </li>
<li>è¾“å‡ºè¯¦ç»†æ—¥å¿—å¹¶åˆ†ç»„ç®¡ç†  </li>
<li>é›†æˆâ€¯GoogleTestâ€¯æ¡†æ¶  </li>
<li>é€šè¿‡â€¯CTestâ€¯è„šæœ¬ +â€¯CDashâ€¯å½¢æˆå®Œæ•´ä»ªè¡¨ç›˜  </li>
<li>å°†æµ‹è¯•æ¥å…¥â€¯CI&#x2F;CDâ€¯å¹³å°</li>
</ul>
<hr>
<hr>
<h1 id="ğŸ“¦-ç¬¬-9-ç« -å®‰è£…ã€å¯¼å‡ºä¸å¤ç”¨ï¼šinstall-ä¸-CMake-Package-Config"><a href="#ğŸ“¦-ç¬¬-9-ç« -å®‰è£…ã€å¯¼å‡ºä¸å¤ç”¨ï¼šinstall-ä¸-CMake-Package-Config" class="headerlink" title="ğŸ“¦ ç¬¬â€¯9â€¯ç« â€¯|â€¯å®‰è£…ã€å¯¼å‡ºä¸å¤ç”¨ï¼šinstall()â€¯ä¸â€¯CMakeâ€¯Packageâ€¯Config"></a>ğŸ“¦ ç¬¬â€¯9â€¯ç« â€¯|â€¯å®‰è£…ã€å¯¼å‡ºä¸å¤ç”¨ï¼šinstall()â€¯ä¸â€¯CMakeâ€¯Packageâ€¯Config</h1><hr>
<h2 id="9-1-å®‰è£…çš„æ„ä¹‰"><a href="#9-1-å®‰è£…çš„æ„ä¹‰" class="headerlink" title="9.1â€¯å®‰è£…çš„æ„ä¹‰"></a>9.1â€¯å®‰è£…çš„æ„ä¹‰</h2><p>CMakeâ€¯å¯ä»¥å°†ç¼–è¯‘äº§ç‰©ã€å¤´æ–‡ä»¶ã€é…ç½®ã€èµ„æºç»Ÿä¸€æ‰“åŒ…åˆ°å®‰è£…ç›®å½•ã€‚<br>è¿™ä¸ä»…æ–¹ä¾¿éƒ¨ç½²ï¼Œè¿˜èƒ½è®©åˆ«çš„é¡¹ç›®é€šè¿‡â€¯<code>find_package()</code>â€¯ç›´æ¥å¤ç”¨ä½ çš„åº“ã€‚  </p>
<p><strong>å®‰è£…æµç¨‹</strong>  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --install &lt;build_dir&gt; [--prefix &lt;path&gt;]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>é»˜è®¤å‰ç¼€ä¸ºâ€¯<code>$&#123;CMAKE_INSTALL_PREFIX&#125;</code>ï¼Œ<br>Linuxâ€¯é€šå¸¸â€¯<code>/usr/local</code>ï¼ŒWindowsâ€¯ä¸ºâ€¯<code>C:/Program Files/&lt;proj&gt;</code>ã€‚</p>
</blockquote>
<hr>
<h2 id="9-2-install-æ ¸å¿ƒè¯­æ³•"><a href="#9-2-install-æ ¸å¿ƒè¯­æ³•" class="headerlink" title="9.2â€¯install()â€¯æ ¸å¿ƒè¯­æ³•"></a>9.2â€¯install()â€¯æ ¸å¿ƒè¯­æ³•</h2><p>CMakeâ€¯çš„â€¯<code>install()</code>â€¯å‘½ä»¤æ”¯æŒå®‰è£…â€œç›®æ ‡â€ã€â€œæ–‡ä»¶â€ã€â€œç›®å½•â€å’Œâ€œè„šæœ¬â€ã€‚  </p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>TARGETS</td>
<td><code>install(TARGETS mylib)</code></td>
<td>å¯æ‰§è¡Œ&#x2F;åº“ç›®æ ‡</td>
</tr>
<tr>
<td>FILES</td>
<td><code>install(FILES a.h b.h DESTINATION include)</code></td>
<td>çº¯æ–‡ä»¶</td>
</tr>
<tr>
<td>DIRECTORY</td>
<td><code>install(DIRECTORY include/ DESTINATION include)</code></td>
<td>æ•´ä¸ªç›®å½•</td>
</tr>
<tr>
<td>PROGRAMS</td>
<td><code>install(PROGRAMS script.sh DESTINATION bin)</code></td>
<td>å¯æ‰§è¡Œè„šæœ¬</td>
</tr>
<tr>
<td>SCRIPTâ€¯&#x2F;â€¯CODE</td>
<td>ç”¨äºåœ¨å®‰è£…æ‰§è¡Œ CMakeâ€¯ä»£ç </td>
<td></td>
</tr>
</tbody></table>
<hr>
<h2 id="9-3-å®‰è£…å¯æ‰§è¡Œä¸åº“"><a href="#9-3-å®‰è£…å¯æ‰§è¡Œä¸åº“" class="headerlink" title="9.3â€¯å®‰è£…å¯æ‰§è¡Œä¸åº“"></a>9.3â€¯å®‰è£…å¯æ‰§è¡Œä¸åº“</h2><p>æœ€å¸¸è§å†™æ³•ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br><span class="line"><span class="keyword">add_library</span>(mathlib <span class="keyword">math</span>.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(TARGETS app mathlib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  ARCHIVE DESTINATION lib/static)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>-â€¯RUNTIMEâ€¯â†’â€¯å¯æ‰§è¡Œæ–‡ä»¶<br>-â€¯LIBRARYâ€¯â†’â€¯åŠ¨æ€åº“ (.so&#x2F;.dylib)<br>-â€¯ARCHIVEâ€¯â†’â€¯é™æ€åº“ (.a&#x2F;.lib)  </p>
</blockquote>
<hr>
<h2 id="9-4-å®‰è£…å¤´æ–‡ä»¶"><a href="#9-4-å®‰è£…å¤´æ–‡ä»¶" class="headerlink" title="9.4â€¯å®‰è£…å¤´æ–‡ä»¶"></a>9.4â€¯å®‰è£…å¤´æ–‡ä»¶</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>/</span><br><span class="line">  DESTINATION <span class="keyword">include</span></span><br><span class="line">  FILES_MATCHING PATTERN <span class="string">&quot;*.h&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ–ç›´æ¥åˆ—è¡¨å¼ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(FILES <span class="keyword">math</span>.h util.h DESTINATION <span class="keyword">include</span>/mylib)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-5-CMAKE-INSTALL-PREFIX-ä¿®æ”¹"><a href="#9-5-CMAKE-INSTALL-PREFIX-ä¿®æ”¹" class="headerlink" title="9.5â€¯CMAKE_INSTALL_PREFIXâ€¯ä¿®æ”¹"></a>9.5â€¯CMAKE_INSTALL_PREFIXâ€¯ä¿®æ”¹</h2><p>é…ç½®æ—¶æŒ‡å®šï¼š  </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DCMAKE_INSTALL_PREFIX=/opt/mylib ..</span><br><span class="line">cmake --install build</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯åœ¨â€¯CMakeListsâ€¯ä¸­è®¾ç½®é»˜è®¤ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_INSTALL_PREFIX <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/dist&quot;</span> CACHE PATH <span class="string">&quot;&quot;</span> FORCE)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-6-ç”Ÿæˆå®‰è£…åŒ…ç›®å½•ç»“æ„ç¤ºä¾‹"><a href="#9-6-ç”Ÿæˆå®‰è£…åŒ…ç›®å½•ç»“æ„ç¤ºä¾‹" class="headerlink" title="9.6â€¯ç”Ÿæˆå®‰è£…åŒ…ç›®å½•ç»“æ„ç¤ºä¾‹"></a>9.6â€¯ç”Ÿæˆå®‰è£…åŒ…ç›®å½•ç»“æ„ç¤ºä¾‹</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dist/</span><br><span class="line"> â”œâ”€ bin/</span><br><span class="line"> â”‚   â””â”€ app</span><br><span class="line"> â”œâ”€ lib/</span><br><span class="line"> â”‚   â”œâ”€ libmathlib.so</span><br><span class="line"> â”‚   â””â”€ cmake/mylib/MyLibConfig.cmake</span><br><span class="line"> â”œâ”€ include/</span><br><span class="line"> â”‚   â””â”€ mylib/</span><br><span class="line"> â”‚       â””â”€ math.h</span><br><span class="line"> â””â”€ share/doc/</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-7-å¯¼å‡ºç›®æ ‡ä¸é‡ç”¨"><a href="#9-7-å¯¼å‡ºç›®æ ‡ä¸é‡ç”¨" class="headerlink" title="9.7â€¯å¯¼å‡ºç›®æ ‡ä¸é‡ç”¨"></a>9.7â€¯å¯¼å‡ºç›®æ ‡ä¸é‡ç”¨</h2><p>ä¸ºäº†è®©åˆ«çš„é¡¹ç›®â€¯<code>find_package(MyLib)</code>â€¯ç”Ÿæ•ˆï¼Œ<br>éœ€è¦å¯¼å‡ºç›®æ ‡å’Œé…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS mathlib</span><br><span class="line">  <span class="keyword">EXPORT</span> MyLibTargets</span><br><span class="line">  DESTINATION lib)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyLibTargets</span><br><span class="line">  <span class="keyword">FILE</span> MyLibTargets.cmake</span><br><span class="line">  NAMESPACE MyLib::</span><br><span class="line">  DESTINATION lib/cmake/MyLib)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·åˆ«çš„é¡¹ç›®å¯å†™ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(MyLib REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE MyLib::mathlib)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-8-Config-Package-æ–‡ä»¶"><a href="#9-8-Config-Package-æ–‡ä»¶" class="headerlink" title="9.8â€¯Configâ€¯Packageâ€¯æ–‡ä»¶"></a>9.8â€¯Configâ€¯Packageâ€¯æ–‡ä»¶</h2><p>ç”Ÿæˆâ€¯<code>MyLibConfig.cmake</code>â€¯å’Œâ€¯<code>MyLibConfigVersion.cmake</code>ï¼Œ<br>ç”¨äºæè¿°åº“ç‰ˆæœ¬ä¸ä¾èµ–ã€‚&#96;&#96;&#96;cmake<br>include(CMakePackageConfigHelpers)</p>
<p>write_basic_package_version_file(<br>  â€œ${CMAKE_CURRENT_BINARY_DIR}&#x2F;MyLibConfigVersion.cmakeâ€<br>  VERSION ${PROJECT_VERSION}<br>  COMPATIBILITY SameMajorVersion)</p>
<p>configure_package_config_file(<br>  â€œ${CMAKE_CURRENT_SOURCE_DIR}&#x2F;cmake&#x2F;MyLibConfig.cmake.inâ€<br>  â€œ${CMAKE_CURRENT_BINARY_DIR}&#x2F;MyLibConfig.cmakeâ€<br>  INSTALL_DESTINATION lib&#x2F;cmake&#x2F;MyLib)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">æ¨¡æ¿â€¯`MyLibConfig.cmake.in`ï¼š</span><br><span class="line">```cmake</span><br><span class="line">@PACKAGE_INIT@</span><br><span class="line">include(&quot;$&#123;CMAKE_CURRENT_LIST_DIR&#125;/MyLibTargets.cmake&quot;)</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä¸€èµ·å®‰è£…ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(FILES</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyLibConfig.cmake&quot;</span></span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyLibConfigVersion.cmake&quot;</span></span><br><span class="line">  DESTINATION lib/cmake/MyLib)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-9-å¯¼å‡ºæ„å»ºç›®å½•ï¼ˆéå®‰è£…æ¨¡å¼ï¼‰"><a href="#9-9-å¯¼å‡ºæ„å»ºç›®å½•ï¼ˆéå®‰è£…æ¨¡å¼ï¼‰" class="headerlink" title="9.9â€¯å¯¼å‡ºæ„å»ºç›®å½•ï¼ˆéå®‰è£…æ¨¡å¼ï¼‰"></a>9.9â€¯å¯¼å‡ºæ„å»ºç›®å½•ï¼ˆéå®‰è£…æ¨¡å¼ï¼‰</h2><p>åœ¨å¼€å‘æ—¶å¯ç›´æ¥å¯¼å‡ºæ„å»ºæ ‘ä¾›ä¸´æ—¶ä½¿ç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span>(<span class="keyword">EXPORT</span> MyLibTargets</span><br><span class="line">  <span class="keyword">FILE</span> <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY&#125;/MyLibTargets.cmake&quot;</span></span><br><span class="line">  NAMESPACE MyLib::)</span><br></pre></td></tr></table></figure>

<p>åˆ«çš„é¡¹ç›®åœ¨æœ¬åœ°å¯é€šè¿‡ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(MyLib_DIR <span class="string">&quot;/path/to/build&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(MyLib REQUIRED)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-10-install-å‘½ä»¤é™„å¸¦ç»„ä»¶ä¸æ¡ä»¶"><a href="#9-10-install-å‘½ä»¤é™„å¸¦ç»„ä»¶ä¸æ¡ä»¶" class="headerlink" title="9.10â€¯installâ€¯å‘½ä»¤é™„å¸¦ç»„ä»¶ä¸æ¡ä»¶"></a>9.10â€¯installâ€¯å‘½ä»¤é™„å¸¦ç»„ä»¶ä¸æ¡ä»¶</h2><p>è®¾ç½®ç»„ä»¶ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS app</span><br><span class="line">  COMPONENT runtime</span><br><span class="line">  DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span>(DIRECTORY docs/ DESTINATION share/doc COMPONENT doc)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake --install build --component runtime</span><br></pre></td></tr></table></figure>

<p>æ¡ä»¶å®‰è£…ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(FILES config.win DESTINATION etc RENAME config.txt</span><br><span class="line">  CONFIGURATIONS Release)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="9-11-ä½¿ç”¨-CPack-ç”Ÿæˆæ‰“åŒ…æ–‡ä»¶"><a href="#9-11-ä½¿ç”¨-CPack-ç”Ÿæˆæ‰“åŒ…æ–‡ä»¶" class="headerlink" title="9.11â€¯ä½¿ç”¨â€¯CPackâ€¯ç”Ÿæˆæ‰“åŒ…æ–‡ä»¶"></a>9.11â€¯ä½¿ç”¨â€¯CPackâ€¯ç”Ÿæˆæ‰“åŒ…æ–‡ä»¶</h2><p>åœ¨é¡¹ç›®ä¸­æ·»åŠ ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(InstallRequiredSystemLibraries)</span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_NAME <span class="string">&quot;MyLib&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_VERSION <span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CPACK_GENERATOR <span class="string">&quot;ZIP;TGZ&quot;</span>)</span><br><span class="line"><span class="keyword">include</span>(CPack)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cpack</span><br></pre></td></tr></table></figure>
<p>å°†è‡ªåŠ¨æŠŠå®‰è£…äº§ç‰©æ‰“åŒ…ä¸ºâ€¯zip &#x2F; tar.gzâ€¯æ–‡ä»¶ã€‚  </p>
<hr>
<h2 id="9-12-ç« èŠ‚å°ç»“"><a href="#9-12-ç« èŠ‚å°ç»“" class="headerlink" title="9.12â€¯ç« èŠ‚å°ç»“"></a>9.12â€¯ç« èŠ‚å°ç»“</h2><p>âœ…â€¯ä½ å·²æŒæ¡ï¼š<br>-â€¯ä½¿ç”¨â€¯install()â€¯å®‰è£…ç›®æ ‡ã€æ–‡ä»¶ã€ç›®å½•<br>-â€¯é€šè¿‡â€¯CMAKE_INSTALL_PREFIXâ€¯æ§åˆ¶å®‰è£…è·¯å¾„<br>-â€¯å¯¼å‡ºâ€¯Targetsâ€¯ä¸â€¯Configâ€¯æ–‡ä»¶ä¾›å…¶ä»–é¡¹ç›®å¤ç”¨<br>-â€¯ä½¿ç”¨â€¯CPackâ€¯ç”Ÿæˆè·¨å¹³å°å®‰è£…åŒ…  </p>
<hr>
<hr>
<h1 id="ğŸ§©-ç¬¬-10-ç« -è¿›é˜¶é¡¹ç›®ç»“æ„ä¸æ¨¡å—åŒ–è®¾è®¡ï¼šåˆ†å±‚ã€å®ä¸å‡½æ•°ã€Find-Module-ç¼–å†™"><a href="#ğŸ§©-ç¬¬-10-ç« -è¿›é˜¶é¡¹ç›®ç»“æ„ä¸æ¨¡å—åŒ–è®¾è®¡ï¼šåˆ†å±‚ã€å®ä¸å‡½æ•°ã€Find-Module-ç¼–å†™" class="headerlink" title="ğŸ§© ç¬¬â€¯10â€¯ç« â€¯|â€¯è¿›é˜¶é¡¹ç›®ç»“æ„ä¸æ¨¡å—åŒ–è®¾è®¡ï¼šåˆ†å±‚ã€å®ä¸å‡½æ•°ã€Findâ€¯Moduleâ€¯ç¼–å†™"></a>ğŸ§© ç¬¬â€¯10â€¯ç« â€¯|â€¯è¿›é˜¶é¡¹ç›®ç»“æ„ä¸æ¨¡å—åŒ–è®¾è®¡ï¼šåˆ†å±‚ã€å®ä¸å‡½æ•°ã€Findâ€¯Moduleâ€¯ç¼–å†™</h1><hr>
<h2 id="10-1-å¤§å‹é¡¹ç›®çš„å…¸å‹ç»“æ„"><a href="#10-1-å¤§å‹é¡¹ç›®çš„å…¸å‹ç»“æ„" class="headerlink" title="10.1â€¯å¤§å‹é¡¹ç›®çš„å…¸å‹ç»“æ„"></a>10.1â€¯å¤§å‹é¡¹ç›®çš„å…¸å‹ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyProject/</span><br><span class="line">â”œâ”€ CMakeLists.txt        # é¡¶å±‚ï¼šé…ç½®ã€å…¨å±€é€‰é¡¹</span><br><span class="line">â”œâ”€ cmake/                # è‡ªå®šä¹‰æ¨¡å—è„šæœ¬</span><br><span class="line">â”‚   â”œâ”€ FindXXX.cmake</span><br><span class="line">â”‚   â””â”€ Utils.cmake</span><br><span class="line">â”œâ”€ src/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt    # åº“ / å¯æ‰§è¡Œå®šä¹‰</span><br><span class="line">â”‚   â”œâ”€ core/</span><br><span class="line">â”‚   â””â”€ ui/</span><br><span class="line">â”œâ”€ include/</span><br><span class="line">â”‚   â””â”€ myproj/</span><br><span class="line">â”‚       â””â”€ *.h</span><br><span class="line">â”œâ”€ tests/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚   â””â”€ *.cpp</span><br><span class="line">â””â”€ examples/</span><br><span class="line">    â””â”€ CMakeLists.txt</span><br></pre></td></tr></table></figure>

<p><strong>å±‚çº§æ€è·¯ï¼š</strong></p>
<ol>
<li>é¡¶å±‚å¤„ç†å…¨å±€é…ç½®ã€é€‰é¡¹ã€ä¾èµ–ï¼›</li>
<li>ä¸‹å±‚æ¨¡å—é€šè¿‡â€¯<code>add_library()</code>â€¯æˆ–â€¯<code>add_executable()</code>â€¯å®šä¹‰ï¼›</li>
<li>ä½¿ç”¨â€¯<code>option()</code>â€¯æ§åˆ¶å¯ç¼–è¯‘æ¨¡å—ï¼›</li>
<li>ä»£ç ä¸å¤´æ–‡ä»¶ä¿æŒåˆ†ç¦»ã€‚</li>
</ol>
<hr>
<h2 id="10-2-å±‚çº§-CMakeLists-txt-çš„åä½œ"><a href="#10-2-å±‚çº§-CMakeLists-txt-çš„åä½œ" class="headerlink" title="10.2â€¯å±‚çº§ CMakeLists.txtâ€¯çš„åä½œ"></a>10.2â€¯å±‚çº§ CMakeLists.txtâ€¯çš„åä½œ</h2><p>æ¯çº§åœ¨è‡ªå·±çš„ CMakeLists.txt ä¸­å®šä¹‰å±€éƒ¨é€»è¾‘ï¼Œ<br>ç„¶ååœ¨ä¸Šå±‚ç”¨â€¯<code>add_subdirectory()</code>â€¯åŠ è½½ã€‚</p>
<p><strong>é¡¶å±‚ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.20</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject VERSION <span class="number">1.0</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(ENABLE_TESTS <span class="string">&quot;Build tests&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(src)</span><br><span class="line"><span class="keyword">if</span>(ENABLE_TESTS)</span><br><span class="line">  <span class="keyword">enable_testing</span>()</span><br><span class="line"> _subdirectory(tests)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(cmake/Utils.cmake)</span><br></pre></td></tr></table></figure>

<p><strong>å­æ¨¡å—ï¼š</strong>  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(core core.cpp core.h)</span><br><span class="line"><span class="keyword">target_include_directories</span>(core PUBLIC <span class="variable">$&#123;PROJECT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-3-æ¨¡å—åŒ–ä¸æ¥å£å°è£…"><a href="#10-3-æ¨¡å—åŒ–ä¸æ¥å£å°è£…" class="headerlink" title="10.3â€¯æ¨¡å—åŒ–ä¸æ¥å£å°è£…"></a>10.3â€¯æ¨¡å—åŒ–ä¸æ¥å£å°è£…</h2><p>æ¨èåšæ³•ï¼š<br>æ¯ä¸ªå­æ¨¡å—æ„æˆè‡ªæˆä½“ç³»çš„â€¯libraryï¼Œ<br>æš´éœ²ç›®æ ‡åã€åŒ…å«è·¯å¾„ã€ä¾èµ–ã€‚  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(ui ui.cpp ui.h)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(ui PUBLIC core Qt::Widgets)</span><br></pre></td></tr></table></figure>

<p>å…¶ä»–æ¨¡å—åªéœ€ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE ui)</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡â€¯<code>target_*</code>â€¯æ¥å£ç®¡ç†ä¾èµ–è€Œéæ‰‹å·¥ include&#x2F;linkï¼Œæ˜¯ç°ä»£â€¯CMakeâ€¯çš„å…³é”®ã€‚</p>
<hr>
<h2 id="10-4-è‡ªå®šä¹‰å‡½æ•°ä¸å®"><a href="#10-4-è‡ªå®šä¹‰å‡½æ•°ä¸å®" class="headerlink" title="10.4â€¯è‡ªå®šä¹‰å‡½æ•°ä¸å®"></a>10.4â€¯è‡ªå®šä¹‰å‡½æ•°ä¸å®</h2><p>CMakeâ€¯æ”¯æŒâ€¯<code>function()</code>â€¯ä¸â€¯<code>macro()</code>â€¯å®šä¹‰å¯é‡ç”¨é€»è¾‘ã€‚  </p>
<table>
<thead>
<tr>
<th>åŒºåˆ«</th>
<th>function</th>
<th>macro</th>
</tr>
</thead>
<tbody><tr>
<td>ä½œç”¨åŸŸ</td>
<td>å±€éƒ¨ä½œç”¨åŸŸï¼ˆæ¨èï¼‰</td>
<td>æ‰©å±•åˆ°è°ƒç”¨å¤„ä½œç”¨åŸŸ</td>
</tr>
<tr>
<td>å‚æ•°ä¼ é€’</td>
<td>å¤åˆ¶</td>
<td>æ–‡æœ¬æ›¿æ¢</td>
</tr>
</tbody></table>
<p>ä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cmake/Utils.cmake</span></span><br><span class="line"><span class="keyword">function</span>(add_my_exec name)</span><br><span class="line">  <span class="keyword">add_executable</span>(<span class="variable">$&#123;name&#125;</span> <span class="variable">$&#123;ARGN&#125;</span>)</span><br><span class="line">  <span class="keyword">target_compile_features</span>(<span class="variable">$&#123;name&#125;</span> PRIVATE cxx_std_17)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(cmake/Utils.cmake)</span><br><span class="line">add_my_exec(app main.cpp)</span><br></pre></td></tr></table></figure>

<p>å¯ç®€åŒ–é‡å¤æ¨¡å¼å¹¶ä¿æŒä¸€è‡´æ€§ã€‚</p>
<hr>
<h2 id="10-5-è·¨å­é¡¹ç›®ä¼ é€’å˜é‡"><a href="#10-5-è·¨å­é¡¹ç›®ä¼ é€’å˜é‡" class="headerlink" title="10.5â€¯è·¨å­é¡¹ç›®ä¼ é€’å˜é‡"></a>10.5â€¯è·¨å­é¡¹ç›®ä¼ é€’å˜é‡</h2><p>è‹¥è¦åœ¨é¡¶å±‚æ§åˆ¶å­é¡¹ç›®ï¼Œå¯ä»¥åˆ©ç”¨â€¯<code>CACHE</code>â€¯å˜é‡æˆ–â€¯<code>option()</code>ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(BUILD_UI <span class="keyword">ON</span> CACHE BOOL <span class="string">&quot;Build UI module&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>å­é¡¹ç›®å°±èƒ½æ£€æµ‹â€¯<code>BUILD_UI</code>â€¯æ˜¯å¦ä¸ºâ€¯ONã€‚</p>
<p>è‹¥æƒ³çœŸæ­£å¯¼å‡ºåˆ°å…¶ä»– scopeï¼Œå¯ç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(VAR_NAME value PARENT_SCOPE)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-6-è‡ªå®šä¹‰æ¨¡å—è·¯å¾„"><a href="#10-6-è‡ªå®šä¹‰æ¨¡å—è·¯å¾„" class="headerlink" title="10.6â€¯è‡ªå®šä¹‰æ¨¡å—è·¯å¾„"></a>10.6â€¯è‡ªå®šä¹‰æ¨¡å—è·¯å¾„</h2><p>è‹¥æƒ³è®©â€¯CMakeâ€¯æ‰¾åˆ°è‡ªå®šä¹‰çš„â€¯FindXXX.cmakeï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">list</span>(APPEND CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·æ‰§è¡Œâ€¯<code>find_package(XXX REQUIRED)</code>â€¯æ—¶ï¼Œä¼šä¼˜å…ˆåœ¨è¯¥ç›®å½•æœç´¢ã€‚</p>
<hr>
<h2 id="10-7-Find-Module-æ–‡ä»¶ç»“æ„"><a href="#10-7-Find-Module-æ–‡ä»¶ç»“æ„" class="headerlink" title="10.7â€¯Findâ€¯Moduleâ€¯æ–‡ä»¶ç»“æ„"></a>10.7â€¯Findâ€¯Moduleâ€¯æ–‡ä»¶ç»“æ„</h2><p>Find æ¨¡å—é€šå¸¸å‘½åä¸ºâ€¯<strong>Find<Package>.cmake</strong>ã€‚<br>åŸºæœ¬æ¨¡æ¿ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># FindFoo.cmake</span></span><br><span class="line"><span class="keyword">find_path</span>(FOO_INCLUDE_DIR foo.h)</span><br><span class="line"><span class="keyword">find_library</span>(FOO_LIBRARY NAMES foo)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(FindPackageHandleStandardArgs)</span><br><span class="line">find_package_handle_standard_args(Foo</span><br><span class="line">  REQUIRED_VARSOO_LIBRARY FOO_INCLUDE_DIR)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(FOO_FOUND)</span><br><span class="line">  <span class="keyword">set</span>(FOO_LIBRARIES <span class="variable">$&#123;FOO_LIBRARY&#125;</span>)</span><br><span class="line">  <span class="keyword">set</span>(FOO_INCLUDE_DIRS <span class="variable">$&#123;FOO_INCLUDE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>é¡¹ç›®ä¸­å³å¯ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(Foo REQUIRED)</span><br><span class="line"><span class="keyword">target_include_directories</span>(app PRIVATE <span class="variable">$&#123;FOO_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE <span class="variable">$&#123;FOO_LIBRARIES&#125;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-8-å°è£…å¤–éƒ¨ä¾èµ–"><a href="#10-8-å°è£…å¤–éƒ¨ä¾èµ–" class="headerlink" title="10.8â€¯å°è£…å¤–éƒ¨ä¾èµ–"></a>10.8â€¯å°è£…å¤–éƒ¨ä¾èµ–</h2><p>å¯¹äºå¸¸è§ç¬¬ä¸‰æ–¹åº“ï¼Œä¾‹å¦‚ fmtã€spdlogã€OpenCVã€Boostï¼š  </p>
<ul>
<li><strong>ä¼˜å…ˆä½¿ç”¨å®˜æ–¹ CMake åŒ…</strong>  <figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(fmt CONFIG REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE fmt::fmt)</span><br></pre></td></tr></table></figure></li>
<li><strong>æ— å®˜æ–¹åŒ…æ—¶ä½¿ç”¨ Find æ¨¡å—</strong>  </li>
<li><strong>æˆ–è€…ä½¿ç”¨ FetchContent ç›´æ¥åµŒå…¥æºç </strong></li>
</ul>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(FetchContent)</span><br><span class="line">FetchContent_Declare(spdlog</span><br><span class="line">  GIT_REPOSITORY https://github.com/gabime/spdlog.git</span><br><span class="line">  GIT_TAG v1.<span class="number">13.0</span>)</span><br><span class="line">FetchContent_MakeAvailable(spdlog)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE spdlog::spdlog)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="10-9-æ¡ä»¶ç¼–è¯‘ä¸å¹³å°å·®å¼‚"><a href="#10-9-æ¡ä»¶ç¼–è¯‘ä¸å¹³å°å·®å¼‚" class="headerlink" title="10.9â€¯æ¡ä»¶ç¼–è¯‘ä¸å¹³å°å·®å¼‚"></a>10.9â€¯æ¡ä»¶ç¼–è¯‘ä¸å¹³å°å·®å¼‚</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(WIN32)</span><br><span class="line">  <span class="keyword">target_compile_definitions</span>(app PRIVATE PLATFORM_WINDOWS)</span><br><span class="line"><span class="keyword">elseif</span>(APPLE)</span><br><span class="line">  <span class="keyword">target_compile_definitions</span>(app PRIVATE PLATFORM_MACOS)</span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">target_compile_definitions</span>(app PRIVATE PLATFORM_LINUX)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<p>-â€¯<code>WIN32</code>,â€¯<code>UNIX</code>,â€¯<code>APPLE</code>,â€¯<code>CMAKE_SYSTEM_NAME</code>â€¯ç­‰å˜é‡ç”¨äºåˆ¤æ–­ç³»ç»Ÿï¼›<br>-â€¯å¯é…åˆâ€¯generatorâ€¯expressionâ€¯åœ¨ç¼–è¯‘æ—¶è‡ªåŠ¨åˆ‡æ¢ã€‚</p>
<hr>
<h2 id="10-10-ç”Ÿæˆå™¨è¡¨è¾¾å¼å›é¡¾"><a href="#10-10-ç”Ÿæˆå™¨è¡¨è¾¾å¼å›é¡¾" class="headerlink" title="10.10â€¯ç”Ÿæˆå™¨è¡¨è¾¾å¼å›é¡¾"></a>10.10â€¯ç”Ÿæˆå™¨è¡¨è¾¾å¼å›é¡¾</h2><p><strong>ç”Ÿæˆå™¨è¡¨è¾¾å¼</strong> <code>$&lt;...&gt;</code><br>å¯åœ¨é…ç½®æ—¶å†³å®šæŸä¸ªå±æ€§åœ¨ä¸åŒæ¡ä»¶ä¸‹çš„å€¼ï¼š  </p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_compile_definitions</span>(app PRIVATE</span><br><span class="line">  $&lt;$&lt;CONFIG:Debug&gt;:DEBUG_BUILD&gt;)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(app PRIVATE</span><br><span class="line">  $&lt;$&lt;PLATFORM_ID:Windows&gt;:ws2_32&gt;)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ç»Ÿä¸€ç®¡ç†å¤šå¹³å°å·®å¼‚ä¸”ä¿æŒæ–‡ä»¶æ•´æ´ã€‚</p>
<hr>
<h2 id="10-11-æœ€ä½³å®è·µæ€»ç»“"><a href="#10-11-æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="10.11â€¯æœ€ä½³å®è·µæ€»ç»“"></a>10.11â€¯æœ€ä½³å®è·µæ€»ç»“</h2><p>âœ…â€¯<strong>æ¨¡å—åŸåˆ™</strong>  </p>
<ul>
<li>æ¯ä¸ªæ¨¡å—å°½é‡ç‹¬ç«‹ï¼ˆè‡ªå®šä¹‰å¤´ã€æºç ã€CMakeListsï¼‰  </li>
<li>åœ¨æ¥å£ä¸Šæš´éœ²ç›®æ ‡è€Œéè·¯å¾„  </li>
<li>é¿å…ä½¿ç”¨å…¨å±€å˜é‡ä¸å…¨å±€ include_directories</li>
</ul>
<p>âœ…â€¯<strong>å‡½æ•°å°è£…</strong>  </p>
<ul>
<li>å°†é‡å¤è§„åˆ™æŠ½è±¡æˆå‡½æ•°  </li>
<li>å°½é‡é¿å…å®æ±¡æŸ“å…¨å±€</li>
</ul>
<p>âœ…â€¯<strong>ä¾èµ–ç®¡ç†</strong>  </p>
<ul>
<li>ä¼˜å…ˆâ€¯CONFIGâ€¯åŒ… â†’â€¯Find æ¨¡å— â†’â€¯FetchContent  </li>
<li>è‡ªå·±çš„åº“è¦å¯¼å‡ºâ€¯Configâ€¯æ–‡ä»¶æ–¹ä¾¿ä»–äººâ€¯find_package()</li>
</ul>
<p>âœ…â€¯<strong>ç›®å½•ç»„ç»‡</strong>  </p>
<ul>
<li><code>cmake/</code>â€¯æ”¾è‡ªå®šä¹‰è„šæœ¬  </li>
<li><code>include/</code>â€¯æš´éœ²å¤´æ–‡ä»¶  </li>
<li><code>src/</code>â€¯æ”¾å®ç°  </li>
<li><code>tests/</code>ã€<code>examples/</code>â€¯æ¸…æ™°åˆ†å±‚</li>
</ul>
<hr>
<h2 id="10-12-æ•´é—¨è¯¾ç¨‹å›é¡¾-ğŸ™Œ"><a href="#10-12-æ•´é—¨è¯¾ç¨‹å›é¡¾-ğŸ™Œ" class="headerlink" title="10.12â€¯æ•´é—¨è¯¾ç¨‹å›é¡¾ ğŸ™Œ"></a>10.12â€¯æ•´é—¨è¯¾ç¨‹å›é¡¾ ğŸ™Œ</h2><table>
<thead>
<tr>
<th>ç« èŠ‚</th>
<th>æ ¸å¿ƒå†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>CMakeâ€¯åˆä½“éªŒ</td>
</tr>
<tr>
<td>2</td>
<td>åŸºæœ¬å‘½ä»¤ä¸å˜é‡</td>
</tr>
<tr>
<td>3</td>
<td>ç›®æ ‡ä¸ä¾èµ–ç®¡ç†</td>
</tr>
<tr>
<td>4</td>
<td>ç¼–è¯‘é€‰é¡¹ä¸ç‰¹æ€§æ§åˆ¶</td>
</tr>
<tr>
<td>5</td>
<td>æ¡ä»¶ã€å¾ªç¯ä¸å®</td>
</tr>
<tr>
<td>6</td>
<td>å¤–éƒ¨é¡¹ç›®ä¸â€¯FetchContent</td>
</tr>
<tr>
<td>7</td>
<td>è‡ªå®šä¹‰å‘½ä»¤ä¸ç›®æ ‡</td>
</tr>
<tr>
<td>8</td>
<td>æµ‹è¯•ä¸â€¯CTest&#x2F;CDash</td>
</tr>
<tr>
<td>9</td>
<td>å®‰è£…ä¸å¯¼å‡ºé…ç½®</td>
</tr>
<tr>
<td>10</td>
<td>æ¨¡å—åŒ–ä¸å¤§å‹å·¥ç¨‹æ¶æ„</td>
</tr>
</tbody></table>
<p>ğŸ¯â€¯ç°åœ¨ä½ èƒ½ä»é›¶è®¾è®¡ã€æ„å»ºã€æµ‹è¯•ã€å®‰è£…å¹¶å¤ç”¨è·¨å¹³å°â€¯CMakeâ€¯é¡¹ç›®ã€‚  </p>
<hr>
<hr>
<h1 id="ğŸ“˜-é™„å½•-CMake-å¸¸ç”¨å‘½ä»¤ã€å˜é‡ä¸ç”Ÿæˆè¡¨è¾¾å¼é€ŸæŸ¥è¡¨"><a href="#ğŸ“˜-é™„å½•-CMake-å¸¸ç”¨å‘½ä»¤ã€å˜é‡ä¸ç”Ÿæˆè¡¨è¾¾å¼é€ŸæŸ¥è¡¨" class="headerlink" title="ğŸ“˜ é™„å½•â€¯|â€¯CMakeâ€¯å¸¸ç”¨å‘½ä»¤ã€å˜é‡ä¸ç”Ÿæˆè¡¨è¾¾å¼é€ŸæŸ¥è¡¨"></a>ğŸ“˜ é™„å½•â€¯|â€¯CMakeâ€¯å¸¸ç”¨å‘½ä»¤ã€å˜é‡ä¸ç”Ÿæˆè¡¨è¾¾å¼é€ŸæŸ¥è¡¨</h1><hr>
<h2 id="ğŸ”§-A-1-æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥"><a href="#ğŸ”§-A-1-æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥" class="headerlink" title="ğŸ”§â€¯A.1â€¯æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥"></a>ğŸ”§â€¯A.1â€¯æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥</h2><table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>å¸¸ç”¨å‘½ä»¤</th>
<th>åŠŸèƒ½æ¦‚è¿°</th>
</tr>
</thead>
<tbody><tr>
<td><strong>é¡¹ç›®åˆå§‹åŒ–</strong></td>
<td><code>cmake_minimum_required()</code></td>
<td>å£°æ˜æ‰€éœ€æœ€ä½ç‰ˆæœ¬</td>
</tr>
<tr>
<td></td>
<td><code>project(&lt;name&gt; VERSION &lt;v&gt; LANGUAGES C CXX)</code></td>
<td>å®šä¹‰é¡¹ç›®åç§°ä¸è¯­è¨€</td>
</tr>
<tr>
<td><strong>æ„å»ºé€»è¾‘</strong></td>
<td><code>add_executable()</code></td>
<td>å®šä¹‰å¯æ‰§è¡Œæ–‡ä»¶</td>
</tr>
<tr>
<td></td>
<td><code>add_library()</code></td>
<td>å®šä¹‰é™æ€æˆ–åŠ¨æ€åº“</td>
</tr>
<tr>
<td></td>
<td><code>target_link_libraries()</code></td>
<td>ç»‘å®šä¾èµ–ç›®æ ‡</td>
</tr>
<tr>
<td></td>
<td><code>target_include_directories()</code></td>
<td>è®¾ç½®å¤´æ–‡ä»¶è·¯å¾„</td>
</tr>
<tr>
<td></td>
<td><code>target_compile_definitions()</code></td>
<td>æŒ‡å®šå®å®šä¹‰</td>
</tr>
<tr>
<td><strong>å˜é‡ä¸é€‰é¡¹</strong></td>
<td><code>set()</code></td>
<td>å®šä¹‰å˜é‡</td>
</tr>
<tr>
<td></td>
<td><code>option()</code></td>
<td>å®šä¹‰å¼€å…³</td>
</tr>
<tr>
<td></td>
<td><code>message()</code></td>
<td>è¾“å‡ºä¿¡æ¯</td>
</tr>
<tr>
<td><strong>ç›®å½•å±‚çº§</strong></td>
<td><code>add_subdirectory()</code></td>
<td>åŒ…å«å­ç›®å½•</td>
</tr>
<tr>
<td></td>
<td><code>include()</code></td>
<td>å¼•å…¥è„šæœ¬æ–‡ä»¶</td>
</tr>
<tr>
<td><strong>æ¡ä»¶ä¸å¾ªç¯</strong></td>
<td><code>if()/elseif()/else()/endif()</code></td>
<td>æ¡ä»¶åˆ¤æ–­</td>
</tr>
<tr>
<td></td>
<td><code>foreach()/endforeach()</code></td>
<td>å¾ªç¯è¿­ä»£</td>
</tr>
<tr>
<td></td>
<td><code>while()/endwhile()</code></td>
<td>æ¡ä»¶å¾ªç¯</td>
</tr>
<tr>
<td><strong>å®‰è£…ä¸æ‰“åŒ…</strong></td>
<td><code>install()</code></td>
<td>å®‰è£…æ–‡ä»¶&#x2F;ç›®æ ‡</td>
</tr>
<tr>
<td></td>
<td><code>include(CPack)</code></td>
<td>å¯åŠ¨æ‰“åŒ…ç³»ç»Ÿ</td>
</tr>
<tr>
<td><strong>æµ‹è¯•</strong></td>
<td><code>enable_testing()</code></td>
<td>å¼€å¯æµ‹è¯•åŠŸèƒ½</td>
</tr>
<tr>
<td></td>
<td><code>add_test()</code></td>
<td>æ³¨å†Œæµ‹è¯•</td>
</tr>
<tr>
<td></td>
<td><code>ctest</code></td>
<td>å‘½ä»¤è¡Œæ‰§è¡Œæµ‹è¯•</td>
</tr>
<tr>
<td><strong>è‡ªå®šä¹‰è¡Œä¸º</strong></td>
<td><code>add_custom_command()</code></td>
<td>è‡ªå®šä¹‰å‘½ä»¤</td>
</tr>
<tr>
<td></td>
<td><code>add_custom_target()</code></td>
<td>è‡ªå®šä¹‰ç›®æ ‡</td>
</tr>
<tr>
<td><strong>å¯¼å…¥ä¸ä¾èµ–</strong></td>
<td><code>find_package()</code></td>
<td>æŸ¥æ‰¾å¤–éƒ¨åº“</td>
</tr>
<tr>
<td></td>
<td><code>find_library()</code>â€¯&#x2F;â€¯<code>find_path()</code></td>
<td>æŸ¥æ‰¾æ–‡ä»¶æˆ–åº“è·¯å¾„</td>
</tr>
<tr>
<td><strong>è„šæœ¬ä¸å‡½æ•°</strong></td>
<td><code>function()</code></td>
<td>å®šä¹‰å±€éƒ¨å‡½æ•°</td>
</tr>
<tr>
<td></td>
<td><code>macro()</code></td>
<td>å®šä¹‰å®</td>
</tr>
<tr>
<td><strong>å¯¼å‡ºå¤ç”¨</strong></td>
<td><code>install(EXPORT â€¦)</code></td>
<td>å®‰è£…å¯¼å‡ºç›®æ ‡</td>
</tr>
<tr>
<td></td>
<td><code>export(EXPORT â€¦)</code></td>
<td>å¯¼å‡ºæ„å»ºå†…ç›®æ ‡</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ§©-A-2-é‡è¦å˜é‡é€ŸæŸ¥"><a href="#ğŸ§©-A-2-é‡è¦å˜é‡é€ŸæŸ¥" class="headerlink" title="ğŸ§©â€¯A.2â€¯é‡è¦å˜é‡é€ŸæŸ¥"></a>ğŸ§©â€¯A.2â€¯é‡è¦å˜é‡é€ŸæŸ¥</h2><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_SOURCE_DIR</code></td>
<td>é¡¶å±‚æºç›®å½•</td>
</tr>
<tr>
<td><code>CMAKE_BINARY_DIR</code></td>
<td>é¡¶å±‚æ„å»ºç›®å½•</td>
</tr>
<tr>
<td><code>CMAKE_CURRENT_SOURCE_DIR</code></td>
<td>å½“å‰è„šæœ¬æºç›®å½•</td>
</tr>
<tr>
<td><code>CMAKE_CURRENT_BINARY_DIR</code></td>
<td>å½“å‰è„šæœ¬æ„å»ºç›®å½•</td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_PREFIX</code></td>
<td>å®‰è£…è·¯å¾„</td>
</tr>
<tr>
<td><code>CMAKE_BUILD_TYPE</code></td>
<td>æ„å»ºç±»å‹ï¼ˆDebug&#x2F;Releaseï¼‰</td>
</tr>
<tr>
<td><code>PROJECT_SOURCE_DIR</code> &#x2F; <code>PROJECT_BINARY_DIR</code></td>
<td>å½“å‰é¡¹ç›®è·¯å¾„</td>
</tr>
<tr>
<td><code>CMAKE_CXX_STANDARD</code></td>
<td>è®¾ç½® C++ æ ‡å‡†ç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>CMAKE_MODULE_PATH</code></td>
<td>æŸ¥æ‰¾è‡ªå®šä¹‰æ¨¡å—è·¯å¾„</td>
</tr>
<tr>
<td><code>CMAKE_PREFIX_PATH</code></td>
<td>æç¤º find_package() æŸ¥æ‰¾å‰ç¼€</td>
</tr>
<tr>
<td><code>CMAKE_TOOLCHAIN_FILE</code></td>
<td>æŒ‡å®šäº¤å‰ç¼–è¯‘å·¥å…·é“¾æ–‡ä»¶</td>
</tr>
<tr>
<td><code>CMAKE_GENERATOR</code></td>
<td>å½“å‰ç”Ÿæˆå™¨ç±»å‹</td>
</tr>
<tr>
<td><code>CMAKE_EXPORT_COMPILE_COMMANDS</code></td>
<td>è¾“å‡ºâ€¯compile_commands.json</td>
</tr>
</tbody></table>
<hr>
<h2 id="âš™ï¸-A-3-å¸¸ç”¨ç”Ÿæˆè¡¨è¾¾å¼ï¼ˆGenerator-Expressionsï¼‰"><a href="#âš™ï¸-A-3-å¸¸ç”¨ç”Ÿæˆè¡¨è¾¾å¼ï¼ˆGenerator-Expressionsï¼‰" class="headerlink" title="âš™ï¸â€¯A.3â€¯å¸¸ç”¨ç”Ÿæˆè¡¨è¾¾å¼ï¼ˆGenerator Expressionsï¼‰"></a>âš™ï¸â€¯A.3â€¯å¸¸ç”¨ç”Ÿæˆè¡¨è¾¾å¼ï¼ˆGenerator Expressionsï¼‰</h2><table>
<thead>
<tr>
<th>è¡¨è¾¾å¼</th>
<th>åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&lt;CONFIG:Debug&gt;</code></td>
<td>åœ¨ Debugâ€¯é…ç½®æ—¶ä¸ºçœŸ</td>
</tr>
<tr>
<td><code>$&lt;STREQUAL:a,b&gt;</code></td>
<td>åˆ¤æ–­å­—ç¬¦ä¸²ç›¸ç­‰</td>
</tr>
<tr>
<td><code>$&lt;PLATFORM_ID:Windows&gt;</code></td>
<td>åŒ¹é…ç‰¹å®šå¹³å°</td>
</tr>
<tr>
<td><code>$&lt;COMPILE_LANG_AND_ID:CXX,Clang&gt;</code></td>
<td>æ£€æµ‹ç¼–è¯‘å™¨</td>
</tr>
<tr>
<td><code>$&lt;TARGET_EXISTS:foo&gt;</code></td>
<td>åˆ¤æ–­ç›®æ ‡æ˜¯å¦å­˜åœ¨</td>
</tr>
<tr>
<td><code>$&lt;BUILD_INTERFACE:â€¦&gt;</code></td>
<td>æ„å»ºé˜¶æ®µæœ‰æ•ˆå†…å®¹</td>
</tr>
<tr>
<td><code>$&lt;INSTALL_INTERFACE:â€¦&gt;</code></td>
<td>å®‰è£…é˜¶æ®µæœ‰æ•ˆå†…å®¹</td>
</tr>
<tr>
<td><code>$&lt;BOOL:var&gt;</code></td>
<td>å¸ƒå°”å–å€¼</td>
</tr>
<tr>
<td><code>$&lt;IF:cond,then,else&gt;</code></td>
<td>æ¡ä»¶è¡¨è¾¾å¼</td>
</tr>
<tr>
<td><code>$&lt;AND:cond1,cond2&gt;</code></td>
<td>ä¸é€»è¾‘</td>
</tr>
<tr>
<td><code>$&lt;OR:cond1,cond2&gt;</code></td>
<td>æˆ–é€»è¾‘</td>
</tr>
</tbody></table>
<p>å¸¸è§ç”¨æ³•ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_include_directories</span>(mylib PUBLIC</span><br><span class="line">  $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">  $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§°-A-4-CTest-å‘½ä»¤é€ŸæŸ¥"><a href="#ğŸ§°-A-4-CTest-å‘½ä»¤é€ŸæŸ¥" class="headerlink" title="ğŸ§°â€¯A.4â€¯CTestâ€¯å‘½ä»¤é€ŸæŸ¥"></a>ğŸ§°â€¯A.4â€¯CTestâ€¯å‘½ä»¤é€ŸæŸ¥</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>ctest -N</code></td>
<td>ä»…åˆ—å‡ºæµ‹è¯•</td>
</tr>
<tr>
<td><code>ctest -V</code></td>
<td>è¯¦ç»†æ¨¡å¼</td>
</tr>
<tr>
<td><code>ctest -R &lt;regex&gt;</code></td>
<td>æŒ‰åç§°ç­›é€‰</td>
</tr>
<tr>
<td><code>ctest --output-on-failure</code></td>
<td>ä»…è¾“å‡ºå¤±è´¥æµ‹è¯•ä¿¡æ¯</td>
</tr>
<tr>
<td><code>ctest -L &lt;label&gt;</code></td>
<td>æŒ‰æ ‡ç­¾æ‰§è¡Œ</td>
</tr>
<tr>
<td><code>ctest -T memcheck</code></td>
<td>è¿è¡Œå†…å­˜æ£€æŸ¥</td>
</tr>
<tr>
<td><code>ctest -T coverage</code></td>
<td>è¿è¡Œè¦†ç›–ç‡æµ‹è¯•</td>
</tr>
<tr>
<td><code>ctest -S &lt;script&gt;</code></td>
<td>è¿è¡Œè„šæœ¬æ¨¡å¼</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸª£-A-5-ç›®å½•ç»„ç»‡é£æ ¼ä¸å‘½åå»ºè®®"><a href="#ğŸª£-A-5-ç›®å½•ç»„ç»‡é£æ ¼ä¸å‘½åå»ºè®®" class="headerlink" title="ğŸª£â€¯A.5â€¯ç›®å½•ç»„ç»‡é£æ ¼ä¸å‘½åå»ºè®®"></a>ğŸª£â€¯A.5â€¯ç›®å½•ç»„ç»‡é£æ ¼ä¸å‘½åå»ºè®®</h2><table>
<thead>
<tr>
<th>é¡¹ç›®éƒ¨åˆ†</th>
<th>ç¤ºä¾‹</th>
<th>å»ºè®®</th>
</tr>
</thead>
<tbody><tr>
<td>ä¸»ä»£ç </td>
<td><code>src/</code></td>
<td>æŒ‰æ¨¡å—ç»†åˆ†ï¼šcoreã€uiã€net</td>
</tr>
<tr>
<td>å¤´æ–‡ä»¶</td>
<td><code>include/&lt;project&gt;/</code></td>
<td>å¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td>å•å…ƒæµ‹è¯•</td>
<td><code>tests/</code></td>
<td>ä¸€è‡´çš„å‘½åï¼š<code>test_*.cpp</code></td>
</tr>
<tr>
<td>ç¤ºä¾‹</td>
<td><code>examples/</code></td>
<td>æ•™å­¦æˆ–éªŒè¯ä»£ç </td>
</tr>
<tr>
<td>CMake è„šæœ¬</td>
<td><code>cmake/</code></td>
<td>å­˜æ”¾ Find æ¨¡å— &#x2F; å·¥å…·å‡½æ•°</td>
</tr>
<tr>
<td>è¾“å‡ºç›®å½•</td>
<td><code>build/</code></td>
<td>æºç å¤–æ„å»º</td>
</tr>
<tr>
<td>å®‰è£…äº§ç‰©</td>
<td><code>dist/</code>â€¯æˆ–â€¯<code>install/</code></td>
<td>å‘å¸ƒåŒ…</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ“œ-A-6-å®ç”¨æŠ€å·§æ±‡æ€»"><a href="#ğŸ“œ-A-6-å®ç”¨æŠ€å·§æ±‡æ€»" class="headerlink" title="ğŸ“œâ€¯A.6â€¯å®ç”¨æŠ€å·§æ±‡æ€»"></a>ğŸ“œâ€¯A.6â€¯å®ç”¨æŠ€å·§æ±‡æ€»</h2><ul>
<li>ä½¿ç”¨â€¯<code>target_*</code>â€¯ç³»åˆ—ä»£æ›¿å…¨å±€å‘½ä»¤ï¼›</li>
<li>è‡ªåŠ¨æ£€æµ‹ç¼–è¯‘å™¨æ”¯æŒï¼š<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(CheckCXXCompilerFlag)</span><br><span class="line">check_cxx_compiler_flag(<span class="string">&quot;-std=c++20&quot;</span> HAS_CXX20)</span><br></pre></td></tr></table></figure></li>
<li>é€šè¿‡â€¯<code>FetchContent</code>â€¯ç®¡ç†è½»é‡ä¾èµ–ï¼›</li>
<li>ä½¿ç”¨â€¯<code>find_package(... CONFIG REQUIRED)</code>â€¯ä¼˜å…ˆå¯¼å…¥ç°ä»£â€¯CMakeâ€¯åŒ…ï¼›</li>
<li>åœ¨å¤šå¹³å°è„šæœ¬ä¸­åˆ©ç”¨ç”Ÿæˆè¡¨è¾¾å¼æ§åˆ¶å·®å¼‚ï¼›</li>
<li>æ„å»ºå‹å¯¼å‡ºä¸å®‰è£…å‹å¯¼å‡ºç»“åˆï¼Œæé«˜å¤ç”¨æ€§ï¼›</li>
<li>ç¡®ä¿é¡¹ç›®æœ€é¡¶å±‚â€¯<code>CMakeLists.txt</code>â€¯å¹²å‡€ç®€æ˜ï¼Œå¯ä½œä¸ºç¤ºä¾‹æ•™å­¦ï¼›</li>
<li>é‡‡ç”¨â€¯<code>ctest</code>â€¯æŒç»­æµ‹è¯•å’Œâ€¯CDashâ€¯å¯è§†åŒ–ç»“æœã€‚</li>
</ul>
<hr>
<h2 id="ğŸ§­-A-7-å‚è€ƒä¸åç»­å­¦ä¹ è·¯çº¿"><a href="#ğŸ§­-A-7-å‚è€ƒä¸åç»­å­¦ä¹ è·¯çº¿" class="headerlink" title="ğŸ§­â€¯A.7â€¯å‚è€ƒä¸åç»­å­¦ä¹ è·¯çº¿"></a>ğŸ§­â€¯A.7â€¯å‚è€ƒä¸åç»­å­¦ä¹ è·¯çº¿</h2><table>
<thead>
<tr>
<th>ä¸»é¢˜</th>
<th>æ¨èèµ„æº</th>
</tr>
</thead>
<tbody><tr>
<td>å®˜æ–¹æ–‡æ¡£</td>
<td><a href="https://cmake.org/cmake/help/latest">https://cmake.org/cmake/help/latest</a></td>
</tr>
<tr>
<td>Kitware Blog</td>
<td>æ·±å…¥è®²è§£ç°ä»£â€¯CMakeâ€¯ç‰¹æ€§ä¸å®è·µ</td>
</tr>
<tr>
<td>â€œEffectiveâ€¯Modernâ€¯CMakeâ€ï¼ˆå¼€æºç”µå­ä¹¦ï¼‰</td>
<td>ç³»ç»Ÿæ•´ç†ç°ä»£ç”¨æ³•</td>
</tr>
<tr>
<td>GoogleTest &#x2F; Catch2 é›†æˆ</td>
<td>å®˜æ–¹ç¤ºä¾‹ä»“åº“</td>
</tr>
<tr>
<td>Conan &#x2F; vcpkg</td>
<td>æ„å»ºä¸æ‰“åŒ…ç”Ÿæ€å·¥å…·</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ“-ç»“è¯­"><a href="#ğŸ“-ç»“è¯­" class="headerlink" title="ğŸ“â€¯ç»“è¯­"></a>ğŸ“â€¯ç»“è¯­</h2><p>ä½ å·²ç»å®Œæ•´æŒæ¡ä»åŸºç¡€åˆ°è¿›é˜¶çš„â€¯CMakeâ€¯å·¥ç¨‹æŠ€å·§ï¼š<br>ä» <strong>æ„å»ºç³»ç»Ÿç”Ÿæˆ â†’ æ¨¡å—åŒ–ä¾èµ–ç®¡ç† â†’ æµ‹è¯• â†’ å®‰è£…æ‰“åŒ… â†’ å¤ç”¨ä¸å‘å¸ƒ</strong>ã€‚  </p>
<p>æ— è®ºæ˜¯å°å‹å¼€æºåº“è¿˜æ˜¯ä¼ä¸šçº§è·¨å¹³å°é¡¹ç›®ï¼Œ<br>è¿™å¥—ä½“ç³»éƒ½èƒ½ç›´æ¥åº”ç”¨ã€‚  </p>
<hr>
<p>âœ… <strong>å­¦ä¹ å®Œç»“</strong></p>
<blockquote>
<p>æ­å–œå®Œæˆã€Šç°ä»£â€¯CMakeâ€¯å¼€å‘ä¸å·¥ç¨‹å®è·µæŒ‡å—ã€‹ğŸ‰<br>å¯ä»¥è‡ªè¡Œåˆ›å»ºé¡¹ç›®ã€ç»´æŠ¤æ¨¡å—åº“å’Œé›†æˆâ€¯CI&#x2F;CDâ€¯æµ‹è¯•ï¼</p>
</blockquote>
<hr>
<hr>
<h1 id="ğŸ—ï¸-CMake-é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿"><a href="#ğŸ—ï¸-CMake-é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿" class="headerlink" title="ğŸ—ï¸â€¯CMakeâ€¯é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿"></a>ğŸ—ï¸â€¯CMakeâ€¯é¡¹ç›®è„šæ‰‹æ¶æ¨¡æ¿</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyProject/                # é¡¹ç›®æ ¹ç›®å½•</span><br><span class="line">â”œâ”€ CMakeLists.txt         # é¡¶å±‚é…ç½®</span><br><span class="line">â”œâ”€ include/</span><br><span class="line">â”‚   â””â”€ myproject/</span><br><span class="line">â”‚       â””â”€ myproject.h</span><br><span class="line">â”œâ”€ src/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚   â””â”€ myproject.cpp</span><br><span class="line">â”œâ”€ tests/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚   â””â”€ test_main.cpp</span><br><span class="line">â”œâ”€ cmake/</span><br><span class="line">â”‚   â””â”€ Utils.cmake        # å·¥å…·æ¨¡å—ç¤ºä¾‹</span><br><span class="line">â””â”€ README.md</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§©-é¡¶å±‚-CMakeLists-txt"><a href="#ğŸ§©-é¡¶å±‚-CMakeLists-txt" class="headerlink" title="ğŸ§© é¡¶å±‚â€¯CMakeLists.txt"></a>ğŸ§© é¡¶å±‚â€¯CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.20</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject VERSION <span class="number">1.0</span>.<span class="number">0</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1ï¸âƒ£ å…¨å±€è®¾ç½®</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_EXPORT_COMPILE_COMMANDS <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(ENABLE_TESTS <span class="string">&quot;Build and run unit tests&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">list</span>(APPEND CMAKE_MODULE_PATH <span class="string">&quot;$&#123;CMAKE_SOURCE_DIR&#125;/cmake&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ï¸âƒ£ å­ç›®å½•</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(src)</span><br><span class="line"><span class="keyword">if</span>(ENABLE_TESTS)</span><br><span class="line">  <span class="keyword">enable_testing</span>()</span><br><span class="line">  <span class="keyword">add_subdirectory</span>(tests)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ï¸âƒ£ å®‰è£…å¯¼å‡ºé…ç½®ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"><span class="keyword">include</span>(CMakePackageConfigHelpers)</span><br><span class="line"><span class="keyword">install</span>(TARGETS myproject</span><br><span class="line">  <span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span>(DIRECTORY <span class="keyword">include</span>/ DESTINATION <span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  <span class="keyword">FILE</span> MyProjectTargets.cmake</span><br><span class="line">  NAMESPACE MyProject::</span><br><span class="line">  DESTINATION lib/cmake/MyProject)</span><br><span class="line"></span><br><span class="line">configure_package_config_file(</span><br><span class="line">  cmake/MyProjectConfig.cmake.in</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjectConfig.cmake&quot;</span></span><br><span class="line">  INSTALL_DESTINATION lib/cmake/MyProject)</span><br><span class="line"></span><br><span class="line">write_basic_package_version_file(</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjectConfigVersion.cmake&quot;</span></span><br><span class="line">  VERSION <span class="variable">$&#123;PROJECT_VERSION&#125;</span></span><br><span class="line">  COMPATIBILITY SameMajorVersion)</span><br><span class="line"></span><br><span class="line"><span class="keyword">install</span>(FILES</span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjectConfig.cmake&quot;</span></span><br><span class="line">  <span class="string">&quot;$&#123;CMAKE_CURRENT_BINARY_DIR&#125;/MyProjectConfigVersion.cmake&quot;</span></span><br><span class="line">  DESTINATION lib/cmake/MyProject)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ï¸âƒ£ CPack æ‰“åŒ…</span></span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_VENDOR <span class="string">&quot;YourName&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_CONTACT <span class="string">&quot;you@example.com&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CPACK_PACKAGE_FILE_NAME <span class="string">&quot;$&#123;PROJECT_NAME&#125;-$&#123;PROJECT_VERSION&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">include</span>(CPack)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âš™ï¸-src-CMakeLists-txt"><a href="#âš™ï¸-src-CMakeLists-txt" class="headerlink" title="âš™ï¸â€¯src&#x2F;CMakeLists.txt"></a>âš™ï¸â€¯src&#x2F;CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(myproject myproject.cpp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_include_directories</span>(myproject</span><br><span class="line">  PUBLIC</span><br><span class="line">    $&lt;BUILD_INTERFACE:<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/<span class="keyword">include</span>&gt;</span><br><span class="line">    $&lt;INSTALL_INTERFACE:<span class="keyword">include</span>&gt;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_compile_features</span>(myproject PUBLIC cxx_std_17)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰å‡½æ•°ï¼ˆæ¼”ç¤ºï¼‰ï¼š</span></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/cmake/Utils.cmake)</span><br><span class="line">add_my_compile_options(myproject)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âœ¨-cmake-Utils-cmake"><a href="#âœ¨-cmake-Utils-cmake" class="headerlink" title="âœ¨â€¯cmake&#x2F;Utils.cmake"></a>âœ¨â€¯cmake&#x2F;Utils.cmake</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>(add_my_compile_options <span class="keyword">target</span>)</span><br><span class="line">  <span class="keyword">message</span>(STATUS <span class="string">&quot;Applying default warnings to target $&#123;target&#125;&quot;</span>)</span><br><span class="line">  <span class="keyword">target_compile_options</span>(<span class="variable">$&#123;target&#125;</span></span><br><span class="line">    PRIVATE</span><br><span class="line">      $&lt;$&lt;CXX_COMPILER_ID:MSVC&gt;:/W4 /permissive-&gt;</span><br><span class="line">      $&lt;$&lt;<span class="keyword">NOT</span>:$CXX_COMPILER_ID:MSVC&gt;&gt;:-Wall -Wextra -Wpedantic&gt;)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§±-src-myproject-cpp"><a href="#ğŸ§±-src-myproject-cpp" class="headerlink" title="ğŸ§±â€¯src&#x2F;myproject.cpp"></a>ğŸ§±â€¯src&#x2F;myproject.cpp</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myproject/myproject.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">myproject::say_hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello, CMake world!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“˜-include-myproject-myproject-h"><a href="#ğŸ“˜-include-myproject-myproject-h" class="headerlink" title="ğŸ“˜â€¯include&#x2F;myproject&#x2F;myproject.h"></a>ğŸ“˜â€¯include&#x2F;myproject&#x2F;myproject.h</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="keyword">namespace</span> myproject &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">say_hello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§ª-tests-CMakeLists-txt"><a href="#ğŸ§ª-tests-CMakeLists-txt" class="headerlink" title="ğŸ§ªâ€¯tests&#x2F;CMakeLists.txt"></a>ğŸ§ªâ€¯tests&#x2F;CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(test_main test_main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(test_main PRIVATE myproject)</span><br><span class="line"><span class="keyword">add_test</span>(NAME test_main <span class="keyword">COMMAND</span> test_main)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§ª-tests-test-main-cpp"><a href="#ğŸ§ª-tests-test-main-cpp" class="headerlink" title="ğŸ§ªâ€¯tests&#x2F;test_main.cpp"></a>ğŸ§ªâ€¯tests&#x2F;test_main.cpp</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myproject/myproject.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    myproject::<span class="built_in">say_hello</span>();</span><br><span class="line">    <span class="comment">// ç®€å•éªŒè¯è¾“å‡ºï¼Œå¯æ‰©å±•ä¸ºå•å…ƒæµ‹è¯•æ¡†æ¶ï¼ˆå¦‚â€¯Catch2â€¯æˆ–â€¯GoogleTestï¼‰</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“¥-æ„å»ºä¸æµ‹è¯•æŒ‡ä»¤"><a href="#ğŸ“¥-æ„å»ºä¸æµ‹è¯•æŒ‡ä»¤" class="headerlink" title="ğŸ“¥â€¯æ„å»ºä¸æµ‹è¯•æŒ‡ä»¤"></a>ğŸ“¥â€¯æ„å»ºä¸æµ‹è¯•æŒ‡ä»¤</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1ï¸âƒ£ é…ç½®æ„å»º</span></span><br><span class="line">cmake -S . -B build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ï¸âƒ£ ç¼–è¯‘</span></span><br><span class="line">cmake --build build -j</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ï¸âƒ£ è¿è¡Œæµ‹è¯•</span></span><br><span class="line">ctest --test-dir build --output-on-failure</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ï¸âƒ£ å®‰è£…åˆ°æœ¬åœ°ï¼ˆé»˜è®¤ /usr/localï¼‰</span></span><br><span class="line">cmake --install build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5ï¸âƒ£ æ‰“åŒ…</span></span><br><span class="line">cpack --config build/CPackConfig.cmake</span><br></pre></td></tr></table></figure>

<hr>
<hr>
<p>âœ… è¿™ä¸€å¥—æ¨¡æ¿èƒ½ç«‹å³è¿è¡Œï¼š<br>åœ¨ä¸€ä¸ªç©ºç›®å½•ä¸­å¤åˆ¶è¿™äº›æ–‡ä»¶ â†’ æ„å»º â†’ è¿è¡Œ â†’ çœ‹åˆ°<br><code>Hello, CMake world!</code>â€¯è¾“å‡ºï¼Œå³æˆåŠŸï¼</p>
<hr>
]]></content>
  </entry>
  <entry>
    <title>ä½ å¥½å¹¶å‘ä¸–ç•Œæ–‡æ‘˜</title>
    <url>/%E4%BD%A0%E5%A5%BD%E5%B9%B6%E5%8F%91%E4%B8%96%E7%95%8C%E6%96%87%E6%91%98/</url>
    <content><![CDATA[<span id="more"></span>

<p><a href="https://nj.gitbooks.io/c/content/"></a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.2 ä¸ºä»€ä¹ˆä½¿ç”¨å¹¶å‘ï¼Ÿ</span><br><span class="line">ä¸»è¦åŸå› æœ‰ä¸¤ä¸ªï¼šå…³æ³¨ç‚¹åˆ†ç¦»(SOC)å’Œæ€§èƒ½ã€‚</span><br></pre></td></tr></table></figure>
<p>2ç§å¹¶å‘æ–¹å¼ï¼Œå¤šè¿›ç¨‹ å’Œ å¤šçº¿ç¨‹<br>å¤šè¿›ç¨‹ï¼š å¼€é”€æ›´å¤§ï¼Œè¿›ç¨‹é—´é€šä¿¡æ›´éº»çƒ¦(IPC)</p>
<p>è¿›ç¨‹å†…å­˜å¸ƒå±€(may 1Mb)<br>0x100000    high address<br>0x â€¦         command-line arguments and variables<br>0x â€¦         stack<br>0x â€¦         heap<br>0x â€¦         uninitialized data(bss), initialized to zero by exec<br>0x â€¦         initialized data       , read from program file by exec<br>0x â€¦         text                   , read from program file by exec<br>0x000000    low address                                         </p>
<p>çº¿ç¨‹ä¹‹é—´å…±äº«<br> uninitialized data(bss)<br> initialized data<br> text</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸¤ç§æ–¹å¼åˆ©ç”¨å¹¶å‘æé«˜æ€§èƒ½ï¼š</span><br><span class="line">ç¬¬ä¸€ï¼Œå°†ä¸€ä¸ªå•ä¸ªä»»åŠ¡åˆ†æˆå‡ éƒ¨åˆ†ï¼Œä¸”å„è‡ªå¹¶è¡Œè¿è¡Œï¼Œä»è€Œé™ä½æ€»è¿è¡Œæ—¶é—´ã€‚è¿™å°±æ˜¯ä»»åŠ¡å¹¶è¡Œï¼ˆtask parallelismï¼‰</span><br><span class="line">ç¬¬äºŒï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç®—æ³•çš„ä¸€éƒ¨åˆ†, å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç®—æ³•çš„å¦ä¸€ä¸ªéƒ¨åˆ†â€”â€”æˆ–æ˜¯åœ¨æ•°æ®æ–¹é¢â€”â€”æ¯ä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„æ•°æ®éƒ¨åˆ†ä¸Šæ‰§è¡Œç›¸åŒçš„æ“ä½œ, æ•°æ®å¹¶è¡Œï¼ˆdata parallelismï¼‰</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.2.3 ä»€ä¹ˆæ—¶å€™ä¸ä½¿ç”¨å¹¶å‘</span><br><span class="line">æ“ä½œç³»ç»Ÿéœ€è¦åˆ†é…å†…æ ¸ç›¸å…³èµ„æºå’Œå †æ ˆç©ºé—´ï¼Œæ‰€ä»¥åœ¨å¯åŠ¨çº¿ç¨‹æ—¶å­˜åœ¨å›ºæœ‰çš„å¼€é”€ï¼Œç„¶åæ‰èƒ½æŠŠæ–°çº¿ç¨‹åŠ å…¥è°ƒåº¦å™¨ä¸­ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡éƒ½éœ€è¦æ—¶é—´ã€‚å¦‚æœåœ¨çº¿ç¨‹ä¸Šçš„ä»»åŠ¡å®Œæˆå¾—å¾ˆå¿«ï¼Œé‚£ä¹ˆä»»åŠ¡å®é™…æ‰§è¡Œçš„æ—¶é—´è¦æ¯”å¯åŠ¨çº¿ç¨‹çš„æ—¶é—´å°å¾ˆå¤šï¼Œè¿™å°±ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºçš„æ•´ä½“æ€§èƒ½è¿˜ä¸å¦‚ç›´æ¥ä½¿ç”¨â€œäº§ç”Ÿçº¿ç¨‹â€çš„æ–¹å¼ã€‚</span><br><span class="line"></span><br><span class="line">è¿è¡Œè¶Šå¤šçš„çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå°±éœ€è¦åšè¶Šå¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ¯ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢éƒ½éœ€è¦è€—è´¹æœ¬å¯ä»¥èŠ±åœ¨æœ‰ä»·å€¼å·¥ä½œä¸Šçš„æ—¶é—´ã€‚æ‰€ä»¥åœ¨æŸäº›æ—¶å€™ï¼Œå¢åŠ ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹å®é™…ä¸Šä¼šé™ä½ï¼Œè€Œéæé«˜åº”ç”¨ç¨‹åºçš„æ•´ä½“æ€§èƒ½ã€‚ä¸ºæ­¤ï¼Œå¦‚æœä½ è¯•å›¾å¾—åˆ°ç³»ç»Ÿçš„æœ€ä½³æ€§èƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ç¡¬ä»¶å¹¶å‘(æˆ–ä¸ç”¨)ï¼Œå¹¶è°ƒæ•´è¿è¡Œçº¿ç¨‹çš„æ•°é‡ã€‚</span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>æˆå‘˜å‡½æ•°çš„éšè—å‚æ•°this, åœ¨Cè¯­è¨€ä¸­çš„æ ·å­</title>
    <url>/%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E7%9A%84%E9%9A%90%E8%97%8F%E5%8F%82%E6%95%B0this-%E5%9C%A8C%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E6%A0%B7%E5%AD%90/</url>
    <content><![CDATA[<p>åœ¨C++ä¸­ï¼Œæˆå‘˜å‡½æ•°æœ‰ä¸€ä¸ªéšè—å‚æ•° thisï¼Œå®ƒæ˜¯æŒ‡å‘è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆã€‚è¿™ä¸ªç‰¹æ€§æ˜¯C++é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ ¸å¿ƒä¹‹ä¸€ï¼Œä½†åœ¨Cè¯­è¨€å±‚é¢ï¼ŒC++çš„è¿™ç§æœºåˆ¶ä¼šè¢«ç¼–è¯‘å™¨â€œç¿»è¯‘â€æˆæ›´åº•å±‚çš„å®ç°æ–¹å¼ã€‚</p>
<span id="more"></span>
<h2 id="åœ¨Cè¯­è¨€å±‚é¢çš„è¡¨ç°"><a href="#åœ¨Cè¯­è¨€å±‚é¢çš„è¡¨ç°" class="headerlink" title="åœ¨Cè¯­è¨€å±‚é¢çš„è¡¨ç°"></a>åœ¨Cè¯­è¨€å±‚é¢çš„è¡¨ç°</h2><p>åœ¨Cè¯­è¨€ä¸­, æ²¡æœ‰ç±»çš„æ¦‚å¿µ, å› æ­¤C++çš„æˆå‘˜å‡½æ•°ä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢ä¸ºæ™®é€šçš„å…¨å±€å‡½æ•°, è€Œ this æŒ‡é’ˆä¼šä½œä¸ºæ˜¾å¼çš„å‚æ•°ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°. å…·ä½“æ¥è¯´:<br>æˆå‘˜å‡½æ•°è¢«è½¬æ¢ä¸ºæ™®é€šå‡½æ•°: ç¼–è¯‘å™¨ä¼šå°†ç±»ä¸­çš„æˆå‘˜å‡½æ•°å˜æˆä¸€ä¸ªæ™®é€šçš„Cé£æ ¼å‡½æ•°, å‡½æ•°åé€šå¸¸ä¼šç»è¿‡â€åç§°ä¿®é¥°â€(name mangling), ä»¥é¿å…å‘½åå†²çªå¹¶ä¿ç•™ç±»çš„ä¿¡æ¯(å‡½æ•°çš„å”¯ä¸€ç­¾å)<br>this æŒ‡é’ˆä½œä¸ºæ˜¾å¼å‚æ•°: thisè¿™ä¸ªå‚æ•° ä¼šè¢«æ›¿æ¢æˆæŒ‡å‘å¯¹è±¡çš„ç»“æ„ä½“æŒ‡é’ˆä¼ å…¥å‡½æ•°</p>
<p>ä¾‹å¦‚, å¦‚ä¸‹C++ä»£ç :</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        value = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">MyClass obj;</span><br><span class="line">obj.<span class="built_in">setValue</span>(<span class="number">42</span>);</span><br></pre></td></tr></table></figure>

<p>åœ¨Cè¯­è¨€å±‚é¢, ç¼–è¯‘å™¨å¯èƒ½ä¼šå°†å…¶è½¬æ¢ä¸ºç±»ä¼¼å¦‚ä¸‹çš„å½¢å¼:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyClass</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">MyClass_setValue</span><span class="params">(<span class="keyword">struct</span> MyClass* this, <span class="type">int</span> x)</span> &#123;</span><br><span class="line">    this-&gt;value = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">MyClass</span> <span class="title">obj</span>;</span></span><br><span class="line">MyClass_setValue(&amp;obj, <span class="number">42</span>);</span><br></pre></td></tr></table></figure>

<p>MyClass è¢«è½¬æ¢ä¸ºäº†ä¸€ä¸ª struct<br>setValue æˆå‘˜å‡½æ•°è¢«è½¬æ¢ä¸ºä¸€ä¸ªç­¾åå”¯ä¸€çš„å…¨å±€å‡½æ•° MyClass_setValue<br>this æŒ‡é’ˆè¢«æ˜¾å¼åœ°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’, æŒ‡å‘è°ƒç”¨è¯¥å‡½æ•°çš„å¯¹è±¡å®ä¾‹(&amp;obj)</p>
<h2 id="this-å‚æ•°åœ¨ç¬¬å‡ ä¸ªä½ç½®"><a href="#this-å‚æ•°åœ¨ç¬¬å‡ ä¸ªä½ç½®" class="headerlink" title="this å‚æ•°åœ¨ç¬¬å‡ ä¸ªä½ç½®"></a>this å‚æ•°åœ¨ç¬¬å‡ ä¸ªä½ç½®</h2><p>åœ¨Cè¯­è¨€å±‚é¢ï¼Œthis å‚æ•°é€šå¸¸æ˜¯å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°. è¿™æ˜¯C++ç¼–è¯‘å™¨çš„æƒ¯ä¾‹, å› ä¸º this å¿…é¡»åœ¨å‡½æ•°è°ƒç”¨æ—¶æ˜ç¡®çŸ¥é“å®ƒæ“ä½œçš„æ˜¯å“ªä¸ªå¯¹è±¡å®ä¾‹. å…¶ä»–æ˜¾å¼å‚æ•°(å¦‚ x)åˆ™ä¾æ¬¡æ’åœ¨åé¢<br>ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªå¸¦æœ‰å¤šä¸ªå‚æ•°çš„æˆå‘˜å‡½æ•°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> a, <span class="type">double</span> b)</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨Cè¯­è¨€å±‚é¢å¯èƒ½æ˜¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">MyClass_func</span><span class="params">(<span class="keyword">struct</span> MyClass* this, <span class="type">int</span> a, <span class="type">double</span> b)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>this æ˜¯ç¬¬ 1 ä¸ªå‚æ•°<br>a æ˜¯ç¬¬ 2 ä¸ªå‚æ•°<br>b æ˜¯ç¬¬ 3 ä¸ªå‚æ•°</p>
<p>æ‰€ä»¥åœ¨Cè¯­è¨€å±‚é¢ï¼Œthis è¢«æ˜¾å¼åœ°ä½œä¸ºæŒ‡å‘å¯¹è±¡å®ä¾‹çš„æŒ‡é’ˆå‚æ•°ä¼ é€’<br>å®ƒé€šå¸¸æ˜¯å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°, å› ä¸ºè¿™æ˜¯C++ç¼–è¯‘å™¨å®ç°è°ƒç”¨çº¦å®šæ—¶çš„æ ‡å‡†åšæ³•<br>è¿™ç§è½¬æ¢ç”±ç¼–è¯‘å™¨è‡ªåŠ¨å®Œæˆ, ç¨‹åºå‘˜åœ¨C++å±‚é¢æ— éœ€æ‰‹åŠ¨å¤„ç† this</p>
]]></content>
  </entry>
  <entry>
    <title>ç®€æ˜CMAKEè¯­æ³•ä¸å·¥ç¨‹ç®¡ç†æŒ‡å—</title>
    <url>/%E7%AE%80%E6%98%8ECMAKE%E8%AF%AD%E6%B3%95%E4%B8%8E%E5%B7%A5%E7%A8%8B%E7%AE%A1%E7%90%86%E6%8C%87%E5%8D%97/</url>
    <content><![CDATA[<h2 id="å¿«é€Ÿè®¤è¯†CMakeï¼Œå¹¶æŒæ¡ç®€å•çš„å·¥ç¨‹åŒ–çš„èƒ½åŠ›-è¡¥å……å†…å®¹ï¼Œå¦‚æœè¿˜æœ‰é—æ¼å¯ä»¥åˆ°å®Œå…¨æ‰‹å†Œä¸­æŸ¥è¯¢ç›¸å…³è¯´æ˜"><a href="#å¿«é€Ÿè®¤è¯†CMakeï¼Œå¹¶æŒæ¡ç®€å•çš„å·¥ç¨‹åŒ–çš„èƒ½åŠ›-è¡¥å……å†…å®¹ï¼Œå¦‚æœè¿˜æœ‰é—æ¼å¯ä»¥åˆ°å®Œå…¨æ‰‹å†Œä¸­æŸ¥è¯¢ç›¸å…³è¯´æ˜" class="headerlink" title="å¿«é€Ÿè®¤è¯†CMakeï¼Œå¹¶æŒæ¡ç®€å•çš„å·¥ç¨‹åŒ–çš„èƒ½åŠ›, è¡¥å……å†…å®¹ï¼Œå¦‚æœè¿˜æœ‰é—æ¼å¯ä»¥åˆ°å®Œå…¨æ‰‹å†Œä¸­æŸ¥è¯¢ç›¸å…³è¯´æ˜"></a>å¿«é€Ÿè®¤è¯†CMakeï¼Œå¹¶æŒæ¡ç®€å•çš„å·¥ç¨‹åŒ–çš„èƒ½åŠ›, è¡¥å……å†…å®¹ï¼Œå¦‚æœè¿˜æœ‰é—æ¼å¯ä»¥åˆ°å®Œå…¨æ‰‹å†Œä¸­æŸ¥è¯¢ç›¸å…³è¯´æ˜<br><span id="more"></span></h2><h1 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸæ–‡ç¨¿"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸæ–‡ç¨¿" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸæ–‡ç¨¿"></a>ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸæ–‡ç¨¿</h1><hr>
<hr>
<h1 id="ğŸ§­-æ€»è§ˆç»“æ„"><a href="#ğŸ§­-æ€»è§ˆç»“æ„" class="headerlink" title="ğŸ§­ æ€»è§ˆç»“æ„"></a>ğŸ§­ æ€»è§ˆç»“æ„</h1><ol>
<li><strong>CMake æ¦‚å¿µé€Ÿè§ˆä¸å±‚æ¬¡å…³ç³»</strong>  <ul>
<li>å‘½ä»¤è¡Œè¯­æ³• vs. è„šæœ¬è¯­æ³•</li>
<li>å·¥ç¨‹ç»„ç»‡æ€æƒ³</li>
</ul>
</li>
<li><strong>CMake è¯­æ³•å¤§å…¨ï¼ˆè„šæœ¬è¯­æ³• + å‘½ä»¤è¡Œè¯­æ³•ï¼‰</strong><ul>
<li>è¯­è¨€ç»“æ„ã€æ§åˆ¶æµã€å˜é‡ã€å‡½æ•°ã€å®</li>
<li>å¸¸ç”¨å‘½ä»¤ï¼ˆaddã€targetã€linkã€installã€exportç­‰ï¼‰</li>
<li>å‘½ä»¤è¡Œå·¥å…·ï¼ˆ<code>cmake</code>ã€<code>ctest</code>ã€<code>cpack</code>ï¼‰</li>
</ul>
</li>
<li><strong>å·¥ç¨‹å®æˆ˜æ¨¡æ¿ä¸èŒƒä¾‹</strong><ul>
<li>æ ‡å‡†é¡¹ç›®ç»“æ„ + å«å¤šå­åº“&#x2F;åŠ¨æ€&#x2F;é™æ€ + å¤–éƒ¨åº“ + å¤´æ–‡ä»¶å¼•ç”¨ + install&#x2F;export</li>
<li>é™„å¸¦æ˜“ç†è§£çš„ C++ ç¤ºä¾‹ä»£ç </li>
<li>åˆ†çº§è§£é‡Šä½œç”¨ã€å¯ç›´æ¥ç¼–è¯‘è¿è¡Œ</li>
</ul>
</li>
</ol>
<hr>
<h1 id="ğŸ§©-PART-Iï¼šCMake-æ¦‚å¿µä¸ç»“æ„"><a href="#ğŸ§©-PART-Iï¼šCMake-æ¦‚å¿µä¸ç»“æ„" class="headerlink" title="ğŸ§© PART Iï¼šCMake æ¦‚å¿µä¸ç»“æ„"></a>ğŸ§© PART Iï¼šCMake æ¦‚å¿µä¸ç»“æ„</h1><h2 id="ğŸ€-CMake-æ˜¯â€œä¸¤å±‚è¯­è¨€â€"><a href="#ğŸ€-CMake-æ˜¯â€œä¸¤å±‚è¯­è¨€â€" class="headerlink" title="ğŸ€ CMake æ˜¯â€œä¸¤å±‚è¯­è¨€â€"></a>ğŸ€ CMake æ˜¯â€œä¸¤å±‚è¯­è¨€â€</h2><table>
<thead>
<tr>
<th>å±‚</th>
<th>æè¿°</th>
<th>ç±»æ¯”</th>
</tr>
</thead>
<tbody><tr>
<td><strong>è„šæœ¬è¯­æ³•</strong></td>
<td>CMakeLists.txt æ–‡ä»¶ï¼Œç”± CMake è¯­æ³•ç»„æˆï¼Œç”¨æ¥æè¿°å·¥ç¨‹è§„åˆ™</td>
<td>Shell è„šæœ¬</td>
</tr>
<tr>
<td><strong>å‘½ä»¤è¡Œæ¥å£</strong></td>
<td>cmake CLI å‘½ä»¤ï¼Œç”¨äºé…ç½®ã€æ„å»ºã€å®‰è£…ã€æµ‹è¯•ã€æ‰“åŒ…</td>
<td>æ§åˆ¶é¢æ¿</td>
</tr>
</tbody></table>
<p>!&gt; <strong>CMake ä¸æ˜¯ç¼–è¯‘å™¨ï¼Œä¹Ÿä¸æ‰§è¡Œ makeï¼Œå®ƒç”Ÿæˆç¼–è¯‘ç³»ç»Ÿï¼ˆMakefile&#x2F;Ninja&#x2F;VSï¼‰åå†å§”æ‰˜ç¼–è¯‘ã€‚</strong></p>
<hr>
<h1 id="ğŸ§±-PART-IIï¼šCMake-è¯­æ³•å¤§å…¨"><a href="#ğŸ§±-PART-IIï¼šCMake-è¯­æ³•å¤§å…¨" class="headerlink" title="ğŸ§± PART IIï¼šCMake è¯­æ³•å¤§å…¨"></a>ğŸ§± PART IIï¼šCMake è¯­æ³•å¤§å…¨</h1><hr>
<h2 id="ğŸ“˜-1-åŸºæœ¬è„šæœ¬è¯­æ³•ç»“æ„"><a href="#ğŸ“˜-1-åŸºæœ¬è„šæœ¬è¯­æ³•ç»“æ„" class="headerlink" title="ğŸ“˜ 1. åŸºæœ¬è„šæœ¬è¯­æ³•ç»“æ„"></a>ğŸ“˜ 1. åŸºæœ¬è„šæœ¬è¯­æ³•ç»“æ„</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ³¨é‡Š</span></span><br><span class="line"><span class="comment"># å•è¡Œæ³¨ä»¥ # å¼€å¤´</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¯­å¥æ ¼å¼ï¼šå‘½ä»¤(å‚æ•°1 å‚æ•°2 ...)</span></span><br><span class="line"><span class="keyword">project</span>(MyProject VERSION <span class="number">1.0</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šæœ€å°ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¤-2-å˜é‡ä¸ä½œç”¨åŸŸ"><a href="#ğŸ”¤-2-å˜é‡ä¸ä½œç”¨åŸŸ" class="headerlink" title="ğŸ”¤ 2. å˜é‡ä¸ä½œç”¨åŸŸ"></a>ğŸ”¤ 2. å˜é‡ä¸ä½œç”¨åŸŸ</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ä¸‹æ–¹æœ‰è¡¥å……è§£é‡Š</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>æ™®é€šå˜é‡</td>
<td><code>set(VAR value)</code></td>
<td>å®šä¹‰å˜é‡</td>
</tr>
<tr>
<td>è®¿é—®å˜é‡</td>
<td><code>$&#123;VAR&#125;</code></td>
<td>å–å€¼</td>
</tr>
<tr>
<td>ç¯å¢ƒå˜é‡</td>
<td><code>$ENV&#123;PATH&#125;</code></td>
<td>ç¯å¢ƒè®¿é—®</td>
</tr>
<tr>
<td>ç¼“å­˜å˜é‡</td>
<td><code>set(VAR value CACHE STRING &quot;desc&quot;)</code></td>
<td>è·¨è¿è¡Œ</td>
</tr>
<tr>
<td>æ¡ä»¶åˆ¤æ–­</td>
<td><code>if(VAR)</code> â€¦ <code>elseif(...)</code> â€¦ <code>endif()</code></td>
<td>æ§åˆ¶æµ</td>
</tr>
<tr>
<td>æ¯”è¾ƒ</td>
<td><code>if(VALUE STREQUAL &quot;abc&quot;)</code></td>
<td>å­—ç¬¦ä¸²æ¯”è¾ƒ</td>
</tr>
<tr>
<td>åˆ—è¡¨</td>
<td><code>set(LIST a b c)</code></td>
<td>å®šä¹‰åˆ—è¡¨</td>
</tr>
<tr>
<td>æ“ä½œ</td>
<td><code>list(APPEND LST val)</code></td>
<td>åˆ—è¡¨æ“ä½œ</td>
</tr>
</tbody></table>
<p>â—å¸¸ç”¨å˜é‡ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CMAKE_SOURCE_DIR            # é¡¶å±‚æºç ç›®å½•</span><br><span class="line">CMAKE_BINARY_DIR            # æ„å»ºè¾“å‡ºç›®å½•</span><br><span class="line">PROJECT_NAME                # å½“å‰project()</span><br><span class="line">CMAKE_BUILD_TYPE            # Debug/Release</span><br><span class="line">CMAKE_INSTALL_PREFIX         # å®‰è£…è·¯å¾„</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="âš™ï¸-3-å‡½æ•°ä¸å®"><a href="#âš™ï¸-3-å‡½æ•°ä¸å®" class="headerlink" title="âš™ï¸ 3. å‡½æ•°ä¸å®"></a>âš™ï¸ 3. å‡½æ•°ä¸å®</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span>(print_status msg)</span><br><span class="line">    <span class="keyword">message</span>(STATUS <span class="string">&quot;&gt;&gt;&gt; $&#123;msg&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">macro</span>(print_debug VAR)</span><br><span class="line">    <span class="keyword">message</span>(<span class="string">&quot;DBG: $&#123;VAR&#125;=$&#123;$&#123;VAR&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endmacro</span>()</span><br></pre></td></tr></table></figure>

<p>åŒºåˆ«ï¼š</p>
<ul>
<li><code>function()</code> åˆ›å»ºç‹¬ç«‹ä½œç”¨åŸŸï¼›</li>
<li><code>macro()</code> æ²¡æœ‰ä½œç”¨åŸŸï¼ˆå˜é‡å˜åŒ–ä¼šä¼ å‡ºï¼‰ã€‚</li>
</ul>
<hr>
<h2 id="ğŸ§­-4-æµç¨‹æ§åˆ¶ä¸é€»è¾‘è¡¨è¾¾å¼"><a href="#ğŸ§­-4-æµç¨‹æ§åˆ¶ä¸é€»è¾‘è¡¨è¾¾å¼" class="headerlink" title="ğŸ§­ 4. æµç¨‹æ§åˆ¶ä¸é€»è¾‘è¡¨è¾¾å¼"></a>ğŸ§­ 4. æµç¨‹æ§åˆ¶ä¸é€»è¾‘è¡¨è¾¾å¼</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(WIN32)</span><br><span class="line"> <span class="keyword">message</span>(<span class="string">&quot;Windows build&quot;</span>)</span><br><span class="line"><span class="keyword">elseif</span>(UNIX)</span><br><span class="line"> <span class="keyword">message</span>(<span class="string">&quot;Linux build&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">file</span> IN LISTS myfiles)</span><br><span class="line"> <span class="keyword">message</span>(<span class="variable">$&#123;file&#125;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(cond)</span><br><span class="line"> ...</span><br><span class="line"><span class="keyword">endwhile</span>()</span><br></pre></td></tr></table></figure>

<p>è¿ç®—ç¬¦ï¼š</p>
<ul>
<li><code>STREQUAL</code>, <code>EQUAL</code>, <code>LESS</code>, <code>GREATER</code></li>
<li><code>AND</code>, <code>OR</code>, <code>NOT</code></li>
<li>æ–‡ä»¶åˆ¤æ–­ï¼š<code>if(EXISTS path)</code>, <code>if(IS_DIRECTORY dir)</code></li>
</ul>
<hr>
<h2 id="ğŸª¶-5-è¾“å…¥è¾“å‡ºä¸æ¶ˆæ¯"><a href="#ğŸª¶-5-è¾“å…¥è¾“å‡ºä¸æ¶ˆæ¯" class="headerlink" title="ğŸª¶ 5. è¾“å…¥è¾“å‡ºä¸æ¶ˆæ¯"></a>ğŸª¶ 5. è¾“å…¥è¾“å‡ºä¸æ¶ˆæ¯</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Compiling...&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(WARNING <span class="string">&quot;dangerous&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(FATAL_ERROR <span class="string">&quot;stop!&quot;</span>)</span><br><span class="line"><span class="keyword">file</span>(<span class="keyword">MAKE_DIRECTORY</span> path)</span><br><span class="line"><span class="keyword">file</span>(GLOB SRCS <span class="string">&quot;*.cpp&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§©-6-æ ¸å¿ƒæ„å»ºæŒ‡ä»¤"><a href="#ğŸ§©-6-æ ¸å¿ƒæ„å»ºæŒ‡ä»¤" class="headerlink" title="ğŸ§© 6. æ ¸å¿ƒæ„å»ºæŒ‡ä»¤"></a>ğŸ§© 6. æ ¸å¿ƒæ„å»ºæŒ‡ä»¤</h2><table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>ä½¿ç”¨è¯­æ³•</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>å¯æ‰§è¡Œç¨‹åº</td>
<td><code>add_executable(target src...)</code></td>
<td><code>add_executable(App main.cpp)</code></td>
</tr>
<tr>
<td>é™æ€&#x2F;åŠ¨æ€åº“</td>
<td><code>add_library(name STATIC/SHARED src...)</code></td>
<td></td>
</tr>
<tr>
<td>ç›®æ ‡å±æ€§</td>
<td><code>set_target_properties(tgt PROPERTIES OUTPUT_NAME &quot;libcore&quot;)</code></td>
<td></td>
</tr>
<tr>
<td>é“¾æ¥ä¾èµ–</td>
<td><code>target_link_libraries(A B PRIVATE C)</code></td>
<td></td>
</tr>
<tr>
<td>åŒ…å«ç›®å½•</td>
<td><code>target_include_directories(A PUBLIC include/)</code></td>
<td></td>
</tr>
<tr>
<td>å®šä¹‰å®</td>
<td><code>target_compile_definitions(A PRIVATE BUILD_DLL)</code></td>
<td></td>
</tr>
<tr>
<td>é€‰é¡¹</td>
<td><code>option(ENABLE_LOG &quot;enable log&quot; ON)</code></td>
<td></td>
</tr>
<tr>
<td>æ¡ä»¶ç¼–è¯‘</td>
<td><code>if(ENABLE_LOG)</code>â€¦<code>endif()</code></td>
<td></td>
</tr>
</tbody></table>
<p><strong>ä¸‰ç§å¯è§æ€§å…³é”®å­—ï¼š</strong></p>
<ul>
<li><strong>PRIVATE</strong>ï¼šä»…å½“å‰ targetï¼›</li>
<li><strong>PUBLIC</strong>ï¼šå½“å‰å’Œä¾èµ–å½“å‰çš„ targetï¼›</li>
<li><strong>INTERFACE</strong>ï¼šåªæœ‰è°ƒç”¨è€…å¯è§ã€‚</li>
</ul>
<hr>
<h2 id="ğŸ—ï¸-7-å…¨å±€ä¸å­ç›®å½•æ„å»º"><a href="#ğŸ—ï¸-7-å…¨å±€ä¸å­ç›®å½•æ„å»º" class="headerlink" title="ğŸ—ï¸ 7. å…¨å±€ä¸å­ç›®å½•æ„å»º"></a>ğŸ—ï¸ 7. å…¨å±€ä¸å­ç›®å½•æ„å»º</h2><h3 id="ä¸»æ¬¡ç»“æ„"><a href="#ä¸»æ¬¡ç»“æ„" class="headerlink" title="ä¸»æ¬¡ç»“æ„"></a>ä¸»æ¬¡ç»“æ„</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_subdirectory</span>(Core)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(Modules)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(App)</span><br></pre></td></tr></table></figure>

<h3 id="include-å¼•ç”¨æ¨¡å—"><a href="#include-å¼•ç”¨æ¨¡å—" class="headerlink" title="include å¼•ç”¨æ¨¡å—"></a>include å¼•ç”¨æ¨¡å—</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/cmake/MyUtil.cmake)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ—‚ï¸-8-å®‰è£…ä¸å¯¼å‡ºï¼ˆInstall-Exportï¼‰"><a href="#ğŸ—‚ï¸-8-å®‰è£…ä¸å¯¼å‡ºï¼ˆInstall-Exportï¼‰" class="headerlink" title="ğŸ—‚ï¸ 8. å®‰è£…ä¸å¯¼å‡ºï¼ˆInstall &#x2F; Exportï¼‰"></a>ğŸ—‚ï¸ 8. å®‰è£…ä¸å¯¼å‡ºï¼ˆInstall &#x2F; Exportï¼‰</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS Core Model</span><br><span class="line">  <span class="keyword">EXPORT</span> MyProjTargets</span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjTargets</span><br><span class="line">  <span class="keyword">FILE</span> MyProjConfig.cmake</span><br><span class="line">  NAMESPACE MyProj::</span><br><span class="line">  DESTINATION lib/cmake/MyProj</span><br><span class="line">)</span><br><span class="line"><span class="keyword">install</span>(DIRECTORY <span class="keyword">include</span>/ DESTINATION <span class="keyword">include</span>/MyProj)</span><br></pre></td></tr></table></figure>

<p>è¿™æ · <code>find_package(MyProj REQUIRED)</code> å³å¯å¯¼å…¥ã€‚</p>
<hr>
<h2 id="ğŸ’¼-9-å¯¼å…¥å¤–éƒ¨åº“ä¸-find-package"><a href="#ğŸ’¼-9-å¯¼å…¥å¤–éƒ¨åº“ä¸-find-package" class="headerlink" title="ğŸ’¼ 9. å¯¼å…¥å¤–éƒ¨åº“ä¸ find_package"></a>ğŸ’¼ 9. å¯¼å…¥å¤–éƒ¨åº“ä¸ find_package</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(App PRIVATE <span class="variable">$&#123;OpenCV_LIBS&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰ <code>FindXXX.cmake</code>ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># cmake/FindMylib.cmake</span></span><br><span class="line"><span class="keyword">find_path</span>(MYLIB_INCLUDE_DIR mylib.h PATHS /opt/mylib/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">find_library</span>(MYLIB_LIB NAMES mylib PATHS /opt/mylib/lib)</span><br><span class="line"><span class="keyword">mark_as_advanced</span>(MYLIB_INCLUDE_DIR MYLIB_LIB)</span><br><span class="line"><span class="keyword">if</span>(MYLIB_INCLUDE_DIR <span class="keyword">AND</span> MYLIB_LIB)</span><br><span class="line">  <span class="keyword">set</span>(MYLIB_FOUND <span class="keyword">TRUE</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”—-10-å·¥ç¨‹å±æ€§ä¸é…ç½®"><a href="#ğŸ”—-10-å·¥ç¨‹å±æ€§ä¸é…ç½®" class="headerlink" title="ğŸ”— 10. å·¥ç¨‹å±æ€§ä¸é…ç½®"></a>ğŸ”— 10. å·¥ç¨‹å±æ€§ä¸é…ç½®</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ç¤ºä¾‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>project(NAME VERSION 1.0)</code></td>
<td>â€”</td>
<td>å·¥ç¨‹åå’Œç‰ˆæœ¬</td>
</tr>
<tr>
<td><code>configure_file(in out @ONLY)</code></td>
<td>æ¨¡æ¿ç”Ÿæˆé…ç½®å¤´</td>
<td></td>
</tr>
<tr>
<td><code>add_compile_options(-Wall)</code></td>
<td>å…¨å±€ç¼–è¯‘é€‰é¡¹</td>
<td></td>
</tr>
<tr>
<td><code>set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ...)</code></td>
<td>äºŒè¿›åˆ¶è¾“å‡ºç›®å½•</td>
<td></td>
</tr>
<tr>
<td><code>include(GNUInstallDirs)</code></td>
<td>å¹³å°æ ‡å‡†è·¯å¾„</td>
<td></td>
</tr>
<tr>
<td><code>add_custom_command</code> &#x2F; <code>add_custom_target</code></td>
<td>è‡ªå®šä¹‰å‘½ä»¤</td>
<td></td>
</tr>
</tbody></table>
<p>è‡ªå®šä¹‰å‘½ä»¤ä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_custom_command</span>(</span><br><span class="line">  <span class="keyword">TARGET</span> App POST_BUILD</span><br><span class="line">  <span class="keyword">COMMAND</span> <span class="variable">$&#123;CMAKE_COMMAND&#125;</span> -E copy $&lt;TARGET_FILE:App&gt; <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ§©-11-æµ‹è¯•ä¸æ‰“åŒ…"><a href="#ğŸ§©-11-æµ‹è¯•ä¸æ‰“åŒ…" class="headerlink" title="ğŸ§© 11. æµ‹è¯•ä¸æ‰“åŒ…"></a>ğŸ§© 11. æµ‹è¯•ä¸æ‰“åŒ…</h2><ul>
<li>æµ‹è¯•ï¼š<code>enable_testing()</code> + <code>add_test(NAME test1 COMMAND App arg)</code></li>
<li>æ‰“åŒ…ï¼š  <figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(CPack)</span><br><span class="line"><span class="keyword">set</span>(CPACK_GENERATOR <span class="string">&quot;TGZ&quot;</span>)</span><br><span class="line">make package</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h2 id="âš™ï¸-12-å‘½ä»¤è¡Œå·¥å…·è¯­æ³•é€ŸæŸ¥"><a href="#âš™ï¸-12-å‘½ä»¤è¡Œå·¥å…·è¯­æ³•é€ŸæŸ¥" class="headerlink" title="âš™ï¸ 12. å‘½ä»¤è¡Œå·¥å…·è¯­æ³•é€ŸæŸ¥"></a>âš™ï¸ 12. å‘½ä»¤è¡Œå·¥å…·è¯­æ³•é€ŸæŸ¥</h2><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>åŠŸèƒ½&#x2F;ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td>åˆ›å»ºæ„å»ºç³»ç»Ÿ</td>
<td><code>cmake -S . -B build</code></td>
</tr>
<tr>
<td>æ„å»º</td>
<td><code>cmake --build build -j</code></td>
</tr>
<tr>
<td>å®‰è£…</td>
<td><code>cmake --install build --prefix ./install</code></td>
</tr>
<tr>
<td>æ¸…ç†</td>
<td><code>cmake --build build --target clean</code></td>
</tr>
<tr>
<td>åˆ—å˜é‡</td>
<td><code>cmake -LAH</code></td>
</tr>
<tr>
<td>æµ‹è¯•</td>
<td><code>ctest --output-on-failure</code></td>
</tr>
<tr>
<td>æ‰“åŒ…</td>
<td><code>cpack -G TGZ</code></td>
</tr>
<tr>
<td>ç¼“å­˜ä¿®æ”¹</td>
<td><code>cmake -DVAR=VALUE</code></td>
</tr>
<tr>
<td>GUI (å¯é€‰)</td>
<td><code>cmake-gui</code></td>
</tr>
</tbody></table>
<hr>
<h1 id="âš’ï¸-PART-IIIï¼šå®æˆ˜å·¥ç¨‹æ¨¡æ¿"><a href="#âš’ï¸-PART-IIIï¼šå®æˆ˜å·¥ç¨‹æ¨¡æ¿" class="headerlink" title="âš’ï¸ PART IIIï¼šå®æˆ˜å·¥ç¨‹æ¨¡æ¿"></a>âš’ï¸ PART IIIï¼šå®æˆ˜å·¥ç¨‹æ¨¡æ¿</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">å·¥ç¨‹å·²ä½œåºŸï¼Œä¸‹æ–¹è¡¥å……è¯´æ˜éƒ¨åˆ†æœ‰æ›´æ–°ç‰ˆæœ¬</span><br></pre></td></tr></table></figure>

<h2 id="ğŸ¯-å·¥ç¨‹ç›®æ ‡"><a href="#ğŸ¯-å·¥ç¨‹ç›®æ ‡" class="headerlink" title="ğŸ¯ å·¥ç¨‹ç›®æ ‡"></a>ğŸ¯ å·¥ç¨‹ç›®æ ‡</h2><ul>
<li>ä¸»é¡¹ç›®ï¼š <code>MyProject</code></li>
<li>å­ç»„ä»¶ï¼š<ul>
<li><code>Core</code>ï¼ˆé™æ€åº“ï¼‰</li>
<li><code>Network</code>ï¼ˆåŠ¨æ€åº“ï¼‰</li>
<li><code>App</code>ï¼ˆä¸»ç¨‹åºï¼‰</li>
</ul>
</li>
<li>é¢å¤–å¼•å…¥ç¬¬ä¸‰æ–¹åº“å¦‚ <code>fmt</code>ï¼ˆheader-onlyï¼‰</li>
</ul>
<hr>
<h2 id="ğŸ“-æ–‡ä»¶ç»“æ„"><a href="#ğŸ“-æ–‡ä»¶ç»“æ„" class="headerlink" title="ğŸ“ æ–‡ä»¶ç»“æ„"></a>ğŸ“ æ–‡ä»¶ç»“æ„</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyProject/</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€ CMakeLists.txt</span><br><span class="line">â”œâ”€ Core/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚   â””â”€ core.cpp / core.h</span><br><span class="line">â”œâ”€ Network/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚   â””â”€ network.cpp / network.h</span><br><span class="line">â”œâ”€ App/</span><br><span class="line">â”‚   â”œâ”€ CMakeLists.txt</span><br><span class="line">â”‚   â””â”€ main.cpp</span><br><span class="line">â”œâ”€ cmake/</span><br><span class="line">â”‚   â””â”€ FindFMT.cmake</span><br><span class="line">â””â”€ bin/</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ·ï¸-é¡¶å±‚-CMakeLists-txt"><a href="#ğŸ·ï¸-é¡¶å±‚-CMakeLists-txt" class="headerlink" title="ğŸ·ï¸ é¡¶å±‚ CMakeLists.txt"></a>ğŸ·ï¸ é¡¶å±‚ CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.16</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject LANGUAGES CXX VERSION <span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_LIBRARY_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin/lib)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_ARCHIVE_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin/lib)</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(BUILD_SHARED_LIBS <span class="string">&quot;Build shared instead of static&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(Core)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(Network)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(App)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…å¯¼å‡º</span></span><br><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  <span class="keyword">FILE</span> MyProjectConfig.cmake</span><br><span class="line">  NAMESPACE MyProject::</span><br><span class="line">  DESTINATION lib/cmake/MyProject</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-Core-CMakeLists-txt"><a href="#ğŸ”¹-Core-CMakeLists-txt" class="headerlink" title="ğŸ”¹ Core&#x2F;CMakeLists.txt"></a>ğŸ”¹ Core&#x2F;CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Core STATIC core.cpp core.h)</span><br><span class="line"><span class="keyword">target_include_directories</span>(Core PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">target_compile_definitions</span>(Core PRIVATE CORE_INTERNAL)</span><br><span class="line"><span class="keyword">install</span>(TARGETS Core <span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">  PUBLIC_HEADER DESTINATION <span class="keyword">include</span>/Core</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>core.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">core_init</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Core initialized\n&quot;</span>; &#125;</span><br></pre></td></tr></table></figure>
<p><strong>core.h</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">core_init</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-Network-CMakeLists-txt"><a href="#ğŸ”¹-Network-CMakeLists-txt" class="headerlink" title="ğŸ”¹ Network&#x2F;CMakeLists.txt"></a>ğŸ”¹ Network&#x2F;CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Network SHARED network.cpp network.h)</span><br><span class="line"><span class="keyword">target_include_directories</span>(Network PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(Network PRIVATE Core)</span><br><span class="line"><span class="keyword">find_package</span>(FMT REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">target_link_libraries</span>(Network PRIVATE fmt::fmt)</span><br><span class="line"><span class="keyword">install</span>(TARGETS Network <span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  PUBLIC_HEADER DESTINATION <span class="keyword">include</span>/Network</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><strong>network.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;network.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fmt/core.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">network_run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">core_init</span>();</span><br><span class="line">    fmt::<span class="built_in">print</span>(<span class="string">&quot;Network module online.\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>network.h</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">network_run</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-App-CMakeLists-txt"><a href="#ğŸ”¹-App-CMakeLists-txt" class="headerlink" title="ğŸ”¹ App&#x2F;CMakeLists.txt"></a>ğŸ”¹ App&#x2F;CMakeLists.txt</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(App main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(App PRIVATE Core Network)</span><br><span class="line"><span class="keyword">install</span>(TARGETS App RUNTIME DESTINATION bin)</span><br></pre></td></tr></table></figure>

<p><strong>main.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;network.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">network_run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ“¦-æ„å»ºä¸å®‰è£…"><a href="#ğŸ“¦-æ„å»ºä¸å®‰è£…" class="headerlink" title="ğŸ“¦ æ„å»ºä¸å®‰è£…"></a>ğŸ“¦ æ„å»ºä¸å®‰è£…</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -S . -B build -DCMAKE_BUILD_TYPE=Release</span><br><span class="line">cmake --build build -j</span><br><span class="line">cmake --install build --prefix ./install</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">install/</span><br><span class="line">â”œâ”€ bin/App</span><br><span class="line">â”œâ”€ lib/libCore.a</span><br><span class="line">â”œâ”€ lib/libNetwork.so</span><br><span class="line">â””â”€ include/(Core|Network)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸŒ-å¤–éƒ¨ä½¿ç”¨ï¼ˆSDKå½¢å¼ï¼‰"><a href="#ğŸŒ-å¤–éƒ¨ä½¿ç”¨ï¼ˆSDKå½¢å¼ï¼‰" class="headerlink" title="ğŸŒ å¤–éƒ¨ä½¿ç”¨ï¼ˆSDKå½¢å¼ï¼‰"></a>ğŸŒ å¤–éƒ¨ä½¿ç”¨ï¼ˆSDKå½¢å¼ï¼‰</h2><p>åœ¨å¦ä¸€ä¸ª CMake é¡¹ç›®çš„ CMakeLists.txtï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(MyProject REQUIRED)</span><br><span class="line"><span class="keyword">add_executable</span>(UserApp main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(UserApp PRIVATE MyProject::Network)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ğŸ’¡-é™„å½•ï¼šå­¦ä¹ ä¸å¿ƒæ³•"><a href="#ğŸ’¡-é™„å½•ï¼šå­¦ä¹ ä¸å¿ƒæ³•" class="headerlink" title="ğŸ’¡ é™„å½•ï¼šå­¦ä¹ ä¸å¿ƒæ³•"></a>ğŸ’¡ é™„å½•ï¼šå­¦ä¹ ä¸å¿ƒæ³•</h1><ol>
<li><strong>CMake æ˜¯â€œæè¿°â€ï¼Œä¸æ˜¯â€œæ‰§è¡Œâ€</strong> - å®ƒæè¿°ã€Œå¦‚ä½•æ„å»ºã€ã€‚  </li>
<li><strong>æœ€å°æš´éœ²åŸåˆ™</strong> - å…¬å…±æ¥å£åªé€šè¿‡ <code>target_include_directories(... PUBLIC)</code>ã€‚  </li>
<li><strong>ä¸å…¨å±€æ±¡æŸ“</strong> - é¿å… <code>include_directories(...)</code> è¿™ç§å…¨å±€æŒ‡ä»¤ã€‚  </li>
<li><strong>å¯¼å‡º&#x2F;Import æ˜¯å·¥ç¨‹å¤ç”¨æ ¹åŸºã€‚</strong>  </li>
<li><strong>åŒºåˆ†å¼€å‘ä¸éƒ¨ç½²</strong> - ä½¿ç”¨ INSTALL å’Œ EXPORTã€‚  </li>
<li><strong>ç¬¬ä¸‰æ–¹åº“ä¼˜å…ˆ find_package</strong> - å…¼å®¹ CMakeç”Ÿæ€ã€‚  </li>
<li><strong>Debug&#x2F;Release å„ç‹¬ç«‹æ„å»ºç›®å½•ã€‚</strong>  </li>
<li><strong>æŒæ¡ç›®æ ‡ä¾èµ–ä¸‰ä¿®é¥°ç¬¦ï¼šPRIVATE &#x2F; PUBLIC &#x2F; INTERFACEã€‚</strong>  </li>
<li><strong>ç”¨ configure_file è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å·å¤´æ–‡ä»¶ã€‚</strong>  </li>
<li><strong>å§‹ç»ˆåœ¨ CMake GUI &#x2F; Cache é‡Œç¡®è®¤è·¯å¾„è§£æã€‚</strong></li>
</ol>
<hr>
<p>âœ… <strong>ç»“æœ</strong></p>
<p>è¿™ä»½æ–‡æ¡£åŒ…å«ï¼š</p>
<ul>
<li>å…¨é‡è„šæœ¬è¯­æ³•ï¼ˆå˜é‡ã€å‡½æ•°ã€é€»è¾‘ã€æ„å»ºå‘½ä»¤ã€å®‰è£…å¯¼å‡ºï¼‰ï¼›</li>
<li>æ‰€æœ‰å‘½ä»¤è¡Œæ¥å£ï¼›</li>
<li>å®Œæ•´é«˜å±‚æ¨¡æ¿ï¼ˆå«ä¸‰å±‚å­é¡¹ç›® + install&#x2F;export + ç¬¬ä¸‰æ–¹ä¾èµ–ï¼‰ï¼›</li>
<li>çœŸå® C++ ç¤ºä¾‹å¯ç¼–è¯‘è¿è¡Œï¼›</li>
<li>è¡Œä¸šé€šç”¨å·¥ç¨‹ç»„ç»‡ç†å¿µã€‚</li>
</ul>
<p>æ‹·è´å·¥ç¨‹ç»“æ„åæ‰§è¡Œä¸‰æ­¥ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -S . -B build</span><br><span class="line">cmake --build build</span><br><span class="line">cmake --install build --prefix ./install</span><br></pre></td></tr></table></figure>

<p>ä½ å°±æ‹¥æœ‰äº†ä¸€ä¸ªæ ‡å‡†ã€ç°ä»£ã€å¯æ‰©å±•ä¸”å¯å¤ç”¨çš„ CMake å·¥ç¨‹åŸºç¡€æ¡†æ¶ã€‚</p>
<hr>
<h1 id="ç¬¬äºŒéƒ¨åˆ†ï¼šè¡¥å……è¯´æ˜"><a href="#ç¬¬äºŒéƒ¨åˆ†ï¼šè¡¥å……è¯´æ˜" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ†ï¼šè¡¥å……è¯´æ˜"></a>ç¬¬äºŒéƒ¨åˆ†ï¼šè¡¥å……è¯´æ˜</h1><hr>
<h1 id="ğŸ§±-ç¬¬ä¸€ç« ï¼šå˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆCMake-è„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰"><a href="#ğŸ§±-ç¬¬ä¸€ç« ï¼šå˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆCMake-è„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰" class="headerlink" title="ğŸ§± ç¬¬ä¸€ç« ï¼šå˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆCMake è„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰"></a>ğŸ§± ç¬¬ä¸€ç« ï¼šå˜é‡ç³»ç»Ÿå…¨è§£ï¼ˆCMake è„šæœ¬è¯­æ³•æ ¸å¿ƒï¼‰</h1><hr>
<h2 id="ğŸ”¤-1ï¸âƒ£-å®šä¹‰å˜é‡"><a href="#ğŸ”¤-1ï¸âƒ£-å®šä¹‰å˜é‡" class="headerlink" title="ğŸ”¤ 1ï¸âƒ£ å®šä¹‰å˜é‡"></a>ğŸ”¤ 1ï¸âƒ£ å®šä¹‰å˜é‡</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># set(&lt;å˜é‡å&gt; &lt;å€¼&gt; [CACHE &lt;ç±»å‹&gt; &lt;æè¿°&gt; [FORCE]])</span></span><br><span class="line"><span class="keyword">set</span>(MY_NAME <span class="string">&quot;Alice&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="variable">$&#123;MY_NAME&#125;</span>) <span class="comment"># æ‰“å°å˜é‡å€¼ =&gt; Alice</span></span><br></pre></td></tr></table></figure>

<p>ğŸ“˜ <strong>è¯´æ˜</strong></p>
<ul>
<li>CMake ä¸­å˜é‡åªæ˜¯ã€‚</li>
<li>é»˜è®¤ä½œç”¨åŸŸæ˜¯å½“å‰æ–‡ä»¶ï¼›function æœ‰ç‹¬ç«‹ä½œç”¨åŸŸï¼Œmacro æ²¡æœ‰ã€‚</li>
<li>å¯è·¨æ–‡ä»¶ä½¿ç”¨ <code>$&#123;å˜é‡å&#125;</code> å–å€¼ã€‚</li>
</ul>
<hr>
<h2 id="ğŸŒ-2ï¸âƒ£-é¢„å®šä¹‰è·¯å¾„å˜é‡"><a href="#ğŸŒ-2ï¸âƒ£-é¢„å®šä¹‰è·¯å¾„å˜é‡" class="headerlink" title="ğŸŒ 2ï¸âƒ£ é¢„å®šä¹‰è·¯å¾„å˜é‡"></a>ğŸŒ 2ï¸âƒ£ é¢„å®šä¹‰è·¯å¾„å˜é‡</h2><table>
<thead>
<tr>
<th>å˜é‡</th>
<th>å«ä¹‰</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_SOURCE_DIR</code> æœ€é¡¶å±‚ <code>CMakeLists.txt</code> æ‰€åœ¨ç›®å½•</td>
<td><code>/home/user/MyProject</code></td>
<td></td>
</tr>
<tr>
<td><code>CMAKE_CURRENT_SOURCE_DIR</code></td>
<td>å½“å‰è¿™ä¸€å±‚CMakeListsæ‰€åœ¨ç›®å½•</td>
<td><code>MyProject/Core</code></td>
</tr>
<tr>
<td><code>CMAKE_BINARY_DIR</code></td>
<td>æ„å»ºç›®å½•æ ¹</td>
<td><code>/home/user/MyProject/build</code></td>
</tr>
<tr>
<td><code>CMAKE_CURRENT_BINARY_DIR</code></td>
<td>å½“å‰æ„å»ºå­ç›®å½•</td>
<td><code>/home/user/MyProject/build</code></td>
</tr>
<tr>
<td><code>PROJECT_SOURCE_DIR</code></td>
<td><code>project()</code> å®šä¹‰çš„é¡¹ç›®æºç æ ¹</td>
<td>åŒ <code>CMAKE_SOURCE_DIR</code></td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_PREFIX</code></td>
<td>å®‰è£…æ ¹ç›®å½•</td>
<td><code>/usr/local</code> æˆ–æ‰‹åŠ¨prefix</td>
</tr>
<tr>
<td><code>CMAKE_RUNTIME_OUTPUT_DIRECTORY</code></td>
<td>exe è¾“å‡ºè·¯å¾„</td>
<td><code>MyProject/bin</code></td>
</tr>
<tr>
<td><code>CMAKE_LIBRARY_OUTPUT_DIRECTORY</code></td>
<td>åŠ¨æ€åº“è¾“å‡ºè·¯å¾„</td>
<td><code>MyProject/bin/lib</code></td>
</tr>
<tr>
<td><code>CMAKE_ARCHIVE_OUTPUT_DIRECTORY</code></td>
<td>é™æ€åº“è¾“å‡ºè·¯å¾„</td>
<td><code>MyProject/bin/lib</code></td>
</tr>
</tbody></table>
<p>ğŸ’¬ ç”¨æ³•ç¤ºä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin)</span><br><span class="line"><span class="keyword">add_executable</span>(app main.cpp)</span><br></pre></td></tr></table></figure>
<p>â†’ ç¼–è¯‘å <code>app</code> è¾“å‡ºåˆ° <code>bin/</code></p>
<hr>
<h2 id="ğŸ“‹-3ï¸âƒ£-ç¯å¢ƒä¸ç¼“å­˜å˜é‡"><a href="#ğŸ“‹-3ï¸âƒ£-ç¯å¢ƒä¸ç¼“å­˜å˜é‡" class="headerlink" title="ğŸ“‹ 3ï¸âƒ£ ç¯å¢ƒä¸ç¼“å­˜å˜é‡"></a>ğŸ“‹ 3ï¸âƒ£ ç¯å¢ƒä¸ç¼“å­˜å˜é‡</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(ENV&#123;PATH&#125; <span class="string">&quot;/extra/tools:$ENV&#123;PATH&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">message</span>(<span class="string">&quot;PATH = $ENV&#123;PATH&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(VERSION_TAG <span class="string">&quot;v1&quot;</span> CACHE <span class="keyword">STRING</span> <span class="string">&quot;project version&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>ğŸ“˜ CACHE ä¼šå†™å…¥ <code>CMakeCache.txt</code>ï¼Œä¸‹æ¬¡ cmake ä¿ç•™ã€‚</p>
<hr>
<h2 id="ğŸ§®-4ï¸âƒ£-åˆ—è¡¨ä¸æ“ä½œ"><a href="#ğŸ§®-4ï¸âƒ£-åˆ—è¡¨ä¸æ“ä½œ" class="headerlink" title="ğŸ§® 4ï¸âƒ£ åˆ—è¡¨ä¸æ“ä½œ"></a>ğŸ§® 4ï¸âƒ£ åˆ—è¡¨ä¸æ“ä½œ</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(MYLIST A B C)</span><br><span class="line"><span class="keyword">list</span>(APPEND MYLIST D)</span><br><span class="line"><span class="keyword">foreach</span>(item IN LISTS MYLIST)</span><br><span class="line">  <span class="keyword">message</span>(<span class="variable">$&#123;item&#125;</span>)</span><br><span class="line"><span class="keyword">endforeach</span>()</span><br></pre></td></tr></table></figure>

<p>å­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span>(REPLACE <span class="string">&quot;;&quot;</span> <span class="string">&quot;,&quot;</span> OUTPUT <span class="string">&quot;$&#123;MYLIST&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="âš™ï¸-ç¬¬äºŒç« ï¼šæ„å»ºç›®æ ‡-Targets-ä¸å‘½åç©ºé—´"><a href="#âš™ï¸-ç¬¬äºŒç« ï¼šæ„å»ºç›®æ ‡-Targets-ä¸å‘½åç©ºé—´" class="headerlink" title="âš™ï¸ ç¬¬äºŒç« ï¼šæ„å»ºç›®æ ‡(Targets) ä¸å‘½åç©ºé—´"></a>âš™ï¸ ç¬¬äºŒç« ï¼šæ„å»ºç›®æ ‡(Targets) ä¸å‘½åç©ºé—´</h1><hr>
<h2 id="ğŸ§©-Target-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ§©-Target-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ§© Target æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸ§© Target æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote>
<p>æ¯ä¸ª <code>add_library()</code> æˆ– <code>add_executable()</code> åˆ›å»ºçš„å®ä½“ç›®æ ‡æ˜¯ä¸€ä¸ª <strong>Target</strong>ã€‚<br>ä¸€åˆ‡å¼•ç”¨ã€ä¾èµ–ã€å®‰è£…éƒ½ç»•ç€ Target è¿›è¡Œã€‚</p>
</blockquote>
<p>ä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Core STATIC core.cpp)</span><br><span class="line"><span class="keyword">add_executable</span>(App main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(App PRIVATE Core)</span><br></pre></td></tr></table></figure>

<p>ğŸ“˜ <code>&quot;App&quot;</code> ç›®æ ‡é“¾æ¥ <code>&quot;Core&quot;</code>ã€‚</p>
<blockquote>
<p>Target ä¸å˜é‡ä¸åŒï¼Œå®ƒæ˜¯ CMake å†…éƒ¨çš„â€œæ„å»ºå¯¹è±¡â€ã€‚</p>
</blockquote>
<hr>
<h2 id="ğŸ’¡-target-link-libraries-çš„ä¸‰ä¿®é¥°ç¬¦"><a href="#ğŸ’¡-target-link-libraries-çš„ä¸‰ä¿®é¥°ç¬¦" class="headerlink" title="ğŸ’¡ target_link_libraries çš„ä¸‰ä¿®é¥°ç¬¦"></a>ğŸ’¡ target_link_libraries çš„ä¸‰ä¿®é¥°ç¬¦</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">target_link_libraries</span>(App</span><br><span class="line">    PRIVATE Core</span><br><span class="line">    PUBLIC OpenCV::opencv_core</span><br><span class="line">    INTERFACE Boost::boost)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ä¿®é¥°ç¬¦</th>
<th>æ„ä¹‰</th>
</tr>
</thead>
<tbody><tr>
<td>PRIVATE</td>
<td>ä»… App ç¼–è¯‘éœ€è¦ Core çš„å¤´æ–‡ä»¶ï¼Œä¸ä¼ æ’­</td>
</tr>
<tr>
<td>PUBLIC</td>
<td>App å’Œä¾èµ– App çš„ç›®æ ‡éƒ½è¦ç”¨</td>
</tr>
<tr>
<td>INTERFACE</td>
<td>å½“å‰ç›®æ ‡ä¸éœ€è¦ï¼Œä½†ä¸‹æ¸¸è¦ç”¨ï¼ˆå¤šç”¨äº header-only åº“ï¼‰</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸŒ-å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#ğŸŒ-å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸŒ å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ"></a>ğŸŒ å‘½åç©ºé—´ï¼ˆNamespaceï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><code>OpenCV::opencv_core</code> å…¶å®æ˜¯å¤–éƒ¨åº“ <code>OpenCV</code> å®‰è£…æ—¶å¯¼å‡ºçš„å‘½åç©ºé—´å‰ç¼€ã€‚<br><code>find_package(OpenCV)</code> è¿”å›çš„å°±æ˜¯ä¸€ç³»åˆ— Targetï¼Œå¦‚ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">OpenCV::core</span><br><span class="line">OpenCV::imgproc</span><br><span class="line">OpenCV::highgui</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;&gt; å®ƒä¸æ˜¯å˜é‡ï¼Œè€Œæ˜¯<strong>target åç§°ç©ºé—´å¼•ç”¨</strong>ã€‚<br>åœ¨ <em>install(EXPORT)</em> ç”Ÿæˆ Config ä¸­æˆ‘ä»¬ä¹Ÿèƒ½è‡ªå®šä¹‰è‡ªå·±çš„å‘½åç©ºé—´ã€‚</p>
<hr>
<h1 id="ğŸ§°-ç¬¬ä¸‰ç« ï¼šinstall-ä¸-export-æœºåˆ¶"><a href="#ğŸ§°-ç¬¬ä¸‰ç« ï¼šinstall-ä¸-export-æœºåˆ¶" class="headerlink" title="ğŸ§° ç¬¬ä¸‰ç« ï¼šinstall ä¸ export æœºåˆ¶"></a>ğŸ§° ç¬¬ä¸‰ç« ï¼šinstall ä¸ export æœºåˆ¶</h1><hr>
<h2 id="ğŸ§©-install-TARGETS-â€¦-æ˜¯è£…ä»€ä¹ˆï¼Ÿ"><a href="#ğŸ§©-install-TARGETS-â€¦-æ˜¯è£…ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ğŸ§© install(TARGETS â€¦) æ˜¯è£…ä»€ä¹ˆï¼Ÿ"></a>ğŸ§© install(TARGETS â€¦) æ˜¯è£…ä»€ä¹ˆï¼Ÿ</h2><p>ç”¨äºå¤åˆ¶ç¼–è¯‘å¥½çš„ç›®æ ‡åˆ°æŒ‡å®šå®‰è£…ç›®å½•ã€‚</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(TARGETS Core</span><br><span class="line">  RUNTIME DESTINATION bin</span><br><span class="line">  LIBRARY DESTINATION lib</span><br><span class="line">  ARCHIVE DESTINATION lib</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>å¯¹åº”</th>
<th>å¹³å°å·®å¼‚</th>
</tr>
</thead>
<tbody><tr>
<td>RUNTIME</td>
<td><code>.exe/.so</code> å¯æ‰§è¡Œæ–‡ä»¶</td>
<td>Windows&#x2F;Linux å…±ç”¨</td>
</tr>
<tr>
<td>LIBRARY</td>
<td>åŠ¨æ€åº“ <code>.so/.dll</code></td>
<td>-</td>
</tr>
<tr>
<td>ARCHIVE</td>
<td>é™æ€åº“ <code>.a/.lib</code></td>
<td>-</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸ“¦-install-EXPORT-â€¦-åˆ°åº•å¹²å˜›"><a href="#ğŸ“¦-install-EXPORT-â€¦-åˆ°åº•å¹²å˜›" class="headerlink" title="ğŸ“¦ install(EXPORT â€¦) åˆ°åº•å¹²å˜›"></a>ğŸ“¦ install(EXPORT â€¦) åˆ°åº•å¹²å˜›</h2><p>è¿™æ˜¯å¯¼å‡ºä¸€ä»½ â€œ<strong>ç›®æ ‡æè¿°æ–‡ä»¶</strong>â€ã€‚<br>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  <span class="keyword">FILE</span> MyProjectConfig.cmake</span><br><span class="line">  NAMESPACE MyProject::</span><br><span class="line">  DESTINATION lib/cmake/MyProject</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šï¼š</p>
<ul>
<li>åœ¨é¡¹ç›®å®‰è£…é˜¶æ®µä¼šç”Ÿæˆï¼š<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">install/lib/cmake/MyProject/MyProjectConfig.cmake</span><br></pre></td></tr></table></figure></li>
<li>é‡Œé¢è®°å½•äº†æ‰€æœ‰é€šè¿‡ <code>install(TARGETS ... EXPORT MyProjectTargets)</code> æ³¨å†Œè¿‡çš„ targetã€‚</li>
<li>ä¹‹åå¤–éƒ¨å·¥ç¨‹å°±å¯ä»¥ï¼š<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(MyProject REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(OtherApp MyProject::Core)</span><br></pre></td></tr></table></figure>
æ¥å¿«é€Ÿä½¿ç”¨ä½ çš„åº“ã€‚</li>
</ul>
<p>ğŸª¶ <strong>æ‰€ä»¥ï¼š</strong><br>1ï¸âƒ£ <code>MyProjectTargets</code> åæ˜¯éšä¾¿å–çš„å¯¼å‡ºæ¸…å•åï¼›<br>2ï¸âƒ£ è¯¥æ¸…å•ç”± install(TARGETS â€¦ EXPORT XXX) æ”¶é›†å½¢æˆï¼›<br>3ï¸âƒ£ æœ€ç»ˆå†™å…¥ Config æ–‡ä»¶ï¼›<br>4ï¸âƒ£ å‘½åç©ºé—´åªæ˜¯ä¸€ç§å‰ç¼€çº¦å®šï¼Œé€šå¸¸å’Œå·¥ç¨‹åä¸€è‡´ã€‚</p>
<hr>
<h1 id="ğŸ§©-ç¬¬å››ç« ï¼šfind-package-ç”¨æ³•å®ä¾‹"><a href="#ğŸ§©-ç¬¬å››ç« ï¼šfind-package-ç”¨æ³•å®ä¾‹" class="headerlink" title="ğŸ§© ç¬¬å››ç« ï¼šfind_package ç”¨æ³•å®ä¾‹"></a>ğŸ§© ç¬¬å››ç« ï¼šfind_package ç”¨æ³•å®ä¾‹</h1><hr>
<h2 id="âœ…-æŸ¥æ‰¾ç³»ç»Ÿåº“"><a href="#âœ…-æŸ¥æ‰¾ç³»ç»Ÿåº“" class="headerlink" title="âœ… æŸ¥æ‰¾ç³»ç»Ÿåº“"></a>âœ… æŸ¥æ‰¾ç³»ç»Ÿåº“</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;OpenCV_INCLUDE_DIRS&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(App PRIVATE <span class="variable">$&#123;OpenCV_LIBS&#125;</span>)</span><br></pre></td></tr></table></figure>

<p>è§£é‡Šï¼š</p>
<ul>
<li>æ—§å†™æ³•ï¼ˆå…¼å®¹éç°ä»£å¯¼å‡ºåº“ï¼‰ï¼šä½¿ç”¨ <code>_INCLUDE_DIRS</code> <code>_LIBS</code> å˜é‡ï¼›</li>
<li>æ–°å†™æ³•ï¼š<code>target_link_libraries(App PRIVATE OpenCV::core)</code> ï¼Œè¿™ç§ä¾èµ–æŸ¥æ‰¾ <strong>éœ€è¦ OpenCV è‡ªèº«æä¾›å¯¼å‡ºçš„ CMake é…ç½®æ–‡ä»¶</strong>ã€‚</li>
</ul>
<hr>
<h2 id="âœ…-è‡ªå®šä¹‰-FindXXX-cmake"><a href="#âœ…-è‡ªå®šä¹‰-FindXXX-cmake" class="headerlink" title="âœ… è‡ªå®šä¹‰ FindXXX.cmake"></a>âœ… è‡ªå®šä¹‰ FindXXX.cmake</h2><p>è‹¥åº“æœªæä¾›Configï¼Œå¯è‡ªå·±å†™ <code>FindXxx.cmake</code> å¹¶æ”¾å…¥ <code>cmake/Modules/</code>ã€‚</p>
<p>è·¯å¾„æŸ¥æ‰¾ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(OpenCV_DIR <span class="string">&quot;/opt/opencv/lib/cmake/opencv4&quot;</span>)</span><br><span class="line"><span class="keyword">find_package</span>(OpenCV REQUIRED)</span><br></pre></td></tr></table></figure>

<p>è¿™æ · cmake ä¼šå»é‚£ä¸ªè·¯å¾„ä¸‹æ‰¾ <code>OpenCVConfig.cmake</code>ã€‚</p>
<hr>
<h1 id="ğŸ› ï¸-ç¬¬äº”ç« ï¼šoption-é…ç½®åŠ-if-æ¡ä»¶ç”¨æ³•"><a href="#ğŸ› ï¸-ç¬¬äº”ç« ï¼šoption-é…ç½®åŠ-if-æ¡ä»¶ç”¨æ³•" class="headerlink" title="ğŸ› ï¸ ç¬¬äº”ç« ï¼šoption&#x2F;é…ç½®åŠ if æ¡ä»¶ç”¨æ³•"></a>ğŸ› ï¸ ç¬¬äº”ç« ï¼šoption&#x2F;é…ç½®åŠ if æ¡ä»¶ç”¨æ³•</h1><hr>
<h2 id="âš™ï¸-å®šä¹‰å¼€å…³"><a href="#âš™ï¸-å®šä¹‰å¼€å…³" class="headerlink" title="âš™ï¸ å®šä¹‰å¼€å…³"></a>âš™ï¸ å®šä¹‰å¼€å…³</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">option</span>(BUILD_SHARED_LIBS <span class="string">&quot;Build shared libraries&quot;</span> <span class="keyword">ON</span>)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šå‡ºç°åœ¨ CMake GUI &#x2F; cacheï¼Œå¯åœ¨å‘½ä»¤è¡Œä¿®æ”¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -DBUILD_SHARED_LIBS=OFF ..</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿå†…ç½®çš„å¸¸è§ optionï¼š</p>
<table>
<thead>
<tr>
<th>å˜é‡</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td><code>CMAKE_BUILD_TYPE</code></td>
<td>æŒ‡å®š Debug&#x2F;Release</td>
</tr>
<tr>
<td><code>CMAKE_VERBOSE_MAKEFILE</code></td>
<td>æ‰“å°æ„å»ºè¯¦ç»†å‘½ä»¤</td>
</tr>
<tr>
<td><code>BUILD_SHARED_LIBS</code></td>
<td>æ§åˆ¶é»˜è®¤åº“ç±»å‹</td>
</tr>
<tr>
<td><code>CMAKE_INSTALL_PREFIX</code></td>
<td>å®‰è£…å‰ç¼€</td>
</tr>
</tbody></table>
<hr>
<h1 id="ğŸ”§-ç¬¬å…­ç« ï¼šfile-å‘½ä»¤è¯¦è§£ï¼ˆGLOBç­‰ï¼‰"><a href="#ğŸ”§-ç¬¬å…­ç« ï¼šfile-å‘½ä»¤è¯¦è§£ï¼ˆGLOBç­‰ï¼‰" class="headerlink" title="ğŸ”§ ç¬¬å…­ç« ï¼šfile() å‘½ä»¤è¯¦è§£ï¼ˆGLOBç­‰ï¼‰"></a>ğŸ”§ ç¬¬å…­ç« ï¼šfile() å‘½ä»¤è¯¦è§£ï¼ˆGLOBç­‰ï¼‰</h1><hr>
<h2 id="ğŸ“‚-file-GLOB-â€¦-æŒ‡ä»¤"><a href="#ğŸ“‚-file-GLOB-â€¦-æŒ‡ä»¤" class="headerlink" title="ğŸ“‚ file(GLOB â€¦) æŒ‡ä»¤"></a>ğŸ“‚ file(GLOB â€¦) æŒ‡ä»¤</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">file</span>(GLOB SRC_FILES <span class="string">&quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/*.cpp&quot;</span>)</span><br><span class="line"><span class="keyword">add_library</span>(MyLib <span class="variable">$&#123;SRC_FILES&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>GLOB ç”¨äºé€šé…ç¬¦æ”¶é›†æ–‡ä»¶ï¼›</li>
<li>ä¸ä¼šè‡ªåŠ¨æ£€æµ‹æ–°å¢æ–‡ä»¶ï¼›</li>
<li>é€šå¸¸ä¸å»ºè®®ç”¨åœ¨æ­£å¼é¡¹ç›®ï¼ˆå› ä¸ºæ–°å¢æºæ–‡ä»¶åä¸ä¼šè§¦å‘é‡æ–°é…ç½®ï¼‰ï¼›</li>
<li>æ¨è<strong>æ˜¾å¼åˆ—å‡ºæºç æ–‡ä»¶</strong>ã€‚</li>
</ul>
<p>è¿˜å¯ç”¨ï¼š</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">file</span>(<span class="keyword">MAKE_DIRECTORY</span> build/output)     <span class="comment"># åˆ›å»ºç›®å½•</span></span><br><span class="line"><span class="keyword">file</span>(<span class="keyword">REMOVE</span> old.txt)                  <span class="comment"># åˆ é™¤</span></span><br><span class="line"><span class="keyword">file</span>(READ path OUTPUT)                <span class="comment"># è¯»æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">file</span>(WRITE path <span class="string">&quot;content&quot;</span>)            <span class="comment"># å†™æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ğŸš€-ç¬¬ä¸ƒç« ï¼šCMake-CLI-å…¨åŠŸèƒ½è¡¨ï¼ˆå¸¦ä¾‹å­ï¼‰"><a href="#ğŸš€-ç¬¬ä¸ƒç« ï¼šCMake-CLI-å…¨åŠŸèƒ½è¡¨ï¼ˆå¸¦ä¾‹å­ï¼‰" class="headerlink" title="ğŸš€ ç¬¬ä¸ƒç« ï¼šCMake CLI å…¨åŠŸèƒ½è¡¨ï¼ˆå¸¦ä¾‹å­ï¼‰"></a>ğŸš€ ç¬¬ä¸ƒç« ï¼šCMake CLI å…¨åŠŸèƒ½è¡¨ï¼ˆå¸¦ä¾‹å­ï¼‰</h1><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>å«ä¹‰</th>
<th>ä¾‹å­</th>
</tr>
</thead>
<tbody><tr>
<td><code>cmake -S &lt;src&gt; -B &lt;build&gt;</code></td>
<td>æŒ‡å®šæºç ä¸æ„å»ºç›®å½•</td>
<td><code>cmake -S . -B build</code></td>
</tr>
<tr>
<td><code>cmake --build &lt;dir&gt; --target &lt;t&gt;</code></td>
<td>æ„å»ºç›®æ ‡</td>
<td><code>cmake --build build --target App</code></td>
</tr>
<tr>
<td><code>cmake --install &lt;dir&gt; --prefix &lt;path&gt;</code></td>
<td>æ‰§è¡Œ install é˜¶æ®µ</td>
<td><code>cmake --install build --prefix ./release</code></td>
</tr>
<tr>
<td><code>ctest</code></td>
<td>è¿è¡Œæµ‹è¯•</td>
<td><code>ctest --output-on-failure</code></td>
</tr>
<tr>
<td><code>cpack</code></td>
<td>æ‰“åŒ…(ä½¿ç”¨CPacké…ç½®)</td>
<td><code>cpack -G TGZ -C Release</code></td>
</tr>
<tr>
<td><code>cmake -DVAR=value</code></td>
<td>å®šä¹‰å˜é‡</td>
<td><code>cmake -DBUILD_TESTS=ON ..</code></td>
</tr>
<tr>
<td><code>cmake -G &quot;Ninja&quot;</code></td>
<td>æŒ‡å®šç”Ÿæˆå™¨</td>
<td><code>cmake -G &quot;Unix Makefiles&quot;</code></td>
</tr>
</tbody></table>
<hr>
<h1 id="ğŸ§±-ç¬¬å…«ç« ï¼šå®Œæ•´å·¥ç¨‹åŒ–æ¨¡æ¿é€è¡Œæ³¨é‡Šç‰ˆï¼ˆå¼ºåŒ–ç†è§£ï¼‰"><a href="#ğŸ§±-ç¬¬å…«ç« ï¼šå®Œæ•´å·¥ç¨‹åŒ–æ¨¡æ¿é€è¡Œæ³¨é‡Šç‰ˆï¼ˆå¼ºåŒ–ç†è§£ï¼‰" class="headerlink" title="ğŸ§± ç¬¬å…«ç« ï¼šå®Œæ•´å·¥ç¨‹åŒ–æ¨¡æ¿é€è¡Œæ³¨é‡Šç‰ˆï¼ˆå¼ºåŒ–ç†è§£ï¼‰"></a>ğŸ§± ç¬¬å…«ç« ï¼šå®Œæ•´å·¥ç¨‹åŒ–æ¨¡æ¿é€è¡Œæ³¨é‡Šç‰ˆï¼ˆå¼ºåŒ–ç†è§£ï¼‰</h1><p>ç›®å½•ç»“æ„ï¼ˆå¸¦ç¬¬ä¸‰æ–¹ã€å¯¼å‡ºå®ã€pimplï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">MyProject/</span><br><span class="line">â”œâ”€ Core/</span><br><span class="line">â”‚  â”œâ”€ core.h core.cpp</span><br><span class="line">â”‚  â”œâ”€ core_export.h</span><br><span class="line">â”‚  â””â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€ Net/</span><br><span class="line">â”‚  â”œâ”€ net.h/net.cpp/net_export.h</span><br><span class="line">â”‚  â””â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€ App/</span><br><span class="line">â”‚  â”œâ”€ main.cpp</span><br><span class="line">â”‚  â””â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€ include/        # ç»Ÿä¸€å®‰è£…å¤´</span><br><span class="line">â”œâ”€ cmake/</span><br><span class="line">â”‚  â””â”€ FindFMT.cmake</span><br><span class="line">â””â”€ CMakeLists.txt</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-é¡¶å±‚-CMakeLists-txtï¼ˆè®²è§£ç‰ˆï¼‰"><a href="#ğŸ”¹-é¡¶å±‚-CMakeLists-txtï¼ˆè®²è§£ç‰ˆï¼‰" class="headerlink" title="ğŸ”¹ é¡¶å±‚ CMakeLists.txtï¼ˆè®²è§£ç‰ˆï¼‰"></a>ğŸ”¹ é¡¶å±‚ CMakeLists.txtï¼ˆè®²è§£ç‰ˆï¼‰</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.20</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject VERSION <span class="number">1.0</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_RUNTIME_OUTPUT_DIRECTORY <span class="variable">$&#123;CMAKE_SOURCE_DIR&#125;</span>/bin)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å…¨å±€å®‰è£…è·¯å¾„</span></span><br><span class="line"><span class="keyword">include</span>(GNUInstallDirs)  <span class="comment"># æä¾› $&#123;CMAKE_INSTALL_LIBDIR&#125;, $&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¾èµ–ç¬¬ä¸‰æ–¹ Header-only åº“ fmt</span></span><br><span class="line"><span class="keyword">find_package</span>(fmt REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_subdirectory</span>(Core)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(Net)</span><br><span class="line"><span class="keyword">add_subdirectory</span>(App)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¼å‡ºæ‰€æœ‰ç›®æ ‡æè¿°æ–‡ä»¶ï¼ˆä¸º SDK ä½¿ç”¨åšå‡†å¤‡ï¼‰</span></span><br><span class="line"><span class="keyword">install</span>(<span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">    <span class="keyword">FILE</span> MyProjectConfig.cmake</span><br><span class="line">    NAMESPACE MyProject::</span><br><span class="line">    DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span>/cmake/MyProject)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-Core-æ¨¡å—"><a href="#ğŸ”¹-Core-æ¨¡å—" class="headerlink" title="ğŸ”¹ Core æ¨¡å—"></a>ğŸ”¹ Core æ¨¡å—</h2><p><strong>core_export.h</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(_WIN32)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">if</span> defined(CORE_EXPORTS)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> CORE_API __declspec(dllexport)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> CORE_API __declspec(dllimport)</span></span><br><span class="line">  <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="meta">#<span class="keyword">define</span> CORE_API</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p><strong>core.h &#x2F; core.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core_export.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CORE_API</span> Core &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">Core</span>();</span><br><span class="line">  ~<span class="built_in">Core</span>();</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">hello</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Impl</span>;</span><br><span class="line">  std::unique_ptr&lt;Impl&gt; pImpl; <span class="comment">// Pimpléš”ç¦»ABI</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>core.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Core</span>::Impl &#123; <span class="function"><span class="type">void</span> <span class="title">say</span><span class="params">()</span></span>&#123; std::cout&lt;&lt;<span class="string">&quot;Hello Core\n&quot;</span>; &#125; &#125;;</span><br><span class="line">Core::<span class="built_in">Core</span>() : <span class="built_in">pImpl</span>(std::<span class="built_in">make_unique</span>&lt;Impl&gt;()) &#123;&#125;</span><br><span class="line">Core::~<span class="built_in">Core</span>() = <span class="keyword">default</span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Core::hello</span><span class="params">()</span> <span class="type">const</span> </span>&#123; pImpl-&gt;<span class="built_in">say</span>(); &#125;</span><br></pre></td></tr></table></figure>

<p><strong>CMakeLists.txt</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Core SHARED core.cpp)</span><br><span class="line"><span class="keyword">target_include_directories</span>(Core PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">target_compile_definitions</span>(Core PRIVATE CORE_EXPORTS)</span><br><span class="line"><span class="keyword">install</span>(TARGETS Core <span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  LIBRARY DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">  ARCHIVE DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">  PUBLIC_HEADER DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span>/Core)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-Net-æ¨¡å—ç¤ºä¾‹ï¼ˆä¾èµ–-Core-fmtï¼‰"><a href="#ğŸ”¹-Net-æ¨¡å—ç¤ºä¾‹ï¼ˆä¾èµ–-Core-fmtï¼‰" class="headerlink" title="ğŸ”¹ Net æ¨¡å—ç¤ºä¾‹ï¼ˆä¾èµ– Core + fmtï¼‰"></a>ğŸ”¹ Net æ¨¡å—ç¤ºä¾‹ï¼ˆä¾èµ– Core + fmtï¼‰</h2><p><strong>CMakeLists.txt</strong></p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_library</span>(Net SHARED net.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(Net PUBLIC Core fmt::fmt)</span><br><span class="line"><span class="keyword">target_include_directories</span>(Net PUBLIC <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>)</span><br><span class="line"><span class="keyword">target_compile_definitions</span>(Net PRIVATE NET_EXPORTS)</span><br><span class="line"><span class="keyword">install</span>(TARGETS Net <span class="keyword">EXPORT</span> MyProjectTargets</span><br><span class="line">  LIBRARY DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_LIBDIR&#125;</span></span><br><span class="line">  PUBLIC_HEADER DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_INCLUDEDIR&#125;</span>/Net)</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>net.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;net.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fmt/core.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Net::connect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  fmt::<span class="built_in">print</span>(<span class="string">&quot;Net connecting...\n&quot;</span>);</span><br><span class="line">  Core core;</span><br><span class="line">  core.<span class="built_in">hello</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="ğŸ”¹-App-æ¨¡å—"><a href="#ğŸ”¹-App-æ¨¡å—" class="headerlink" title="ğŸ”¹ App æ¨¡å—"></a>ğŸ”¹ App æ¨¡å—</h2><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="keyword">add_executable</span>(App main.cpp)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(App PRIVATE Core Net)</span><br><span class="line"><span class="keyword">install</span>(TARGETS App RUNTIME DESTINATION <span class="variable">$&#123;CMAKE_INSTALL_BINDIR&#125;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>main.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;net.h&quot;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123; Net net; net.<span class="built_in">connect</span>(); &#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>âœ… ç¼–è¯‘æµç¨‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake -S . -B build</span><br><span class="line">cmake --build build</span><br><span class="line">cmake --install build --prefix ./install</span><br></pre></td></tr></table></figure>

<p>å®‰è£…äº§ç‰©ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">install/</span><br><span class="line">â”œâ”€ bin/App</span><br><span class="line">â”œâ”€ lib/libCore.so</span><br><span class="line">â”œâ”€ lib/libNet.so</span><br><span class="line">â”œâ”€ include/Core/core.h</span><br><span class="line">â”œâ”€ include/Net/net.h</span><br><span class="line">â””â”€ lib/cmake/MyProject/MyProjectConfig.cmake</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="ğŸ-å°ç»“"><a href="#ğŸ-å°ç»“" class="headerlink" title="ğŸ å°ç»“"></a>ğŸ å°ç»“</h1><p>è¿™ä¸€å¥—ç°åœ¨äº¤ä»£æ¸…æ¥šäº†ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>GLOB å¹²ä»€ä¹ˆ</td>
<td>é€šé…æ–‡ä»¶åï¼Œä¸å»ºè®®å¸¸ç”¨</td>
</tr>
<tr>
<td>TARGETS æ˜¯å•¥</td>
<td>add_library&#x2F;add_executable åˆ›å»ºçš„ç›®æ ‡</td>
</tr>
<tr>
<td>MyProjTargets ä»å“ªæ¥</td>
<td>ä½ éšä¾¿å‘½åçš„å¯¼å‡ºæ¸…å•åï¼Œinstall æ—¶ç”Ÿæˆ Config</td>
</tr>
<tr>
<td>OpenCV::OpenCV vs ${OpenCV_LIBS}</td>
<td>å‰è€…æ˜¯ç°ä»£ target å†™æ³•ï¼Œåè€…æ—§å¼å˜é‡å†™æ³•</td>
</tr>
<tr>
<td>option æ˜¯ CMake å†…ç½®ï¼Œå¯è‡ªå®šä¹‰æ›´å¤š</td>
<td><code>option(NAME DESC DEFAULT)</code></td>
</tr>
<tr>
<td>install&#x2F;namespace çš„æ„ä¹‰</td>
<td>ç”¨äºç”Ÿæˆä¾›å¤–éƒ¨ find_package çš„ SDK</td>
</tr>
<tr>
<td>include è·¯å¾„æ²¡è§ï¼Ÿ</td>
<td>é€šè¿‡ target_include_directories å…¬å¸ƒè·¯å¾„</td>
</tr>
<tr>
<td>æ¨¡å—å¯¼å‡ºå®ï¼Ÿ</td>
<td>å·²å±•ç¤º core_export.h å†™æ³•</td>
</tr>
<tr>
<td>ABI å…¼å®¹ï¼Ÿ</td>
<td>é‡‡ç”¨ pimpl å·²å®ç°</td>
</tr>
<tr>
<td>SDK å¼•ç”¨ï¼Ÿ</td>
<td>find_package(MyProject REQUIRED) å link MyProject::Core</td>
</tr>
</tbody></table>
<hr>
]]></content>
  </entry>
  <entry>
    <title>PlantUML cheatsheet</title>
    <url>/PlantUML-cheatsheet/</url>
    <content><![CDATA[<span id="more"></span>
<h3 id="PlantUML-è¯­æ³•è¯´æ˜ï¼ˆè¯­æ³•-ç¤ºä¾‹-è¯´æ˜-åœé¡¿-é£é™©ï¼‰"><a href="#PlantUML-è¯­æ³•è¯´æ˜ï¼ˆè¯­æ³•-ç¤ºä¾‹-è¯´æ˜-åœé¡¿-é£é™©ï¼‰" class="headerlink" title="PlantUML è¯­æ³•è¯´æ˜ï¼ˆè¯­æ³• + ç¤ºä¾‹ + è¯´æ˜ + åœé¡¿&#x2F;é£é™©ï¼‰"></a>PlantUML è¯­æ³•è¯´æ˜ï¼ˆè¯­æ³• + ç¤ºä¾‹ + è¯´æ˜ + åœé¡¿&#x2F;é£é™©ï¼‰</h3><hr>
<h3 id="åŸºç¡€å¯åŠ¨ä¸é€€å‡º"><a href="#åŸºç¡€å¯åŠ¨ä¸é€€å‡º" class="headerlink" title="åŸºç¡€å¯åŠ¨ä¸é€€å‡º"></a>åŸºç¡€å¯åŠ¨ä¸é€€å‡º</h3><ul>
<li><p>è¯­æ³•<br>@startuml â€¦ @enduml</p>
</li>
<li><p>ç¤ºä¾‹<br>@startuml<br>Alice -&gt; Bob: hello<br>@enduml</p>
</li>
<li><p>è¯´æ˜<br>å®šç•Œä¸€ä¸ª PlantUML å›¾å—ï¼Œæ¸²æŸ“å·¥å…·ä¼šè¯†åˆ« @startuml åˆ° @enduml ä¹‹é—´çš„å†…å®¹å¹¶ç”Ÿæˆå›¾åƒã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¿˜è®°é—­åˆ @enduml ä¼šå¯¼è‡´æ¸²æŸ“å¤±è´¥æˆ–è¶…æ—¶ï¼›åœ¨æ‰¹é‡æ¸²æŸ“è„šæœ¬ä¸­åŠ¡å¿…æ ¡éªŒæ¯ä¸ªæ–‡ä»¶å®Œæ•´æ€§ã€‚</p>
</li>
<li><p>è¯­æ³•ï¼ˆæ–‡ä»¶åŒ…å«ï¼‰<br>!include <file></p>
</li>
<li><p>ç¤ºä¾‹<br>!include common&#x2F;colors.puml</p>
</li>
<li><p>è¯´æ˜<br>å°†å¤–éƒ¨ puml æ–‡ä»¶æˆ–åº“åŒ…å«è¿›å½“å‰å›¾ï¼Œç”¨äºå¤ç”¨æ ·å¼&#x2F;å®ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>åŒ…å«ä¸å­˜åœ¨æ–‡ä»¶ä¼šæŠ¥é”™ï¼›ç›¸å¯¹è·¯å¾„åœ¨æ¸²æŸ“ç¯å¢ƒä¸­å¯èƒ½ä¸åŒï¼ŒCI&#x2F;å·¥å…·é“¾ä¸­éœ€ä½¿ç”¨ç»å¯¹æˆ–ä¸€è‡´çš„ç›¸å¯¹è·¯å¾„ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å›¾ç±»å‹ä¸å¯åŠ¨æ¨¡æ¿ï¼ˆå¿«é€Ÿç´¢å¼•ï¼‰"><a href="#å›¾ç±»å‹ä¸å¯åŠ¨æ¨¡æ¿ï¼ˆå¿«é€Ÿç´¢å¼•ï¼‰" class="headerlink" title="å›¾ç±»å‹ä¸å¯åŠ¨æ¨¡æ¿ï¼ˆå¿«é€Ÿç´¢å¼•ï¼‰"></a>å›¾ç±»å‹ä¸å¯åŠ¨æ¨¡æ¿ï¼ˆå¿«é€Ÿç´¢å¼•ï¼‰</h3><ul>
<li><p>Sequenceï¼ˆæ—¶åºå›¾ï¼‰<br>è¯­æ³•<br>participant A; participant B; A -&gt; B: msg<br>ç¤ºä¾‹<br>@startuml<br>Alice -&gt; Bob: Hello<br>@enduml<br>è¯´æ˜<br>æè¿°æ¶ˆæ¯æµä¸äº¤äº’é¡ºåºã€‚<br>åœé¡¿&#x2F;é£é™©<br>å¤§é‡æ¶ˆæ¯ä¼šé€ æˆå›¾åƒæ‹¥æŒ¤ï¼Œå¿…è¦æ—¶åˆ†ç‰‡æˆ–ç”¨ note&#x2F;alt åˆ†æ”¯ç®€åŒ–ã€‚</p>
</li>
<li><p>Classï¼ˆç±»å›¾ï¼‰<br>è¯­æ³•<br>class Name { +field; -method() }<br>ç¤ºä¾‹<br>@startuml<br>class User {<br>  +id: int<br>  +login()<br>}<br>@enduml<br>è¯´æ˜<br>å®šä¹‰ç±»ã€å±æ€§ä¸æ–¹æ³•ï¼Œæ”¯æŒç»§æ‰¿ã€æ¥å£ã€ç»„åˆå…³ç³»ã€‚<br>åœé¡¿&#x2F;é£é™©<br>è¿‡åº¦ç»†åŒ–å±æ€§&#x2F;æ–¹æ³•ä¼šä½¿ç±»å›¾éš¾è¯»ï¼ŒæŒ‰å…³æ³¨ç‚¹æŠ½è±¡å³å¯ã€‚</p>
</li>
<li><p>Activityï¼ˆæ´»åŠ¨å›¾ï¼‰<br>è¯­æ³•<br>start; :action; if (cond) then (yes) :do; else (no) :skip; endif; stop<br>ç¤ºä¾‹<br>@startuml<br>start<br>:initialize;<br>if (ok?) then (yes)<br>  :process;<br>else (no)<br>  :abort;<br>endif<br>stop<br>@enduml<br>è¯´æ˜<br>æè¿°æµç¨‹æ§åˆ¶ã€åˆ†æ”¯ä¸å¹¶è¡Œï¼ˆfork&#x2F;mergeï¼‰ã€‚<br>åœé¡¿&#x2F;é£é™©<br>å¹¶è¡Œåˆ†æ”¯ï¼ˆfork&#x2F;mergeï¼‰æ»¥ç”¨ä¼šå¤æ‚åŒ–è§†å›¾ï¼Œéœ€æ ‡æ³¨åŒæ­¥ç‚¹ã€‚</p>
</li>
<li><p>Stateï¼ˆçŠ¶æ€å›¾ï¼‰<br>è¯­æ³•<br>[<em>] â€“&gt; State; State â€“&gt; AnotherState : event<br>ç¤ºä¾‹<br>@startuml<br>[</em>] â€“&gt; Idle<br>Idle â€“&gt; Running : start<br>Running â€“&gt; Idle : stop<br>@enduml<br>è¯´æ˜<br>è¡¨ç¤ºå®ä½“ç”Ÿå‘½å‘¨æœŸä¸äº‹ä»¶è§¦å‘çš„çŠ¶æ€å˜è¿ã€‚<br>åœé¡¿&#x2F;é£é™©<br>çŠ¶æ€è¿‡å¤šè¦åˆ†å±‚ï¼ˆstate insideï¼‰ä»¥ä¿æŒå¯è¯»æ€§ã€‚</p>
</li>
<li><p>Component &#x2F; Deploymentï¼ˆç»„ä»¶ä¸éƒ¨ç½²ï¼‰<br>è¯­æ³•<br>component A; node N; A -[#]-&gt; B;<br>ç¤ºä¾‹<br>@startuml<br>node â€œServerâ€ {<br>  component WebApp<br>}<br>component Database<br>WebApp â€“&gt; Database : JDBC<br>@enduml<br>è¯´æ˜<br>å±•ç¤ºç³»ç»Ÿç»„ä»¶ã€ç½‘ç»œä¸éƒ¨ç½²ä½ç½®ã€‚<br>åœé¡¿&#x2F;é£é™©<br>éƒ¨ç½²å›¾å«ç¯å¢ƒä¿¡æ¯å¯èƒ½æ³„éœ²æ•æ„Ÿæ¶æ„ï¼Œå‘å¸ƒå‰å®¡æŸ¥ã€‚</p>
</li>
<li><p>Usecaseï¼ˆç”¨ä¾‹å›¾ï¼‰<br>è¯­æ³•<br>actor User; usecase â€œLoginâ€ as UC1; User â€“&gt; UC1<br>ç¤ºä¾‹<br>@startuml<br>actor Customer<br>Customer â€“&gt; (Place order)<br>@enduml<br>è¯´æ˜<br>é«˜å±‚æ¬¡ç”¨æˆ·ä¸ç³»ç»ŸåŠŸèƒ½æ˜ å°„ã€‚<br>åœé¡¿&#x2F;é£é™©<br>ç”¨ä¾‹å›¾ä¸é€‚åˆå±•ç¤ºå®ç°ç»†èŠ‚ï¼Œé¿å…æ··ç”¨ç±»å›¾è¯­ä¹‰ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å…ƒç´ è¯­æ³•ä¸å…³ç³»ï¼ˆå¸¸ç”¨é€ŸæŸ¥ï¼‰"><a href="#å…ƒç´ è¯­æ³•ä¸å…³ç³»ï¼ˆå¸¸ç”¨é€ŸæŸ¥ï¼‰" class="headerlink" title="å…ƒç´ è¯­æ³•ä¸å…³ç³»ï¼ˆå¸¸ç”¨é€ŸæŸ¥ï¼‰"></a>å…ƒç´ è¯­æ³•ä¸å…³ç³»ï¼ˆå¸¸ç”¨é€ŸæŸ¥ï¼‰</h3><ul>
<li><p>å…ƒç´ å®šä¹‰ï¼ˆå‚ä¸è€… &#x2F; å¯¹è±¡ï¼‰<br>è¯­æ³•<br>participant Name; actor Name; object Name; boundary Name<br>ç¤ºä¾‹<br>participant Service</p>
</li>
<li><p>è¯´æ˜<br>ä¸åŒå…³é”®å­—å½±å“å›¾è¯­ä¹‰ä¸æ ·å¼ï¼ˆactor å¸¸å¸¦äººå½¢å›¾æ ‡ï¼‰ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>åç§°å«ç©ºæ ¼æ—¶ç”¨å¼•å·æˆ–åˆ«åï¼›é‡å¤å®šä¹‰ä¼šè¢«åˆå¹¶æˆ–è¦†ç›–ã€‚</p>
</li>
<li><p>å…³ç³»ç®­å¤´ï¼ˆæ–¹å‘ã€ç±»å‹ã€æ–‡æœ¬ï¼‰<br>è¯­æ³•<br>A -&gt; B : msg ; A &lt;â€“ B ; A -[#color]-&gt; B ; A ..&gt; B : note<br>ç¤ºä¾‹<br>A â€“&gt; B : request</p>
</li>
<li><p>è¯´æ˜<br>ç®­å¤´å¯è¡¨ç¤ºåŒæ­¥&#x2F;å¼‚æ­¥è°ƒç”¨ã€ä¾èµ–ã€æ³›åŒ–ï¼ˆâ€“|&gt;ï¼‰ç­‰ï¼›å¯åŠ é¢œè‰²ä¸æ ·å¼ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¤æ‚ç®­å¤´åµŒå¥—ä¼šå½±å“å¸ƒå±€ï¼Œå¿…è¦æ—¶æ‹†å›¾æˆ–ä½¿ç”¨ left&#x2F;right æŒ‡ä»¤å¾®è°ƒã€‚</p>
</li>
<li><p>ç»§æ‰¿ &#x2F; å®ç° &#x2F; å…³è”<br>è¯­æ³•<br>Child â€“|&gt; Parent; Impl ..|&gt; Interface</p>
</li>
<li><p>ç¤ºä¾‹<br>Dog â€“|&gt; Animal</p>
</li>
<li><p>è¯´æ˜<br>ä½¿ç”¨ UML æ ‡å‡†ç®­å¤´è¡¨ç¤ºç±»ä¹‹é—´çš„ç»§æ‰¿æˆ–å®ç°å…³ç³»ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>è¯¯ç”¨ç®­å¤´æ–¹å‘ä¼šå¯¼è‡´è¯­ä¹‰åè½¬ï¼Œä¿æŒä¸€è‡´çš„æ–¹å‘çº¦å®šã€‚</p>
</li>
<li><p>æ³¨é‡Šä¸è¯´æ˜ï¼ˆnoteï¼‰<br>è¯­æ³•<br>note left of A : text ; note right of A ; note as N: text</p>
</li>
<li><p>ç¤ºä¾‹<br>A -&gt; B : call<br>note right of B : validate input</p>
</li>
<li><p>è¯´æ˜<br>ç”¨äºè¡¥å……è¯´æ˜ã€æ³¨é‡Šæˆ–æŠ˜å å¤æ‚é€»è¾‘ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¤ªå¤š note ä¼šé®æŒ¡å…ƒç´ ï¼Œä¼˜å…ˆç”¨å¤–éƒ¨æ–‡æ¡£é“¾æ¥æˆ–å›¾ä¾‹ã€‚</p>
</li>
</ul>
<hr>
<h3 id="æ ·å¼ã€å¸ƒå±€ä¸é…ç½®"><a href="#æ ·å¼ã€å¸ƒå±€ä¸é…ç½®" class="headerlink" title="æ ·å¼ã€å¸ƒå±€ä¸é…ç½®"></a>æ ·å¼ã€å¸ƒå±€ä¸é…ç½®</h3><ul>
<li><p>å…¨å±€çš®è‚¤å‚æ•°ï¼ˆskinparamï¼‰<br>è¯­æ³•<br>skinparam Parameter Value</p>
</li>
<li><p>ç¤ºä¾‹<br>skinparam backgroundColor #F8F8F8<br>skinparam classFontSize 12</p>
</li>
<li><p>è¯´æ˜<br>æ§åˆ¶é¢œè‰²ã€å­—ä½“ã€è¾¹è·ã€èŠ‚ç‚¹åœ†è§’ç­‰å…¨å±€å¤–è§‚ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>ä¸åŒæ¸²æŸ“å™¨æˆ–ç‰ˆæœ¬å¯¹å‚æ•°æ”¯æŒä¸ä¸€è‡´ï¼›åœ¨å›¢é˜Ÿä¸­å›ºå®šä¸€å¥—æ ·å¼æ–‡ä»¶é¿å…å·®å¼‚ã€‚</p>
</li>
<li><p>ä¸»é¢˜ä¸æ ·å¼è¡¨ï¼ˆ!theme &#x2F; skinparam includeï¼‰<br>è¯­æ³•<br>!include &lt;theme.puml&gt;</p>
</li>
<li><p>ç¤ºä¾‹<br>!include <a href="https://raw.githubusercontent.com/xxx/theme.puml">https://raw.githubusercontent.com/xxx/theme.puml</a></p>
</li>
<li><p>è¯´æ˜<br>ä½¿ç”¨å…±äº«ä¸»é¢˜ç¡®ä¿è·¨å›¾ä¸€è‡´æ€§ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>è¿œç¨‹åŒ…å«ä¾èµ–ç½‘ç»œï¼ŒCI ç¯å¢ƒä¸­åº”ç¼“å­˜æˆ– vendor æœ¬åœ°å‰¯æœ¬ã€‚</p>
</li>
<li><p>åˆ†ç»„ä¸åŒ…ï¼ˆpackage &#x2F; rectangleï¼‰<br>è¯­æ³•<br>package â€œNameâ€ { â€¦ } ; rectangle â€œboxâ€ { â€¦ }</p>
</li>
<li><p>ç¤ºä¾‹<br>package â€œAuthâ€ {<br>  class Login<br>  class Token<br>}</p>
</li>
<li><p>è¯´æ˜<br>ç”¨äºé€»è¾‘åˆ†ç»„ã€æ¨¡å—è¾¹ç•Œæˆ–å¯è§†åŒ–åˆ†ç®±ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>è¿‡æ·±åµŒå¥—å½±å“å¯è¯»æ€§ï¼›ä¼˜å…ˆæ‰å¹³åŒ–æˆ–æ‹†åˆ†å­å›¾ã€‚</p>
</li>
<li><p>å¸ƒå±€æ§åˆ¶ï¼ˆleft to right direction &#x2F; newpageï¼‰<br>è¯­æ³•<br>left to right direction ; top to bottom direction ; newpage</p>
</li>
<li><p>ç¤ºä¾‹<br>left to right direction</p>
</li>
<li><p>è¯´æ˜<br>å¼ºåˆ¶å›¾å…ƒç´ ä¸»è¦æ’åˆ—æ–¹å‘æˆ–åˆ†é¡µã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¸ƒå±€æŒ‡ä»¤å¯èƒ½è¢«å±€éƒ¨å…ƒç´ å¤§å°è¦†ç›–ï¼Œéœ€é…åˆç»„ä»¶åˆ†ç»„è°ƒæ•´ã€‚</p>
</li>
</ul>
<hr>
<h3 id="é«˜çº§åŠŸèƒ½ä¸è„šæœ¬åŒ–"><a href="#é«˜çº§åŠŸèƒ½ä¸è„šæœ¬åŒ–" class="headerlink" title="é«˜çº§åŠŸèƒ½ä¸è„šæœ¬åŒ–"></a>é«˜çº§åŠŸèƒ½ä¸è„šæœ¬åŒ–</h3><ul>
<li><p>æ¡ä»¶ &#x2F; åˆ†æ”¯ï¼ˆalt &#x2F; else &#x2F; endï¼‰â€”â€”æ—¶åºå›¾åˆ†æ”¯<br>è¯­æ³•<br>alt condition1<br>  A -&gt; B: x<br>else<br>  A -&gt; B: y<br>end</p>
</li>
<li><p>ç¤ºä¾‹<br>@startuml<br>Alice -&gt; Bob: request<br>alt success<br>  Bob -&gt; Alice: ok<br>else failure<br>  Bob -&gt; Alice: error<br>end<br>@enduml</p>
</li>
<li><p>è¯´æ˜<br>è¡¨ç¤ºåˆ†æ”¯è·¯å¾„æˆ–æ›¿ä»£æµç¨‹ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>åµŒå¥—å¤ªæ·±ä¼šå¯¼è‡´è§†è§‰å¤æ‚ï¼Œè€ƒè™‘åˆå¹¶æˆ–æ‹†å›¾ã€‚</p>
</li>
<li><p>å¾ªç¯ä¸é‡å¤ï¼ˆloopï¼‰<br>è¯­æ³•<br>loop description</p>
</li>
<li><p>ç¤ºä¾‹<br>loop every second<br>  A -&gt; B: tick<br>end</p>
</li>
<li><p>è¯´æ˜<br>è¡¨ç¤ºé‡å¤è¡Œä¸ºæˆ–å‘¨æœŸæ€§äº¤äº’ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>ç”¨äºæŠ½è±¡ï¼Œä¸è¦è¯•å›¾å±•ç¤ºçœŸå®æ— é™å¾ªç¯ç»†èŠ‚ã€‚</p>
</li>
<li><p>çš®è‚¤å‚æ•°æ¡ä»¶åŒ–&#x2F;å®ï¼ˆ!define &#x2F; !if &#x2F; !endifï¼‰<br>è¯­æ³•<br>!define NAME value<br>!if NAME<br>!endif</p>
</li>
<li><p>ç¤ºä¾‹<br>!define PROD<br>!if PROD<br>  skinparam backgroundColor #fff<br>!endif</p>
</li>
<li><p>è¯´æ˜<br>åœ¨ç”Ÿæˆæ—¶åˆ‡æ¢ä¸»é¢˜æˆ–å¯ç”¨é€‰é¡¹ï¼Œé€‚åˆ CI å¤šç¯å¢ƒæ¸²æŸ“ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å®æ‰©å±•é”™è¯¯ä¼šå¯¼è‡´è§£æå¤±è´¥ï¼Œå…ˆåœ¨æœ¬åœ°éªŒè¯ã€‚</p>
</li>
<li><p>å¸ƒå±€å¾®è°ƒï¼ˆ<backspace/> &#x2F; <size> &#x2F; orderï¼‰<br>è¯­æ³•ä¸ç¤ºä¾‹<br>ä½¿ç”¨ skinparam æˆ–éšè—æ ‡ç­¾è°ƒæ•´å…ƒç´ å°ºå¯¸ã€é¡ºåºæˆ–é—´è·ï¼ˆå…·ä½“å‚æ•°è§å®˜æ–¹æ–‡æ¡£ï¼‰ã€‚</p>
</li>
<li><p>è¯´æ˜<br>å¯¹å¤æ‚å›¾å¿…éœ€è¿›è¡Œå¾®è°ƒã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å„ç‰ˆæœ¬å¯¹å¾®è°ƒæ”¯æŒä¸åŒï¼Œç‰ˆæœ¬ä¸ä¸€è‡´ä¼šå¯¼è‡´å›¾åƒå·®å¼‚ã€‚</p>
</li>
<li><p>å¯¼å‡ºä¸å‘½ä»¤è¡Œæ¸²æŸ“<br>è¯­æ³•<br>plantuml -tsvg file.puml ; plantuml -tpng file.puml</p>
</li>
<li><p>ç¤ºä¾‹<br>plantuml -tsvg diagram.puml</p>
</li>
<li><p>è¯´æ˜<br>åœ¨ CI&#x2F;è„šæœ¬ä¸­å¸¸ç”¨å‘½ä»¤è¡Œç”Ÿæˆ PNG&#x2F;SVG&#x2F;PDFï¼Œæ”¯æŒå¹¶è¡Œæ¸²æŸ“ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¤§é‡å¹¶å‘æ¸²æŸ“å¯èƒ½è€—å°½å†…å­˜&#x2F;CPUï¼›åŠ é˜Ÿåˆ—æˆ–å¹¶å‘é™åˆ¶ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å¸¸ç”¨-aliasã€å¿«æ·ç»„åˆä¸é«˜å±å‘½ä»¤æ¸…å•ï¼ˆæ¨¡ä»¿-GDB-Cheat-Sheetï¼‰"><a href="#å¸¸ç”¨-aliasã€å¿«æ·ç»„åˆä¸é«˜å±å‘½ä»¤æ¸…å•ï¼ˆæ¨¡ä»¿-GDB-Cheat-Sheetï¼‰" class="headerlink" title="å¸¸ç”¨ aliasã€å¿«æ·ç»„åˆä¸é«˜å±å‘½ä»¤æ¸…å•ï¼ˆæ¨¡ä»¿ GDB Cheat Sheetï¼‰"></a>å¸¸ç”¨ aliasã€å¿«æ·ç»„åˆä¸é«˜å±å‘½ä»¤æ¸…å•ï¼ˆæ¨¡ä»¿ GDB Cheat Sheetï¼‰</h3><ul>
<li><p>å¸¸ç”¨å¿«æ·ç‰‡æ®µï¼ˆå¯æ”¾å…¥ .puml æˆ–æ¨¡æ¿ï¼‰  </p>
<ul>
<li>ç»„ä»¶æ¨¡æ¿<br>skinparam componentStyle rectangle</li>
<li>æ ‡å‡†é¡µçœ‰ä¸ç‰ˆæƒ<br>â€˜ Header: auto-generated</li>
<li>æ ‡æ³¨å›¾ä¾‹<br>legend left<br>  |&#x3D; Symbol |&#x3D; Meaning |<br>  | â€“&gt; | call |<br>endlegend</li>
</ul>
</li>
<li><p>è¯´æ˜<br>æŠŠå¸¸ç”¨ç‰‡æ®µæŠ½æˆ include æ–‡ä»¶ä¾¿äºå¤ç”¨ã€‚</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>æ¨¡æ¿å˜åŒ–ä¼šå½±å“å¤§é‡å›¾ï¼Œå˜æ›´éœ€å®¡æŸ¥ã€‚</p>
</li>
<li><p>é«˜å±æŒ‡ä»¤ï¼ˆéœ€è°¨æ…ï¼‰  </p>
<ul>
<li>!include æŒ‡å‘å¤–éƒ¨ URLï¼šä¾èµ–ç½‘ç»œå’Œç¬¬ä¸‰æ–¹ä»£ç ï¼Œå¯èƒ½å¸¦æ¥ä¸å—æ§å˜åŒ–æˆ–å®‰å…¨é£é™©ã€‚  </li>
<li>è¿‡åº¦å®å®šä¹‰ï¼ˆ!defineï¼‰ä¸æ¡ä»¶ç¼–è¯‘ï¼šå¢åŠ è°ƒè¯•å¤æ‚åº¦ä¸å¯ç»´æŠ¤æ€§é£é™©ã€‚  </li>
<li>ç»å¯¹è·¯å¾„ï¼ˆ!include &#x2F; skinparam æŒ‡å‘æœ¬åœ°ç»å¯¹è·¯å¾„ï¼‰ï¼šåœ¨è·¨æœºå™¨&#x2F;CI ä¸­å¤±æ•ˆã€‚  </li>
<li>å¤§å‹å•å›¾ï¼ˆæ•°åƒèŠ‚ç‚¹ï¼‰ï¼šä¼šå¯¼è‡´æ¸²æŸ“å¡æ­»æˆ–è¾“å‡ºå·¨å¤§æ–‡ä»¶ï¼Œå»ºè®®æ‹†å›¾æˆ–åˆ†å±‚å›¾ã€‚</li>
</ul>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>åœ¨ç”Ÿäº§æ–‡æ¡£ä¸­ä½¿ç”¨å¤–éƒ¨ include å‰æ‰§è¡Œå®‰å…¨ä¸ç‰ˆæœ¬å®¡è®¡ï¼›åœ¨ CI ä¸­é”å®šæ¨¡æ¿ç‰ˆæœ¬ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å­¦ä¹ ä¸å¿ƒæ³•é™„æ³¨ï¼ˆå¦‚ä½•é«˜æ•ˆä½¿ç”¨-PlantUMLï¼‰"><a href="#å­¦ä¹ ä¸å¿ƒæ³•é™„æ³¨ï¼ˆå¦‚ä½•é«˜æ•ˆä½¿ç”¨-PlantUMLï¼‰" class="headerlink" title="å­¦ä¹ ä¸å¿ƒæ³•é™„æ³¨ï¼ˆå¦‚ä½•é«˜æ•ˆä½¿ç”¨ PlantUMLï¼‰"></a>å­¦ä¹ ä¸å¿ƒæ³•é™„æ³¨ï¼ˆå¦‚ä½•é«˜æ•ˆä½¿ç”¨ PlantUMLï¼‰</h3><ul>
<li>å…ˆç”»å¤§ç»“æ„å†ç»†åŒ–ï¼šå…ˆç¡®è®¤å›¾çš„ç›®çš„ä¸å—ä¼—ï¼Œé¿å…æŠŠæ‰€æœ‰ç»†èŠ‚å¡è¿›ä¸€å¼ å›¾ã€‚  </li>
<li>æŠ½è±¡ä¼˜å…ˆäºç²¾ç¡®ï¼šè®¾è®¡äº¤ä»˜ç‰©æ˜¯æ²Ÿé€šå·¥å…·è€Œéç²¾ç¡®æ¨¡å‹ï¼Œä¿ç•™å¿…è¦ç»†èŠ‚ã€‚  </li>
<li>æ¨¡æ¿åŒ–ä¸å¤ç”¨ï¼šæŠŠçš®è‚¤å‚æ•°ã€å›¾ä¾‹ã€å¸¸ç”¨ç»„ä»¶æŠ½æˆå…±äº« includeï¼Œä¿è¯é£æ ¼ä¸€è‡´æ€§ä¸ç»´æŠ¤æ€§ã€‚  </li>
<li>è‡ªåŠ¨åŒ–æ¸²æŸ“ï¼šåœ¨ CI ä¸­åŠ å…¥ lint ä¸æ¸²æŸ“æ­¥éª¤ï¼Œå‘ç°è¯­æ³•é”™è¯¯ä¸æ ·å¼å›å½’ã€‚  </li>
<li>ç‰ˆæœ¬é”å®šï¼šå¯¹å¤–éƒ¨ include ä¸ä¸»é¢˜è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œé¿å…â€œä»Šå¤©å¯æ¸²æŸ“ã€æ˜å¤©æŠ¥é”™â€çš„æƒ…å†µã€‚  </li>
<li>å®‰å…¨ä¸éšç§ï¼šéƒ¨ç½²&#x2F;ç½‘ç»œ&#x2F;ç¯å¢ƒå›¾è¯·å…ˆè„±æ•ï¼Œå‘å¸ƒå‰å®¡æŸ¥æ‰€æœ‰å¤–éƒ¨ä¾èµ–ã€‚</li>
</ul>
<hr>
<p>é™„ï¼šå¿«é€Ÿç¤ºä¾‹é›†åˆï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° .pumlï¼‰<br>@startuml<br>skinparam backgroundColor #F8F8F8<br>left to right direction</p>
<p>actor Customer<br>rectangle â€œWebAppâ€ {<br>  component UI<br>  component â€œAuth Serviceâ€ as Auth<br>}<br>database DB</p>
<p>Customer -&gt; UI: open page<br>UI -&gt; Auth: login(credentials)<br>Auth -&gt; DB: query user<br>Auth â€“&gt; UI: token<br>UI â€“&gt; Customer: success</p>
<p>@enduml</p>
<p>è¯´æ˜ï¼šå¤åˆç¤ºä¾‹åŒ…å« actorã€componentã€databaseã€ç®­å¤´ä¸å…¨å±€ skinparamã€‚åœé¡¿&#x2F;é£é™©ï¼šç¤ºä¾‹ä¸ºæ¼”ç¤ºï¼Œä¸é€‚åˆç›´æ¥å±•ç¤ºç”Ÿäº§éƒ¨ç½²ç»†èŠ‚ï¼Œè¯·è„±æ•ä¸åˆ†å›¾è¡¨è¾¾ã€‚</p>
<hr>
]]></content>
  </entry>
  <entry>
    <title>Graphviz cheatsheet</title>
    <url>/Graphviz-cheatsheet/</url>
    <content><![CDATA[<span id="more"></span>
<h1 id="Graphviz-è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³•-ç¤ºä¾‹-è¯´æ˜-åœé¡¿-é£é™©ï¼‰"><a href="#Graphviz-è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³•-ç¤ºä¾‹-è¯´æ˜-åœé¡¿-é£é™©ï¼‰" class="headerlink" title="Graphviz è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³• + ç¤ºä¾‹ + è¯´æ˜ + åœé¡¿&#x2F;é£é™©ï¼‰"></a>Graphviz è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³• + ç¤ºä¾‹ + è¯´æ˜ + åœé¡¿&#x2F;é£é™©ï¼‰</h1><p>æ¦‚è§ˆï¼šGraphviz ä½¿ç”¨ DOT è¯­è¨€æè¿°å›¾ã€‚æ ¸å¿ƒæ˜¯ graph&#x2F; digraphã€nodeã€edgeã€subgraphã€attributesã€‚ä¸‹é¢æŒ‰ä¸»é¢˜ç»™å‡ºå¸¸ç”¨è¯­æ³•æ¡ç›®ï¼Œæ¯æ¡åŒ…å«ã€Œè¯­æ³•ã€ã€Œç¤ºä¾‹ã€ã€Œè¯´æ˜ã€ã€Œåœé¡¿&#x2F;é£é™©ã€ã€‚</p>
<hr>
<h3 id="åŸºæœ¬ç»“æ„ä¸å¯åŠ¨"><a href="#åŸºæœ¬ç»“æ„ä¸å¯åŠ¨" class="headerlink" title="åŸºæœ¬ç»“æ„ä¸å¯åŠ¨"></a>åŸºæœ¬ç»“æ„ä¸å¯åŠ¨</h3><ul>
<li><p>è¯­æ³•<br>graph åç§° { â€¦ }<br>digraph åç§° { â€¦ }</p>
</li>
<li><p>ç¤ºä¾‹<br>digraph G {<br>  A -&gt; B;<br>}</p>
</li>
<li><p>è¯´æ˜<br>graph ç”¨äºæ— å‘å›¾ï¼ˆä½¿ç”¨ â€“ï¼‰ï¼Œdigraph ç”¨äºæœ‰å‘å›¾ï¼ˆä½¿ç”¨ -&gt;ï¼‰ã€‚å—å†…æ”¾èŠ‚ç‚¹ã€è¾¹ã€å±æ€§ä¸å­å›¾ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¿˜è®°åˆ†å·å¯èƒ½è¢«å…è®¸ä½†ä¼šå¼•èµ·è§£ææ­§ä¹‰ï¼›ä¸¥æ ¼éµå®ˆæ‹¬å·é…å¯¹ï¼Œç¼ºå°‘é—­åˆä¼šå¯¼è‡´æ¸²æŸ“å¤±è´¥ã€‚</p>
</li>
<li><p>å‘½ä»¤è¡Œæ¸²æŸ“<br>dot -Tpng in.dot -o out.png</p>
</li>
<li><p>ç¤ºä¾‹<br>dot -Tsvg diagram.dot -o diagram.svg</p>
</li>
<li><p>è¯´æ˜<br>dot&#x2F;neato&#x2F;fdp&#x2F;twopi&#x2F;sfdp&#x2F;osage ç­‰ä¸ºä¸åŒå¸ƒå±€å¼•æ“ï¼Œ-T æŒ‡å®šè¾“å‡ºæ ¼å¼ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>é€‰æ‹©é”™è¯¯å¸ƒå±€å¼•æ“ä¼šä½¿å¤§å›¾ä¸å¯è¯»æˆ–è€—æ—¶æ˜¾è‘—ï¼Œæ‰¹é‡æ¸²æŸ“æ³¨æ„èµ„æºé™åˆ¶ã€‚</p>
</li>
</ul>
<hr>
<h3 id="èŠ‚ç‚¹ä¸è¾¹åŸºç¡€"><a href="#èŠ‚ç‚¹ä¸è¾¹åŸºç¡€" class="headerlink" title="èŠ‚ç‚¹ä¸è¾¹åŸºç¡€"></a>èŠ‚ç‚¹ä¸è¾¹åŸºç¡€</h3><ul>
<li><p>èŠ‚ç‚¹å®šä¹‰ï¼ˆéšå¼ä¸æ˜¾å¼ï¼‰<br>è¯­æ³•<br>A;<br>A [label&#x3D;â€Userâ€, shape&#x3D;box];</p>
</li>
<li><p>ç¤ºä¾‹<br>node1 [label&#x3D;â€DBâ€, shape&#x3D;component];</p>
</li>
<li><p>è¯´æ˜<br>æœªæ˜¾å¼å®šä¹‰çš„æ ‡è¯†ç¬¦åœ¨ç¬¬ä¸€æ¬¡ç”¨äºè¾¹æ—¶è‡ªåŠ¨åˆ›å»ºã€‚attributes æ§åˆ¶å¤–è§‚ä¸è¡Œä¸ºã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>èŠ‚ç‚¹åå«ç‰¹æ®Šå­—ç¬¦æˆ–ç©ºæ ¼éœ€ç”¨å¼•å·æˆ–ç”¨ label ä¿è¯å¯è¯»æ€§ï¼›å¤§å°å†™æ•æ„Ÿã€‚</p>
</li>
<li><p>è¾¹è¯­æ³•ï¼ˆæ— å‘&#x2F;æœ‰å‘ï¼‰<br>è¯­æ³•<br>A â€“ B;   (æ— å‘)<br>A -&gt; B;   (æœ‰å‘)</p>
</li>
<li><p>ç¤ºä¾‹<br>A -&gt; B [label&#x3D;â€reqâ€, color&#x3D;blue];</p>
</li>
<li><p>è¯´æ˜<br>è¾¹å¯ä»¥å¸¦å±æ€§ï¼ˆlabelã€colorã€styleã€taillabel&#x2F;headlabelã€arrowhead ç­‰ï¼‰ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>åœ¨ digraph ä¸­ä½¿ç”¨ â€“ ä¼šè¢«æ¥å—ä½†è¯­ä¹‰æ··æ·†ï¼Œä¿æŒä¸€è‡´ä½¿ç”¨ -&gt;ã€‚</p>
</li>
<li><p>å¤šç«¯&#x2F;å¤åˆè¾¹<br>è¯­æ³•<br>A -&gt; {B C D};  </p>
</li>
<li><p>ç¤ºä¾‹<br>Service -&gt; {DB Cache};</p>
</li>
<li><p>è¯´æ˜<br>æ‰¹é‡è¿æ¥çš„ç®€å†™ï¼Œç­‰ä»·äºå¤šæ¡ç‹¬ç«‹è¾¹ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¯¹å±æ€§çš„ä½œç”¨åŸŸéœ€æ³¨æ„ï¼šæ”¾åœ¨é›†åˆåé¢çš„å±æ€§é€šå¸¸åº”ç”¨åˆ°æ‰€æœ‰éšå¼ç”Ÿæˆçš„è¾¹ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å±æ€§ç³»ç»Ÿï¼ˆèŠ‚ç‚¹-è¾¹-å›¾ï¼‰"><a href="#å±æ€§ç³»ç»Ÿï¼ˆèŠ‚ç‚¹-è¾¹-å›¾ï¼‰" class="headerlink" title="å±æ€§ç³»ç»Ÿï¼ˆèŠ‚ç‚¹&#x2F;è¾¹&#x2F;å›¾ï¼‰"></a>å±æ€§ç³»ç»Ÿï¼ˆèŠ‚ç‚¹&#x2F;è¾¹&#x2F;å›¾ï¼‰</h3><ul>
<li><p>é€šç”¨è¯­æ³•<br>target [attr1&#x3D;value1, attr2&#x3D;value2];<br>graph [splines&#x3D;true]; node [shape&#x3D;box];</p>
</li>
<li><p>ç¤ºä¾‹<br>graph [rankdir&#x3D;LR, fontsize&#x3D;12];<br>node [shape&#x3D;ellipse, color&#x3D;â€#333333â€];</p>
</li>
<li><p>è¯´æ˜<br>graphã€nodeã€edge çš„è£¸å±æ€§ä¼šä½œä¸ºé»˜è®¤å€¼åº”ç”¨åˆ°å›¾ä¸­ç›¸åº”å…ƒç´ ã€‚æ”¯æŒå­—ç¬¦ä¸²ã€é¢œè‰²ã€å¸ƒå°”å€¼ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>ä¸åŒæ¸²æŸ“å™¨å¯¹å±æ€§æ”¯æŒä¸åŒï¼ˆå¦‚ HTML æ ‡ç­¾ã€gradientï¼‰ï¼Œåœ¨è·¨ç¯å¢ƒæ¸²æŸ“å‰éªŒè¯ã€‚</p>
</li>
<li><p>å¸¸ç”¨å±æ€§é€ŸæŸ¥  </p>
<ul>
<li>label: æ˜¾ç¤ºæ–‡å­—  </li>
<li>shape: box, ellipse, record, plaintext, circle, component ç­‰  </li>
<li>style: filled, dashed, bold, invis  </li>
<li>color &#x2F; fillcolor &#x2F; fontcolor  </li>
<li>fontsize &#x2F; fontname  </li>
<li>rankdir: LR, TB, RL, BTï¼ˆæ–¹å‘ï¼‰  </li>
<li>splines: true|false|curved|orthoï¼ˆè¾¹è·¯ç”±ï¼‰  </li>
<li>rank: same|min|maxï¼ˆèŠ‚ç‚¹çºµå‘å¯¹é½ï¼‰</li>
</ul>
</li>
<li><p>ç¤ºä¾‹<br>edge [arrowhead&#x3D;vee, color&#x3D;gray];</p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>é¢œè‰²ä»£ç ä¸å­—ä½“åœ¨ç›®æ ‡ç¯å¢ƒå¯èƒ½ä¸å¯ç”¨æˆ–æ›¿æ¢ï¼Œæœ€å¥½æŒ‡å®šå®‰å…¨çš„ web é¢œè‰²ä¸å¸¸è§å­—ä½“ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å­å›¾ã€Cluster-ä¸å±‚çº§å¸ƒå±€"><a href="#å­å›¾ã€Cluster-ä¸å±‚çº§å¸ƒå±€" class="headerlink" title="å­å›¾ã€Cluster ä¸å±‚çº§å¸ƒå±€"></a>å­å›¾ã€Cluster ä¸å±‚çº§å¸ƒå±€</h3><ul>
<li><p>åŸºæœ¬å­å›¾è¯­æ³•<br>subgraph name { â€¦ }  </p>
</li>
<li><p>ç¤ºä¾‹<br>subgraph cluster_0 {<br>  label&#x3D;â€Authâ€;<br>  A; B;<br>  A -&gt; B;<br>}</p>
</li>
<li><p>è¯´æ˜<br>ä½¿ç”¨ cluster_ å‰ç¼€ä¼šæŠŠå­å›¾æ¸²æŸ“ä¸ºå¸¦è¾¹æ¡†çš„èšç°‡ï¼ˆclusterï¼‰ï¼Œå¸¸ç”¨äºæ¨¡å—&#x2F;åœºåŸŸåˆ†ç»„ã€‚å­å›¾å¯å«å±æ€§ï¼ˆlabelã€styleï¼‰ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>cluster åç§°æœ€å¥½ä»¥ cluster_ å¼€å¤´ï¼›é”™è¯¯çš„å­å›¾åµŒå¥—æˆ–å±æ€§æ”¾ç½®ä¼šæ”¹å˜å¸ƒå±€é¢„æœŸã€‚</p>
</li>
<li><p>æ§åˆ¶ rankï¼ˆåŒå±‚å¯¹é½ï¼‰<br>è¯­æ³•<br>{ rank &#x3D; same; A; B; }</p>
</li>
<li><p>ç¤ºä¾‹<br>{ rank &#x3D; same; UI; API; DB; }</p>
</li>
<li><p>è¯´æ˜<br>å¼ºåˆ¶è¿™äº›èŠ‚ç‚¹å¤„äºåŒä¸€â€œç­‰çº§â€è¡Œ&#x2F;åˆ—ï¼ˆå— rankdir å½±å“ï¼‰ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>è¿‡å¤š rank çº¦æŸä¼šä¸è‡ªåŠ¨å¸ƒå±€å†²çªï¼Œä½¿å¸ƒå±€å˜å½¢æˆ–ä¸å¯è¯»ã€‚</p>
</li>
</ul>
<hr>
<h3 id="ç«¯å£ã€è®°å½•èŠ‚ç‚¹ä¸-HTML-æ ‡ç­¾"><a href="#ç«¯å£ã€è®°å½•èŠ‚ç‚¹ä¸-HTML-æ ‡ç­¾" class="headerlink" title="ç«¯å£ã€è®°å½•èŠ‚ç‚¹ä¸ HTML æ ‡ç­¾"></a>ç«¯å£ã€è®°å½•èŠ‚ç‚¹ä¸ HTML æ ‡ç­¾</h3><ul>
<li><p>ç«¯å£è¯­æ³•ï¼ˆè®°å½•å‹èŠ‚ç‚¹ï¼‰<br>è¯­æ³•<br>node:port æˆ– â€œnodeâ€:â€portâ€<br>ä½¿ç”¨ record shape: {left|mid|right}</p>
</li>
<li><p>ç¤ºä¾‹<br>node1 [shape&#x3D;record, label&#x3D;â€{left|mid|right}â€];<br>node1:left -&gt; node2;</p>
</li>
<li><p>è¯´æ˜<br>è®°å½•ï¼ˆrecordï¼‰èŠ‚ç‚¹å…è®¸åˆ†åŒºå¹¶å¯¹å‡†è¾¹çš„ç«¯å£ï¼Œé€‚åˆæ˜¾ç¤ºç»“æ„åŒ–ç»„ä»¶æˆ–æ•°æ®å­—æ®µã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>è®°å½•æ ‡ç­¾è¯­æ³•å¯¹å¼•å·ã€èŠ±æ‹¬å·æ•æ„Ÿï¼Œå¤æ‚æ–‡æœ¬éœ€ç”¨è½¬ä¹‰æˆ– HTML æ ‡ç­¾ã€‚</p>
</li>
<li><p>HTML-like æ ‡ç­¾ï¼ˆå¯Œæ–‡æœ¬ labelï¼‰<br>è¯­æ³•<br>label&#x3D;&lt;<table><tr><td>â€¦</td></tr></table>&gt;  </p>
</li>
<li><p>ç¤ºä¾‹<br>node [label&#x3D;&lt;<b>Service</b><br/>v1&gt;&gt;, shape&#x3D;plaintext];</p>
</li>
<li><p>è¯´æ˜<br>ä½¿ç”¨ HTML-like æ ‡ç­¾è¿›è¡Œå¤æ‚æ ¼å¼åŒ–ï¼ˆè¡¨æ ¼ã€ç²—ä½“ã€æ¢è¡Œï¼‰ã€‚å¹¶éæ‰€æœ‰è¾“å‡º&#x2F;æ¸²æŸ“å™¨å¯¹æ‰€æœ‰æ ‡ç­¾å®Œå…¨æ”¯æŒã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>HTML label ä¸­çš„å¤§å°å†™æˆ–ä¸é—­åˆæ ‡ç­¾ä¼šå¯¼è‡´è§£æé”™è¯¯ï¼›SVG è¾“å‡ºåœ¨ä¸åŒæ¸²æŸ“å™¨ä¸‹æ ·å¼å¯èƒ½ä¸åŒã€‚</p>
</li>
</ul>
<hr>
<h3 id="å¸ƒå±€å¼•æ“ä¸é«˜çº§æ§åˆ¶"><a href="#å¸ƒå±€å¼•æ“ä¸é«˜çº§æ§åˆ¶" class="headerlink" title="å¸ƒå±€å¼•æ“ä¸é«˜çº§æ§åˆ¶"></a>å¸ƒå±€å¼•æ“ä¸é«˜çº§æ§åˆ¶</h3><ul>
<li><p>å¸¸è§å¸ƒå±€å¼•æ“<br>dotï¼ˆå±‚æ¬¡å¸ƒå±€ï¼Œé€‚åˆæœ‰å‘å›¾ï¼‰<br>neato&#x2F;fdp&#x2F;sfdpï¼ˆåŸºäºåŠ›å¯¼å‘ï¼Œé€‚åˆæ— å‘&#x2F;å¤§å›¾ï¼‰<br>twopiï¼ˆå¾„å‘å¸ƒå±€ï¼‰<br>circoï¼ˆåœ†å½¢å¸ƒå±€ï¼‰</p>
</li>
<li><p>å‘½ä»¤è¡Œç¤ºä¾‹<br>neato -Tpng graph.dot -o graph.png</p>
</li>
<li><p>è¯´æ˜<br>é€‰å¯¹å¼•æ“èƒ½æ˜¾è‘—æ”¹å–„å¯è¯»æ€§ï¼šdot é€‚åˆæµç¨‹&#x2F;å±‚çº§ï¼Œsfdp é€‚åˆæ•°åƒèŠ‚ç‚¹çš„å¤§å›¾ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>ä¸åŒå¼•æ“å¯¹ç›¸åŒ DOT æ–‡ä»¶ä¼šäº§ç”Ÿå®Œå…¨ä¸åŒçš„è§†è§‰ç»“æœï¼›æµ‹è¯•å¹¶é€‰æ‹©æœ€åˆé€‚çš„å¼•æ“ã€‚</p>
</li>
<li><p>ç»†ç²’åº¦å¸ƒå±€æ§åˆ¶ï¼ˆpos &#x2F; constraint &#x2F; weightï¼‰  </p>
<ul>
<li>pos&#x3D;â€x,y!â€ï¼šå›ºå®šèŠ‚ç‚¹ä½ç½®ï¼ˆâ€œ!â€ è¡¨ç¤ºå¼ºåˆ¶ï¼‰  </li>
<li>edge [constraint&#x3D;false]ï¼šå¿½ç•¥è¾¹åœ¨å±‚çº§è®¡ç®—ä¸­çš„çº¦æŸ  </li>
<li>weightï¼šå½±å“è¾¹åœ¨åŠ›å¯¼å‘å¸ƒå±€ä¸­çš„ç‰µå¼•åŠ›</li>
</ul>
</li>
<li><p>ç¤ºä¾‹<br>A [pos&#x3D;â€0,0!â€]; B [pos&#x3D;â€1,0!â€]; A -&gt; B [constraint&#x3D;false];</p>
</li>
<li><p>è¯´æ˜<br>å¯ç”¨äºåœ¨æ··åˆæ‰‹å·¥ä¸è‡ªåŠ¨å¸ƒå±€æ—¶å¾®è°ƒä½ç½®ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>ä½¿ç”¨å›ºå®šä½ç½®ä¼šå…³é—­å¸ƒå±€å¼•æ“çš„è‡ªåŠ¨ä¼˜åŒ–ï¼Œè·¨è¾“å‡ºå°ºå¯¸æ—¶ä½ç½®å¯èƒ½å¤±çœŸï¼›æ…ç”¨â€œ!â€å¼ºåˆ¶ä½ç½®ã€‚</p>
</li>
</ul>
<hr>
<h3 id="å­å›¾å¯è§†åŒ–æŠ€å·§ä¸å¸¸è§é™·é˜±"><a href="#å­å›¾å¯è§†åŒ–æŠ€å·§ä¸å¸¸è§é™·é˜±" class="headerlink" title="å­å›¾å¯è§†åŒ–æŠ€å·§ä¸å¸¸è§é™·é˜±"></a>å­å›¾å¯è§†åŒ–æŠ€å·§ä¸å¸¸è§é™·é˜±</h3><ul>
<li><p>åˆ†å›¾ï¼ˆnewpage &#x2F; compound å›¾ï¼‰  </p>
<ul>
<li>newpageï¼šå°†è¾“å‡ºåˆ†é¡µï¼ˆä»…éƒ¨åˆ†å·¥å…·æ”¯æŒï¼‰ã€‚  </li>
<li>compound&#x3D;trueï¼šå…è®¸è¾¹è·¨ cluster å¹¶ä½¿ç”¨ lhead&#x2F;ltail æŒ‡å®šé™„ç€ç‚¹ã€‚</li>
</ul>
</li>
<li><p>ç¤ºä¾‹<br>graph [compound&#x3D;true]; A -&gt; B [lhead&#x3D;cluster_0];</p>
</li>
<li><p>è¯´æ˜<br>compound æœ‰åŠ©äºç”»è·¨æ¨¡å—çš„è¿æ¥å¹¶æŠŠè¾¹é™„ç€åˆ°èšç°‡è¾¹ç•Œã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>compound é…ç½®å¤æ‚ï¼Œé”™è¯¯çš„ lhead&#x2F;ltail ä¼šå¯¼è‡´è¾¹ä¸å¯è§æˆ–å¸ƒå±€æ··ä¹±ã€‚</p>
</li>
<li><p>æ€§èƒ½ä¸è§„æ¨¡è€ƒé‡  </p>
<ul>
<li>å¯¹äºä¸ŠåƒèŠ‚ç‚¹ï¼Œä¼˜å…ˆ sfdp å¹¶è®¾ç½® overlap&#x3D;falseã€nodesepã€ranksep ç­‰ç¼©æ”¾å‚æ•°ã€‚  </li>
<li>ä½¿ç”¨å­å›¾åˆ†å±‚æˆ–åˆ†é¡µå¯¼å‡ºä»¥é¿å…å•å›¾æ¸²æŸ“å¤±è´¥ã€‚</li>
</ul>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>å¤§å›¾æ¸²æŸ“å¯èƒ½è€—å°½å†…å­˜æˆ–è¶…æ—¶ï¼Œåœ¨ CI ä¸­å¹¶è¡Œæ¸²æŸ“éœ€é™é€Ÿã€‚</p>
</li>
</ul>
<hr>
<h3 id="å¸¸ç”¨å±æ€§é€ŸæŸ¥åˆ—è¡¨ï¼ˆå¿«é€Ÿå‚è€ƒï¼‰"><a href="#å¸¸ç”¨å±æ€§é€ŸæŸ¥åˆ—è¡¨ï¼ˆå¿«é€Ÿå‚è€ƒï¼‰" class="headerlink" title="å¸¸ç”¨å±æ€§é€ŸæŸ¥åˆ—è¡¨ï¼ˆå¿«é€Ÿå‚è€ƒï¼‰"></a>å¸¸ç”¨å±æ€§é€ŸæŸ¥åˆ—è¡¨ï¼ˆå¿«é€Ÿå‚è€ƒï¼‰</h3><ul>
<li>graph: rankdir, bgcolor, splines, compound, overlap  </li>
<li>node: shape, label, style, color, fillcolor, fontsize, fontname, width, height  </li>
<li>edge: label, color, style, arrowhead, arrowtail, dir, minlen, constraint, weight, headlabel, taillabel  </li>
<li>å¸ƒå±€: pos, rank, rankdir, nodesep, ranksep, margin</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆç»„åˆï¼‰<br>digraph G {<br>  graph [rankdir&#x3D;LR, splines&#x3D;ortho];<br>  node [shape&#x3D;record, fontsize&#x3D;11];<br>  A [label&#x3D;â€{Req|id:int|data}â€];<br>  B [label&#x3D;â€<f0>left|<f1>rightâ€, shape&#x3D;record];<br>  A:f1 -&gt; B:f0 [label&#x3D;â€mapâ€, color&#x3D;â€#0066ccâ€];<br>}</p>
<p>åœé¡¿&#x2F;é£é™©<br>å±æ€§ç›¸äº’ä½œç”¨å¤æ‚ï¼Œå…ˆåœ¨å°æ ·ä¾‹ä¸­éªŒè¯æ¯ä¸ªå±æ€§çš„è§†è§‰æ•ˆæœå†ç”¨äºç”Ÿäº§å›¾ã€‚</p>
<hr>
<h3 id="å¸¸è§å‘ä¸æœ€ä½³å®è·µ"><a href="#å¸¸è§å‘ä¸æœ€ä½³å®è·µ" class="headerlink" title="å¸¸è§å‘ä¸æœ€ä½³å®è·µ"></a>å¸¸è§å‘ä¸æœ€ä½³å®è·µ</h3><ul>
<li>å‘ï¼šä¸åŒ Graphviz ç‰ˆæœ¬&#x2F;å¹³å°å¯¹å±æ€§æ”¯æŒä¸åŒã€‚<br>æœ€ä½³å®è·µï¼šåœ¨ç›®æ ‡æ¸²æŸ“ç¯å¢ƒä¸­é”å®š Graphviz ç‰ˆæœ¬å¹¶æµ‹è¯•æ ·å¼åº“ã€‚</li>
<li>å‘ï¼šä½¿ç”¨å¤–éƒ¨å­—ä½“æˆ–æœ¬åœ°å›¾ç‰‡ä¼šå¯¼è‡´æ¸²æŸ“ç¯å¢ƒä¸å¯å¤ç°ã€‚<br>æœ€ä½³å®è·µï¼šä¾èµ–é€šç”¨å­—ä½“æˆ–å°†èµ„æºå†…åµŒ&#x2F;æ‰“åŒ…åˆ° CIã€‚</li>
<li>å‘ï¼šè¿‡åº¦ä½¿ç”¨ HTML labels æˆ–å¤æ‚ record å¯¼è‡´å¯è®¿é—®æ€§å·®ã€‚<br>æœ€ä½³å®è·µï¼šä¸ºå¤æ‚è§†å›¾æä¾›çº¯æ–‡æœ¬æ›¿ä»£æˆ–ç”Ÿæˆè¯´æ˜æ–‡æ¡£ã€‚</li>
<li>å‘ï¼šåœ¨çº¿åµŒå…¥ï¼ˆå¦‚ Markdown æ¸²æŸ“å™¨ï¼‰ä¸æœ¬åœ° dot è¡Œä¸ºä¸ä¸€è‡´ã€‚<br>æœ€ä½³å®è·µï¼šç»´æŠ¤ä¸€å¥—ã€Œå¯åœ¨ç›®æ ‡å¹³å°ç›´æ¥æ¸²æŸ“çš„æœ€å° DOT ç¤ºä¾‹ã€ã€‚</li>
</ul>
<hr>
]]></content>
  </entry>
  <entry>
    <title>Mermaid cheatsheet</title>
    <url>/Mermaid-cheatsheet/</url>
    <content><![CDATA[<span id="more"></span>
<h3 id="Mermaid-è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³•-ç¤ºä¾‹-è¯´æ˜-åœé¡¿-é£é™©ï¼‰"><a href="#Mermaid-è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³•-ç¤ºä¾‹-è¯´æ˜-åœé¡¿-é£é™©ï¼‰" class="headerlink" title="Mermaid è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³• + ç¤ºä¾‹ + è¯´æ˜ + åœé¡¿&#x2F;é£é™©ï¼‰"></a>Mermaid è¯­æ³•é€ŸæŸ¥æ–‡æ¡£ï¼ˆè¯­æ³• + ç¤ºä¾‹ + è¯´æ˜ + åœé¡¿&#x2F;é£é™©ï¼‰</h3><p>æ¦‚è§ˆï¼šMermaid æ˜¯é¢å‘æ–‡æ¡£å’Œå‰ç«¯æ¸²æŸ“çš„è½»é‡å›¾è¡¨è¯­è¨€ï¼Œå¸¸è§äº Markdownã€Wikiã€Docsã€‚æ”¯æŒ flowchartã€sequenceã€classã€stateã€gitgraphã€pieã€ganttã€er ç­‰å›¾ç±»å‹ã€‚ä¸‹é¢æŒ‰ä¸»é¢˜ç»™å‡ºå¸¸ç”¨è¯­æ³•æ¡ç›®ï¼Œæ¯æ¡åŒ…å«ã€Œè¯­æ³•ã€ã€Œç¤ºä¾‹ã€ã€Œè¯´æ˜ã€ã€Œåœé¡¿&#x2F;é£é™©ã€ã€‚</p>
<hr>
<h3 id="åŸºæœ¬ç»“æ„ä¸æ¸²æŸ“"><a href="#åŸºæœ¬ç»“æ„ä¸æ¸²æŸ“" class="headerlink" title="åŸºæœ¬ç»“æ„ä¸æ¸²æŸ“"></a>åŸºæœ¬ç»“æ„ä¸æ¸²æŸ“</h3><ul>
<li>è¯­æ³•  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%% å¼€å¤´å¯åŠ æ³¨é‡Š</span><br><span class="line">graph LR</span><br><span class="line">  A--&gt;B</span><br></pre></td></tr></table></figure></li>
<li>ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph TD</span><br><span class="line">  A[Start] --&gt; B&#123;Is ok?&#125;</span><br><span class="line">  B -- Yes --&gt; C[Finish]</span><br><span class="line">  B -- No --&gt; D[Retry]</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>ä»¥å›¾ç±»å‹å¼€å¤´ï¼ˆgraph, sequenceDiagram, classDiagram ç­‰ï¼‰ï¼Œéšåçš„å—ä¸ºå›¾å®šä¹‰ã€‚å¸¸è§æ¸²æŸ“ç¯å¢ƒï¼šGitHubã€GitLabã€Mermaid Live Editorã€Docs å·¥å…·é“¾å’Œ VSCode æ’ä»¶ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>ä¸åŒå¹³å°çš„ Mermaid ç‰ˆæœ¬å·®å¼‚è¾ƒå¤§ï¼ˆè¯­æ³•æ‰©å±•ä¸ä¸»é¢˜æ”¯æŒä¸åŒï¼‰ï¼Œåœ¨ç›®æ ‡å¹³å°ä¸ŠéªŒè¯éå¸¸å¿…è¦ã€‚</li>
</ul>
<hr>
<h3 id="æµç¨‹å›¾ï¼ˆflowchart-graphï¼‰"><a href="#æµç¨‹å›¾ï¼ˆflowchart-graphï¼‰" class="headerlink" title="æµç¨‹å›¾ï¼ˆflowchart &#x2F; graphï¼‰"></a>æµç¨‹å›¾ï¼ˆflowchart &#x2F; graphï¼‰</h3><ul>
<li><p>è¯­æ³•ï¼ˆæ–¹å‘ã€èŠ‚ç‚¹ã€è¾¹ï¼‰  </p>
<ul>
<li>æ–¹å‘ï¼šgraph LR&#x2F;TD&#x2F;BT&#x2F;RLï¼ˆLeftâ†’Right &#x2F; Topâ†’Down ç­‰ï¼‰  </li>
<li>èŠ‚ç‚¹ï¼šA[Label], A((Circle)), A&gt;parens], A[[database]]  </li>
<li>è¾¹ï¼šA â€“&gt; B, A -.-&gt; B, A &#x3D;&#x3D;&gt; B, A â€” B</li>
</ul>
</li>
<li><p>ç¤ºä¾‹  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  Start([Start]) --&gt; Step1&#123;Check?&#125;</span><br><span class="line">  Step1 -- yes --&gt; Step2[Do it]</span><br><span class="line">  Step1 -- no --&gt; End([End])</span><br><span class="line">  Step2 --&gt; End</span><br></pre></td></tr></table></figure></li>
<li><p>è¯´æ˜<br>ä¸°å¯Œçš„èŠ‚ç‚¹å½¢çŠ¶é€šè¿‡ä¸åŒæ‹¬å·è¯­æ³•å®ç°ï¼›è¾¹æ”¯æŒæ ·å¼ï¼ˆå®çº¿ã€ç‚¹çº¿ã€åŠ ç®­å¤´æ ·å¼ï¼‰ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>èŠ‚ç‚¹åç§°ä¸èƒ½å«ç©ºæ ¼ï¼ˆå¯ç”¨å¼•å·æˆ–æ–¹æ‹¬å· labelï¼‰ï¼Œè¿‡å¤šèŠ‚ç‚¹ä¼šè§¦å‘å¸ƒå±€æ‹¥æŒ¤ï¼Œå»ºè®®æ‹†åˆ†æˆ–ä½¿ç”¨ subgraphã€‚</p>
</li>
<li><p>å­å›¾ï¼ˆåˆ†ç»„ï¼‰<br>è¯­æ³•&#x2F;ç¤ºä¾‹  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">subgraph Auth</span><br><span class="line">  A --&gt; B</span><br><span class="line">end</span><br></pre></td></tr></table></figure></li>
<li><p>è¯´æ˜<br>subgraph ç”¨äºè§†è§‰åˆ†ç»„æˆ–æ¨¡å—åŒ–ã€‚  </p>
</li>
<li><p>åœé¡¿&#x2F;é£é™©<br>subgraph åµŒå¥—å’Œæ–¹å‘ç»§æ‰¿å¯èƒ½å¯¼è‡´å¸ƒå±€ä¸é¢„æœŸä¸åŒï¼Œæ³¨æ„å†™æ³•ä¸ç¼©è¿›ã€‚</p>
</li>
</ul>
<hr>
<h3 id="æ—¶åºå›¾ï¼ˆsequenceDiagramï¼‰"><a href="#æ—¶åºå›¾ï¼ˆsequenceDiagramï¼‰" class="headerlink" title="æ—¶åºå›¾ï¼ˆsequenceDiagramï¼‰"></a>æ—¶åºå›¾ï¼ˆsequenceDiagramï¼‰</h3><ul>
<li>è¯­æ³•  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">  participant Alice</span><br><span class="line">  participant Bob</span><br><span class="line">  Alice-&gt;&gt;Bob: Hello</span><br><span class="line">  Bob--&gt;&gt;Alice: Hi</span><br></pre></td></tr></table></figure></li>
<li>ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">  Alice-&gt;&gt;+Bob: request</span><br><span class="line">  Bob--&gt;&gt;-Alice: response</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>æ”¯æŒå‚ä¸è€…å£°æ˜ã€åŒæ­¥&#x2F;å¼‚æ­¥ç®­å¤´ã€æ¿€æ´»ï¼ˆ+ &#x2F; -ï¼‰ã€æ³¨é‡Šã€alt&#x2F;opt&#x2F;loop åˆ†æ”¯ç­‰ç»“æ„åŒ–æ§åˆ¶ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>å¤æ‚åˆ†æ”¯æ·±åº¦å¯¹æ¸²æŸ“å™¨è¦æ±‚é«˜ï¼›ä¸åŒå®ç°å¯¹ alt&#x2F;opt çš„æ”¯æŒç»†èŠ‚ä¸åŒï¼Œåˆ†æ”¯æ ‡ç­¾è¦ç®€æ´ã€‚</li>
</ul>
<hr>
<h3 id="ç±»å›¾ï¼ˆclassDiagramï¼‰"><a href="#ç±»å›¾ï¼ˆclassDiagramï¼‰" class="headerlink" title="ç±»å›¾ï¼ˆclassDiagramï¼‰"></a>ç±»å›¾ï¼ˆclassDiagramï¼‰</h3><ul>
<li>è¯­æ³•  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">  class A &#123;</span><br><span class="line">    +int id</span><br><span class="line">    +do()</span><br><span class="line">  &#125;</span><br><span class="line">  A &lt;|-- B</span><br></pre></td></tr></table></figure></li>
<li>ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">  Animal &lt;|-- Dog</span><br><span class="line">  Animal : +name</span><br><span class="line">  Dog : +bark()</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>è¡¨ç¤ºç±»ã€å±æ€§ã€æ–¹æ³•ã€ç»§æ‰¿å’Œå…³è”ï¼›æ”¯æŒæ¥å£ä¸æ³¨é‡Šã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>Mermaid çš„ç±»å›¾åŠŸèƒ½è¾ƒ PlantUML ç®€ç•¥ï¼Œå¤æ‚ UML è¡¨è¾¾å¯èƒ½æ— æ³•è¦†ç›–ï¼Œé€‰æ‹©æ—¶ç¡®è®¤éœ€æ±‚ã€‚</li>
</ul>
<hr>
<h3 id="çŠ¶æ€å›¾ï¼ˆstateDiagram-v2ï¼‰"><a href="#çŠ¶æ€å›¾ï¼ˆstateDiagram-v2ï¼‰" class="headerlink" title="çŠ¶æ€å›¾ï¼ˆstateDiagram-v2ï¼‰"></a>çŠ¶æ€å›¾ï¼ˆstateDiagram-v2ï¼‰</h3><ul>
<li>è¯­æ³•  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stateDiagram-v2</span><br><span class="line">  [*] --&gt; Idle</span><br><span class="line">  Idle --&gt; Running : start</span><br><span class="line">  Running --&gt; Idle : stop</span><br></pre></td></tr></table></figure></li>
<li>ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stateDiagram-v2</span><br><span class="line">  state &quot;Processing&quot; as P &#123;</span><br><span class="line">    S1 --&gt; S2</span><br><span class="line">  &#125;</span><br><span class="line">  [*] --&gt; P</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>æ”¯æŒå¤åˆçŠ¶æ€ã€å¹¶è¡Œã€å…¥å£&#x2F;å‡ºå£ç‚¹ä¸äº‹ä»¶æ ‡æ³¨ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>å¹¶è¡ŒçŠ¶æ€ï¼ˆfork&#x2F;mergeï¼‰åœ¨ä¸åŒæ¸²æŸ“ç‰ˆæœ¬è¡¨ç°ä¸åŒï¼Œæ³¨æ„æµ‹è¯•ã€‚</li>
</ul>
<hr>
<h3 id="ER-å›¾ä¸-Git-Graphã€Gantt-ç­‰"><a href="#ER-å›¾ä¸-Git-Graphã€Gantt-ç­‰" class="headerlink" title="ER å›¾ä¸ Git Graphã€Gantt ç­‰"></a>ER å›¾ä¸ Git Graphã€Gantt ç­‰</h3><ul>
<li>ER å›¾ï¼ˆå®ä½“å…³ç³»ï¼‰è¯­æ³•ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">erDiagram</span><br><span class="line">  CUSTOMER ||--o&#123; ORDER : places</span><br><span class="line">  CUSTOMER &#123;</span><br><span class="line">    string name</span><br><span class="line">    int id</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li>Git Graph ç®€å•ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gitGraph</span><br><span class="line">  commit</span><br><span class="line">  branch develop</span><br><span class="line">  commit</span><br><span class="line">  checkout main</span><br></pre></td></tr></table></figure></li>
<li>Gantt ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gantt</span><br><span class="line">  title Project</span><br><span class="line">  section Dev</span><br><span class="line">  Task1 :a1, 2023-01-01, 7d</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>Mermaid æä¾›å¤šç§å›¾ç±»å‹ï¼Œé€‚åˆæ–‡æ¡£å†…å¿«é€Ÿè¡¨è¾¾ä¸åŒè§†å›¾ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>å„å›¾ç±»å‹è¯­æ³•å·®å¼‚å¤§ï¼ŒæŸäº›é«˜çº§å±æ€§åœ¨åµŒå…¥ç¯å¢ƒï¼ˆå¦‚ GitHubï¼‰è¢«é™åˆ¶æˆ–ç¦ç”¨ã€‚</li>
</ul>
<hr>
<h3 id="labellingã€æ ·å¼ä¸ä¸»é¢˜"><a href="#labellingã€æ ·å¼ä¸ä¸»é¢˜" class="headerlink" title="labellingã€æ ·å¼ä¸ä¸»é¢˜"></a>labellingã€æ ·å¼ä¸ä¸»é¢˜</h3><ul>
<li>æ–‡æœ¬ä¸æ¢è¡Œ<br>ä½¿ç”¨ <br> æˆ– \n åœ¨ label ä¸­æ¢è¡Œï¼ˆå¹³å°æ”¯æŒå·®å¼‚ï¼‰ã€‚  </li>
<li>è‡ªå®šä¹‰æ ·å¼ï¼ˆclassDef &#x2F; class &#x2F; linkStyleï¼‰<br>ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classDef green fill:#9f6,stroke:#333,stroke-width:2px;</span><br><span class="line">class A green;</span><br><span class="line">linkStyle 0 stroke:#ff3,stroke-width:2px;</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>classDef å¯å®šä¹‰èŠ‚ç‚¹æ ·å¼å¹¶é€šè¿‡ class åº”ç”¨åˆ°èŠ‚ç‚¹ï¼ŒlinkStyle æ§åˆ¶è¾¹æ ·å¼ã€‚å…¨å±€ä¸»é¢˜å¯é€šè¿‡é…ç½®æˆ– CSSï¼ˆåœ¨æ”¯æŒçš„å¹³å°ï¼‰è¦†ç›–ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>æ ·å¼ API éšç‰ˆæœ¬æ¼”è¿›ï¼Œå»ºè®®å°†æ ·å¼æå–ä¸ºå¯å¤ç”¨ç‰‡æ®µå¹¶åœ¨ç›®æ ‡å¹³å°ä¸ŠéªŒè¯ã€‚</li>
</ul>
<hr>
<h3 id="äº¤äº’ã€é“¾æ¥ä¸-Click-äº‹ä»¶"><a href="#äº¤äº’ã€é“¾æ¥ä¸-Click-äº‹ä»¶" class="headerlink" title="äº¤äº’ã€é“¾æ¥ä¸ Click äº‹ä»¶"></a>äº¤äº’ã€é“¾æ¥ä¸ Click äº‹ä»¶</h3><ul>
<li>è¶…é“¾æ¥ &#x2F; ç‚¹å‡»äº‹ä»¶<br>è¯­æ³•ç¤ºä¾‹  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A[Node] --&gt; B</span><br><span class="line">click A &quot;https://example.com&quot; &quot;Open example&quot;</span><br></pre></td></tr></table></figure></li>
<li>è¯´æ˜<br>æ”¯æŒä¸ºèŠ‚ç‚¹&#x2F;è¾¹æ·»åŠ å¤–éƒ¨é“¾æ¥æˆ– JavaScript å›è°ƒï¼ˆåœ¨æ”¯æŒçš„å¹³å°ï¼‰ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>ç‚¹å‡»å›è°ƒåœ¨é™æ€å¯¼å‡ºï¼ˆPNG&#x2F;SVGï¼‰ä¸­å¤±æ•ˆï¼›åœ¨ web æ¸²æŸ“æ—¶æ³¨æ„å®‰å…¨ä¸è·¨åŸŸé™åˆ¶ã€‚</li>
</ul>
<hr>
<h3 id="è°ƒè¯•ã€æ€§èƒ½ä¸å…¼å®¹æ€§æ³¨æ„"><a href="#è°ƒè¯•ã€æ€§èƒ½ä¸å…¼å®¹æ€§æ³¨æ„" class="headerlink" title="è°ƒè¯•ã€æ€§èƒ½ä¸å…¼å®¹æ€§æ³¨æ„"></a>è°ƒè¯•ã€æ€§èƒ½ä¸å…¼å®¹æ€§æ³¨æ„</h3><ul>
<li>ç‰ˆæœ¬å…¼å®¹æ€§<br>Mermaid çš„è¯­æ³•ä¸åŠŸèƒ½éšç‰ˆæœ¬å˜åŒ–é¢‘ç¹ï¼ŒGitHub&#x2F;GitLab&#x2F;VSCode&#x2F;Docs çš„å†…ç½® Mermaid ç‰ˆæœ¬å¯èƒ½æ»åæˆ–å·®å¼‚åŒ–ã€‚  </li>
<li>æ€§èƒ½ä¸å¤§å›¾<br>å¤§å›¾æˆ–å¤§é‡æ ·å¼ä¼šä½¿æµè§ˆå™¨æ¸²æŸ“å¡é¡¿ï¼Œå»ºè®®åˆ†å›¾æˆ–ä½¿ç”¨æ‡’åŠ è½½ã€‚  </li>
<li>å¯è®¿é—®æ€§ä¸æ–‡æœ¬æ›¿ä»£<br>å¯¼å‡ºå›¾åƒæˆ–åµŒå…¥æ—¶æä¾›æ–‡æœ¬è¯´æ˜ï¼Œå¤æ‚å›¾åœ¨å°å±å¹•ä¸Šä¸å¯è¯»æ—¶æä¾›æ›¿ä»£è§†å›¾ã€‚  </li>
<li>åœé¡¿&#x2F;é£é™©<br>åœ¨ CI æˆ–æ–‡æ¡£ç”Ÿæˆç®¡é“ä¸­ä½¿ç”¨ Mermaid æ—¶é”å®š mermaid-cli æˆ–é›†æˆå·¥å…·ç‰ˆæœ¬ï¼Œé¿å…çº¿ä¸Šæ¸²æŸ“ä¸ä¸€è‡´ã€‚</li>
</ul>
<hr>
<h3 id="å¸¸è§å‘ä¸æœ€ä½³å®è·µ"><a href="#å¸¸è§å‘ä¸æœ€ä½³å®è·µ" class="headerlink" title="å¸¸è§å‘ä¸æœ€ä½³å®è·µ"></a>å¸¸è§å‘ä¸æœ€ä½³å®è·µ</h3><ul>
<li>å‘ï¼šç›´æ¥æŠŠå¤æ‚ PlantUML&#x2F;Graphviz æ–‡ä»¶ç²˜å…¥ Mermaid æ— æ³•å…¼å®¹ã€‚<br>æœ€ä½³å®è·µï¼šæŒ‰å›¾ç±»å‹é‡å†™ä¸º Mermaid è¯­æ³•æˆ–ä¿æŒåŸå·¥å…·é“¾å¹¶åœ¨æ–‡æ¡£ä¸­åµŒå…¥æ¸²æŸ“ç»“æœã€‚</li>
<li>å‘ï¼šèŠ‚ç‚¹&#x2F;ç±»åå«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦å¯¼è‡´è§£æå¤±è´¥ã€‚<br>æœ€ä½³å®è·µï¼šä½¿ç”¨çŸ­æ ‡è¯†ç¬¦å¹¶é€šè¿‡ label å±•ç¤ºå¯è¯»æ–‡æœ¬æˆ–ç”¨å¼•å·åŒ…è£¹ labelã€‚</li>
<li>å‘ï¼šä¸åŒæ¸²æŸ“ç¯å¢ƒå¯¹ classDefã€linkStyleã€click çš„æ”¯æŒä¸ä¸€è‡´ã€‚<br>æœ€ä½³å®è·µï¼šåœ¨ç›®æ ‡å¹³å°ä¸ŠéªŒè¯å¹¶ä¸ºä¸æ”¯æŒçš„åœºæ™¯æä¾›é™çº§æ ·å¼æˆ–çº¯æ–‡æœ¬è¯´æ˜ã€‚</li>
<li>å‘ï¼šç‰ˆæœ¬å˜æ›´å¯¼è‡´ç°æœ‰å›¾æ¸²æŸ“å¼‚å¸¸ã€‚<br>æœ€ä½³å®è·µï¼šåœ¨é¡¹ç›®ä¸­é”å®š mermaid ç‰ˆæœ¬å¹¶åœ¨ CI ä¸­å›ºå®šæ¸²æŸ“å·¥å…·ã€‚</li>
</ul>
<hr>
<h3 id="å¿«é€Ÿç¤ºä¾‹åˆé›†ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°-Markdownï¼‰"><a href="#å¿«é€Ÿç¤ºä¾‹åˆé›†ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ°-Markdownï¼‰" class="headerlink" title="å¿«é€Ÿç¤ºä¾‹åˆé›†ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° Markdownï¼‰"></a>å¿«é€Ÿç¤ºä¾‹åˆé›†ï¼ˆå¯ç›´æ¥å¤åˆ¶åˆ° Markdownï¼‰</h3><ul>
<li>æµç¨‹å›¾<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  A[Start] --&gt; B&#123;Check&#125;</span><br><span class="line">  B -- yes --&gt; C[OK]</span><br><span class="line">  B -- no  --&gt; D[Fail]</span><br></pre></td></tr></table></figure></li>
<li>æ—¶åºå›¾<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">  Alice-&gt;&gt;Bob: Hello</span><br><span class="line">  Bob--&gt;&gt;Alice: Hi</span><br></pre></td></tr></table></figure></li>
<li>ç±»å›¾<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">  Class01 &lt;|-- Class02</span><br><span class="line">  Class01 : +int id</span><br><span class="line">  Class02 : +do()</span><br></pre></td></tr></table></figure></li>
<li>ER å›¾<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">erDiagram</span><br><span class="line">  USER ||--o&#123; ORDER : places</span><br><span class="line">  USER &#123;</span><br><span class="line">    string name</span><br><span class="line">    int id</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
]]></content>
  </entry>
  <entry>
    <title>NtpåŒæ­¥å®¢æˆ·ç«¯</title>
    <url>/Ntp%E5%90%8C%E6%AD%A5%E5%AE%A2%E6%88%B7%E7%AB%AF/</url>
    <content><![CDATA[<span id="more"></span>
<h3 id="QtNtpClient-ç±»-â€”-å¤´æ–‡ä»¶-qt-ntp-client-h"><a href="#QtNtpClient-ç±»-â€”-å¤´æ–‡ä»¶-qt-ntp-client-h" class="headerlink" title="QtNtpClient ç±» â€” å¤´æ–‡ä»¶ (qt_ntp_client.h)"></a>QtNtpClient ç±» â€” å¤´æ–‡ä»¶ (qt_ntp_client.h)</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QObject&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QUdpSocket&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QElapsedTimer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDateTime&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QTimer&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QHostAddress&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * QtNtpClient</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * - å¼‚æ­¥é€šè¿‡ QUdpSocket å‘ NTP/SNTP æœåŠ¡å™¨å‘èµ·è¯·æ±‚å¹¶è§£æå“åº”ï¼ˆä¸ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ï¼‰</span></span><br><span class="line"><span class="comment"> * - ç»´æŒä¸€ä¸ªå¹³æ»‘çš„æ—¶é’Ÿåç§»ä¼°è®¡ (seconds)</span></span><br><span class="line"><span class="comment"> * - æä¾›å°†å•è°ƒæ—¶é’Ÿäº‹ä»¶æ˜ å°„åˆ°æ ¡æ­£åçš„ UTC æ—¶é—´çš„æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨æ–¹æ³•ï¼ˆç¤ºä¾‹ï¼‰:</span></span><br><span class="line"><span class="comment"> *   QtNtpClient *c = new QtNtpClient(parent);</span></span><br><span class="line"><span class="comment"> *   connect(c, &amp;QtNtpClient::offsetUpdated, [](double off, double delay)&#123;</span></span><br><span class="line"><span class="comment"> *     qDebug() &lt;&lt; &quot;offset&quot; &lt;&lt; off &lt;&lt; &quot;delay&quot; &lt;&lt; delay;</span></span><br><span class="line"><span class="comment"> *   &#125;);</span></span><br><span class="line"><span class="comment"> *   c-&gt;queryOnce(QHostAddress(&quot;129.6.15.28&quot;)); // time.nist.gov</span></span><br><span class="line"><span class="comment"> *   // æˆ–å‘¨æœŸæŸ¥è¯¢ï¼šc-&gt;startPeriodic(QHostAddress(&quot;...&quot;), 60000);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QtNtpClient</span> : <span class="keyword">public</span> QObject &#123;</span><br><span class="line">  Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">QtNtpClient</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">  ~<span class="built_in">QtNtpClient</span>() <span class="keyword">override</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å•æ¬¡æŸ¥è¯¢ï¼ŒtimeoutMs ä¸º UDP æ¥æ”¶è¶…æ—¶ï¼ˆmsï¼‰</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">queryOnce</span><span class="params">(<span class="type">const</span> QHostAddress &amp;server, quint16 port = <span class="number">123</span>, <span class="type">int</span> timeoutMs = <span class="number">1000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼€/å…³ å‘¨æœŸæŸ¥è¯¢ï¼ˆå‘¨æœŸä»¥æ¯«ç§’è®¡ï¼‰</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">startPeriodic</span><span class="params">(<span class="type">const</span> QHostAddress &amp;server, quint16 port = <span class="number">123</span>, <span class="type">int</span> periodMs = <span class="number">60000</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">stopPeriodic</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// EWMA å¹³æ»‘ç³»æ•° (0,1], é»˜è®¤ 0.2</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">setEwmaAlpha</span><span class="params">(<span class="type">double</span> a)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å½“å‰ä¼°è®¡çš„åç§»ï¼ˆç§’ï¼‰ï¼Œæ­£å€¼è¡¨ç¤º server_time - local_time</span></span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">offsetEstimateSeconds</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›å½“å‰ä¼°è®¡çš„å¾€è¿”å»¶è¿Ÿï¼ˆç§’ï¼‰ï¼Œæœ€åä¸€æ¬¡æµ‹é‡å€¼ï¼ˆéå¹³æ»‘ï¼‰</span></span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">lastDelaySeconds</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–å½“å‰æ ¡æ­£åçš„ UTC æ—¶é—´ï¼ˆç§’ï¼Œå«å°æ•°éƒ¨åˆ†ï¼‰</span></span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">correctedUtcNowSeconds</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å•è°ƒæ—¶é’Ÿï¼ˆæ¯«ç§’ï¼‰æ˜ å°„ä¸ºæ ¡æ­£åçš„ UTC ç§’ã€‚ç”¨äºä»¥å•è°ƒè®¡æ—¶è®°å½•äº‹ä»¶æ—¶é—´ï¼š</span></span><br><span class="line">  <span class="comment">//   mapped = mapMonotonicMsToCorrectedUtc(monoMs);</span></span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">mapMonotonicMsToCorrectedUtc</span><span class="params">(qint64 monotonicMs)</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">  <span class="comment">// å¹³æ»‘åçš„åç§»å€¼ä¸æœ¬æ¬¡æµ‹é‡çš„å¾€è¿”å»¶è¿Ÿï¼ˆsecondsï¼‰</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">offsetUpdated</span><span class="params">(<span class="type">double</span> offsetSeconds, <span class="type">double</span> delaySeconds)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŸ¥è¯¢å¤±è´¥æˆ–è¶…æ—¶æ—¶å‘å‡º</span></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">queryFailed</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">onReadyRead</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">onTimeout</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">onPeriodicTimeout</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  <span class="comment">// helpers</span></span><br><span class="line">  <span class="function"><span class="type">static</span> quint32 <span class="title">toNtpSec</span><span class="params">(<span class="type">double</span> unixSecs)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">static</span> quint32 <span class="title">toNtpFrac</span><span class="params">(<span class="type">double</span> unixSecs)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">double</span> <span class="title">ntpToUnix</span><span class="params">(quint32 sec, quint32 frac)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">double</span> <span class="title">nowWallUtcSeconds</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line">  <span class="function">qint64 <span class="title">nowMonoMs</span><span class="params">()</span> <span class="type">const</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">processResponse</span><span class="params">(<span class="type">const</span> QByteArray &amp;datagram, <span class="type">double</span> t4_wall, qint64 t4_mono)</span></span>;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">recordMappingPoint</span><span class="params">(<span class="type">double</span> wallUtcSec, qint64 monoMs)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">  QUdpSocket *m_sock = <span class="literal">nullptr</span>;</span><br><span class="line">  QTimer m_timeoutTimer;</span><br><span class="line">  QTimer m_periodicTimer;</span><br><span class="line">  QHostAddress m_periodicServer;</span><br><span class="line">  quint16 m_periodicPort = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// reference mapping between monotonic and wall-clock (established at construction and updated on successful sync)</span></span><br><span class="line">  QElapsedTimer m_monoTimer;</span><br><span class="line">  qint64 m_refMonoMs = <span class="number">0</span>;</span><br><span class="line">  <span class="type">double</span> m_refWallUtcSec = <span class="number">0.0</span>; <span class="comment">// seconds since epoch</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// pending request info</span></span><br><span class="line">  <span class="keyword">struct</span> <span class="title class_">Pending</span> &#123;</span><br><span class="line">    <span class="type">double</span> t1_wall = <span class="number">0.0</span>; <span class="comment">// originate timestamp in unix seconds</span></span><br><span class="line">    qint64 t1_mono = <span class="number">0</span>;   <span class="comment">// monotonic ms when sent</span></span><br><span class="line">    <span class="type">bool</span> active = <span class="literal">false</span>;</span><br><span class="line">  &#125; m_pending;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// smoothing &amp; stats</span></span><br><span class="line">  <span class="keyword">mutable</span> QMutex m_mutex;</span><br><span class="line">  <span class="type">double</span> m_offsetEwma = <span class="number">0.0</span>;</span><br><span class="line">  <span class="type">double</span> m_ewmaAlpha = <span class="number">0.2</span>;</span><br><span class="line">  <span class="type">double</span> m_lastDelay = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// constants</span></span><br><span class="line">  <span class="type">static</span> <span class="keyword">constexpr</span> quint32 NTP_DELTA = <span class="number">2208988800u</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="QtNtpClient-ç±»-â€”-å®ç°æ–‡ä»¶-qt-ntp-client-cpp"><a href="#QtNtpClient-ç±»-â€”-å®ç°æ–‡ä»¶-qt-ntp-client-cpp" class="headerlink" title="QtNtpClient ç±» â€” å®ç°æ–‡ä»¶ (qt_ntp_client.cpp)"></a>QtNtpClient ç±» â€” å®ç°æ–‡ä»¶ (qt_ntp_client.cpp)</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;qt_ntp_client.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QDataStream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QtMath&gt;</span></span></span><br><span class="line"></span><br><span class="line">QtNtpClient::<span class="built_in">QtNtpClient</span>(QObject *parent) : <span class="built_in">QObject</span>(parent) &#123;</span><br><span class="line">  m_sock = <span class="keyword">new</span> <span class="built_in">QUdpSocket</span>(<span class="keyword">this</span>);</span><br><span class="line">  <span class="built_in">connect</span>(m_sock, &amp;QUdpSocket::readyRead, <span class="keyword">this</span>, &amp;QtNtpClient::onReadyRead);</span><br><span class="line">  <span class="built_in">connect</span>(&amp;m_timeoutTimer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;QtNtpClient::onTimeout);</span><br><span class="line">  <span class="built_in">connect</span>(&amp;m_periodicTimer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;QtNtpClient::onPeriodicTimeout);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–å•è°ƒ-&gt;å¢™é’Ÿæ˜ å°„</span></span><br><span class="line">  m_monoTimer.<span class="built_in">start</span>();</span><br><span class="line">  m_refMonoMs = m_monoTimer.<span class="built_in">elapsed</span>();</span><br><span class="line">  m_refWallUtcSec = QDateTime::<span class="built_in">currentDateTimeUtc</span>().<span class="built_in">toMSecsSinceEpoch</span>() / <span class="number">1000.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åç§»å€¼ä¸º0</span></span><br><span class="line">  m_offsetEwma = <span class="number">0.0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">QtNtpClient::~<span class="built_in">QtNtpClient</span>() &#123;</span><br><span class="line">  <span class="built_in">stopPeriodic</span>();</span><br><span class="line">  <span class="keyword">if</span> (m_sock) &#123;</span><br><span class="line">    m_sock-&gt;<span class="built_in">close</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::setEwmaAlpha</span><span class="params">(<span class="type">double</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (a &lt;= <span class="number">0.0</span>) a = <span class="number">0.001</span>;</span><br><span class="line">  <span class="keyword">if</span> (a &gt; <span class="number">1.0</span>) a = <span class="number">1.0</span>;</span><br><span class="line">  <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">  m_ewmaAlpha = a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">QtNtpClient::offsetEstimateSeconds</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> m_offsetEwma;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">QtNtpClient::lastDelaySeconds</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> m_lastDelay;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">QtNtpClient::nowWallUtcSeconds</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ä½¿ç”¨æ˜ å°„ä»¥æä¾›æ›´ç¨³å®šçš„ wall-clockï¼ˆåŸºäº monotonic åŸºå‡†ï¼‰</span></span><br><span class="line">  qint64 nowMono = m_monoTimer.<span class="built_in">elapsed</span>();</span><br><span class="line">  <span class="type">double</span> deltaSec = <span class="built_in">double</span>(nowMono - m_refMonoMs) / <span class="number">1000.0</span>;</span><br><span class="line">  <span class="keyword">return</span> m_refWallUtcSec + deltaSec;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">qint64 <span class="title">QtNtpClient::nowMonoMs</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> m_monoTimer.<span class="built_in">elapsed</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::queryOnce</span><span class="params">(<span class="type">const</span> QHostAddress &amp;server, quint16 port, <span class="type">int</span> timeoutMs)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!m_sock) <span class="keyword">return</span>;</span><br><span class="line">  <span class="function">QByteArray <span class="title">pkt</span><span class="params">(<span class="number">48</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">  pkt[<span class="number">0</span>] = <span class="built_in">char</span>((<span class="number">0</span> &lt;&lt; <span class="number">6</span>) | (<span class="number">4</span> &lt;&lt; <span class="number">3</span>) | <span class="number">3</span>); <span class="comment">// LI=0 VN=4 Mode=3 (client)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¡« originate timestamp (bytes 24..31)</span></span><br><span class="line">  <span class="type">double</span> t1 = <span class="built_in">nowWallUtcSeconds</span>();</span><br><span class="line">  quint32 sec = <span class="built_in">toNtpSec</span>(t1);</span><br><span class="line">  quint32 frac = <span class="built_in">toNtpFrac</span>(t1);</span><br><span class="line"></span><br><span class="line">  <span class="function">QDataStream <span class="title">ds</span><span class="params">(&amp;pkt, QIODevice::WriteOnly)</span></span>;</span><br><span class="line">  ds.<span class="built_in">setByteOrder</span>(QDataStream::BigEndian);</span><br><span class="line">  ds.<span class="built_in">device</span>()-&gt;<span class="built_in">seek</span>(<span class="number">24</span>);</span><br><span class="line">  ds &lt;&lt; sec &lt;&lt; frac;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®°å½• pending</span></span><br><span class="line">  m_pending.t1_wall = t1;</span><br><span class="line">  m_pending.t1_mono = <span class="built_in">nowMonoMs</span>();</span><br><span class="line">  m_pending.active = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å‘é€</span></span><br><span class="line">  m_sock-&gt;<span class="built_in">writeDatagram</span>(pkt, server, port);</span><br><span class="line">  m_timeoutTimer.<span class="built_in">start</span>(timeoutMs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::startPeriodic</span><span class="params">(<span class="type">const</span> QHostAddress &amp;server, quint16 port, <span class="type">int</span> periodMs)</span> </span>&#123;</span><br><span class="line">  m_periodicServer = server;</span><br><span class="line">  m_periodicPort = port;</span><br><span class="line">  m_periodicTimer.<span class="built_in">start</span>(periodMs);</span><br><span class="line">  <span class="comment">// ç«‹å³è§¦å‘ä¸€æ¬¡</span></span><br><span class="line">  <span class="built_in">queryOnce</span>(server, port, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::stopPeriodic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  m_periodicTimer.<span class="built_in">stop</span>();</span><br><span class="line">  m_timeoutTimer.<span class="built_in">stop</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::onPeriodicTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!m_periodicServer.<span class="built_in">isNull</span>()) &#123;</span><br><span class="line">    <span class="built_in">queryOnce</span>(m_periodicServer, m_periodicPort, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::onTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  m_timeoutTimer.<span class="built_in">stop</span>();</span><br><span class="line">  m_pending.active = <span class="literal">false</span>;</span><br><span class="line">  <span class="function">emit <span class="title">queryFailed</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::onReadyRead</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (m_sock-&gt;<span class="built_in">hasPendingDatagrams</span>()) &#123;</span><br><span class="line">    QByteArray datagram;</span><br><span class="line">    datagram.<span class="built_in">resize</span>(<span class="built_in">int</span>(m_sock-&gt;<span class="built_in">pendingDatagramSize</span>()));</span><br><span class="line">    QHostAddress from; quint16 port;</span><br><span class="line">    m_sock-&gt;<span class="built_in">readDatagram</span>(datagram.<span class="built_in">data</span>(), datagram.<span class="built_in">size</span>(), &amp;from, &amp;port);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•æ¥æ”¶æ—¶åˆ»</span></span><br><span class="line">    qint64 t4_mono = <span class="built_in">nowMonoMs</span>();</span><br><span class="line">    <span class="type">double</span> t4_wall = <span class="built_in">nowWallUtcSeconds</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">processResponse</span>(datagram, t4_wall, t4_mono);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::processResponse</span><span class="params">(<span class="type">const</span> QByteArray &amp;datagram, <span class="type">double</span> t4_wall, qint64 t4_mono)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (datagram.<span class="built_in">size</span>() &lt; <span class="number">48</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">QDataStream <span class="title">ds</span><span class="params">(datagram)</span></span>;</span><br><span class="line">  ds.<span class="built_in">setByteOrder</span>(QDataStream::BigEndian);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¯»å– originate (24..31), recv (32..39), tx (40..47)</span></span><br><span class="line">  ds.<span class="built_in">device</span>()-&gt;<span class="built_in">seek</span>(<span class="number">24</span>);</span><br><span class="line">  quint32 orig_sec = <span class="number">0</span>, orig_frac = <span class="number">0</span>;</span><br><span class="line">  quint32 recv_sec = <span class="number">0</span>, recv_frac = <span class="number">0</span>;</span><br><span class="line">  quint32 tx_sec = <span class="number">0</span>, tx_frac = <span class="number">0</span>;</span><br><span class="line">  ds &gt;&gt; orig_sec &gt;&gt; orig_frac &gt;&gt; recv_sec &gt;&gt; recv_frac &gt;&gt; tx_sec &gt;&gt; tx_frac;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è½¬ä¸ºä¸»æœºå­—èŠ‚åºå¹¶è½¬æˆ unix ç§’</span></span><br><span class="line">  <span class="type">double</span> T1 = <span class="built_in">ntpToUnix</span>(orig_sec, orig_frac);</span><br><span class="line">  <span class="type">double</span> T2 = <span class="built_in">ntpToUnix</span>(recv_sec, recv_frac);</span><br><span class="line">  <span class="type">double</span> T3 = <span class="built_in">ntpToUnix</span>(tx_sec, tx_frac);</span><br><span class="line">  <span class="type">double</span> T4 = t4_wall;</span><br><span class="line"></span><br><span class="line">  <span class="type">double</span> delay = (T4 - T1) - (T3 - T2);</span><br><span class="line">  <span class="type">double</span> offset = ((T2 - T1) + (T3 - T4)) / <span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">    <span class="comment">// é¦–æ¬¡åˆå§‹åŒ–åç§»ï¼ˆé¿å…åˆå§‹å€¼ 0 å¯¹ EWMA äº§ç”Ÿå¤§è¯¯å·®ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">qIsFinite</span>(m_offsetEwma) &amp;&amp; m_offsetEwma == <span class="number">0.0</span>) &#123;</span><br><span class="line">      m_offsetEwma = offset;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      m_offsetEwma = m_ewmaAlpha * offset + (<span class="number">1.0</span> - m_ewmaAlpha) * m_offsetEwma;</span><br><span class="line">    &#125;</span><br><span class="line">    m_lastDelay = delay;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ›´æ–° monotonic-&gt;wall æ˜ å°„ç‚¹ï¼ˆä½¿ç”¨æ¥æ”¶æ—¶åˆ»ï¼‰</span></span><br><span class="line">  <span class="built_in">recordMappingPoint</span>(T4, t4_mono);</span><br><span class="line"></span><br><span class="line">  m_pending.active = <span class="literal">false</span>;</span><br><span class="line">  m_timeoutTimer.<span class="built_in">stop</span>();</span><br><span class="line">  <span class="function">emit <span class="title">offsetUpdated</span><span class="params">(offsetEstimateSeconds(), lastDelaySeconds())</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">QtNtpClient::recordMappingPoint</span><span class="params">(<span class="type">double</span> wallUtcSec, qint64 monoMs)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// é‡æ–°é”šå®šæ˜ å°„ç‚¹ä»¥å‡å°‘æ¼‚ç§»å½±å“ï¼ˆé‡‡ç”¨ç®€å•çš„ç§»åŠ¨å¹³å‡ï¼‰</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œæˆ‘ä»¬ç›´æ¥æ›¿æ¢å‚è€ƒç‚¹ä¸ºæœ€æ–°æµ‹é‡æ—¶åˆ»ä»¥ä¾¿åç»­æ˜ å°„æ›´ç²¾ç¡®</span></span><br><span class="line">  <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">  m_refWallUtcSec = wallUtcSec;</span><br><span class="line">  m_refMonoMs = monoMs;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">QtNtpClient::correctedUtcNowSeconds</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="type">double</span> local = QDateTime::<span class="built_in">currentDateTimeUtc</span>().<span class="built_in">toMSecsSinceEpoch</span>() / <span class="number">1000.0</span>;</span><br><span class="line">  <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> local + m_offsetEwma;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">QtNtpClient::mapMonotonicMsToCorrectedUtc</span><span class="params">(qint64 monotonicMs)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">  <span class="function">QMutexLocker <span class="title">locker</span><span class="params">(&amp;m_mutex)</span></span>;</span><br><span class="line">  <span class="type">double</span> deltaSec = <span class="built_in">double</span>(monotonicMs - m_refMonoMs) / <span class="number">1000.0</span>;</span><br><span class="line">  <span class="type">double</span> wall = m_refWallUtcSec + deltaSec;</span><br><span class="line">  <span class="keyword">return</span> wall + m_offsetEwma;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NTP helpers</span></span><br><span class="line"><span class="function">quint32 <span class="title">QtNtpClient::toNtpSec</span><span class="params">(<span class="type">double</span> unixSecs)</span> </span>&#123;</span><br><span class="line">  <span class="type">double</span> s = unixSecs + <span class="built_in">double</span>(NTP_DELTA);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">quint32</span>(std::<span class="built_in">floor</span>(s));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">quint32 <span class="title">QtNtpClient::toNtpFrac</span><span class="params">(<span class="type">double</span> unixSecs)</span> </span>&#123;</span><br><span class="line">  <span class="type">double</span> s = unixSecs + <span class="built_in">double</span>(NTP_DELTA);</span><br><span class="line">  <span class="type">double</span> frac = s - std::<span class="built_in">floor</span>(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">quint32</span>(frac * <span class="number">0x100000000ULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">QtNtpClient::ntpToUnix</span><span class="params">(quint32 sec, quint32 frac)</span> </span>&#123;</span><br><span class="line">  <span class="type">double</span> s = <span class="built_in">double</span>(sec) - <span class="built_in">double</span>(NTP_DELTA) + <span class="built_in">double</span>(frac) / <span class="built_in">double</span>(<span class="number">0x100000000ULL</span>);</span><br><span class="line">  <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="è¯´æ˜ä¸ä½¿ç”¨å»ºè®®"><a href="#è¯´æ˜ä¸ä½¿ç”¨å»ºè®®" class="headerlink" title="è¯´æ˜ä¸ä½¿ç”¨å»ºè®®"></a>è¯´æ˜ä¸ä½¿ç”¨å»ºè®®</h3><ul>
<li><p>è¯¥å®ç°:</p>
<ul>
<li>å®Œæ•´ä»¥ç±»å½¢å¼å°è£…ï¼Œæ— éœ€æ”¹å˜ç³»ç»Ÿæ—¶é—´ï¼Œä»…åœ¨åº”ç”¨å±‚ç»´æŠ¤åç§»ä¼°è®¡ã€‚</li>
<li>ä½¿ç”¨ QUdpSocket éé˜»å¡å¼‚æ­¥ I&#x2F;Oï¼Œé€‚åˆ GUI æˆ–æœåŠ¡ç¨‹åºã€‚</li>
<li>æä¾›å‘¨æœŸæŸ¥è¯¢å’Œå•æ¬¡æŸ¥è¯¢æ¥å£ï¼Œå¹¶é€šè¿‡ä¿¡å·ä¸ŠæŠ¥ç»“æœæˆ–å¤±è´¥ã€‚</li>
</ul>
</li>
<li><p>ç²¾åº¦ä¸é²æ£’æ€§å»ºè®®:</p>
<ul>
<li>åœ¨çœŸå®ç½‘ç»œä¸­å»ºè®®å¤šæ¬¡é‡‡æ ·å¹¶è¿‡æ»¤é«˜å»¶è¿Ÿæ ·æœ¬ï¼Œå†ç”¨åŠ æƒæˆ–ä¸­ä½æ•°é€‰å–æœ€ç»ˆåç§»ã€‚</li>
<li>å¯ä»¥åœ¨ processResponse ä¸­æ”¶é›†å¤šæ¬¡æ ·æœ¬ç„¶åé€‰æœ€å° delay çš„ offset æˆ–ç”¨æƒé‡ 1&#x2F;delay åšåŠ æƒå¹³å‡ã€‚</li>
<li>å¯¹åç§»ä½¿ç”¨æ›´ç¨³å¥çš„æ»¤æ³¢å™¨ï¼ˆKalmanã€æ»‘åŠ¨ä¸­ä½æ•°æˆ–æ›´å¤æ‚çš„æ—¶é’Ÿè·Ÿè¸ªå™¨ï¼‰èƒ½æå‡é•¿æœŸç¨³å®šæ€§ã€‚</li>
<li>è‹¥éœ€è¦æ›´é«˜ç²¾åº¦ï¼ˆLAN å¾®ç§’çº§ï¼‰ï¼Œè€ƒè™‘ä½¿ç”¨ PTP æˆ–ç¡¬ä»¶æ—¶é—´æˆ³ã€‚</li>
</ul>
</li>
<li><p>å•è°ƒæ—¶é’Ÿæ˜ å°„:</p>
<ul>
<li>ä¸ºé¿å…ç³»ç»Ÿæ—¶é—´è·³å˜å½±å“äº‹ä»¶è®¡æ—¶ï¼Œå»ºè®®ç”¨ mapMonotonicMsToCorrectedUtc å°†å•è°ƒæ—¶é’Ÿæ—¶é—´æ˜ å°„åˆ°æ ¡æ­£å¢™é’Ÿå†åŠ åç§»ã€‚</li>
<li>recordMappingPoint åœ¨æˆåŠŸåŒæ­¥æ—¶é‡æ–°é”šå®šå‚è€ƒç‚¹ï¼Œå‡å°‘æ˜ å°„è¯¯å·®ã€‚</li>
</ul>
</li>
<li><p>æƒé™:</p>
<ul>
<li>æœ¬ç±»ä¸ä¼šè°ƒç”¨ settimeofday æˆ– adjtimeï¼Œä¸éœ€è¦ root æƒé™ã€‚è‹¥éœ€è¦ä¿®æ”¹ç³»ç»Ÿæ—¶é’Ÿï¼Œè¯·äº¤ç”±ç³»ç»ŸæœåŠ¡ï¼ˆchrony&#x2F;ntpdï¼‰æˆ–è°¨æ…ä½¿ç”¨ç‰¹æƒç³»ç»Ÿè°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<p>æœ¬ç±»å¯ä»¥æ‰©å±•ä¸ºï¼šå¤šæœåŠ¡å™¨å¹¶è¡ŒæŸ¥è¯¢ã€å»¶è¿Ÿ&#x2F;åç§»æ ·æœ¬ç¼“å†²ä¸é€‰æ‹©ç­–ç•¥ã€æˆ–åŠ å…¥ Kalman æ»¤æ³¢å™¨</p>
]]></content>
  </entry>
</search>
